!function(){function getListener(a,c,h){var g;return c=c.toLowerCase(),(g=a.__allListeners||h&&(a.__allListeners={}))&&(g[c]||h&&(g[c]=[]))}function getDomNode(a,c,h,g,v,b){var y,C=g&&a[c];for(!C&&(C=a[h]);!C&&(y=(y||a).parentNode);){if("BODY"==y.tagName||b&&!b(y))return null;C=y[h]}return C&&v&&!v(C)?getDomNode(C,c,h,!1,v):C}UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu,window.UE=baidu.editor=window.UE||{},UE.plugins={},UE.commands={},UE.instants={},UE.I18N={},UE._customizeUI={},UE.version="1.4.3";var dom=UE.dom={},browser=UE.browser=function(){var a=navigator.userAgent.toLowerCase(),c=window.opera,h={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(a),opera:!!c&&c.version,webkit:a.indexOf(" applewebkit/")>-1,mac:a.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};h.gecko="Gecko"==navigator.product&&!h.webkit&&!h.opera&&!h.ie;var g=0;if(h.ie){var v=a.match(/(?:msie\s([\w.]+))/),b=a.match(/(?:trident.*rv:([\w.]+))/);g=v&&b&&v[1]&&b[1]?Math.max(1*v[1],1*b[1]):v&&v[1]?1*v[1]:b&&b[1]?1*b[1]:0,h.ie11Compat=11==document.documentMode,h.ie9Compat=9==document.documentMode,h.ie8=!!document.documentMode,h.ie8Compat=8==document.documentMode,h.ie7Compat=7==g&&!document.documentMode||7==document.documentMode,h.ie6Compat=7>g||h.quirks,h.ie9above=g>8,h.ie9below=9>g,h.ie11above=g>10,h.ie11below=11>g}if(h.gecko){var y=a.match(/rv:([\d\.]+)/);y&&(y=y[1].split("."),g=1e4*y[0]+100*(y[1]||0)+1*(y[2]||0))}return/chrome\/(\d+\.\d)/i.test(a)&&(h.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(a)&&!/chrome/i.test(a)&&(h.safari=+(RegExp.$1||RegExp.$2)),h.opera&&(g=parseFloat(c.version())),h.webkit&&(g=parseFloat(a.match(/ applewebkit\/(\d+)/)[1])),h.version=g,h.isCompatible=!h.mobile&&(h.ie&&g>=6||h.gecko&&g>=10801||h.opera&&g>=9.5||h.air&&g>=1||h.webkit&&g>=522||!1),h}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UE.utils={each:function(a,c,h){if(null!=a)if(a.length===+a.length){for(var i=0,l=a.length;l>i;i++)if(c.call(h,a[i],i,a)===!1)return!1}else for(var g in a)if(a.hasOwnProperty(g)&&c.call(h,a[g],g,a)===!1)return!1},makeInstance:function(a){var c=new Function;return c.prototype=a,a=new c,c.prototype=null,a},extend:function(t,s,a){if(s)for(var c in s)a&&t.hasOwnProperty(c)||(t[c]=s[c]);return t},extend2:function(t){for(var a=arguments,i=1;i<a.length;i++){var x=a[i];for(var c in x)t.hasOwnProperty(c)||(t[c]=x[c])}return t},inherits:function(a,c){var h=a.prototype,g=utils.makeInstance(c.prototype);return utils.extend(g,h,!0),a.prototype=g,g.constructor=a},bind:function(a,c){return function(){return a.apply(c,arguments)}},defer:function(a,c,h){var g;return function(){h&&clearTimeout(g),g=setTimeout(a,c)}},indexOf:function(a,c,h){var g=-1;return h=this.isNumber(h)?h:0,this.each(a,function(a,i){return i>=h&&a===c?(g=i,!1):void 0}),g},removeItem:function(a,c){for(var i=0,l=a.length;l>i;i++)a[i]===c&&(a.splice(i,1),i--)},trim:function(a){return a.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(a){if(!a)return{};a=utils.isArray(a)?a:a.split(",");for(var c,i=0,h={};c=a[i++];)h[c.toUpperCase()]=h[c]=1;return h},unhtml:function(a,c){return a?a.replace(c||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(a,c){return c?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""},html:function(a){return a?a.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[m]}):""},cssStyleToDomStyle:function(){var a=document.createElement("div").style,c={"float":void 0!=a.cssFloat?"cssFloat":void 0!=a.styleFloat?"styleFloat":"float"};return function(a){return c[a]||(c[a]=a.toLowerCase().replace(/-./g,function(a){return a.charAt(1).toUpperCase()}))}}(),loadFile:function(){function a(a,h){try{for(var g,i=0;g=c[i++];)if(g.doc===a&&g.url==(h.src||h.href))return g}catch(e){return null}}var c=[];return function(h,g,v){var b=a(h,g);if(b)return void(b.ready?v&&v():b.funs.push(v));if(c.push({doc:h,url:g.src||g.href,funs:[v]}),!h.body){var y=[];for(var p in g)"tag"!=p&&y.push(p+'="'+g[p]+'"');return void h.write("<"+g.tag+" "+y.join(" ")+" ></"+g.tag+">")}if(!g.id||!h.getElementById(g.id)){var C=h.createElement(g.tag);delete g.tag;for(var p in g)C.setAttribute(p,g[p]);C.onload=C.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(b=a(h,g),b.funs.length>0){b.ready=1;for(var fi;fi=b.funs.pop();)fi()}C.onload=C.onreadystatechange=null}},C.onerror=function(){throw Error("The load "+(g.href||g.src)+" fails,check the url settings of file ueditor.config.js ")},h.getElementsByTagName("head")[0].appendChild(C)}}}(),isEmptyObject:function(a){if(null==a)return!0;if(this.isArray(a)||this.isString(a))return 0===a.length;for(var c in a)if(a.hasOwnProperty(c))return!1;return!0},fixColor:function(a,c){if(/color/i.test(a)&&/rgba?/.test(c)){var h=c.split(",");if(h.length>3)return"";c="#";for(var g,i=0;g=h[i++];)g=parseInt(g.replace(/[^\d]/gi,""),10).toString(16),c+=1==g.length?"0"+g:g;c=c.toUpperCase()}return c},optCss:function(a){function c(a,c){if(!a)return"";var t=a.top,h=a.bottom,l=a.left,r=a.right,g="";if(t&&l&&h&&r)g+=";"+c+":"+(t==h&&h==l&&l==r?t:t==h&&l==r?t+" "+l:l==r?t+" "+l+" "+h:t+" "+r+" "+h+" "+l)+";";else for(var p in a)g+=";"+c+"-"+p+":"+a[p]+";";return g}var h,g;return a=a.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(a,c,v,b){if(1==b.split(" ").length)switch(c){case"padding":return!h&&(h={}),h[v]=b,"";case"margin":return!g&&(g={}),g[v]=b,"";case"border":return"initial"==b?"":a}return a}),a+=c(h,"padding")+c(g,"margin"),a.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,c){return c?c+";;":";"})},clone:function(a,c){var h;c=c||{};for(var i in a)a.hasOwnProperty(i)&&(h=a[i],"object"==typeof h?(c[i]=utils.isArray(h)?[]:{},utils.clone(a[i],c[i])):c[i]=h);return c},transUnitToPx:function(a){if(!/(pt|cm)/.test(a))return a;var c;switch(a.replace(/([\d.]+)(\w+)/,function(h,g,u){a=g,c=u}),c){case"cm":a=25*parseFloat(a);break;case"pt":a=Math.round(96*parseFloat(a)/72)}return a+(a?"px":"")},domReady:function(){function a(a){a.isReady=!0;for(var h;h=c.pop();h());}var c=[];return function(h,g){g=g||window;var v=g.document;h&&c.push(h),"complete"===v.readyState?a(v):(v.isReady&&a(v),browser.ie&&11!=browser.version?(!function(){if(!v.isReady){try{v.documentElement.doScroll("left")}catch(c){return void setTimeout(arguments.callee,0)}a(v)}}(),g.attachEvent("onload",function(){a(v)})):(v.addEventListener("DOMContentLoaded",function(){v.removeEventListener("DOMContentLoaded",arguments.callee,!1),a(v)},!1),g.addEventListener("load",function(){a(v)},!1)))}}(),cssRule:browser.ie&&11!=browser.version?function(a,c,h){var g,v;return void 0===c||c&&c.nodeType&&9==c.nodeType?(h=c&&c.nodeType&&9==c.nodeType?c:h||document,g=h.indexList||(h.indexList={}),v=g[a],void 0!==v?h.styleSheets[v].cssText:void 0):(h=h||document,g=h.indexList||(h.indexList={}),v=g[a],""===c?void 0!==v?(h.styleSheets[v].cssText="",delete g[a],!0):!1:(void 0!==v?sheetStyle=h.styleSheets[v]:(sheetStyle=h.createStyleSheet("",v=h.styleSheets.length),g[a]=v),void(sheetStyle.cssText=c)))}:function(a,c,h){var g;return void 0===c||c&&c.nodeType&&9==c.nodeType?(h=c&&c.nodeType&&9==c.nodeType?c:h||document,g=h.getElementById(a),g?g.innerHTML:void 0):(h=h||document,g=h.getElementById(a),""===c?g?(g.parentNode.removeChild(g),!0):!1:void(g?g.innerHTML=c:(g=h.createElement("style"),g.id=a,g.innerHTML=c,h.getElementsByTagName("head")[0].appendChild(g))))},sort:function(a,c){c=c||function(a,c){return a.localeCompare(c)};for(var i=0,h=a.length;h>i;i++)for(var g=i,v=a.length;v>g;g++)if(c(a[i],a[g])>0){var t=a[i];a[i]=a[g],a[g]=t}return a},serializeParam:function(a){var c=[];for(var i in a)if("method"!=i&&"timeout"!=i&&"async"!=i)if("function"!=(typeof a[i]).toLowerCase()&&"object"!=(typeof a[i]).toLowerCase())c.push(encodeURIComponent(i)+"="+encodeURIComponent(a[i]));else if(utils.isArray(a[i]))for(var h=0;h<a[i].length;h++)c.push(encodeURIComponent(i)+"[]="+encodeURIComponent(a[i][h]));return c.join("&")},formatUrl:function(a){var u=a.replace(/&&/g,"&");return u=u.replace(/\?&/g,"?"),u=u.replace(/&$/g,""),u=u.replace(/&#/g,"#"),u=u.replace(/&+/g,"&")},isCrossDomainUrl:function(a){var c=document.createElement("a");return c.href=a,browser.ie&&(c.href=c.href),!(c.protocol==location.protocol&&c.hostname==location.hostname&&(c.port==location.port||"80"==c.port&&""==location.port||""==c.port&&"80"==location.port))},clearEmptyAttrs:function(a){for(var p in a)""===a[p]&&delete a[p];return a},str2json:function(s){return utils.isString(s)?window.JSON?JSON.parse(s):new Function("return "+utils.trim(s||""))():null},json2str:function(){function a(a){return/["\\\x00-\x1f]/.test(a)&&(a=a.replace(/["\\\x00-\x1f]/g,function(a){var c=v[a];return c?c:(c=a.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})),'"'+a+'"'}function c(a){var c,i,h,g=["["],l=a.length;for(i=0;l>i;i++)switch(h=a[i],typeof h){case"undefined":case"function":case"unknown":break;default:c&&g.push(","),g.push(utils.json2str(h)),c=1}return g.push("]"),g.join("")}function h(a){return 10>a?"0"+a:a}function g(a){return'"'+a.getFullYear()+"-"+h(a.getMonth()+1)+"-"+h(a.getDate())+"T"+h(a.getHours())+":"+h(a.getMinutes())+":"+h(a.getSeconds())+'"'}if(window.JSON)return JSON.stringify;var v={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(h){switch(typeof h){case"undefined":return"undefined";case"number":return isFinite(h)?String(h):"null";case"string":return a(h);case"boolean":return String(h);default:if(null===h)return"null";if(utils.isArray(h))return c(h);if(utils.isDate(h))return g(h);var v,b,y=["{"],C=utils.json2str;for(var N in h)if(Object.prototype.hasOwnProperty.call(h,N))switch(b=h[N],typeof b){case"undefined":case"unknown":case"function":break;default:v&&y.push(","),v=1,y.push(C(N)+":"+C(b))}return y.push("}"),y.join("")}}}()};utils.each(["String","Function","Array","Number","RegExp","Object","Date"],function(a){UE.utils["is"+a]=function(c){return Object.prototype.toString.apply(c)=="[object "+a+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(a,c){a=utils.trim(a).split(/\s+/);for(var h,i=0;h=a[i++];)getListener(this,h,!0).push(c)},on:function(a,c){return this.addListener(a,c)},off:function(a,c){return this.removeListener(a,c)},trigger:function(){return this.fireEvent.apply(this,arguments)},removeListener:function(a,c){a=utils.trim(a).split(/\s+/);for(var h,i=0;h=a[i++];)utils.removeItem(getListener(this,h)||[],c)},fireEvent:function(){var a=arguments[0];a=utils.trim(a).split(" ");for(var c,i=0;c=a[i++];){var r,t,h,g=getListener(this,c);if(g)for(h=g.length;h--;)if(g[h]){if(t=g[h].apply(this,arguments),t===!0)return t;void 0!==t&&(r=t)}(t=this["on"+c.toLowerCase()])&&(r=t.apply(this,arguments))}return r}};var dtd=dom.dtd=function(){function a(s){for(var a in s)s[a.toUpperCase()]=s[a];return s}var c=utils.extend2,h=a({isindex:1,fieldset:1}),g=a({input:1,button:1,select:1,textarea:1,label:1}),v=c(a({a:1}),g),b=c({iframe:1},v),y=a({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),C=a({ins:1,del:1,script:1,style:1}),N=c(a({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),C),w=c(a({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),N),U=c(a({p:1}),w),E=c(a({iframe:1}),w,g),T=a({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),S=c(a({a:0}),E),k=a({tr:1}),B=a({"#":1}),I=c(a({param:1}),T),_=c(a({form:1}),h,b,y,U),A=a({li:1,ol:1,ul:1}),L=a({style:1,script:1}),R=a({base:1,link:1,meta:1,title:1}),D=c(R,L),O=a({head:1,body:1}),P=a({html:1}),M=a({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),H=a({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return a({$nonBodyContent:c(P,O,R),$block:M,$inline:S,$inlineWithA:c(a({a:1}),S),$body:c(a({script:1,style:1}),M),$cdata:a({script:1,style:1}),$empty:H,$nonChild:a({iframe:1,textarea:1}),$listItem:a({dd:1,dt:1,li:1}),$list:a({ul:1,ol:1,dl:1}),$isNotEmpty:a({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:a({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:a({p:1,div:1}),$tableContent:a({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:a({pre:1,script:1,style:1,textarea:1}),html:O,head:D,style:B,script:B,body:_,base:{},link:{},meta:{},title:B,col:{},tr:a({td:1,th:1}),img:{},embed:{},colgroup:a({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:_,td:_,br:{},th:_,center:_,kbd:S,button:c(U,y),basefont:{},h5:S,h4:S,samp:S,h6:S,ol:A,h1:S,h3:S,option:B,h2:S,form:c(h,b,y,U),select:a({optgroup:1,option:1}),font:S,ins:S,menu:A,abbr:S,label:S,table:a({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:S,tfoot:k,cite:S,li:_,input:{},iframe:_,strong:S,textarea:B,noframes:_,big:S,small:S,span:a({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:S,dt:S,sub:S,optgroup:a({option:1}),param:{},bdo:S,"var":S,div:_,object:I,sup:S,dd:_,strike:S,area:{},dir:A,map:c(a({area:1,form:1,p:1}),h,C,y),applet:I,dl:a({dt:1,dd:1}),del:S,isindex:{},fieldset:c(a({legend:1}),T),thead:k,ul:A,acronym:S,b:S,a:c(a({a:1}),E),blockquote:c(a({td:1,tr:1,tbody:1,li:1}),_),caption:S,i:S,u:S,tbody:k,s:S,address:c(b,U),tt:S,legend:S,q:S,pre:c(N,v),p:c(a({a:1}),S),em:S,dfn:S})}(),attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(a,c){if(a===c)return 0;var h,g=[a],v=[c];for(h=a;h=h.parentNode;){if(h===c)return 10;g.push(h)}for(h=c;h=h.parentNode;){if(h===a)return 20;v.push(h)}if(g.reverse(),v.reverse(),g[0]!==v[0])return 1;for(var i=-1;i++,g[i]===v[i];);for(a=g[i],c=v[i];a=a.nextSibling;)if(a===c)return 4;return 2},getNodeIndex:function(a,c){for(var h=a,i=0;h=h.previousSibling;)c&&3==h.nodeType?h.nodeType!=h.nextSibling.nodeType&&i++:i++;return i},inDoc:function(a,c){return 10==domUtils.getPosition(a,c)},findParent:function(a,c,h){if(a&&!domUtils.isBody(a))for(a=h?a:a.parentNode;a;){if(!c||c(a)||domUtils.isBody(a))return c&&!c(a)&&domUtils.isBody(a)?null:a;a=a.parentNode}return null},findParentByTagName:function(a,c,h,g){return c=utils.listToMap(utils.isArray(c)?c:[c]),domUtils.findParent(a,function(a){return c[a.tagName]&&!(g&&g(a))},h)},findParents:function(a,c,h,g){for(var v=c&&(h&&h(a)||!h)?[a]:[];a=domUtils.findParent(a,h);)v.push(a);return g?v:v.reverse()},insertAfter:function(a,c){return a.nextSibling?a.parentNode.insertBefore(c,a.nextSibling):a.parentNode.appendChild(c)},remove:function(a,c){var h,g=a.parentNode;if(g){if(c&&a.hasChildNodes())for(;h=a.firstChild;)g.insertBefore(h,a);g.removeChild(a)}return a},getNextDomNode:function(a,c,h,g){return getDomNode(a,"firstChild","nextSibling",c,h,g)},getPreDomNode:function(a,c,h,g){return getDomNode(a,"lastChild","previousSibling",c,h,g)},isBookmarkNode:function(a){return 1==a.nodeType&&a.id&&/^_baidu_bookmark_/i.test(a.id)},getWindow:function(a){var c=a.ownerDocument||a;return c.defaultView||c.parentWindow},getCommonAncestor:function(a,c){if(a===c)return a;for(var h=[a],g=[c],v=a,i=-1;v=v.parentNode;){if(v===c)return v;h.push(v)}for(v=c;v=v.parentNode;){if(v===a)return v;g.push(v)}for(h.reverse(),g.reverse();i++,h[i]===g[i];);return 0==i?null:h[i-1]},clearEmptySibling:function(a,c,h){function g(a,c){for(var h;a&&!domUtils.isBookmarkNode(a)&&(domUtils.isEmptyInlineElement(a)||!new RegExp("[^	\n\r"+domUtils.fillChar+"]").test(a.nodeValue));)h=a[c],domUtils.remove(a),a=h}!c&&g(a.nextSibling,"nextSibling"),!h&&g(a.previousSibling,"previousSibling")},split:function(a,c){var h=a.ownerDocument;if(browser.ie&&c==a.nodeValue.length){var g=h.createTextNode("");return domUtils.insertAfter(a,g)}var v=a.splitText(c);if(browser.ie8){var b=h.createTextNode("");domUtils.insertAfter(v,b),domUtils.remove(b)}return v},isWhitespace:function(a){return!new RegExp("[^ 	\n\r"+domUtils.fillChar+"]").test(a.nodeValue)},getXY:function(a){for(var x=0,c=0;a.offsetParent;)c+=a.offsetTop,x+=a.offsetLeft,a=a.offsetParent;return{x:x,y:c}},on:function(a,c,h){var g=utils.isArray(c)?c:utils.trim(c).split(/\s+/),v=g.length;if(v)for(;v--;)if(c=g[v],a.addEventListener)a.addEventListener(c,h,!1);else{h._d||(h._d={els:[]});var b=c+h.toString(),y=utils.indexOf(h._d.els,a);h._d[b]&&-1!=y||(-1==y&&h._d.els.push(a),h._d[b]||(h._d[b]=function(a){return h.call(a.srcElement,a||window.event)}),a.attachEvent("on"+c,h._d[b]))}a=null},un:function(a,c,h){var g=utils.isArray(c)?c:utils.trim(c).split(/\s+/),v=g.length;if(v)for(;v--;)if(c=g[v],a.removeEventListener)a.removeEventListener(c,h,!1);else{var b=c+h.toString();try{a.detachEvent("on"+c,h._d?h._d[b]:h)}catch(e){}if(h._d&&h._d[b]){var y=utils.indexOf(h._d.els,a);-1!=y&&h._d.els.splice(y,1),0==h._d.els.length&&delete h._d[b]}}},isSameElement:function(a,c){if(a.tagName!=c.tagName)return!1;var h=a.attributes,g=c.attributes;if(!ie&&h.length!=g.length)return!1;for(var v,b,y=0,C=0,i=0;v=h[i++];){if("style"==v.nodeName){if(v.specified&&y++,domUtils.isSameStyle(a,c))continue;return!1}if(ie){if(!v.specified)continue;y++,b=g.getNamedItem(v.nodeName)}else b=c.attributes[v.nodeName];if(!b.specified||v.nodeValue!=b.nodeValue)return!1}if(ie){for(i=0;b=g[i++];)b.specified&&C++;if(y!=C)return!1}return!0},isSameStyle:function(a,c){var h=a.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),g=c.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){if(h=a.style,g=c.style,h.length!=g.length)return!1;for(var p in h)if(!/^(\d+|csstext)$/i.test(p)&&h[p]!=g[p])return!1;return!0}if(!h||!g)return h==g;if(h=h.split(";"),g=g.split(";"),h.length!=g.length)return!1;for(var v,i=0;v=h[i++];)if(-1==utils.indexOf(g,v))return!1;return!0},isBlockElm:function(a){return 1==a.nodeType&&(dtd.$block[a.tagName]||styleBlock[domUtils.getComputedStyle(a,"display")])&&!dtd.$nonChild[a.tagName]},isBody:function(a){return a&&1==a.nodeType&&"body"==a.tagName.toLowerCase()},breakParent:function(a,c){var h,g,v,b=a,y=a;do{for(b=b.parentNode,g?(h=b.cloneNode(!1),h.appendChild(g),g=h,h=b.cloneNode(!1),h.appendChild(v),v=h):(g=b.cloneNode(!1),v=g.cloneNode(!1));h=y.previousSibling;)g.insertBefore(h,g.firstChild);for(;h=y.nextSibling;)v.appendChild(h);y=b}while(c!==b);return h=c.parentNode,h.insertBefore(g,c),h.insertBefore(v,c),h.insertBefore(a,v),domUtils.remove(c),a},isEmptyInlineElement:function(a){if(1!=a.nodeType||!dtd.$removeEmpty[a.tagName])return 0;for(a=a.firstChild;a;){if(domUtils.isBookmarkNode(a))return 0;if(1==a.nodeType&&!domUtils.isEmptyInlineElement(a)||3==a.nodeType&&!domUtils.isWhitespace(a))return 0;a=a.nextSibling}return 1},trimWhiteTextNode:function(a){function c(c){for(var h;(h=a[c])&&3==h.nodeType&&domUtils.isWhitespace(h);)a.removeChild(h)}c("firstChild"),c("lastChild")},mergeChild:function(a,c,h){for(var g,v=domUtils.getElementsByTagName(a,a.tagName.toLowerCase()),i=0;g=v[i++];)if(g.parentNode&&!domUtils.isBookmarkNode(g))if("span"!=g.tagName.toLowerCase())domUtils.isSameElement(a,g)&&domUtils.remove(g,!0);else{if(a===g.parentNode&&(domUtils.trimWhiteTextNode(a),1==a.childNodes.length)){a.style.cssText=g.style.cssText+";"+a.style.cssText,domUtils.remove(g,!0);continue}if(g.style.cssText=a.style.cssText+";"+g.style.cssText,h){var b=h.style;if(b){b=b.split(";");for(var s,y=0;s=b[y++];)g.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}domUtils.isSameStyle(g,a)&&domUtils.remove(g,!0)}},getElementsByTagName:function(a,c,h){if(h&&utils.isString(h)){var g=h;h=function(a){return domUtils.hasClass(a,g)}}c=utils.trim(c).replace(/[ ]{2,}/g," ").split(" ");for(var v,b=[],n=0;v=c[n++];)for(var y,C=a.getElementsByTagName(v),i=0;y=C[i++];)(!h||h(y))&&b.push(y);return b},mergeToParent:function(a){for(var c=a.parentNode;c&&dtd.$removeEmpty[c.tagName];){if(c.tagName==a.tagName||"A"==c.tagName){if(domUtils.trimWhiteTextNode(c),"SPAN"==c.tagName&&!domUtils.isSameStyle(c,a)||"A"==c.tagName&&"SPAN"==a.tagName){if(c.childNodes.length>1||c!==a.parentNode){a.style.cssText=c.style.cssText+";"+a.style.cssText,c=c.parentNode;continue}c.style.cssText+=";"+a.style.cssText,"A"==c.tagName&&(c.style.textDecoration="underline")}if("A"!=c.tagName){c===a.parentNode&&domUtils.remove(a,!0);break}}c=c.parentNode}},mergeSibling:function(a,c,h){function g(a,c,h){var g;if((g=h[a])&&!domUtils.isBookmarkNode(g)&&1==g.nodeType&&domUtils.isSameElement(h,g)){for(;g.firstChild;)"firstChild"==c?h.insertBefore(g.lastChild,h.firstChild):h.appendChild(g.firstChild);domUtils.remove(g)}}!c&&g("previousSibling","firstChild",a),!h&&g("nextSibling","lastChild",a)},unSelectable:ie&&browser.ie9below||browser.opera?function(a){a.onselectstart=function(){return!1},a.onclick=a.onkeyup=a.onkeydown=function(){return!1},a.unselectable="on",a.setAttribute("unselectable","on");for(var c,i=0;c=a.all[i++];)switch(c.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:c.unselectable="on",a.setAttribute("unselectable","on")}}:function(a){a.style.MozUserSelect=a.style.webkitUserSelect=a.style.msUserSelect=a.style.KhtmlUserSelect="none"},removeAttributes:function(a,c){c=utils.isArray(c)?c:utils.trim(c).replace(/[ ]{2,}/g," ").split(" ");for(var h,i=0;h=c[i++];){switch(h=attrFix[h]||h){case"className":a[h]="";break;case"style":a.style.cssText="";var g=a.getAttributeNode("style");!browser.ie&&g&&a.removeAttributeNode(g)}a.removeAttribute(h)}},createElement:function(a,c,h){return domUtils.setAttributes(a.createElement(c),h)},setAttributes:function(a,c){for(var h in c)if(c.hasOwnProperty(h)){var g=c[h];switch(h){case"class":a.className=g;break;case"style":a.style.cssText=a.style.cssText+";"+g;break;case"innerHTML":a[h]=g;break;case"value":a.value=g;break;default:a.setAttribute(attrFix[h]||h,g)}}return a},getComputedStyle:function(a,c){var h="width height top left";if(h.indexOf(c)>-1)return a["offset"+c.replace(/^\w/,function(s){return s.toUpperCase()})]+"px";if(3==a.nodeType&&(a=a.parentNode),browser.ie&&browser.version<9&&"font-size"==c&&!a.style.fontSize&&!dtd.$empty[a.tagName]&&!dtd.$nonChild[a.tagName]){var g=a.ownerDocument.createElement("span");g.style.cssText="padding:0;border:0;font-family:simsun;",g.innerHTML=".",a.appendChild(g);var v=g.offsetHeight;return a.removeChild(g),g=null,v+"px"}try{var b=domUtils.getStyle(a,c)||(window.getComputedStyle?domUtils.getWindow(a).getComputedStyle(a,"").getPropertyValue(c):(a.currentStyle||a.style)[utils.cssStyleToDomStyle(c)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(c,b))},removeClasses:function(a,c){c=utils.isArray(c)?c:utils.trim(c).replace(/[ ]{2,}/g," ").split(" ");for(var h,i=0,g=a.className;h=c[i++];)g=g.replace(new RegExp("\\b"+h+"\\b"),"");g=utils.trim(g).replace(/[ ]{2,}/g," "),g?a.className=g:domUtils.removeAttributes(a,["class"])},addClass:function(a,c){if(a){c=utils.trim(c).replace(/[ ]{2,}/g," ").split(" ");for(var h,i=0,g=a.className;h=c[i++];)new RegExp("\\b"+h+"\\b").test(g)||(g+=" "+h);a.className=utils.trim(g)}},hasClass:function(a,c){if(utils.isRegExp(c))return c.test(a.className);c=utils.trim(c).replace(/[ ]{2,}/g," ").split(" ");for(var h,i=0,g=a.className;h=c[i++];)if(!new RegExp("\\b"+h+"\\b","i").test(g))return!1;return i-1==c.length},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},removeStyle:function(a,c){browser.ie?("color"==c&&(c="(^|;)"+c),a.style.cssText=a.style.cssText.replace(new RegExp(c+"[^:]*:[^;]+;?","ig"),"")):a.style.removeProperty?a.style.removeProperty(c):a.style.removeAttribute(utils.cssStyleToDomStyle(c)),a.style.cssText||domUtils.removeAttributes(a,["style"])},getStyle:function(a,c){var h=a.style[utils.cssStyleToDomStyle(c)];return utils.fixColor(c,h)},setStyle:function(a,c,h){a.style[utils.cssStyleToDomStyle(c)]=h,utils.trim(a.style.cssText)||this.removeAttributes(a,"style")},setStyles:function(a,c){for(var h in c)c.hasOwnProperty(h)&&domUtils.setStyle(a,h,c[h])},removeDirtyAttr:function(a){for(var c,i=0,h=a.getElementsByTagName("*");c=h[i++];)c.removeAttribute("_moz_dirty");a.removeAttribute("_moz_dirty")},getChildCount:function(a,c){var h=0,g=a.firstChild;for(c=c||function(){return 1};g;)c(g)&&h++,g=g.nextSibling;return h},isEmptyNode:function(a){return!a.firstChild||0==domUtils.getChildCount(a,function(a){return!domUtils.isBr(a)&&!domUtils.isBookmarkNode(a)&&!domUtils.isWhitespace(a)})},clearSelectedArr:function(a){for(var c;c=a.pop();)domUtils.removeAttributes(c,["class"])},scrollToView:function(a,c,h){var g=function(){var a=c.document,h="CSS1Compat"==a.compatMode;return{width:(h?a.documentElement.clientWidth:a.body.clientWidth)||0,height:(h?a.documentElement.clientHeight:a.body.clientHeight)||0}},v=function(a){if("pageXOffset"in a)return{x:a.pageXOffset||0,y:a.pageYOffset||0};var c=a.document;return{x:c.documentElement.scrollLeft||c.body.scrollLeft||0,y:c.documentElement.scrollTop||c.body.scrollTop||0}},b=g().height,y=-1*b+h;y+=a.offsetHeight||0;var C=domUtils.getXY(a);y+=C.y;var N=v(c).y;(y>N||N-b>y)&&c.scrollTo(0,y+(0>y?-20:20))},isBr:function(a){return 1==a.nodeType&&"BR"==a.tagName},isFillChar:function(a,c){if(3!=a.nodeType)return!1;var h=a.nodeValue;return c?new RegExp("^"+domUtils.fillChar).test(h):!h.replace(new RegExp(domUtils.fillChar,"g"),"").length},isStartInblock:function(a){var c,h=a.cloneRange(),g=0,v=h.startContainer;if(1==v.nodeType&&v.childNodes[h.startOffset]){v=v.childNodes[h.startOffset];for(var b=v.previousSibling;b&&domUtils.isFillChar(b);)v=b,b=b.previousSibling}for(this.isFillChar(v,!0)&&1==h.startOffset&&(h.setStartBefore(v),v=h.startContainer);v&&domUtils.isFillChar(v);)c=v,v=v.previousSibling;for(c&&(h.setStartBefore(c),v=h.startContainer),1==v.nodeType&&domUtils.isEmptyNode(v)&&1==h.startOffset&&h.setStart(v,0).collapse(!0);!h.startOffset;){if(v=h.startContainer,domUtils.isBlockElm(v)||domUtils.isBody(v)){g=1;break}var y,b=h.startContainer.previousSibling;if(b){for(;b&&domUtils.isFillChar(b);)y=b,b=b.previousSibling;h.setStartBefore(y?y:h.startContainer)}else h.setStartBefore(h.startContainer)}return g&&!domUtils.isBody(h.startContainer)?1:0},isEmptyBlock:function(a,c){if(1!=a.nodeType)return 0;if(c=c||new RegExp("[  	\r\n"+domUtils.fillChar+"]","g"),a[browser.ie?"innerText":"textContent"].replace(c,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(a.getElementsByTagName(n).length)return 0;return 1},setViewportOffset:function(a,c){var h=0|parseInt(a.style.left),g=0|parseInt(a.style.top),v=a.getBoundingClientRect(),b=c.left-v.left,y=c.top-v.top;b&&(a.style.left=h+b+"px"),y&&(a.style.top=g+y+"px")},fillNode:function(a,c){var h=browser.ie?a.createTextNode(domUtils.fillChar):a.createElement("br");c.innerHTML="",c.appendChild(h)},moveChild:function(a,c,h){for(;a.firstChild;)h&&c.firstChild?c.insertBefore(a.lastChild,c.firstChild):c.appendChild(a.firstChild)},hasNoAttributes:function(a){return browser.ie?/^<\w+\s*?>/.test(a.outerHTML):0==a.attributes.length},isCustomeNode:function(a){return 1==a.nodeType&&a.getAttribute("_ue_custom_node_")},isTagNode:function(a,c){return 1==a.nodeType&&new RegExp("\\b"+a.tagName+"\\b","i").test(c)},filterNodeList:function(a,c,h){var g=[];if(!utils.isFunction(c)){var v=c;c=function(n){return-1!=utils.indexOf(utils.isArray(v)?v:v.split(" "),n.tagName.toLowerCase())}}return utils.each(a,function(n){c(n)&&g.push(n)}),0==g.length?null:1!=g.length&&h?g:g[0]},isInNodeEndBoundary:function(a,c){var h=a.startContainer;if(3==h.nodeType&&a.startOffset!=h.nodeValue.length)return 0;if(1==h.nodeType&&a.startOffset!=h.childNodes.length)return 0;for(;h!==c;){if(h.nextSibling)return 0;h=h.parentNode}return 1},isBoundaryNode:function(a,c){for(var h;!domUtils.isBody(a);)if(h=a,a=a.parentNode,h!==a[c])return!1;return!0},fillHtml:browser.ie11below?"&nbsp;":"<br/>"},fillCharReg=new RegExp(domUtils.fillChar,"g");!function(){function a(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer===a.endContainer&&a.startOffset==a.endOffset}function c(a){return!a.collapsed&&1==a.startContainer.nodeType&&a.startContainer===a.endContainer&&a.endOffset-a.startOffset==1}function h(c,h,g,v){return 1==h.nodeType&&(dtd.$empty[h.tagName]||dtd.$nonChild[h.tagName])&&(g=domUtils.getNodeIndex(h)+(c?0:1),h=h.parentNode),c?(v.startContainer=h,v.startOffset=g,v.endContainer||v.collapse(!0)):(v.endContainer=h,v.endOffset=g,v.startContainer||v.collapse(!1)),a(v),v}function g(a,c){var h,g,v=a.startContainer,b=a.endContainer,y=a.startOffset,C=a.endOffset,N=a.document,w=N.createDocumentFragment();if(1==v.nodeType&&(v=v.childNodes[y]||(h=v.appendChild(N.createTextNode("")))),1==b.nodeType&&(b=b.childNodes[C]||(g=b.appendChild(N.createTextNode("")))),v===b&&3==v.nodeType)return w.appendChild(N.createTextNode(v.substringData(y,C-y))),c&&(v.deleteData(y,C-y),a.collapse(!0)),w;for(var U,E,T=w,S=domUtils.findParents(v,!0),k=domUtils.findParents(b,!0),i=0;S[i]==k[i];)i++;for(var B,I=i;B=S[I];I++){for(U=B.nextSibling,B==v?h||(3==a.startContainer.nodeType?(T.appendChild(N.createTextNode(v.nodeValue.slice(y))),c&&v.deleteData(y,v.nodeValue.length-y)):T.appendChild(c?v:v.cloneNode(!0))):(E=B.cloneNode(!1),T.appendChild(E));U&&U!==b&&U!==k[I];)B=U.nextSibling,T.appendChild(c?U:U.cloneNode(!0)),U=B;T=E}T=w,S[i]||(T.appendChild(S[i-1].cloneNode(!1)),T=T.firstChild);for(var _,I=i;_=k[I];I++){if(U=_.previousSibling,_==b?g||3!=a.endContainer.nodeType||(T.appendChild(N.createTextNode(b.substringData(0,C))),c&&b.deleteData(0,C)):(E=_.cloneNode(!1),T.appendChild(E)),I!=i||!S[i])for(;U&&U!==v;)_=U.previousSibling,T.insertBefore(c?U:U.cloneNode(!0),T.firstChild),U=_;T=E}return c&&a.setStartBefore(k[i]?S[i]?k[i]:S[i-1]:k[i-1]).collapse(!0),h&&domUtils.remove(h),g&&domUtils.remove(g),w}function v(a,c){try{if(y&&domUtils.inDoc(y,a))if(y.nodeValue.replace(fillCharReg,"").length)y.nodeValue=y.nodeValue.replace(fillCharReg,"");else{var h=y.parentNode;for(domUtils.remove(y);h&&domUtils.isEmptyInlineElement(h)&&(browser.safari?!(domUtils.getPosition(h,c)&domUtils.POSITION_CONTAINS):!h.contains(c));)y=h.parentNode,domUtils.remove(h),h=y}}catch(e){}}function b(a,c){var h;for(a=a[c];a&&domUtils.isFillChar(a);)h=a[c],domUtils.remove(a),a=h}var y,C=0,N=domUtils.fillChar,w=dom.Range=function(a){var c=this;c.startContainer=c.startOffset=c.endContainer=c.endOffset=null,c.document=a,c.collapsed=!0
};w.prototype={cloneContents:function(){return this.collapsed?null:g(this,0)},deleteContents:function(){var a;return this.collapsed||g(this,1),browser.webkit&&(a=this.startContainer,3!=a.nodeType||a.nodeValue.length||(this.setStartBefore(a).collapse(!0),domUtils.remove(a))),this},extractContents:function(){return this.collapsed?null:g(this,2)},setStart:function(a,c){return h(!0,a,c,this)},setEnd:function(a,c){return h(!1,a,c,this)},setStartAfter:function(a){return this.setStart(a.parentNode,domUtils.getNodeIndex(a)+1)},setStartBefore:function(a){return this.setStart(a.parentNode,domUtils.getNodeIndex(a))},setEndAfter:function(a){return this.setEnd(a.parentNode,domUtils.getNodeIndex(a)+1)},setEndBefore:function(a){return this.setEnd(a.parentNode,domUtils.getNodeIndex(a))},setStartAtFirst:function(a){return this.setStart(a,0)},setStartAtLast:function(a){return this.setStart(a,3==a.nodeType?a.nodeValue.length:a.childNodes.length)},setEndAtFirst:function(a){return this.setEnd(a,0)},setEndAtLast:function(a){return this.setEnd(a,3==a.nodeType?a.nodeValue.length:a.childNodes.length)},selectNode:function(a){return this.setStartBefore(a).setEndAfter(a)},selectNodeContents:function(a){return this.setStart(a,0).setEndAtLast(a)},cloneRange:function(){var a=this;return new w(a.document).setStart(a.startContainer,a.startOffset).setEnd(a.endContainer,a.endOffset)},collapse:function(a){var c=this;return a?(c.endContainer=c.startContainer,c.endOffset=c.startOffset):(c.startContainer=c.endContainer,c.startOffset=c.endOffset),c.collapsed=!0,c},shrinkBoundary:function(a){function c(a){return 1==a.nodeType&&!domUtils.isBookmarkNode(a)&&!dtd.$empty[a.tagName]&&!dtd.$nonChild[a.tagName]}for(var h,g=this,v=g.collapsed;1==g.startContainer.nodeType&&(h=g.startContainer.childNodes[g.startOffset])&&c(h);)g.setStart(h,0);if(v)return g.collapse(!0);if(!a)for(;1==g.endContainer.nodeType&&g.endOffset>0&&(h=g.endContainer.childNodes[g.endOffset-1])&&c(h);)g.setEnd(h,h.childNodes.length);return g},getCommonAncestor:function(a,h){var g=this,v=g.startContainer,b=g.endContainer;return v===b?a&&c(this)&&(v=v.childNodes[g.startOffset],1==v.nodeType)?v:h&&3==v.nodeType?v.parentNode:v:domUtils.getCommonAncestor(v,b)},trimBoundary:function(a){this.txtToElmBoundary();var c=this.startContainer,h=this.startOffset,g=this.collapsed,v=this.endContainer;if(3==c.nodeType){if(0==h)this.setStartBefore(c);else if(h>=c.nodeValue.length)this.setStartAfter(c);else{var b=domUtils.split(c,h);c===v?this.setEnd(b,this.endOffset-h):c.parentNode===v&&(this.endOffset+=1),this.setStartBefore(b)}if(g)return this.collapse(!0)}return a||(h=this.endOffset,v=this.endContainer,3==v.nodeType&&(0==h?this.setEndBefore(v):(h<v.nodeValue.length&&domUtils.split(v,h),this.setEndAfter(v)))),this},txtToElmBoundary:function(a){function c(r,a){var c=r[a+"Container"],h=r[a+"Offset"];3==c.nodeType&&(h?h>=c.nodeValue.length&&r["set"+a.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](c):r["set"+a.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](c))}return(a||!this.collapsed)&&(c(this,"start"),c(this,"end")),this},insertNode:function(a){var c=a,h=1;11==a.nodeType&&(c=a.firstChild,h=a.childNodes.length),this.trimBoundary(!0);var g=this.startContainer,v=this.startOffset,b=g.childNodes[v];return b?g.insertBefore(a,b):g.appendChild(a),c.parentNode===this.endContainer&&(this.endOffset=this.endOffset+h),this.setStartBefore(c)},setCursor:function(a,c){return this.collapse(!a).select(c)},createBookmark:function(a,c){var h,g=this.document.createElement("span");return g.style.cssText="display:none;line-height:0px;",g.appendChild(this.document.createTextNode("‍")),g.id="_baidu_bookmark_start_"+(c?"":C++),this.collapsed||(h=g.cloneNode(!0),h.id="_baidu_bookmark_end_"+(c?"":C++)),this.insertNode(g),h&&this.collapse().insertNode(h).setEndBefore(h),this.setStartAfter(g),{start:a?g.id:g,end:h?a?h.id:h:null,id:a}},moveToBookmark:function(a){var c=a.id?this.document.getElementById(a.start):a.start,h=a.end&&a.id?this.document.getElementById(a.end):a.end;return this.setStartBefore(c),domUtils.remove(c),h?(this.setEndBefore(h),domUtils.remove(h)):this.collapse(!0),this},enlarge:function(a,c){var h,g,v=domUtils.isBody,b=this.document.createTextNode("");if(a){for(g=this.startContainer,1==g.nodeType?g.childNodes[this.startOffset]?h=g=g.childNodes[this.startOffset]:(g.appendChild(b),h=g=b):h=g;;){if(domUtils.isBlockElm(g)){for(g=h;(h=g.previousSibling)&&!domUtils.isBlockElm(h);)g=h;this.setStartBefore(g);break}h=g,g=g.parentNode}for(g=this.endContainer,1==g.nodeType?((h=g.childNodes[this.endOffset])?g.insertBefore(b,h):g.appendChild(b),h=g=b):h=g;;){if(domUtils.isBlockElm(g)){for(g=h;(h=g.nextSibling)&&!domUtils.isBlockElm(h);)g=h;this.setEndAfter(g);break}h=g,g=g.parentNode}b.parentNode===this.endContainer&&this.endOffset--,domUtils.remove(b)}if(!this.collapsed){for(;!(0!=this.startOffset||c&&c(this.startContainer)||v(this.startContainer));)this.setStartBefore(this.startContainer);for(;!(this.endOffset!=(1==this.endContainer.nodeType?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)||c&&c(this.endContainer)||v(this.endContainer));)this.setEndAfter(this.endContainer)}return this},enlargeToBlockElm:function(a){for(;!domUtils.isBlockElm(this.startContainer);)this.setStartBefore(this.startContainer);if(!a)for(;!domUtils.isBlockElm(this.endContainer);)this.setEndAfter(this.endContainer);return this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(a,c,h){if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(a){return 1==a.nodeType&&domUtils.isBlockElm(a)}).adjustmentBoundary();for(var g,v,b=this.createBookmark(),y=b.end,C=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase():!domUtils.isWhitespace(a)},N=domUtils.getNextDomNode(b.start,!1,C),w=this.cloneRange();N&&domUtils.getPosition(N,y)&domUtils.POSITION_PRECEDING;)if(3==N.nodeType||dtd[a][N.tagName]){for(w.setStartBefore(N),g=N;g&&(3==g.nodeType||dtd[a][g.tagName])&&g!==y;)v=g,g=domUtils.getNextDomNode(g,1==g.nodeType,null,function(c){return dtd[a][c.tagName]});var U,E=w.setEndAfter(v).extractContents();if(h&&h.length>0){var T,S;S=T=h[0].cloneNode(!1);for(var k,i=1;k=h[i++];)T.appendChild(k.cloneNode(!1)),T=T.firstChild;U=T}else U=w.document.createElement(a);c&&domUtils.setAttributes(U,c),U.appendChild(E),w.insertNode(h?S:U);var B;if("span"==a&&c.style&&/text\-decoration/.test(c.style)&&(B=domUtils.findParentByTagName(U,"a",!0))?(domUtils.setAttributes(B,c),domUtils.remove(U,!0),U=B):(domUtils.mergeSibling(U),domUtils.clearEmptySibling(U)),domUtils.mergeChild(U,c),N=domUtils.getNextDomNode(U,!1,C),domUtils.mergeToParent(U),g===y)break}else N=domUtils.getNextDomNode(N,!0,C);return this.moveToBookmark(b)},removeInlineStyle:function(a){if(this.collapsed)return this;a=utils.isArray(a)?a:[a],this.shrinkBoundary().adjustmentBoundary();for(var c=this.startContainer,h=this.endContainer;;){if(1==c.nodeType){if(utils.indexOf(a,c.tagName.toLowerCase())>-1)break;if("body"==c.tagName.toLowerCase()){c=null;break}}c=c.parentNode}for(;;){if(1==h.nodeType){if(utils.indexOf(a,h.tagName.toLowerCase())>-1)break;if("body"==h.tagName.toLowerCase()){h=null;break}}h=h.parentNode}var g,v,b=this.createBookmark();c&&(v=this.cloneRange().setEndBefore(b.start).setStartBefore(c),g=v.extractContents(),v.insertNode(g),domUtils.clearEmptySibling(c,!0),c.parentNode.insertBefore(b.start,c)),h&&(v=this.cloneRange().setStartAfter(b.end).setEndAfter(h),g=v.extractContents(),v.insertNode(g),domUtils.clearEmptySibling(h,!1,!0),h.parentNode.insertBefore(b.end,h.nextSibling));for(var y,C=domUtils.getNextDomNode(b.start,!1,function(a){return 1==a.nodeType});C&&C!==b.end;)y=domUtils.getNextDomNode(C,!0,function(a){return 1==a.nodeType}),utils.indexOf(a,C.tagName.toLowerCase())>-1&&domUtils.remove(C,!0),C=y;return this.moveToBookmark(b)},getClosedNode:function(){var a;if(!this.collapsed){var h=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(c(h)){var g=h.startContainer.childNodes[h.startOffset];g&&1==g.nodeType&&(dtd.$empty[g.tagName]||dtd.$nonChild[g.tagName])&&(a=g)}}return a},select:browser.ie?function(a,c){var h;this.collapsed||this.shrinkBoundary();var g=this.getClosedNode();if(g&&!c){try{h=this.document.body.createControlRange(),h.addElement(g),h.select()}catch(e){}return this}var C,w=this.createBookmark(),U=w.start;if(h=this.document.body.createTextRange(),h.moveToElementText(U),h.moveStart("character",1),this.collapsed){if(!a&&3!=this.startContainer.nodeType){var E=this.document.createTextNode(N),T=this.document.createElement("span");T.appendChild(this.document.createTextNode(N)),U.parentNode.insertBefore(T,U),U.parentNode.insertBefore(E,U),v(this.document,E),y=E,b(T,"previousSibling"),b(U,"nextSibling"),h.moveStart("character",-1),h.collapse(!0)}}else{var S=this.document.body.createTextRange();C=w.end,S.moveToElementText(C),h.setEndPoint("EndToEnd",S)}this.moveToBookmark(w),T&&domUtils.remove(T);try{h.select()}catch(e){}return this}:function(a){function c(a){function c(c,h,g){3==c.nodeType&&c.nodeValue.length<h&&(a[g+"Offset"]=c.nodeValue.length)}c(a.startContainer,a.startOffset,"start"),c(a.endContainer,a.endOffset,"end")}var h,g=domUtils.getWindow(this.document),C=g.getSelection();if(browser.gecko?this.document.body.focus():g.focus(),C){if(C.removeAllRanges(),this.collapsed&&!a){var w=this.startContainer,U=w;1==w.nodeType&&(U=w.childNodes[this.startOffset]),3==w.nodeType&&this.startOffset||(U?U.previousSibling&&3==U.previousSibling.nodeType:w.lastChild&&3==w.lastChild.nodeType)||(h=this.document.createTextNode(N),this.insertNode(h),v(this.document,h),b(h,"previousSibling"),b(h,"nextSibling"),y=h,this.setStart(h,browser.webkit?1:0).collapse(!0))}var E=this.document.createRange();if(this.collapsed&&browser.opera&&1==this.startContainer.nodeType){var U=this.startContainer.childNodes[this.startOffset];if(U){for(;U&&domUtils.isBlockElm(U)&&1==U.nodeType&&U.childNodes[0];)U=U.childNodes[0];U&&this.setStartBefore(U).collapse(!0)}else U=this.startContainer.lastChild,U&&domUtils.isBr(U)&&this.setStartBefore(U).collapse(!0)}c(this),E.setStart(this.startContainer,this.startOffset),E.setEnd(this.endContainer,this.endOffset),C.addRange(E)}return this},scrollToView:function(a,c){a=a?window:domUtils.getWindow(this.document);var h=this,g=h.document.createElement("span");return g.innerHTML="&nbsp;",h.cloneRange().insertNode(g),domUtils.scrollToView(g,a,c),domUtils.remove(g),h},inFillChar:function(){var a=this.startContainer;return this.collapsed&&3==a.nodeType&&a.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==a.nodeValue.length?!0:!1},createAddress:function(a,c){function h(a){for(var h,g=a?v.startContainer:v.endContainer,b=domUtils.findParents(g,!0,function(a){return!domUtils.isBody(a)}),y=[],i=0;h=b[i++];)y.push(domUtils.getNodeIndex(h,c));var C=0;if(c)if(3==g.nodeType){for(var N=g.previousSibling;N&&3==N.nodeType;)C+=N.nodeValue.replace(fillCharReg,"").length,N=N.previousSibling;C+=a?v.startOffset:v.endOffset}else if(g=g.childNodes[a?v.startOffset:v.endOffset])C=domUtils.getNodeIndex(g,c);else{g=a?v.startContainer:v.endContainer;for(var w=g.firstChild;w;)if(domUtils.isFillChar(w))w=w.nextSibling;else if(C++,3==w.nodeType)for(;w&&3==w.nodeType;)w=w.nextSibling;else w=w.nextSibling}else C=a?domUtils.isFillChar(g)?0:v.startOffset:v.endOffset;return 0>C&&(C=0),y.push(C),y}var g={},v=this;return g.startAddress=h(!0),a||(g.endAddress=v.collapsed?[].concat(g.startAddress):h()),g},moveToAddress:function(a,c){function h(a,c){for(var h,v,b,y=g.document.body,i=0,l=a.length;l>i;i++)if(b=a[i],h=y,y=y.childNodes[b],!y){v=b;break}c?y?g.setStartBefore(y):g.setStart(h,v):y?g.setEndBefore(y):g.setEnd(h,v)}var g=this;return h(a.startAddress,!0),!c&&a.endAddress&&h(a.endAddress),g},equals:function(a){for(var p in this)if(this.hasOwnProperty(p)&&this[p]!==a[p])return!1;return!0},traversal:function(a,c){if(this.collapsed)return this;for(var h=this.createBookmark(),g=h.end,v=domUtils.getNextDomNode(h.start,!1,c);v&&v!==g&&domUtils.getPosition(v,g)&domUtils.POSITION_PRECEDING;){var b=domUtils.getNextDomNode(v,!1,c);a(v),v=b}return this.moveToBookmark(h)}}}(),function(){function a(a,c){var h=domUtils.getNodeIndex;a=a.duplicate(),a.collapse(c);var g=a.parentElement();if(!g.hasChildNodes())return{container:g,offset:0};for(var v,b,y=g.children,C=a.duplicate(),N=0,w=y.length-1,U=-1;w>=N;){U=Math.floor((N+w)/2),v=y[U],C.moveToElementText(v);var E=C.compareEndPoints("StartToStart",a);if(E>0)w=U-1;else{if(!(0>E))return{container:g,offset:h(v)};N=U+1}}if(-1==U){if(C.moveToElementText(g),C.setEndPoint("StartToStart",a),b=C.text.replace(/(\r\n|\r)/g,"\n").length,y=g.childNodes,!b)return v=y[y.length-1],{container:v,offset:v.nodeValue.length};for(var i=y.length;b>0;)b-=y[--i].nodeValue.length;return{container:y[i],offset:-b}}if(C.collapse(E>0),C.setEndPoint(E>0?"StartToStart":"EndToStart",a),b=C.text.replace(/(\r\n|\r)/g,"\n").length,!b)return dtd.$empty[v.tagName]||dtd.$nonChild[v.tagName]?{container:g,offset:h(v)+(E>0?0:1)}:{container:v,offset:E>0?0:v.childNodes.length};for(;b>0;)try{var T=v;v=v[E>0?"previousSibling":"nextSibling"],b-=v.nodeValue.length}catch(e){return{container:g,offset:h(T)}}return{container:v,offset:E>0?-b:v.nodeValue.length+b}}function c(c,h){if(c.item)h.selectNode(c.item(0));else{var g=a(c,!0);h.setStart(g.container,g.offset),0!=c.compareEndPoints("StartToEnd",c)&&(g=a(c,!1),h.setEnd(g.container,g.offset))}return h}function h(a){var c;try{c=a.getNative().createRange()}catch(e){return null}var h=c.item?c.item(0):c.parentElement();return(h.ownerDocument||h)===a.document?c:null}var g=dom.Selection=function(a){var c,g=this;g.document=a,browser.ie9below&&(c=domUtils.getWindow(a).frameElement,domUtils.on(c,"beforedeactivate",function(){g._bakIERange=g.getIERange()}),domUtils.on(c,"activate",function(){try{!h(g)&&g._bakIERange&&g._bakIERange.select()}catch(ex){}g._bakIERange=null})),c=a=null};g.prototype={rangeInBody:function(a,c){var h=browser.ie9below||c?a.item?a.item():a.parentElement():a.startContainer;return h===this.document.body||domUtils.inDoc(h,this.document)},getNative:function(){var a=this.document;try{return a?browser.ie9below?a.selection:domUtils.getWindow(a).getSelection():null}catch(e){return null}},getIERange:function(){var a=h(this);return!a&&this._bakIERange?this._bakIERange:a},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var a=this.getStart();return a?domUtils.findParents(a,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{if(browser.ie9below){var a=h(this);return!(!a||!this.rangeInBody(a))}return!!this.getNative().rangeCount}catch(e){return!1}},getRange:function(){function a(a){for(var c=h.document.body.firstChild,g=a.collapsed;c&&c.firstChild;)a.setStart(c,0),c=c.firstChild;a.startContainer||a.setStart(h.document.body,0),g&&a.collapse(!0)}var h=this;if(null!=h._cachedRange)return this._cachedRange;var g=new baidu.editor.dom.Range(h.document);if(browser.ie9below){var v=h.getIERange();if(v)try{c(v,g)}catch(e){a(g)}else a(g)}else{var b=h.getNative();if(b&&b.rangeCount){var y=b.getRangeAt(0),C=b.getRangeAt(b.rangeCount-1);g.setStart(y.startContainer,y.startOffset).setEnd(C.endContainer,C.endOffset),g.collapsed&&domUtils.isBody(g.startContainer)&&!g.startOffset&&a(g)}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document))return this._bakRange;a(g)}}return this._bakRange=g},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var a,c,h,g,v=browser.ie9below?this.getIERange():this.getRange();if(browser.ie9below){if(!v)return this.document.body.firstChild;if(v.item)return v.item(0);for(a=v.duplicate(),a.text.length>0&&a.moveStart("character",1),a.collapse(1),c=a.parentElement(),g=h=v.parentElement();h=h.parentNode;)if(h==c){c=g;break}}else if(v.shrinkBoundary(),c=v.startContainer,1==c.nodeType&&c.hasChildNodes()&&(c=c.childNodes[Math.min(c.childNodes.length-1,v.startOffset)]),3==c.nodeType)return c.parentNode;return c},getText:function(){var a,c;return this.isFocus()&&(a=this.getNative())?(c=browser.ie9below?a.createRange():a.getRangeAt(0),browser.ie9below?c.text:c.toString()):""},clearRange:function(){this.getNative()[browser.ie9below?"empty":"removeAllRanges"]()}}}(),function(){function a(a,c){var h;if(c.textarea)if(utils.isString(c.textarea)){for(var g,i=0,v=domUtils.getElementsByTagName(a,"textarea");g=v[i++];)if(g.id=="ueditor_textarea_"+c.options.textarea){h=g;break}}else h=c.textarea;h||(a.appendChild(h=domUtils.createElement(document,"textarea",{name:c.options.textarea,id:"ueditor_textarea_"+c.options.textarea,style:"display:none"})),c.textarea=h),!h.getAttribute("name")&&h.setAttribute("name",c.options.textarea),h.value=c.hasContents()?c.options.allHtmlEnabled?c.getAllHtml():c.getContent(null,null,!0):""}function c(a){for(var c in a)return c}function h(a){a.langIsReady=!0,a.fireEvent("langReady")}var g,v=0,b=UE.Editor=function(a){var g=this;g.uid=v++,EventBase.call(g),g.commands={},g.options=utils.extend(utils.clone(a||{}),UEDITOR_CONFIG,!0),g.shortcutkeys={},g.inputRules=[],g.outputRules=[],g.setOpt(b.defaultOptions(g)),g.loadServerConfig(),utils.isEmptyObject(UE.I18N)?utils.loadFile(document,{src:g.options.langPath+g.options.lang+"/"+g.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){UE.plugin.load(g),h(g)}):(g.options.lang=c(UE.I18N),UE.plugin.load(g),h(g)),UE.instants["ueditorInstant"+g.uid]=g};b.prototype={registerCommand:function(a,c){this.commands[a]=c},ready:function(a){var c=this;a&&(c.isReady?a.apply(c):c.addListener("ready",a))},setOpt:function(a,c){var h={};utils.isString(a)?h[a]=c:h=a,utils.extend(this.options,h,!0)},getOpt:function(a){return this.options[a]},destroy:function(){var a=this;a.fireEvent("destroy");var c=a.container.parentNode,h=a.textarea;h?h.style.display="":(h=document.createElement("textarea"),c.parentNode.insertBefore(h,c)),h.style.width=a.iframe.offsetWidth+"px",h.style.height=a.iframe.offsetHeight+"px",h.value=a.getContent(),h.id=a.key,c.innerHTML="",domUtils.remove(c);var g=a.key;for(var p in a)a.hasOwnProperty(p)&&delete this[p];UE.delEditor(g)},render:function(a){var c=this,h=c.options,g=function(c){return parseInt(domUtils.getComputedStyle(a,c))};if(utils.isString(a)&&(a=document.getElementById(a)),a){h.minFrameWidth=h.initialFrameWidth?h.initialFrameWidth:h.initialFrameWidth=a.offsetWidth,h.initialFrameHeight?h.minFrameHeight=h.initialFrameHeight:h.initialFrameHeight=h.minFrameHeight=a.offsetHeight,a.style.width=/%$/.test(h.initialFrameWidth)?"100%":h.initialFrameWidth-g("padding-left")-g("padding-right")+"px",a.style.height=/%$/.test(h.initialFrameHeight)?"100%":h.initialFrameHeight-g("padding-top")-g("padding-bottom")+"px",a.style.zIndex=h.zIndex;var v=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml' class='view' ><head><style type='text/css'>.view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\nbody{margin:8px;font-family:sans-serif;font-size:16px;}p{margin:5px 0;}</style>"+(h.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(h.iframeCssUrl)+"'/>":"")+(h.initialStyle?"<style>"+h.initialStyle+"</style>":"")+"</head><body class='view' ></body><script type='text/javascript' "+(ie?"defer='defer'":"")+" id='_initialScript'>setTimeout(function(){editor = window.parent.UE.instants['ueditorInstant"+c.uid+"'];editor._setup(document);},0);var _tmpScript = document.getElementById('_initialScript');_tmpScript.parentNode.removeChild(_tmpScript);</script></html>";a.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+c.uid,width:"100%",height:"100%",frameborder:"0",src:"javascript:void(function(){document.open();"+(h.customDomain&&document.domain!=location.hostname?'document.domain="'+document.domain+'";':"")+'document.write("'+v+'");document.close();}())'})),a.style.overflow="hidden",setTimeout(function(){/%$/.test(h.initialFrameWidth)&&(h.minFrameWidth=h.initialFrameWidth=a.offsetWidth),/%$/.test(h.initialFrameHeight)&&(h.minFrameHeight=h.initialFrameHeight=a.offsetHeight,a.style.height=h.initialFrameHeight+"px")})}},_setup:function(c){var h=this,g=h.options;ie?(c.body.disabled=!0,c.body.contentEditable=!0,c.body.disabled=!1):c.body.contentEditable=!0,c.body.spellcheck=!1,h.document=c,h.window=c.defaultView||c.parentWindow,h.iframe=h.window.frameElement,h.body=c.body,h.selection=new dom.Selection(c);var v;browser.gecko&&(v=this.selection.getNative())&&v.removeAllRanges(),this._initEvents();for(var b=this.iframe.parentNode;!domUtils.isBody(b);b=b.parentNode)if("FORM"==b.tagName){h.form=b,h.options.autoSyncData?domUtils.on(h.window,"blur",function(){a(b,h)}):domUtils.on(b,"submit",function(){a(this,h)});break}if(g.initialContent)if(g.autoClearinitialContent){var y=h.execCommand;h.execCommand=function(){return h.fireEvent("firstBeforeExecCommand"),y.apply(h,arguments)},this._setDefaultContent(g.initialContent)}else this.setContent(g.initialContent,!1,!0);domUtils.isEmptyNode(h.body)&&(h.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),g.focus&&setTimeout(function(){h.focus(h.options.focusInEnd),!h.options.autoClearinitialContent&&h._selectionChange()},0),h.container||(h.container=this.iframe.parentNode),g.fullscreen&&h.ui&&h.ui.setFullScreen(!0);try{h.document.execCommand("2D-position",!1,!1)}catch(e){}try{h.document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}try{h.document.execCommand("enableObjectResizing",!1,!1)}catch(e){}h._bindshortcutKeys(),h.isReady=1,h.fireEvent("ready"),g.onready&&g.onready.call(h),browser.ie9below||domUtils.on(h.window,["blur","focus"],function(e){if("blur"==e.type){h._bakRange=h.selection.getRange();try{h._bakNativeRange=h.selection.getNative().getRangeAt(0),h.selection.getNative().removeAllRanges()}catch(e){h._bakNativeRange=null}}else try{h._bakRange&&h._bakRange.select()}catch(e){}}),browser.gecko&&browser.version<=10902&&(h.body.contentEditable=!1,setTimeout(function(){h.body.contentEditable=!0},100),setInterval(function(){h.body.style.height=h.iframe.offsetHeight-20+"px"},100)),!g.isShow&&h.setHide(),g.readonly&&h.setDisabled()},sync:function(c){var h=this,g=c?document.getElementById(c):domUtils.findParent(h.iframe.parentNode,function(a){return"FORM"==a.tagName},!0);g&&a(g,h)},setHeight:function(a,c){a!==parseInt(this.iframe.parentNode.style.height)&&(this.iframe.parentNode.style.height=a+"px"),!c&&(this.options.minFrameHeight=this.options.initialFrameHeight=a),this.body.style.height=a+"px",!c&&this.trigger("setHeight")},addshortcutkey:function(a,c){var h={};c?h[a]=c:h=a,utils.extend(this.shortcutkeys,h)},_bindshortcutKeys:function(){var a=this,c=this.shortcutkeys;a.addListener("keydown",function(h,e){var g=e.keyCode||e.which;for(var i in c)for(var v,b=c[i].split(","),t=0;v=b[t++];){v=v.split(":");var y=v[0],C=v[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(y.toLowerCase())||/^(\d+)$/.test(y))&&(("ctrl"==RegExp.$1?e.ctrlKey||e.metaKey:0)&&(""!=RegExp.$2?e[RegExp.$2.slice(1)+"Key"]:1)&&g==RegExp.$3||g==RegExp.$1)&&(-1!=a.queryCommandState(i,C)&&a.execCommand(i,C),domUtils.preventDefault(e))}})},getContent:function(a,c,h,g,v){var b=this;if(a&&utils.isFunction(a)&&(c=a,a=""),c?!c():!this.hasContents())return"";b.fireEvent("beforegetcontent");var y=UE.htmlparser(b.body.innerHTML,g);return b.filterOutputRule(y),b.fireEvent("aftergetcontent",a,y),y.toHtml(v)},getAllHtml:function(){var a=this,c=[];if(a.fireEvent("getAllHtml",c),browser.ie&&browser.version>8){var h="";utils.each(a.document.styleSheets,function(a){h+=a.href?'<link rel="stylesheet" type="text/css" href="'+a.href+'" />':"<style>"+a.cssText+"</style>"}),utils.each(a.document.getElementsByTagName("script"),function(a){h+=a.outerHTML})}return"<html><head>"+(a.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+a.options.charset+'"/>':"")+(h||a.document.getElementsByTagName("head")[0].innerHTML)+c.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+a.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var a=new RegExp(domUtils.fillChar,"g"),c=this.body.innerHTML.replace(/[\n\r]/g,"");return c=c.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,c,h){return dtd.$block[h]?"\n":c?c:""}),c.replace(a,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var a=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(a,"").replace(/\u00a0/g," ")},setContent:function(c,h,g){function v(a){return"DIV"==a.tagName&&a.getAttribute("cdata_tag")}var b=this;b.fireEvent("beforesetcontent",c);var y=UE.htmlparser(c);if(b.filterInputRule(y),c=y.toHtml(),b.body.innerHTML=(h?b.body.innerHTML:"")+c,"p"==b.options.enterTag){var C,N=this.body.firstChild;if(!N||1==N.nodeType&&(dtd.$cdata[N.tagName]||v(N)||domUtils.isCustomeNode(N))&&N===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var p=b.document.createElement("p");N;){for(;N&&(3==N.nodeType||1==N.nodeType&&dtd.p[N.tagName]&&!dtd.$cdata[N.tagName]);)C=N.nextSibling,p.appendChild(N),N=C;if(p.firstChild){if(!N){b.body.appendChild(p);break}N.parentNode.insertBefore(p,N),p=b.document.createElement("p")}N=N.nextSibling}}b.fireEvent("aftersetcontent"),b.fireEvent("contentchange"),!g&&b._selectionChange(),b._bakRange=b._bakIERange=b._bakNativeRange=null;var w;browser.gecko&&(w=this.selection.getNative())&&w.removeAllRanges(),b.options.autoSyncData&&b.form&&a(b.form,b)},focus:function(a){try{var c=this,h=c.selection.getRange();if(a){var g=c.body.lastChild;g&&1==g.nodeType&&!dtd.$empty[g.tagName]&&(domUtils.isEmptyBlock(g)?h.setStartAtFirst(g):h.setStartAtLast(g),h.collapse(!0)),h.setCursor(!0)}else{if(!h.collapsed&&domUtils.isBody(h.startContainer)&&0==h.startOffset){var g=c.body.firstChild;g&&1==g.nodeType&&!dtd.$empty[g.tagName]&&h.setStartAtFirst(g).collapse(!0)}h.select(!0)}this.fireEvent("focus selectionchange")}catch(e){}},isFocus:function(){return this.selection.isFocus()},blur:function(){var a=this.selection.getNative();if(a.empty&&browser.ie){var c=document.body.createTextRange();c.moveToElementText(document.body),c.collapse(!0),c.select(),a.empty()}else a.removeAllRanges()},_initEvents:function(){var a=this,c=a.document,h=a.window;a._proxyDomEvent=utils.bind(a._proxyDomEvent,a),domUtils.on(c,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],a._proxyDomEvent),domUtils.on(h,["focus","blur"],a._proxyDomEvent),domUtils.on(a.body,"drop",function(e){browser.gecko&&e.stopPropagation&&e.stopPropagation(),a.fireEvent("contentchange")}),domUtils.on(c,["mouseup","keydown"],function(c){"keydown"==c.type&&(c.ctrlKey||c.metaKey||c.shiftKey||c.altKey)||2!=c.button&&a._selectionChange(250,c)})},_proxyDomEvent:function(a){return this.fireEvent("before"+a.type.replace(/^on/,"").toLowerCase())===!1?!1:this.fireEvent(a.type.replace(/^on/,""),a)===!1?!1:this.fireEvent("after"+a.type.replace(/^on/,"").toLowerCase())},_selectionChange:function(a,c){var h,v,b=this,y=!1;if(browser.ie&&browser.version<9&&c&&"mouseup"==c.type){var C=this.selection.getRange();C.collapsed||(y=!0,h=c.clientX,v=c.clientY)}clearTimeout(g),g=setTimeout(function(){if(b.selection&&b.selection.getNative()){var a;if(y&&"None"==b.selection.getNative().type){a=b.document.body.createTextRange();try{a.moveToPoint(h,v)}catch(ex){a=null}}var g;a&&(g=b.selection.getIERange,b.selection.getIERange=function(){return a}),b.selection.cache(),g&&(b.selection.getIERange=g),b.selection._cachedRange&&b.selection._cachedStartElement&&(b.fireEvent("beforeselectionchange"),b.fireEvent("selectionchange",!!c),b.fireEvent("afterselectionchange"),b.selection.clear())}},a||50)},_callCmdFn:function(a,c){var h,g,v=c[0].toLowerCase();return h=this.commands[v]||UE.commands[v],g=h&&h[a],h&&g||"queryCommandState"!=a?g?g.apply(this,c):void 0:0},execCommand:function(a){a=a.toLowerCase();var c,h=this,g=h.commands[a]||UE.commands[a];return g&&g.execCommand?(g.notNeedUndo||h.__hasEnterExecCommand?(c=this._callCmdFn("execCommand",arguments),!h.__hasEnterExecCommand&&!g.ignoreContentChange&&!h._ignoreContentChange&&h.fireEvent("contentchange")):(h.__hasEnterExecCommand=!0,-1!=h.queryCommandState.apply(h,arguments)&&(h.fireEvent("saveScene"),h.fireEvent.apply(h,["beforeexeccommand",a].concat(arguments)),c=this._callCmdFn("execCommand",arguments),h.fireEvent.apply(h,["afterexeccommand",a].concat(arguments)),h.fireEvent("saveScene")),h.__hasEnterExecCommand=!1),!h.__hasEnterExecCommand&&!g.ignoreContentChange&&!h._ignoreContentChange&&h._selectionChange(),c):null},queryCommandState:function(){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(a){if(a)for(var c,i=0;c=a[i++];)if(this.document.getElementsByTagName(c).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(a=["div"],i=0;c=a[i++];)for(var h,g=domUtils.getElementsByTagName(this.document,c),n=0;h=g[n++];)if(domUtils.isCustomeNode(h))return!0;return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var a,c=this;if("false"==c.body.contentEditable){c.body.contentEditable=!0,a=c.selection.getRange();try{a.moveToBookmark(c.lastBk),delete c.lastBk}catch(e){a.setStartAtFirst(c.body).collapse(!0)}a.select(!0),c.bkqueryCommandState&&(c.queryCommandState=c.bkqueryCommandState,delete c.bkqueryCommandState),c.bkqueryCommandValue&&(c.queryCommandValue=c.bkqueryCommandValue,delete c.bkqueryCommandValue),c.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(a){var c=this;a=a?utils.isArray(a)?a:[a]:[],"true"==c.body.contentEditable&&(c.lastBk||(c.lastBk=c.selection.getRange().createBookmark(!0)),c.body.contentEditable=!1,c.bkqueryCommandState=c.queryCommandState,c.bkqueryCommandValue=c.queryCommandValue,c.queryCommandState=function(h){return-1!=utils.indexOf(a,h)?c.bkqueryCommandState.apply(c,arguments):-1},c.queryCommandValue=function(h){return-1!=utils.indexOf(a,h)?c.bkqueryCommandValue.apply(c,arguments):null},c.fireEvent("selectionchange"))},disable:function(a){return this.setDisabled(a)},_setDefaultContent:function(){function a(){var c=this;c.document.getElementById("initContent")&&(c.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",c.removeListener("firstBeforeExecCommand focus",a),setTimeout(function(){c.focus(),c._selectionChange()},0))}return function(c){var h=this;h.body.innerHTML='<p id="initContent">'+c+"</p>",h.addListener("firstBeforeExecCommand focus",a)}}(),setShow:function(){var a=this,c=a.selection.getRange();if("none"==a.container.style.display){try{c.moveToBookmark(a.lastBk),delete a.lastBk}catch(e){c.setStartAtFirst(a.body).collapse(!0)}setTimeout(function(){c.select(!0)},100),a.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var a=this;a.lastBk||(a.lastBk=a.selection.getRange().createBookmark(!0)),a.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(a){var c=UE.I18N[this.options.lang];if(!c)throw Error("not import language file");
a=(a||"").split(".");for(var h,i=0;(h=a[i++])&&(c=c[h],c););return c},getContentLength:function(a,c){var h=this.getContent(!1,!1,!0).length;if(a){c=(c||[]).concat(["hr","img","iframe"]),h=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var g,i=0;g=c[i++];)h+=this.document.getElementsByTagName(g).length}return h},addInputRule:function(a){this.inputRules.push(a)},filterInputRule:function(a){for(var c,i=0;c=this.inputRules[i++];)c.call(this,a)},addOutputRule:function(a){this.outputRules.push(a)},filterOutputRule:function(a){for(var c,i=0;c=this.outputRules[i++];)c.call(this,a)},getActionUrl:function(a){var c=this.getOpt(a)||a,h=this.getOpt("imageUrl"),g=this.getOpt("serverUrl");return!g&&h&&(g=h.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2")),g?(g=g+(-1==g.indexOf("?")?"?":"&")+"action="+(c||""),utils.formatUrl(g)):""}},utils.inherits(b,EventBase)}(),UE.Editor.defaultOptions=function(a){var c=a.options.UEDITOR_HOME_URL;return{isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,iframeCssUrl:c+"themes/iframe.css",textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,imagePopup:!0,enterTag:"p",customDomain:!1,lang:"zh-cn",langPath:c+"lang/",theme:"default",themePath:c+"themes/",allHtmlEnabled:!1,scaleEnabled:!1,tableNativeEditInFF:!1,autoSyncData:!0,fileNameFormat:"{time}{rand:6}"}},function(){UE.Editor.prototype.loadServerConfig=function(){function showErrorMsg(a){console&&console.error(a)}var me=this;setTimeout(function(){try{me.options.imageUrl&&me.setOpt("serverUrl",me.options.imageUrl.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2"));var configUrl=me.getActionUrl("config"),isJsonp=utils.isCrossDomainUrl(configUrl);me._serverConfigLoaded=!1,configUrl&&UE.ajax.request(configUrl,{method:"GET",dataType:isJsonp?"jsonp":"",onsuccess:function(r){try{var config=isJsonp?r:eval("("+r.responseText+")");utils.extend(me.options,config),me.fireEvent("serverConfigLoaded"),me._serverConfigLoaded=!0}catch(e){showErrorMsg(me.getLang("loadconfigFormatError"))}},onerror:function(){showErrorMsg(me.getLang("loadconfigHttpError"))}})}catch(e){showErrorMsg(me.getLang("loadconfigError"))}})},UE.Editor.prototype.isServerConfigLoaded=function(){var a=this;return a._serverConfigLoaded||!1},UE.Editor.prototype.afterConfigReady=function(a){if(a&&utils.isFunction(a)){var c=this,h=function(){a.apply(c,arguments),c.removeListener("serverConfigLoaded",h)};c.isServerConfigLoaded()?a.call(c,"serverConfigLoaded"):c.addListener("serverConfigLoaded",h)}}}(),UE.ajax=function(){function a(a){var c=[];for(var i in a)if("method"!=i&&"timeout"!=i&&"async"!=i&&"dataType"!=i&&"callback"!=i&&void 0!=a[i]&&null!=a[i])if("function"!=(typeof a[i]).toLowerCase()&&"object"!=(typeof a[i]).toLowerCase())c.push(encodeURIComponent(i)+"="+encodeURIComponent(a[i]));else if(utils.isArray(a[i]))for(var h=0;h<a[i].length;h++)c.push(encodeURIComponent(i)+"[]="+encodeURIComponent(a[i][h]));return c.join("&")}function c(c,h){var g=v(),b=!1,y={method:"POST",timeout:5e3,async:!0,data:{},onsuccess:function(){},onerror:function(){}};if("object"==typeof c&&(h=c,c=h.url),g&&c){var C=h?utils.extend(y,h):y,N=a(C);utils.isEmptyObject(C.data)||(N+=(N?"&":"")+a(C.data));var w=setTimeout(function(){4!=g.readyState&&(b=!0,g.abort(),clearTimeout(w))},C.timeout),U=C.method.toUpperCase(),E=c+(-1==c.indexOf("?")?"?":"&")+("POST"==U?"":N+"&noCache="+ +new Date);g.open(U,E,C.async),g.onreadystatechange=function(){4==g.readyState&&(b||200!=g.status?C.onerror(g):C.onsuccess(g))},"POST"==U?(g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(N)):g.send(null)}}function h(c,h){function g(a,c,h){a.setAttribute("type","text/javascript"),a.setAttribute("defer","defer"),h&&a.setAttribute("charset",h),a.setAttribute("src",c),document.getElementsByTagName("head")[0].appendChild(a)}function v(a){return function(){try{if(a)U.onerror&&U.onerror();else try{clearTimeout(y),N.apply(window,arguments)}catch(e){}}catch(c){U.onerror&&U.onerror.call(window,c)}finally{U.oncomplete&&U.oncomplete.apply(window,arguments),w.parentNode&&w.parentNode.removeChild(w),window[b]=null;try{delete window[b]}catch(e){}}}}var b,y,C,N=h.onsuccess||function(){},w=document.createElement("SCRIPT"),U=h||{},E=U.charset,T=U.jsonp||"callback",S=U.timeOut||0,k=new RegExp("(\\?|&)"+T+"=([^&]*)");utils.isFunction(N)?(b="bd__editor__"+Math.floor(2147483648*Math.random()).toString(36),window[b]=v(0)):utils.isString(N)?b=N:(C=k.exec(c))&&(b=C[2]),c=c.replace(k,"$1"+T+"="+b),c.search(k)<0&&(c+=(c.indexOf("?")<0?"?":"&")+T+"="+b);var B=a(h);utils.isEmptyObject(h.data)||(B+=(B?"&":"")+a(h.data)),B&&(c=c.replace(/\?/,"?"+B+"&")),w.onerror=v(1),S&&(y=setTimeout(v(1),S)),g(w,c,E)}var g="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP"),g="ActiveXObject('Msxml2.XMLHTTP')"}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP"),g="ActiveXObject('Microsoft.XMLHTTP')"}catch(e){}}var v=new Function("return new "+g);return{request:function(a,g){g&&"jsonp"==g.dataType?h(a,g):c(a,g)},getJSONP:function(a,c,g){var v={data:c,oncomplete:g};h(a,v)}}}();var filterWord=UE.filterWord=function(){function a(a){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(a)}function c(a){return a=a.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m)})}function h(a){return a.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(a){if(browser.opera)return"";try{if(/Bitmap/i.test(a))return"";var h=a.match(/width:([ \d.]*p[tx])/i)[1],g=a.match(/height:([ \d.]*p[tx])/i)[1],v=a.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+c(h)+'" height="'+c(g)+'" src="'+v+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(a,c,h,g){return"class"==c&&"MsoListParagraph"==g?a:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(a,c,h){return h.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(a,h,g,v){for(var b,n=[],s=v.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").replace(/[\d.]+(cm|pt)/g,function(a){return utils.transUnitToPx(a)}).split(/;\s*/g),i=0;b=s[i];i++){var y,C,N=b.split(":");if(2==N.length){if(y=N[0].toLowerCase(),C=N[1].toLowerCase(),/^(background)\w*/.test(y)&&0==C.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(y)&&/^0\w+$/.test(C))continue;switch(y){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(h)||(n[i]=y.replace(/^mso-|-alt$/g,"")+":"+c(C));continue;case"horiz-align":n[i]="text-align:"+C;continue;case"vert-align":n[i]="vertical-align:"+C;continue;case"font-color":case"mso-foreground":n[i]="color:"+C;continue;case"mso-background":case"mso-highlight":n[i]="background:"+C;continue;case"mso-default-height":n[i]="min-height:"+c(C);continue;case"mso-default-width":n[i]="min-width:"+c(C);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+c(C);continue;case"text-line-through":("single"==C||"double"==C)&&(n[i]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==C&&(n[i]="display:none");continue;case"margin":if(!/[1-9]/.test(C))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(y)||/text\-indent|padding|margin/.test(y)&&/\-[\d.]+/.test(C))continue;n[i]=y+":"+N[1]}}return h+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"")})}return function(c){return a(c)?h(c):c}}();!function(){function a(a,c,h){return a.push(S),c+(h?1:-1)}function c(a,c){for(var i=0;c>i;i++)a.push(T)}function h(y,C,N,w){switch(y.type){case"root":for(var U,i=0;U=y.children[i++];)N&&"element"==U.type&&!dtd.$inlineWithA[U.tagName]&&i>1&&(a(C,w,!0),c(C,w)),h(U,C,N,w);break;case"text":g(y,C);break;case"element":v(y,C,N,w);break;case"comment":b(y,C,N)}return C}function g(a,c){c.push("pre"==a.parentNode.tagName?a.data:E[a.parentNode.tagName]?utils.html(a.data):a.data.replace(/[ ]{2}/g," &nbsp;"))}function v(g,v,b,y){var C="";if(g.attrs){C=[];var N=g.attrs;for(var w in N)C.push(w+(void 0!==N[w]?'="'+(U[w]?utils.html(N[w]).replace(/["]/g,function(){return"&quot;"}):utils.unhtml(N[w]))+'"':""));C=C.join(" ")}if(v.push("<"+g.tagName+(C?" "+C:"")+(dtd.$empty[g.tagName]?"/":"")+">"),b&&!dtd.$inlineWithA[g.tagName]&&"pre"!=g.tagName&&g.children&&g.children.length&&(y=a(v,y,!0),c(v,y)),g.children&&g.children.length)for(var E,i=0;E=g.children[i++];)b&&"element"==E.type&&!dtd.$inlineWithA[E.tagName]&&i>1&&(a(v,y),c(v,y)),h(E,v,b,y);dtd.$empty[g.tagName]||(b&&!dtd.$inlineWithA[g.tagName]&&"pre"!=g.tagName&&g.children&&g.children.length&&(y=a(v,y),c(v,y)),v.push("</"+g.tagName+">"))}function b(a,c){c.push("<!--"+a.data+"-->")}function y(a,c){var h;if("element"==a.type&&a.getAttr("id")==c)return a;if(a.children&&a.children.length)for(var g,i=0;g=a.children[i++];)if(h=y(g,c))return h}function C(a,c,h){if("element"==a.type&&a.tagName==c&&h.push(a),a.children&&a.children.length)for(var g,i=0;g=a.children[i++];)C(g,c,h)}function N(a,c){if(a.children&&a.children.length)for(var h,i=0;h=a.children[i];)N(h,c),h.parentNode&&(h.children&&h.children.length&&c(h),h.parentNode&&i++);else c(a)}var w=UE.uNode=function(a){this.type=a.type,this.data=a.data,this.tagName=a.tagName,this.parentNode=a.parentNode,this.attrs=a.attrs||{},this.children=a.children},U={href:1,src:1,_src:1,_href:1,cdata_data:1},E={style:1,script:1},T="    ",S="\n";w.createElement=function(a){return/[<>]/.test(a)?UE.htmlparser(a).children[0]:new w({type:"element",children:[],tagName:a})},w.createText=function(a,c){return new UE.uNode({type:"text",data:c?a:utils.unhtml(a||"")})},w.prototype={toHtml:function(a){var c=[];return h(this,c,a,0),c.join("")},innerHTML:function(a){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(a)){if(this.children)for(var c,i=0;c=this.children[i++];)c.parentNode=null;this.children=[];for(var c,h=UE.htmlparser(a),i=0;c=h.children[i++];)this.children.push(c),c.parentNode=this;return this}var h=new UE.uNode({type:"root",children:this.children});return h.toHtml()},innerText:function(a,c){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(a){if(this.children)for(var h,i=0;h=this.children[i++];)h.parentNode=null;return this.children=[],this.appendChild(w.createText(a,c)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var a,c=this.parentNode,i=0;a=c.children[i];i++)if(a===this)return 0==i?null:c.children[i-1]},nextSibling:function(){for(var a,c=this.parentNode,i=0;a=c.children[i++];)if(a===this)return c.children[i]},replaceChild:function(a,c){if(this.children){a.parentNode&&a.parentNode.removeChild(a);for(var h,i=0;h=this.children[i];i++)if(h===c)return this.children.splice(i,1,a),c.parentNode=null,a.parentNode=this,a}},appendChild:function(a){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),a.parentNode&&a.parentNode.removeChild(a);for(var c,i=0;c=this.children[i];i++)if(c===a){this.children.splice(i,1);break}return this.children.push(a),a.parentNode=this,a}},insertBefore:function(a,c){if(this.children){a.parentNode&&a.parentNode.removeChild(a);for(var h,i=0;h=this.children[i];i++)if(h===c)return this.children.splice(i,0,a),a.parentNode=this,a}},insertAfter:function(a,c){if(this.children){a.parentNode&&a.parentNode.removeChild(a);for(var h,i=0;h=this.children[i];i++)if(h===c)return this.children.splice(i+1,0,a),a.parentNode=this,a}},removeChild:function(a,c){if(this.children)for(var h,i=0;h=this.children[i];i++)if(h===a){if(this.children.splice(i,1),h.parentNode=null,c&&h.children&&h.children.length)for(var g,v=0;g=h.children[v];v++)this.children.splice(i+v,0,g),g.parentNode=this;return h}},getAttr:function(a){return this.attrs&&this.attrs[a.toLowerCase()]},setAttr:function(a,c){if(!a)return void delete this.attrs;if(this.attrs||(this.attrs={}),utils.isObject(a))for(var h in a)a[h]?this.attrs[h.toLowerCase()]=a[h]:delete this.attrs[h];else c?this.attrs[a.toLowerCase()]=c:delete this.attrs[a]},getIndex:function(){for(var a,c=this.parentNode,i=0;a=c.children[i];i++)if(a===this)return i;return-1},getNodeById:function(a){var c;if(this.children&&this.children.length)for(var h,i=0;h=this.children[i++];)if(c=y(h,a))return c},getNodesByTagName:function(a){a=utils.trim(a).replace(/[ ]{2,}/g," ").split(" ");var c=[],h=this;return utils.each(a,function(a){if(h.children&&h.children.length)for(var g,i=0;g=h.children[i++];)C(g,a,c)}),c},getStyle:function(a){var c=this.getAttr("style");if(!c)return"";var h=new RegExp("(^|;)\\s*"+a+":([^;]+)","i"),g=c.match(h);return g&&g[0]?g[2]:""},setStyle:function(a,c){function h(a,c){var h=new RegExp("(^|;)\\s*"+a+":([^;]+;?)","gi");g=g.replace(h,"$1"),c&&(g=a+":"+utils.unhtml(c)+";"+g)}var g=this.getAttr("style");if(g||(g=""),utils.isObject(a))for(var v in a)h(v,a[v]);else h(a,c);this.setAttr("style",utils.trim(g))},traversal:function(a){return this.children&&this.children.length&&N(this,a),this}}}();var htmlparser=UE.htmlparser=function(a,c){function h(a,c){if(T[a.tagName]){var h=U.createElement(T[a.tagName]);a.appendChild(h),h.appendChild(U.createText(c)),a=h}else a.appendChild(U.createText(c))}function g(a,c,h){var v;if(v=E[c]){for(var b,C=a;"root"!=C.type;){if(utils.isArray(v)?-1!=utils.indexOf(v,C.tagName):v==C.tagName){a=C,b=!0;break}C=C.parentNode}b||(a=g(a,utils.isArray(v)?v[0]:v))}var N=new U({parentNode:a,type:"element",tagName:c.toLowerCase(),children:dtd.$empty[c]?null:[]});if(h){for(var T,S={};T=y.exec(h);)S[T[1].toLowerCase()]=w[T[1].toLowerCase()]?T[2]||T[3]||T[4]:utils.unhtml(T[2]||T[3]||T[4]);N.attrs=S}return a.children.push(N),dtd.$empty[c]?a:N}function v(a,c){a.children.push(new U({type:"comment",data:c,parentNode:a}))}var b=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,y=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,C={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};a=a.replace(new RegExp(domUtils.fillChar,"g"),""),c||(a=a.replace(new RegExp("[\\r\\t\\n"+(c?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(c?"":" ")+"]*","g"),function(a,h){return h&&C[h.toLowerCase()]?a.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):a.replace(new RegExp("^[\\r\\n"+(c?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(c?"":" ")+"]+$"),"")}));for(var N,w={href:1,src:1},U=UE.uNode,E={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},T={ol:"li",ul:"li"},S=0,k=0,B=new U({type:"root",children:[]}),I=B;N=b.exec(a);){S=N.index;try{if(S>k&&h(I,a.slice(k,S)),N[3])dtd.$cdata[I.tagName]?h(I,N[0]):I=g(I,N[3].toLowerCase(),N[4]);else if(N[1]){if("root"!=I.type)if(dtd.$cdata[I.tagName]&&!dtd.$cdata[N[1]])h(I,N[0]);else{for(var _=I;"element"==I.type&&I.tagName!=N[1].toLowerCase();)if(I=I.parentNode,"root"==I.type)throw I=_,"break";I=I.parentNode}}else N[2]&&v(I,N[2])}catch(e){}k=b.lastIndex}return k<a.length&&h(I,a.slice(k)),B},filterNode=UE.filterNode=function(){function a(c,h){switch(c.type){case"text":break;case"element":var g;if(g=h[c.tagName])if("-"===g)c.parentNode.removeChild(c);else if(utils.isFunction(g)){var v=c.parentNode,b=c.getIndex();if(g(c),c.parentNode){if(c.children)for(var y,i=0;y=c.children[i];)a(y,h),y.parentNode&&i++}else for(var y,i=b;y=v.children[i];)a(y,h),y.parentNode&&i++}else{var C=g.$;if(C&&c.attrs){var N,w={};for(var U in C){if(N=c.getAttr(U),"style"==U&&utils.isArray(C[U])){var E=[];utils.each(C[U],function(a){var h;(h=c.getStyle(a))&&E.push(a+":"+h)}),N=E.join(";")}N&&(w[U]=N)}c.attrs=w}if(c.children)for(var y,i=0;y=c.children[i];)a(y,h),y.parentNode&&i++}else if(dtd.$cdata[c.tagName])c.parentNode.removeChild(c);else{var v=c.parentNode,b=c.getIndex();c.parentNode.removeChild(c,!0);for(var y,i=b;y=v.children[i];)a(y,h),y.parentNode&&i++}break;case"comment":c.parentNode.removeChild(c)}}return function(c,h){if(utils.isEmptyObject(h))return c;var g;(g=h["-"])&&utils.each(g.split(" "),function(a){h[a]="-"});for(var v,i=0;v=c.children[i];)a(v,h),v.parentNode&&i++;return c}}();UE.plugin=function(){var a={};return{register:function(c,h,g,v){g&&utils.isFunction(g)&&(v=g,g=null),a[c]={optionName:g||c,execFn:h,afterDisabled:v}},load:function(c){utils.each(a,function(a){var h=a.execFn.call(c);c.options[a.optionName]!==!1?h&&utils.each(h,function(a,h){switch(h.toLowerCase()){case"shortcutkey":c.addshortcutkey(a);break;case"bindevents":utils.each(a,function(a,h){c.addListener(h,a)});break;case"bindmultievents":utils.each(utils.isArray(a)?a:[a],function(a){var h=utils.trim(a.type).split(/\s+/);utils.each(h,function(h){c.addListener(h,a.handler)})});break;case"commands":utils.each(a,function(a,h){c.commands[h]=a});break;case"outputrule":c.addOutputRule(a);break;case"inputrule":c.addInputRule(a);break;case"defaultoptions":c.setOpt(a)}}):a.afterDisabled&&a.afterDisabled.call(c)}),utils.each(UE.plugins,function(a){a.call(c)})},run:function(c,h){var g=a[c];g&&g.exeFn.call(h)}}}();var keymap=UE.keymap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Del:46,NumLock:144,Cmd:91,"=":187,"-":189,b:66,i:73,z:90,y:89,v:86,x:88,s:83,n:78},LocalStorage=UE.LocalStorage=function(){function a(){var a=document.createElement("div");return a.style.display="none",a.addBehavior?(a.addBehavior("#default#userdata"),{getItem:function(c){var g=null;try{document.body.appendChild(a),a.load(h),g=a.getAttribute(c),document.body.removeChild(a)}catch(e){}return g},setItem:function(c,g){document.body.appendChild(a),a.setAttribute(c,g),a.save(h),document.body.removeChild(a)},removeItem:function(c){document.body.appendChild(a),a.removeAttribute(c),a.save(h),document.body.removeChild(a)}}):null}var c=window.localStorage||a()||null,h="localStorage";return{saveLocalData:function(a,h){return c&&h?(c.setItem(a,h),!0):!1},getLocalData:function(a){return c?c.getItem(a):null},removeItem:function(a){c&&c.removeItem(a)}}}();!function(){var a="ueditor_preference";UE.Editor.prototype.setPreferences=function(c,h){var g={};utils.isString(c)?g[c]=h:g=c;var v=LocalStorage.getLocalData(a);v&&(v=utils.str2json(v))?utils.extend(v,g):v=g,v&&LocalStorage.saveLocalData(a,utils.json2str(v))},UE.Editor.prototype.getPreferences=function(c){var h=LocalStorage.getLocalData(a);return h&&(h=utils.str2json(h))?c?h[c]:h:null},UE.Editor.prototype.removePreferences=function(c){var h=LocalStorage.getLocalData(a);h&&(h=utils.str2json(h))&&(h[c]=void 0,delete h[c]),h&&LocalStorage.saveLocalData(a,utils.json2str(h))}}(),UE.plugins.defaultfilter=function(){var a=this;a.setOpt({allowDivTransToP:!0,disabledTableInTable:!0}),a.addInputRule(function(c){function h(a){for(;a&&"element"==a.type;){if("td"==a.tagName)return!0;a=a.parentNode}return!1}var g,v=this.options.allowDivTransToP;c.traversal(function(c){if("element"==c.type){if(!dtd.$cdata[c.tagName]&&a.options.autoClearEmptyNode&&dtd.$inline[c.tagName]&&!dtd.$empty[c.tagName]&&(!c.attrs||utils.isEmptyObject(c.attrs)))return void(c.firstChild()?"span"!=c.tagName||c.attrs&&!utils.isEmptyObject(c.attrs)||c.parentNode.removeChild(c,!0):c.parentNode.removeChild(c));switch(c.tagName){case"style":case"script":c.setAttr({cdata_tag:c.tagName,cdata_data:c.innerHTML()||"",_ue_custom_node_:"true"}),c.tagName="div",c.innerHTML("");break;case"a":(g=c.getAttr("href"))&&c.setAttr("_href",g);break;case"img":if((g=c.getAttr("src"))&&/^data:/.test(g)){c.parentNode.removeChild(c);break}c.setAttr("_src",c.getAttr("src"));break;case"span":browser.webkit&&(g=c.getStyle("white-space"))&&/nowrap|normal/.test(g)&&(c.setStyle("white-space",""),a.options.autoClearEmptyNode&&utils.isEmptyObject(c.attrs)&&c.parentNode.removeChild(c,!0)),g=c.getAttr("id"),g&&/^_baidu_bookmark_/i.test(g)&&c.parentNode.removeChild(c);break;case"p":(g=c.getAttr("align"))&&(c.setAttr("align"),c.setStyle("text-align",g)),utils.each(c.children,function(n){if("element"==n.type&&"p"==n.tagName){var a=n.nextSibling();c.parentNode.insertAfter(n,c);for(var h=n;a;){var g=a.nextSibling();c.parentNode.insertAfter(a,h),h=a,a=g}return!1}}),c.firstChild()||c.innerHTML(browser.ie?"&nbsp;":"<br/>");break;case"div":if(c.getAttr("cdata_tag"))break;if(g=c.getAttr("class"),g&&/^line number\d+/.test(g))break;if(!v)break;for(var b,p=UE.uNode.createElement("p");b=c.firstChild();)"text"!=b.type&&UE.dom.dtd.$block[b.tagName]?p.firstChild()?(c.parentNode.insertBefore(p,c),p=UE.uNode.createElement("p")):c.parentNode.insertBefore(b,c):p.appendChild(b);p.firstChild()&&c.parentNode.insertBefore(p,c),c.parentNode.removeChild(c);break;case"dl":c.tagName="ul";break;case"dt":case"dd":c.tagName="li";break;case"li":var y=c.getAttr("class");y&&/list\-/.test(y)||c.setAttr();var C=c.getNodesByTagName("ol ul");UE.utils.each(C,function(n){c.parentNode.insertAfter(n,c)});break;case"td":case"th":case"caption":c.children&&c.children.length||c.appendChild(browser.ie11below?UE.uNode.createText(" "):UE.uNode.createElement("br"));break;case"table":a.options.disabledTableInTable&&h(c)&&(c.parentNode.insertBefore(UE.uNode.createText(c.innerText()),c),c.parentNode.removeChild(c))}}})}),a.addOutputRule(function(c){var h;c.traversal(function(c){if("element"==c.type){if(a.options.autoClearEmptyNode&&dtd.$inline[c.tagName]&&!dtd.$empty[c.tagName]&&(!c.attrs||utils.isEmptyObject(c.attrs)))return void(c.firstChild()?"span"!=c.tagName||c.attrs&&!utils.isEmptyObject(c.attrs)||c.parentNode.removeChild(c,!0):c.parentNode.removeChild(c));switch(c.tagName){case"div":(h=c.getAttr("cdata_tag"))&&(c.tagName=h,c.appendChild(UE.uNode.createText(c.getAttr("cdata_data"))),c.setAttr({cdata_tag:"",cdata_data:"",_ue_custom_node_:""}));break;case"a":(h=c.getAttr("_href"))&&c.setAttr({href:utils.html(h),_href:""});break;case"span":h=c.getAttr("id"),h&&/^_baidu_bookmark_/i.test(h)&&c.parentNode.removeChild(c);break;case"img":(h=c.getAttr("_src"))&&c.setAttr({src:c.getAttr("_src"),_src:""})}}})})},UE.commands.inserthtml={execCommand:function(a,c,h){var g,v,b=this;if(c&&b.fireEvent("beforeinserthtml",c)!==!0){if(g=b.selection.getRange(),v=g.document.createElement("div"),v.style.display="inline",!h){var y=UE.htmlparser(c);b.options.filterRules&&UE.filterNode(y,b.options.filterRules),b.filterInputRule(y),c=y.toHtml()}if(v.innerHTML=utils.trim(c),!g.collapsed){var C=g.startContainer;if(domUtils.isFillChar(C)&&g.setStartBefore(C),C=g.endContainer,domUtils.isFillChar(C)&&g.setEndAfter(C),g.txtToElmBoundary(),g.endContainer&&1==g.endContainer.nodeType&&(C=g.endContainer.childNodes[g.endOffset],C&&domUtils.isBr(C)&&g.setEndAfter(C)),0==g.startOffset&&(C=g.startContainer,domUtils.isBoundaryNode(C,"firstChild")&&(C=g.endContainer,g.endOffset==(3==C.nodeType?C.nodeValue.length:C.childNodes.length)&&domUtils.isBoundaryNode(C,"lastChild")&&(b.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",g.setStart(b.body.firstChild,0).collapse(!0)))),!g.collapsed&&g.deleteContents(),1==g.startContainer.nodeType){var N,w=g.startContainer.childNodes[g.startOffset];if(w&&domUtils.isBlockElm(w)&&(N=w.previousSibling)&&domUtils.isBlockElm(N)){for(g.setEnd(N,N.childNodes.length).collapse();w.firstChild;)N.appendChild(w.firstChild);domUtils.remove(w)}}}var w,U,N,E,T,S=0;g.inFillChar()&&(w=g.startContainer,domUtils.isFillChar(w)?(g.setStartBefore(w).collapse(!0),domUtils.remove(w)):domUtils.isFillChar(w,!0)&&(w.nodeValue=w.nodeValue.replace(fillCharReg,""),g.startOffset--,g.collapsed&&g.collapse(!0)));var k=domUtils.findParentByTagName(g.startContainer,"li",!0);if(k){for(var B,I;w=v.firstChild;){for(;w&&(3==w.nodeType||!domUtils.isBlockElm(w)||"HR"==w.tagName);)B=w.nextSibling,g.insertNode(w).collapse(),I=w,w=B;if(w)if(/^(ol|ul)$/i.test(w.tagName)){for(;w.firstChild;)I=w.firstChild,domUtils.insertAfter(k,w.firstChild),k=k.nextSibling;domUtils.remove(w)}else{var _;B=w.nextSibling,_=b.document.createElement("li"),domUtils.insertAfter(k,_),_.appendChild(w),I=w,w=B,k=_}}k=domUtils.findParentByTagName(g.startContainer,"li",!0),domUtils.isEmptyBlock(k)&&domUtils.remove(k),I&&g.setStartAfter(I).collapse(!0).select(!0)}else{for(;w=v.firstChild;){if(S){for(var p=b.document.createElement("p");w&&(3==w.nodeType||!dtd.$block[w.tagName]);)T=w.nextSibling,p.appendChild(w),w=T;p.firstChild&&(w=p)}if(g.insertNode(w),T=w.nextSibling,!S&&w.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(w)&&(U=domUtils.findParent(w,function(a){return domUtils.isBlockElm(a)}),U&&"body"!=U.tagName.toLowerCase()&&(!dtd[U.tagName][w.nodeName]||w.parentNode!==U))){if(dtd[U.tagName][w.nodeName])for(E=w.parentNode;E!==U;)N=E,E=E.parentNode;else N=U;domUtils.breakParent(w,N||E);var N=w.previousSibling;domUtils.trimWhiteTextNode(N),N.childNodes.length||domUtils.remove(N),!browser.ie&&(B=w.nextSibling)&&domUtils.isBlockElm(B)&&B.lastChild&&!domUtils.isBr(B.lastChild)&&B.appendChild(b.document.createElement("br")),S=1}var B=w.nextSibling;if(!v.firstChild&&B&&domUtils.isBlockElm(B)){g.setStart(B,0).collapse(!0);break}g.setEndAfter(w).collapse()}if(w=g.startContainer,T&&domUtils.isBr(T)&&domUtils.remove(T),domUtils.isBlockElm(w)&&domUtils.isEmptyNode(w))if(T=w.nextSibling)domUtils.remove(w),1==T.nodeType&&dtd.$block[T.tagName]&&g.setStart(T,0).collapse(!0).shrinkBoundary();else try{w.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(e){g.setStartBefore(w),domUtils.remove(w)}try{g.select(!0)}catch(e){}}setTimeout(function(){g=b.selection.getRange(),g.scrollToView(b.autoHeightEnabled,b.autoHeightEnabled?domUtils.getXY(b.iframe).y:0),b.fireEvent("afterinserthtml",c)},200)}}},UE.plugins.autotypeset=function(){function a(a,c){return a&&3!=a.nodeType?domUtils.isBr(a)?1:a&&a.parentNode&&E[a.tagName.toLowerCase()]?y&&y.contains(a)||a.getAttribute("pagebreak")?0:c?!domUtils.isEmptyBlock(a):domUtils.isEmptyBlock(a,new RegExp("[\\s"+domUtils.fillChar+"]","g")):void 0:0}function c(a){a.style.cssText||(domUtils.removeAttributes(a,["style"]),"span"==a.tagName.toLowerCase()&&domUtils.hasNoAttributes(a)&&domUtils.remove(a,!0))}function h(h,b){var C,E=this;if(b){if(!N.pasteFilter)return;C=E.document.createElement("div"),C.innerHTML=b.html}else C=E.document.body;for(var T,S=domUtils.getElementsByTagName(C,"*"),i=0;T=S[i++];)if(E.fireEvent("excludeNodeinautotype",T)!==!0){if(N.clearFontSize&&T.style.fontSize&&(domUtils.removeStyle(T,"font-size"),c(T)),N.clearFontFamily&&T.style.fontFamily&&(domUtils.removeStyle(T,"font-family"),c(T)),a(T)){if(N.mergeEmptyline)for(var k,B=T.nextSibling,I=domUtils.isBr(T);a(B)&&(k=B,B=k.nextSibling,!I||B&&(!B||domUtils.isBr(B)));)domUtils.remove(k);if(N.removeEmptyline&&domUtils.inDoc(T,C)&&!U[T.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(T)&&(B=T.nextSibling,B&&!domUtils.isBr(B)))continue;domUtils.remove(T);continue}}if(a(T,!0)&&"SPAN"!=T.tagName&&(N.indent&&(T.style.textIndent=N.indentValue),N.textAlign&&(T.style.textAlign=N.textAlign)),N.removeClass&&T.className&&!w[T.className.toLowerCase()]){if(y&&y.contains(T))continue;domUtils.removeAttributes(T,["class"])}if(N.imageBlockLine&&"img"==T.tagName.toLowerCase()&&!T.getAttribute("emotion"))if(b){var _=T;switch(N.imageBlockLine){case"left":case"right":case"none":for(var k,A,B,L=_.parentNode;dtd.$inline[L.tagName]||"A"==L.tagName;)L=L.parentNode;if(k=L,"P"==k.tagName&&"center"==domUtils.getStyle(k,"text-align")&&!domUtils.isBody(k)&&1==domUtils.getChildCount(k,function(a){return!domUtils.isBr(a)&&!domUtils.isWhitespace(a)}))if(A=k.previousSibling,B=k.nextSibling,A&&B&&1==A.nodeType&&1==B.nodeType&&A.tagName==B.tagName&&domUtils.isBlockElm(A)){for(A.appendChild(k.firstChild);B.firstChild;)A.appendChild(B.firstChild);domUtils.remove(k),domUtils.remove(B)}else domUtils.setStyle(k,"text-align","");domUtils.setStyle(_,"float",N.imageBlockLine);break;case"center":if("center"!=E.queryCommandValue("imagefloat")){for(L=_.parentNode,domUtils.setStyle(_,"float","none"),k=_;L&&1==domUtils.getChildCount(L,function(a){return!domUtils.isBr(a)&&!domUtils.isWhitespace(a)})&&(dtd.$inline[L.tagName]||"A"==L.tagName);)k=L,L=L.parentNode;var R=E.document.createElement("p");domUtils.setAttributes(R,{style:"text-align:center"}),k.parentNode.insertBefore(R,k),R.appendChild(k),domUtils.setStyle(k,"float","")}}}else{var D=E.selection.getRange();D.selectNode(T).select(),E.execCommand("imagefloat",N.imageBlockLine)}N.removeEmptyNode&&N.removeTagNames[T.tagName.toLowerCase()]&&domUtils.hasNoAttributes(T)&&domUtils.isEmptyBlock(T)&&domUtils.remove(T)}if(N.tobdc){var O=UE.htmlparser(C.innerHTML);O.traversal(function(a){"text"==a.type&&(a.data=v(a.data))}),C.innerHTML=O.toHtml()}if(N.bdc2sb){var O=UE.htmlparser(C.innerHTML);O.traversal(function(a){"text"==a.type&&(a.data=g(a.data))}),C.innerHTML=O.toHtml()}b&&(b.html=C.innerHTML)}function g(a){for(var c="",i=0;i<a.length;i++){var h=a.charCodeAt(i);c+=h>=65281&&65373>=h?String.fromCharCode(a.charCodeAt(i)-65248):12288==h?String.fromCharCode(a.charCodeAt(i)-12288+32):a.charAt(i)}return c}function v(a){a=utils.html(a);for(var c="",i=0;i<a.length;i++)c+=32==a.charCodeAt(i)?String.fromCharCode(12288):a.charCodeAt(i)<127?String.fromCharCode(a.charCodeAt(i)+65248):a.charAt(i);return c}function b(){var a=C.getPreferences("autotypeset");utils.extend(C.options.autotypeset,a)}this.setOpt({autotypeset:{mergeEmptyline:!0,removeClass:!0,removeEmptyline:!1,textAlign:"left",imageBlockLine:"center",pasteFilter:!1,clearFontSize:!1,clearFontFamily:!1,removeEmptyNode:!1,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:!1,indentValue:"2em",bdc2sb:!1,tobdc:!1}});var y,C=this,N=C.options.autotypeset,w={selectTdClass:1,pagebreak:1,anchorclass:1},U={li:1},E={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1};N&&(b(),N.pasteFilter&&C.addListener("beforepaste",h),C.commands.autotypeset={execCommand:function(){C.removeListener("beforepaste",h),N.pasteFilter&&C.addListener("beforepaste",h),h.call(C)}})},UE.plugin.register("autosubmit",function(){return{shortcutkey:{autosubmit:"ctrl+13"},commands:{autosubmit:{execCommand:function(){var a=this,c=domUtils.findParentByTagName(a.iframe,"form",!1);if(c){if(a.fireEvent("beforesubmit")===!1)return;a.sync(),c.submit()}}}}}}),UE.plugin.register("background",function(){function a(a){var c={},h=a.split(";");return utils.each(h,function(a){var h=a.indexOf(":"),g=utils.trim(a.substr(0,h)).toLowerCase();g&&(c[g]=utils.trim(a.substr(h+1)||""))}),c}function c(a){if(a){var c=[];for(var h in a)a.hasOwnProperty(h)&&c.push(h+":"+a[h]+"; ");utils.cssRule(v,c.length?"body{"+c.join("")+"}":"",g.document)}else utils.cssRule(v,"",g.document)}var h,g=this,v="editor_background",b=new RegExp("body[\\s]*\\{(.+)\\}","i"),y=g.hasContents;return g.hasContents=function(){return g.queryCommandValue("background")?!0:y.apply(g,arguments)},{bindEvents:{getAllHtml:function(a,c){var h=this.body,v=domUtils.getComputedStyle(h,"background-image"),b="";b=v.indexOf(g.options.imagePath)>0?v.substring(v.indexOf(g.options.imagePath),v.length-1).replace(/"|\(|\)/gi,""):"none"!=v?v.replace(/url\("?|"?\)/gi,""):"";var y='<style type="text/css">body{',C={"background-color":domUtils.getComputedStyle(h,"background-color")||"#ffffff","background-image":b?"url("+b+")":"","background-repeat":domUtils.getComputedStyle(h,"background-repeat")||"","background-position":browser.ie?domUtils.getComputedStyle(h,"background-position-x")+" "+domUtils.getComputedStyle(h,"background-position-y"):domUtils.getComputedStyle(h,"background-position"),height:domUtils.getComputedStyle(h,"height")};
for(var N in C)C.hasOwnProperty(N)&&(y+=N+":"+C[N]+"; ");y+="}</style> ",c.push(y)},aftersetcontent:function(){0==h&&c()}},inputRule:function(g){h=!1,utils.each(g.getNodesByTagName("p"),function(p){var g=p.getAttr("data-background");g&&(h=!0,c(a(g)),p.parentNode.removeChild(p))})},outputRule:function(a){var c=this,h=(utils.cssRule(v,c.document)||"").replace(/[\n\r]+/g,"").match(b);h&&a.appendChild(UE.uNode.createElement('<p style="display:none;" data-background="'+utils.trim(h[1].replace(/"/g,"").replace(/[\s]+/g," "))+'"><br/></p>'))},commands:{background:{execCommand:function(a,h){c(h)},queryCommandValue:function(){var c=this,h=(utils.cssRule(v,c.document)||"").replace(/[\n\r]+/g,"").match(b);return h?a(h[1]):null},notNeedUndo:!0}}}}),UE.commands.imagefloat={execCommand:function(a,c){var h=this,g=h.selection.getRange();if(!g.collapsed){var v=g.getClosedNode();if(v&&"IMG"==v.tagName)switch(c){case"left":case"right":case"none":for(var b,y,C,N=v.parentNode;dtd.$inline[N.tagName]||"A"==N.tagName;)N=N.parentNode;if(b=N,"P"==b.tagName&&"center"==domUtils.getStyle(b,"text-align")){if(!domUtils.isBody(b)&&1==domUtils.getChildCount(b,function(a){return!domUtils.isBr(a)&&!domUtils.isWhitespace(a)}))if(y=b.previousSibling,C=b.nextSibling,y&&C&&1==y.nodeType&&1==C.nodeType&&y.tagName==C.tagName&&domUtils.isBlockElm(y)){for(y.appendChild(b.firstChild);C.firstChild;)y.appendChild(C.firstChild);domUtils.remove(b),domUtils.remove(C)}else domUtils.setStyle(b,"text-align","");g.selectNode(v).select()}domUtils.setStyle(v,"float","none"==c?"":c),"none"==c&&domUtils.removeAttributes(v,"align");break;case"center":if("center"!=h.queryCommandValue("imagefloat")){for(N=v.parentNode,domUtils.setStyle(v,"float",""),domUtils.removeAttributes(v,"align"),b=v;N&&1==domUtils.getChildCount(N,function(a){return!domUtils.isBr(a)&&!domUtils.isWhitespace(a)})&&(dtd.$inline[N.tagName]||"A"==N.tagName);)b=N,N=N.parentNode;g.setStartBefore(b).setCursor(!1),N=h.document.createElement("div"),N.appendChild(b),domUtils.setStyle(b,"float",""),h.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+N.innerHTML+"</p>"),b=h.document.getElementById("_img_parent_tmp"),b.removeAttribute("id"),b=b.firstChild,g.selectNode(b).select(),C=b.parentNode.nextSibling,C&&domUtils.isEmptyNode(C)&&domUtils.remove(C)}}}},queryCommandValue:function(){var a,c,h=this.selection.getRange();return h.collapsed?"none":(a=h.getClosedNode(),a&&1==a.nodeType&&"IMG"==a.tagName?(c=domUtils.getComputedStyle(a,"float")||a.getAttribute("align"),"none"==c&&(c="center"==domUtils.getComputedStyle(a.parentNode,"text-align")?"center":c),{left:1,right:1,center:1}[c]?c:"none"):"none")},queryCommandState:function(){var a,c=this.selection.getRange();return c.collapsed?-1:(a=c.getClosedNode(),a&&1==a.nodeType&&"IMG"==a.tagName?0:-1)}},UE.commands.insertimage={execCommand:function(a,c){if(c=utils.isArray(c)?c:[c],c.length){var h=this,g=h.selection.getRange(),v=g.getClosedNode();if(h.fireEvent("beforeinsertimage",c)!==!0){if(!v||!/img/i.test(v.tagName)||"edui-faked-video"==v.className&&-1==v.className.indexOf("edui-upload-video")||v.getAttribute("word_img")){var b,y=[],C="";if(b=c[0],1==c.length)C='<img src="'+b.src+'" '+(b._src?' _src="'+b._src+'" ':"")+(b.width?'width="'+b.width+'" ':"")+(b.height?' height="'+b.height+'" ':"")+("left"==b.floatStyle||"right"==b.floatStyle?' style="float:'+b.floatStyle+';"':"")+(b.title&&""!=b.title?' title="'+b.title+'"':"")+(b.border&&"0"!=b.border?' border="'+b.border+'"':"")+(b.alt&&""!=b.alt?' alt="'+b.alt+'"':"")+(b.hspace&&"0"!=b.hspace?' hspace = "'+b.hspace+'"':"")+(b.vspace&&"0"!=b.vspace?' vspace = "'+b.vspace+'"':"")+"/>","center"==b.floatStyle&&(C='<p style="text-align: center">'+C+"</p>"),y.push(C);else for(var i=0;b=c[i++];)C="<p "+("center"==b.floatStyle?'style="text-align: center" ':"")+'><img src="'+b.src+'" '+(b.width?'width="'+b.width+'" ':"")+(b._src?' _src="'+b._src+'" ':"")+(b.height?' height="'+b.height+'" ':"")+' style="'+(b.floatStyle&&"center"!=b.floatStyle?"float:"+b.floatStyle+";":"")+(b.border||"")+'" '+(b.title?' title="'+b.title+'"':"")+" /></p>",y.push(C);h.execCommand("insertHtml",y.join(""))}else{var N=c.shift(),w=N.floatStyle;delete N.floatStyle,domUtils.setAttributes(v,N),h.execCommand("imagefloat",w),c.length>0&&(g.setStartAfter(v).setCursor(!1,!0),h.execCommand("insertimage",c))}h.fireEvent("afterinsertimage",c)}}}},UE.plugins.justify=function(){var a=domUtils.isBlockElm,c={left:1,right:1,center:1,justify:1},h=function(c,h){var g=c.createBookmark(),v=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase()&&!domUtils.isBookmarkNode(a):!domUtils.isWhitespace(a)};c.enlarge(!0);for(var b,y=c.createBookmark(),C=domUtils.getNextDomNode(y.start,!1,v),N=c.cloneRange();C&&!(domUtils.getPosition(C,y.end)&domUtils.POSITION_FOLLOWING);)if(3!=C.nodeType&&a(C))C=domUtils.getNextDomNode(C,!0,v);else{for(N.setStartBefore(C);C&&C!==y.end&&!a(C);)b=C,C=domUtils.getNextDomNode(C,!1,null,function(c){return!a(c)});N.setEndAfter(b);var w=N.getCommonAncestor();if(!domUtils.isBody(w)&&a(w))domUtils.setStyles(w,utils.isString(h)?{"text-align":h}:h),C=w;else{var p=c.document.createElement("p");domUtils.setStyles(p,utils.isString(h)?{"text-align":h}:h);var U=N.extractContents();p.appendChild(U),N.insertNode(p),C=p}C=domUtils.getNextDomNode(C,!1,v)}return c.moveToBookmark(y).moveToBookmark(g)};UE.commands.justify={execCommand:function(a,c){var g,v=this.selection.getRange();return v.collapsed&&(g=this.document.createTextNode("p"),v.insertNode(g)),h(v,c),g&&(v.setStartBefore(g).collapse(!0),domUtils.remove(g)),v.select(),!0},queryCommandValue:function(){var a=this.selection.getStart(),h=domUtils.getComputedStyle(a,"text-align");return c[h]?h:"left"},queryCommandState:function(){var a=this.selection.getStart(),c=a&&domUtils.findParentByTagName(a,["td","th","caption"],!0);return c?-1:0}}},UE.plugins.font=function(){function a(a){for(var c;(c=a.parentNode)&&"SPAN"==c.tagName&&1==domUtils.getChildCount(c,function(a){return!domUtils.isBookmarkNode(a)&&!domUtils.isBr(a)});)c.style.cssText+=a.style.cssText,domUtils.remove(a,!0),a=c}function c(a,c,h){if(y[c]&&(a.adjustmentBoundary(),!a.collapsed&&1==a.startContainer.nodeType)){var g=a.startContainer.childNodes[a.startOffset];if(g&&domUtils.isTagNode(g,"span")){var v=a.createBookmark();utils.each(domUtils.getElementsByTagName(g,"span"),function(a){a.parentNode&&!domUtils.isBookmarkNode(a)&&("backcolor"!=c||domUtils.getComputedStyle(a,"background-color").toLowerCase()!==h)&&(domUtils.removeStyle(a,y[c]),0==a.style.cssText.replace(/^\s+$/,"").length&&domUtils.remove(a,!0))}),a.moveToBookmark(v)}}}function h(h,g,v){var b,y=h.collapsed,C=h.createBookmark();if(y)for(b=C.start.parentNode;dtd.$inline[b.tagName];)b=b.parentNode;else b=domUtils.getCommonAncestor(C.start,C.end);utils.each(domUtils.getElementsByTagName(b,"span"),function(c){if(c.parentNode&&!domUtils.isBookmarkNode(c)){if(/\s*border\s*:\s*none;?\s*/i.test(c.style.cssText))return void(/^\s*border\s*:\s*none;?\s*$/.test(c.style.cssText)?domUtils.remove(c,!0):domUtils.removeStyle(c,"border"));if(/border/i.test(c.style.cssText)&&"SPAN"==c.parentNode.tagName&&/border/i.test(c.parentNode.style.cssText)&&(c.style.cssText=c.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")),"fontborder"!=g||"none"!=v)for(var h=c.nextSibling;h&&1==h.nodeType&&"SPAN"==h.tagName;)if(domUtils.isBookmarkNode(h)&&"fontborder"==g)c.appendChild(h),h=c.nextSibling;else{if(h.style.cssText==c.style.cssText&&(domUtils.moveChild(h,c),domUtils.remove(h)),c.nextSibling===h)break;h=c.nextSibling}if(a(c),browser.ie&&browser.version>8){var b=domUtils.findParent(c,function(n){return"SPAN"==n.tagName&&/background-color/.test(n.style.cssText)});b&&!/background-color/.test(c.style.cssText)&&(c.style.backgroundColor=b.style.backgroundColor)}}}),h.moveToBookmark(C),c(h,g,v)}var g=this,v={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},b={underline:1,strikethrough:1,fontborder:1},y={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};g.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]}),g.addInputRule(function(a){utils.each(a.getNodesByTagName("u s del font strike"),function(a){if("font"==a.tagName){var c=[];for(var p in a.attrs)switch(p){case"size":c.push("font-size:"+({1:"10",2:"12",3:"16",4:"18",5:"24",6:"32",7:"48"}[a.attrs[p]]||a.attrs[p])+"px");break;case"color":c.push("color:"+a.attrs[p]);break;case"face":c.push("font-family:"+a.attrs[p]);break;case"style":c.push(a.attrs[p])}a.attrs={style:c.join(";")}}else{var h="u"==a.tagName?"underline":"line-through";a.attrs={style:(a.getAttr("style")||"")+"text-decoration:"+h+";"}}a.tagName="span"})});for(var p in v)!function(a,c){UE.commands[a]={execCommand:function(g,v){v=v||(this.queryCommandState(g)?"none":"underline"==g?"underline":"fontborder"==g?"1px solid #000":"line-through");var y,C=this,N=this.selection.getRange();if("default"==v)N.collapsed&&(y=C.document.createTextNode("font"),N.insertNode(y).select()),C.execCommand("removeFormat","span,a",c),y&&(N.setStartBefore(y).collapse(!0),domUtils.remove(y)),h(N,g,v),N.select();else if(N.collapsed){var w=domUtils.findParentByTagName(N.startContainer,"span",!0);if(y=C.document.createTextNode("font"),!w||w.children.length||w[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){if(N.insertNode(y),N.selectNode(y).select(),w=N.document.createElement("span"),b[a]){if(domUtils.findParentByTagName(y,"a",!0))return N.setStartBefore(y).setCursor(),void domUtils.remove(y);C.execCommand("removeFormat","span,a",c)}if(w.style.cssText=c+":"+v,y.parentNode.insertBefore(w,y),!browser.ie||browser.ie&&9==browser.version)for(var U=w.parentNode;!domUtils.isBlockElm(U);)"SPAN"==U.tagName&&(w.style.cssText=U.style.cssText+";"+w.style.cssText),U=U.parentNode;opera?setTimeout(function(){N.setStart(w,0).collapse(!0),h(N,g,v),N.select()}):(N.setStart(w,0).collapse(!0),h(N,g,v),N.select())}else N.insertNode(y),b[a]&&(N.selectNode(y).select(),C.execCommand("removeFormat","span,a",c,null),w=domUtils.findParentByTagName(y,"span",!0),N.setStartBefore(y)),w&&(w.style.cssText+=";"+c+":"+v),N.collapse(!0).select();domUtils.remove(y)}else b[a]&&C.queryCommandValue(a)&&C.execCommand("removeFormat","span,a",c),N=C.selection.getRange(),N.applyInlineStyle("span",{style:c+":"+v}),h(N,g,v),N.select();return!0},queryCommandValue:function(a){var h=this.selection.getStart();if("underline"==a||"strikethrough"==a){for(var g,v=h;v&&!domUtils.isBlockElm(v)&&!domUtils.isBody(v);){if(1==v.nodeType&&(g=domUtils.getComputedStyle(v,c),"none"!=g))return g;v=v.parentNode}return"none"}if("fontborder"==a){for(var b,y=h;y&&dtd.$inline[y.tagName];){if((b=domUtils.getComputedStyle(y,"border"))&&/1px/.test(b)&&/solid/.test(b))return b;y=y.parentNode}return""}if("FontSize"==a){var C=domUtils.getComputedStyle(h,c),y=/^([\d\.]+)(\w+)$/.exec(C);return y?Math.floor(y[1])+y[2]:C}return domUtils.getComputedStyle(h,c)},queryCommandState:function(a){if(!b[a])return 0;var c=this.queryCommandValue(a);return"fontborder"==a?/1px/.test(c)&&/solid/.test(c):"underline"==a?/underline/.test(c):/line\-through/.test(c)}}}(p,v[p])},UE.plugins.link=function(){function a(a){var c=a.startContainer,h=a.endContainer;(c=domUtils.findParentByTagName(c,"a",!0))&&a.setStartBefore(c),(h=domUtils.findParentByTagName(h,"a",!0))&&a.setEndAfter(h)}function c(c,h,g){var v=c.cloneRange(),b=g.queryCommandValue("link");a(c=c.adjustmentBoundary());var y=c.startContainer;if(1==y.nodeType&&b&&(y=y.childNodes[c.startOffset],y&&1==y.nodeType&&"A"==y.tagName&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(y[browser.ie?"innerText":"textContent"])&&(y[browser.ie?"innerText":"textContent"]=utils.html(h.textValue||h.href))),(!v.collapsed||b)&&(c.removeInlineStyle("a"),v=c.cloneRange()),v.collapsed){var C=c.document.createElement("a"),N="";h.textValue?(N=utils.html(h.textValue),delete h.textValue):N=utils.html(h.href),domUtils.setAttributes(C,h),y=domUtils.findParentByTagName(v.startContainer,"a",!0),y&&domUtils.isInNodeEndBoundary(v,y)&&c.setStartAfter(y).collapse(!0),C[browser.ie?"innerText":"textContent"]=N,c.insertNode(C).selectNode(C)}else c.applyInlineStyle("a",h)}UE.commands.unlink={execCommand:function(){var c,h=this.selection.getRange();(!h.collapsed||domUtils.findParentByTagName(h.startContainer,"a",!0))&&(c=h.createBookmark(),a(h),h.removeInlineStyle("a").moveToBookmark(c).select())},queryCommandState:function(){return!this.highlight&&this.queryCommandValue("link")?0:-1}},UE.commands.link={execCommand:function(a,h){var g;h._href&&(h._href=utils.unhtml(h._href,/[<">]/g)),h.href&&(h.href=utils.unhtml(h.href,/[<">]/g)),h.textValue&&(h.textValue=utils.unhtml(h.textValue,/[<">]/g)),c(g=this.selection.getRange(),h,this),g.collapse().select(!0)},queryCommandValue:function(){var a,c=this.selection.getRange();if(!c.collapsed){c.shrinkBoundary();var h=3!=c.startContainer.nodeType&&c.startContainer.childNodes[c.startOffset]?c.startContainer.childNodes[c.startOffset]:c.startContainer,g=3==c.endContainer.nodeType||0==c.endOffset?c.endContainer:c.endContainer.childNodes[c.endOffset-1],v=c.getCommonAncestor();if(a=domUtils.findParentByTagName(v,"a",!0),!a&&1==v.nodeType)for(var b,y,C,N=v.getElementsByTagName("a"),i=0;C=N[i++];)if(b=domUtils.getPosition(C,h),y=domUtils.getPosition(C,g),(b&domUtils.POSITION_FOLLOWING||b&domUtils.POSITION_CONTAINS)&&(y&domUtils.POSITION_PRECEDING||y&domUtils.POSITION_CONTAINS)){a=C;break}return a}return a=c.startContainer,a=1==a.nodeType?a:a.parentNode,a&&(a=domUtils.findParentByTagName(a,"a",!0))&&!domUtils.isInNodeEndBoundary(c,a)?a:void 0},queryCommandState:function(){var a=this.selection.getRange().getClosedNode(),c=a&&("edui-faked-video"==a.className||-1!=a.className.indexOf("edui-upload-video"));return c?-1:0}}},UE.plugins.insertframe=function(){function a(){c._iframe&&delete c._iframe}var c=this;c.addListener("selectionchange",function(){a()})},UE.commands.scrawl={queryCommandState:function(){return browser.ie&&browser.version<=8?-1:0}},UE.plugins.removeformat=function(){var a=this;a.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),a.commands.removeformat={execCommand:function(a,c,h,g,v){function b(a){if(3==a.nodeType||"span"!=a.tagName.toLowerCase())return 0;if(browser.ie){var c=a.attributes;if(c.length){for(var i=0,l=c.length;l>i;i++)if(c[i].specified)return 0;return 1}}return!a.attributes.length}function y(a){var c=a.createBookmark();if(a.collapsed&&a.enlarge(!0),!v){var g=domUtils.findParentByTagName(a.startContainer,"a",!0);g&&a.setStartBefore(g),g=domUtils.findParentByTagName(a.endContainer,"a",!0),g&&a.setEndAfter(g)}for(C=a.createBookmark(),B=C.start;(N=B.parentNode)&&!domUtils.isBlockElm(N);)domUtils.breakParent(B,N),domUtils.clearEmptySibling(B);if(C.end){for(B=C.end;(N=B.parentNode)&&!domUtils.isBlockElm(N);)domUtils.breakParent(B,N),domUtils.clearEmptySibling(B);for(var y,E=domUtils.getNextDomNode(C.start,!1,T);E&&E!=C.end;)y=domUtils.getNextDomNode(E,!0,T),dtd.$empty[E.tagName.toLowerCase()]||domUtils.isBookmarkNode(E)||(w.test(E.tagName)?h?(domUtils.removeStyle(E,h),b(E)&&"text-decoration"!=h&&domUtils.remove(E,!0)):domUtils.remove(E,!0):dtd.$tableContent[E.tagName]||dtd.$list[E.tagName]||(domUtils.removeAttributes(E,U),b(E)&&domUtils.remove(E,!0))),E=y}var S=C.start.parentNode;!domUtils.isBlockElm(S)||dtd.$tableContent[S.tagName]||dtd.$list[S.tagName]||domUtils.removeAttributes(S,U),S=C.end.parentNode,C.end&&domUtils.isBlockElm(S)&&!dtd.$tableContent[S.tagName]&&!dtd.$list[S.tagName]&&domUtils.removeAttributes(S,U),a.moveToBookmark(C).moveToBookmark(c);for(var k,B=a.startContainer,I=a.collapsed;1==B.nodeType&&domUtils.isEmptyNode(B)&&dtd.$removeEmpty[B.tagName];)k=B.parentNode,a.setStartBefore(B),a.startContainer===a.endContainer&&a.endOffset--,domUtils.remove(B),B=k;if(!I)for(B=a.endContainer;1==B.nodeType&&domUtils.isEmptyNode(B)&&dtd.$removeEmpty[B.tagName];)k=B.parentNode,a.setEndBefore(B),domUtils.remove(B),B=k}var C,N,w=new RegExp("^(?:"+(c||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),U=h?[]:(g||this.options.removeFormatAttributes).split(","),E=new dom.Range(this.document),T=function(a){return 1==a.nodeType};E=this.selection.getRange(),y(E),E.select()}}},UE.plugins.blockquote=function(){function a(a){return domUtils.filterNodeList(a.selection.getStartElementPath(),"blockquote")}var c=this;c.commands.blockquote={execCommand:function(c,h){var g=this.selection.getRange(),v=a(this),b=dtd.blockquote,y=g.createBookmark();if(v){var C=g.startContainer,N=domUtils.isBlockElm(C)?C:domUtils.findParent(C,function(a){return domUtils.isBlockElm(a)}),w=g.endContainer,U=domUtils.isBlockElm(w)?w:domUtils.findParent(w,function(a){return domUtils.isBlockElm(a)});N=domUtils.findParentByTagName(N,"li",!0)||N,U=domUtils.findParentByTagName(U,"li",!0)||U,"LI"==N.tagName||"TD"==N.tagName||N===v||domUtils.isBody(N)?domUtils.remove(v,!0):domUtils.breakParent(N,v),N!==U&&(v=domUtils.findParentByTagName(U,"blockquote"),v&&("LI"==U.tagName||"TD"==U.tagName||domUtils.isBody(U)?v.parentNode&&domUtils.remove(v,!0):domUtils.breakParent(U,v)));for(var E,T=domUtils.getElementsByTagName(this.document,"blockquote"),i=0;E=T[i++];)E.childNodes.length?domUtils.getPosition(E,N)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(E,U)&domUtils.POSITION_PRECEDING&&domUtils.remove(E,!0):domUtils.remove(E)}else{for(var S=g.cloneRange(),k=1==S.startContainer.nodeType?S.startContainer:S.startContainer.parentNode,B=k,I=1;;){if(domUtils.isBody(k)){B!==k?g.collapsed?(S.selectNode(B),I=0):S.setStartBefore(B):S.setStart(k,0);break}if(!b[k.tagName]){g.collapsed?S.selectNode(B):S.setStartBefore(B);break}B=k,k=k.parentNode}if(I)for(B=k=k=1==S.endContainer.nodeType?S.endContainer:S.endContainer.parentNode;;){if(domUtils.isBody(k)){B!==k?S.setEndAfter(B):S.setEnd(k,k.childNodes.length);break}if(!b[k.tagName]){S.setEndAfter(B);break}B=k,k=k.parentNode}k=g.document.createElement("blockquote"),domUtils.setAttributes(k,h),k.appendChild(S.extractContents()),S.insertNode(k);for(var _,A=domUtils.getElementsByTagName(k,"blockquote"),i=0;_=A[i++];)_.parentNode&&domUtils.remove(_,!0)}g.moveToBookmark(y).select()},queryCommandState:function(){return a(this)?1:0}}},UE.commands.touppercase=UE.commands.tolowercase={execCommand:function(a){var c=this,h=c.selection.getRange();if(h.collapsed)return h;for(var g=h.createBookmark(),v=g.end,b=function(a){return!domUtils.isBr(a)&&!domUtils.isWhitespace(a)},y=domUtils.getNextDomNode(g.start,!1,b);y&&domUtils.getPosition(y,v)&domUtils.POSITION_PRECEDING&&(3==y.nodeType&&(y.nodeValue=y.nodeValue["touppercase"==a?"toUpperCase":"toLowerCase"]()),y=domUtils.getNextDomNode(y,!0,b),y!==v););h.moveToBookmark(g).select()}},UE.commands.indent={execCommand:function(){var a=this,c=a.queryCommandState("indent")?"0em":a.options.indentValue||"2em";a.execCommand("Paragraph","p",{style:"text-indent:"+c})},queryCommandState:function(){var a=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return a&&a.style.textIndent&&parseInt(a.style.textIndent)?1:0}},UE.commands.print={execCommand:function(){this.window.print()},notNeedUndo:1},UE.commands.preview={execCommand:function(){var a=window.open("","_blank",""),d=a.document;d.open(),d.write('<!DOCTYPE html><html><head><meta charset="utf-8"/><script src="'+this.options.UEDITOR_HOME_URL+"ueditor.parse.js\"></script><script>setTimeout(function(){uParse('div',{rootPath: '"+this.options.UEDITOR_HOME_URL+"'})},300)</script></head><body><div>"+this.getContent(null,null,!0)+"</div></body></html>"),d.close()},notNeedUndo:1},UE.plugins.selectall=function(){var a=this;a.commands.selectall={execCommand:function(){var a=this,c=a.body,h=a.selection.getRange();h.selectNodeContents(c),domUtils.isEmptyBlock(c)&&(browser.opera&&c.firstChild&&1==c.firstChild.nodeType&&h.setStartAtFirst(c.firstChild),h.collapse(!0)),h.select(!0)},notNeedUndo:1},a.addshortcutkey({selectAll:"ctrl+65"})},UE.plugins.paragraph=function(){var a=this,c=domUtils.isBlockElm,h=["TD","LI","PRE"],g=function(a,g,v,b){var y,C=a.createBookmark(),N=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase()&&!domUtils.isBookmarkNode(a):!domUtils.isWhitespace(a)};a.enlarge(!0);for(var w,U=a.createBookmark(),E=domUtils.getNextDomNode(U.start,!1,N),T=a.cloneRange();E&&!(domUtils.getPosition(E,U.end)&domUtils.POSITION_FOLLOWING);)if(3!=E.nodeType&&c(E))E=domUtils.getNextDomNode(E,!0,N);else{for(T.setStartBefore(E);E&&E!==U.end&&!c(E);)w=E,E=domUtils.getNextDomNode(E,!1,null,function(a){return!c(a)});T.setEndAfter(w),y=a.document.createElement(g),v&&(domUtils.setAttributes(y,v),b&&"customstyle"==b&&v.style&&(y.style.cssText=v.style)),y.appendChild(T.extractContents()),domUtils.isEmptyNode(y)&&domUtils.fillChar(a.document,y),T.insertNode(y);var S=y.parentNode;c(S)&&!domUtils.isBody(y.parentNode)&&-1==utils.indexOf(h,S.tagName)&&(b&&"customstyle"==b||(S.getAttribute("dir")&&y.setAttribute("dir",S.getAttribute("dir")),S.style.cssText&&(y.style.cssText=S.style.cssText+";"+y.style.cssText),S.style.textAlign&&!y.style.textAlign&&(y.style.textAlign=S.style.textAlign),S.style.textIndent&&!y.style.textIndent&&(y.style.textIndent=S.style.textIndent),S.style.padding&&!y.style.padding&&(y.style.padding=S.style.padding)),v&&/h\d/i.test(S.tagName)&&!/h\d/i.test(y.tagName)?(domUtils.setAttributes(S,v),b&&"customstyle"==b&&v.style&&(S.style.cssText=v.style),domUtils.remove(y,!0),y=S):domUtils.remove(y.parentNode,!0)),E=-1!=utils.indexOf(h,S.tagName)?S:y,E=domUtils.getNextDomNode(E,!1,N)}return a.moveToBookmark(U).moveToBookmark(C)};a.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),a.commands.paragraph={execCommand:function(a,c,h,v){var b=this.selection.getRange();if(b.collapsed){var y=this.document.createTextNode("p");if(b.insertNode(y),browser.ie){var C=y.previousSibling;C&&domUtils.isWhitespace(C)&&domUtils.remove(C),C=y.nextSibling,C&&domUtils.isWhitespace(C)&&domUtils.remove(C)}}if(b=g(b,c,h,v),y&&(b.setStartBefore(y).collapse(!0),pN=y.parentNode,domUtils.remove(y),domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)&&domUtils.fillNode(this.document,pN)),browser.gecko&&b.collapsed&&1==b.startContainer.nodeType){var N=b.startContainer.childNodes[b.startOffset];N&&1==N.nodeType&&N.tagName.toLowerCase()==c&&b.setStart(N,0).collapse(!0)}return b.select(),!0},queryCommandValue:function(){var a=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return a?a.tagName.toLowerCase():""}}},function(){var a=domUtils.isBlockElm,c=function(a){return domUtils.filterNodeList(a.selection.getStartElementPath(),function(n){return n&&1==n.nodeType&&n.getAttribute("dir")})},h=function(h,g,v){var b,y=function(a){return 1==a.nodeType?!domUtils.isBookmarkNode(a):!domUtils.isWhitespace(a)},C=c(g);if(C&&h.collapsed)return C.setAttribute("dir",v),h;b=h.createBookmark(),h.enlarge(!0);for(var N,w=h.createBookmark(),U=domUtils.getNextDomNode(w.start,!1,y),E=h.cloneRange();U&&!(domUtils.getPosition(U,w.end)&domUtils.POSITION_FOLLOWING);)if(3!=U.nodeType&&a(U))U=domUtils.getNextDomNode(U,!0,y);else{for(E.setStartBefore(U);U&&U!==w.end&&!a(U);)N=U,U=domUtils.getNextDomNode(U,!1,null,function(c){return!a(c)});E.setEndAfter(N);var T=E.getCommonAncestor();if(!domUtils.isBody(T)&&a(T))T.setAttribute("dir",v),U=T;else{var p=h.document.createElement("p");p.setAttribute("dir",v);var S=E.extractContents();p.appendChild(S),E.insertNode(p),U=p}U=domUtils.getNextDomNode(U,!1,y)}return h.moveToBookmark(w).moveToBookmark(b)};UE.commands.directionality={execCommand:function(a,c){var g=this.selection.getRange();if(g.collapsed){var v=this.document.createTextNode("d");g.insertNode(v)}return h(g,this,c),v&&(g.setStartBefore(v).collapse(!0),domUtils.remove(v)),g.select(),!0},queryCommandValue:function(){var a=c(this);return a?a.getAttribute("dir"):"ltr"}}}(),UE.plugins.horizontal=function(){var a=this;a.commands.horizontal={execCommand:function(a){var c=this;if(-1!==c.queryCommandState(a)){c.execCommand("insertHtml","<hr>");var h=c.selection.getRange(),g=h.startContainer;if(1==g.nodeType&&!g.childNodes[h.startOffset]){var v;(v=g.childNodes[h.startOffset-1])&&1==v.nodeType&&"HR"==v.tagName&&("p"==c.options.enterTag?(v=c.document.createElement("p"),h.insertNode(v),h.setStart(v,0).setCursor()):(v=c.document.createElement("br"),h.insertNode(v),h.setStartBefore(v).setCursor()))}return!0}},queryCommandState:function(){return domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}},a.addListener("delkeydown",function(a,c){var h=this.selection.getRange();if(h.txtToElmBoundary(!0),domUtils.isStartInblock(h)){var g=h.startContainer,v=g.previousSibling;if(v&&domUtils.isTagNode(v,"hr"))return domUtils.remove(v),h.select(),domUtils.preventDefault(c),!0}})},UE.commands.time=UE.commands.date={execCommand:function(a,c){function h(a,c){var h=("0"+a.getHours()).slice(-2),g=("0"+a.getMinutes()).slice(-2),v=("0"+a.getSeconds()).slice(-2);return c=c||"hh:ii:ss",c.replace(/hh/gi,h).replace(/ii/gi,g).replace(/ss/gi,v)}function g(a,c){var h=("000"+a.getFullYear()).slice(-4),g=h.slice(-2),v=("0"+(a.getMonth()+1)).slice(-2),b=("0"+a.getDate()).slice(-2);return c=c||"yyyy-mm-dd",c.replace(/yyyy/gi,h).replace(/yy/gi,g).replace(/mm/gi,v).replace(/dd/gi,b)}var v=new Date;this.execCommand("insertHtml","time"==a?h(v,c):g(v,c))}},UE.plugins.rowspacing=function(){var a=this;a.setOpt({rowspacingtop:["5","10","15","20","25"],rowspacingbottom:["5","10","15","20","25"]}),a.commands.rowspacing={execCommand:function(a,c,h){return this.execCommand("paragraph","p",{style:"margin-"+h+":"+c+"px"}),!0},queryCommandValue:function(a,c){var h,g=domUtils.filterNodeList(this.selection.getStartElementPath(),function(a){return domUtils.isBlockElm(a)});return g?(h=domUtils.getComputedStyle(g,"margin-"+c).replace(/[^\d]/g,""),h?h:0):0}}},UE.plugins.lineheight=function(){var a=this;a.setOpt({lineheight:["1","1.5","1.75","2","3","4","5"]}),a.commands.lineheight={execCommand:function(a,c){return this.execCommand("paragraph","p",{style:"line-height:"+("1"==c?"normal":c+"em")}),!0},queryCommandValue:function(){var a=domUtils.filterNodeList(this.selection.getStartElementPath(),function(a){return domUtils.isBlockElm(a)});if(a){var c=domUtils.getComputedStyle(a,"line-height");return"normal"==c?1:c.replace(/[^\d.]*/gi,"")}}}},UE.plugins.insertcode=function(){var a=this;a.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",a.document)}),a.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"}),a.commands.insertcode={execCommand:function(a,c){var h=this,g=h.selection.getRange(),v=domUtils.findParentByTagName(g.startContainer,"pre",!0);if(v)v.className="brush:"+c+";toolbar:false;";else{var b="";if(g.collapsed)b=browser.ie&&browser.ie11below?browser.version<=8?"&nbsp;":"":"<br/>";else{var y=g.extractContents(),C=h.document.createElement("div");C.appendChild(y),utils.each(UE.filterNode(UE.htmlparser(C.innerHTML.replace(/[\r\t]/g,"")),h.options.filterTxtRules).children,function(a){if(browser.ie&&browser.ie11below&&browser.version>8)"element"==a.type?"br"==a.tagName?b+="\n":dtd.$empty[a.tagName]||(utils.each(a.children,function(c){"element"==c.type?"br"==c.tagName?b+="\n":dtd.$empty[a.tagName]||(b+=c.innerText()):b+=c.data}),/\n$/.test(b)||(b+="\n")):b+=a.data+"\n",!a.nextSibling()&&/\n$/.test(b)&&(b=b.replace(/\n$/,""));else if(browser.ie&&browser.ie11below)"element"==a.type?"br"==a.tagName?b+="<br>":dtd.$empty[a.tagName]||(utils.each(a.children,function(c){"element"==c.type?"br"==c.tagName?b+="<br>":dtd.$empty[a.tagName]||(b+=c.innerText()):b+=c.data}),/br>$/.test(b)||(b+="<br>")):b+=a.data+"<br>",!a.nextSibling()&&/<br>$/.test(b)&&(b=b.replace(/<br>$/,""));else if(b+="element"==a.type?dtd.$empty[a.tagName]?"":a.innerText():a.data,!/br\/?\s*>$/.test(b)){if(!a.nextSibling())return;b+="<br>"}})}h.execCommand("inserthtml",'<pre id="coder"class="brush:'+c+';toolbar:false">'+b+"</pre>",!0),v=h.document.getElementById("coder"),domUtils.removeAttributes(v,"id");var N=v.previousSibling;N&&(3==N.nodeType&&1==N.nodeValue.length&&browser.ie&&6==browser.version||domUtils.isEmptyBlock(N))&&domUtils.remove(N);var g=h.selection.getRange();domUtils.isEmptyBlock(v)?g.setStart(v,0).setCursor(!1,!0):g.selectNodeContents(v).select()}},queryCommandValue:function(){var a=this.selection.getStartElementPath(),c="";return utils.each(a,function(a){if("PRE"==a.nodeName){var h=a.className.match(/brush:([^;]+)/);return c=h&&h[1]?h[1]:"",!1}}),c}},a.addInputRule(function(a){utils.each(a.getNodesByTagName("pre"),function(a){var c=a.getNodesByTagName("br");if(c.length)return void(browser.ie&&browser.ie11below&&browser.version>8&&utils.each(c,function(a){var c=UE.uNode.createText("\n");a.parentNode.insertBefore(c,a),a.parentNode.removeChild(a)}));if(!(browser.ie&&browser.ie11below&&browser.version>8)){var h=a.innerText().split(/\n/);a.innerHTML(""),utils.each(h,function(c){c.length&&a.appendChild(UE.uNode.createText(c)),a.appendChild(UE.uNode.createElement("br"))})}})}),a.addOutputRule(function(a){utils.each(a.getNodesByTagName("pre"),function(a){var c="";utils.each(a.children,function(n){c+="text"==n.type?n.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,""):"br"==n.tagName?"\n":dtd.$empty[n.tagName]?n.innerText():""}),a.innerText(c.replace(/(&nbsp;|\n)+$/,""))})}),a.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,selectall:1};a.queryCommandState;a.queryCommandState=function(a){var c=this;return!c.notNeedCodeQuery[a.toLowerCase()]&&c.selection&&c.queryCommandValue("insertcode")?-1:UE.Editor.prototype.queryCommandState.apply(this,arguments)},a.addListener("beforeenterkeydown",function(){var c=a.selection.getRange(),h=domUtils.findParentByTagName(c.startContainer,"pre",!0);if(h){if(a.fireEvent("saveScene"),c.collapsed||c.deleteContents(),!browser.ie||browser.ie9above){var h,g=a.document.createElement("br");c.insertNode(g).setStartAfter(g).collapse(!0);var v=g.nextSibling;v||browser.ie&&!(browser.version>10)?c.setStartAfter(g):c.insertNode(g.cloneNode(!1)),h=g.previousSibling;for(var b;h;)if(b=h,h=h.previousSibling,!h||"BR"==h.nodeName){h=b;break}if(h){for(var y="";h&&"BR"!=h.nodeName&&new RegExp("^[\\s"+domUtils.fillChar+"]*$").test(h.nodeValue);)y+=h.nodeValue,h=h.nextSibling;if("BR"!=h.nodeName){var C=h.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)"));C&&C[1]&&(y+=C[1])}y&&(y=a.document.createTextNode(y),c.insertNode(y).setStartAfter(y))}c.collapse(!0).select(!0)}else if(browser.version>8){var N=a.document.createTextNode("\n"),w=c.startContainer;if(0==c.startOffset){var U=w.previousSibling;if(U){c.insertNode(N);var E=a.document.createTextNode(" ");c.setStartAfter(N).insertNode(E).setStart(E,0).collapse(!0).select(!0)}}else{c.insertNode(N).setStartAfter(N);var E=a.document.createTextNode(" ");w=c.startContainer.childNodes[c.startOffset],w&&!/^\n/.test(w.nodeValue)&&c.setStartBefore(N),c.insertNode(E).setStart(E,0).collapse(!0).select(!0)
}}else{var g=a.document.createElement("br");c.insertNode(g),c.insertNode(a.document.createTextNode(domUtils.fillChar)),c.setStartAfter(g),h=g.previousSibling;for(var b;h;)if(b=h,h=h.previousSibling,!h||"BR"==h.nodeName){h=b;break}if(h){for(var y="";h&&"BR"!=h.nodeName&&new RegExp("^[ "+domUtils.fillChar+"]*$").test(h.nodeValue);)y+=h.nodeValue,h=h.nextSibling;if("BR"!=h.nodeName){var C=h.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)"));C&&C[1]&&(y+=C[1])}y=a.document.createTextNode(y),c.insertNode(y).setStartAfter(y)}c.collapse(!0).select()}return a.fireEvent("saveScene"),!0}}),a.addListener("tabkeydown",function(c,h){var g=a.selection.getRange(),v=domUtils.findParentByTagName(g.startContainer,"pre",!0);if(v){if(a.fireEvent("saveScene"),h.shiftKey);else if(g.collapsed){var b=a.document.createTextNode("    ");g.insertNode(b).setStartAfter(b).collapse(!0).select(!0)}else{for(var y=g.createBookmark(),C=y.start.previousSibling;C;){if(v.firstChild===C&&!domUtils.isBr(C)){v.insertBefore(a.document.createTextNode("    "),C);break}if(domUtils.isBr(C)){v.insertBefore(a.document.createTextNode("    "),C.nextSibling);break}C=C.previousSibling}var N=y.end;for(C=y.start.nextSibling,v.firstChild===y.start&&v.insertBefore(a.document.createTextNode("    "),C.nextSibling);C&&C!==N;){if(domUtils.isBr(C)&&C.nextSibling){if(C.nextSibling===N)break;v.insertBefore(a.document.createTextNode("    "),C.nextSibling)}C=C.nextSibling}g.moveToBookmark(y).select()}return a.fireEvent("saveScene"),!0}}),a.addListener("beforeinserthtml",function(a,c){var h=this,g=h.selection.getRange(),v=domUtils.findParentByTagName(g.startContainer,"pre",!0);if(v){g.collapsed||g.deleteContents();var b="";if(browser.ie&&browser.version>8){utils.each(UE.filterNode(UE.htmlparser(c),h.options.filterTxtRules).children,function(a){"element"==a.type?"br"==a.tagName?b+="\n":dtd.$empty[a.tagName]||(utils.each(a.children,function(c){"element"==c.type?"br"==c.tagName?b+="\n":dtd.$empty[a.tagName]||(b+=c.innerText()):b+=c.data}),/\n$/.test(b)||(b+="\n")):b+=a.data+"\n",!a.nextSibling()&&/\n$/.test(b)&&(b=b.replace(/\n$/,""))});var y=h.document.createTextNode(utils.html(b.replace(/&nbsp;/g," ")));g.insertNode(y).selectNode(y).select()}else{var C=h.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(c),h.options.filterTxtRules).children,function(a){"element"==a.type?"br"==a.tagName?C.appendChild(h.document.createElement("br")):dtd.$empty[a.tagName]||(utils.each(a.children,function(c){"element"==c.type?"br"==c.tagName?C.appendChild(h.document.createElement("br")):dtd.$empty[a.tagName]||C.appendChild(h.document.createTextNode(utils.html(c.innerText().replace(/&nbsp;/g," ")))):C.appendChild(h.document.createTextNode(utils.html(c.data.replace(/&nbsp;/g," "))))}),"BR"!=C.lastChild.nodeName&&C.appendChild(h.document.createElement("br"))):C.appendChild(h.document.createTextNode(utils.html(a.data.replace(/&nbsp;/g," ")))),a.nextSibling()||"BR"!=C.lastChild.nodeName||C.removeChild(C.lastChild)}),g.insertNode(C).select()}return!0}}),a.addListener("keydown",function(a,c){var h=this,g=c.keyCode||c.which;if(40==g){var v,b=h.selection.getRange(),y=b.startContainer;if(b.collapsed&&(v=domUtils.findParentByTagName(b.startContainer,"pre",!0))&&!v.nextSibling){for(var C=v.lastChild;C&&"BR"==C.nodeName;)C=C.previousSibling;(C===y||b.startContainer===v&&b.startOffset==v.childNodes.length)&&(h.execCommand("insertparagraph"),domUtils.preventDefault(c))}}}),a.addListener("delkeydown",function(c,h){var g=this.selection.getRange();g.txtToElmBoundary(!0);var v=g.startContainer;if(domUtils.isTagNode(v,"pre")&&g.collapsed&&domUtils.isStartInblock(g)){var p=a.document.createElement("p");return domUtils.fillNode(a.document,p),v.parentNode.insertBefore(p,v),domUtils.remove(v),g.setStart(p,0).setCursor(!1,!0),domUtils.preventDefault(h),!0}})},UE.commands.cleardoc={execCommand:function(){var a=this,c=a.options.enterTag,h=a.selection.getRange();"br"==c?(a.body.innerHTML="<br/>",h.setStart(a.body,0).setCursor()):(a.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",h.setStart(a.body.firstChild,0).setCursor(!1,!0)),setTimeout(function(){a.fireEvent("clearDoc")},0)}},UE.plugin.register("anchor",function(){return{bindEvents:{ready:function(){utils.cssRule("anchor",".anchorclass{background: url('"+this.options.themePath+this.options.theme+"/images/anchor.gif') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}",this.document)}},outputRule:function(a){utils.each(a.getNodesByTagName("img"),function(a){var c;(c=a.getAttr("anchorname"))&&(a.tagName="a",a.setAttr({anchorname:"",name:c,"class":""}))})},inputRule:function(a){utils.each(a.getNodesByTagName("a"),function(a){var c;(c=a.getAttr("name"))&&!a.getAttr("href")&&(a.tagName="img",a.setAttr({anchorname:a.getAttr("name"),"class":"anchorclass"}),a.setAttr("name"))})},commands:{anchor:{execCommand:function(a,c){var h=this.selection.getRange(),g=h.getClosedNode();if(g&&g.getAttribute("anchorname"))c?g.setAttribute("anchorname",c):(h.setStartBefore(g).setCursor(),domUtils.remove(g));else if(c){var v=this.document.createElement("img");h.collapse(!0),domUtils.setAttributes(v,{anchorname:c,"class":"anchorclass"}),h.insertNode(v).setStartAfter(v).setCursor(!1,!0)}}}}}}),UE.plugins.wordcount=function(){var a=this;a.setOpt("wordCount",!0),a.addListener("contentchange",function(){a.fireEvent("wordcount")});var c;a.addListener("ready",function(){var a=this;domUtils.on(a.body,"keyup",function(h){var g=h.keyCode||h.which,v={16:1,18:1,20:1,37:1,38:1,39:1,40:1};g in v||(clearTimeout(c),c=setTimeout(function(){a.fireEvent("wordcount")},200))})})},UE.plugins.pagebreak=function(){function a(a){if(domUtils.isEmptyBlock(a)){for(var c,g=a.firstChild;g&&1==g.nodeType&&domUtils.isEmptyBlock(g);)c=g,g=g.firstChild;!c&&(c=a),domUtils.fillNode(h.document,c)}}function c(a){return a&&1==a.nodeType&&"HR"==a.tagName&&"pagebreak"==a.className}var h=this,g=["td"];h.setOpt("pageBreakTag","_ueditor_page_break_tag_"),h.ready(function(){utils.cssRule("pagebreak",".pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}",h.document)}),h.addInputRule(function(a){a.traversal(function(a){if("text"==a.type&&a.data==h.options.pageBreakTag){var c=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');a.parentNode.insertBefore(c,a),a.parentNode.removeChild(a)}})}),h.addOutputRule(function(a){utils.each(a.getNodesByTagName("hr"),function(n){if("pagebreak"==n.getAttr("class")){var a=UE.uNode.createText(h.options.pageBreakTag);n.parentNode.insertBefore(a,n),n.parentNode.removeChild(n)}})}),h.commands.pagebreak={execCommand:function(){var v=h.selection.getRange(),b=h.document.createElement("hr");domUtils.setAttributes(b,{"class":"pagebreak",noshade:"noshade",size:"5"}),domUtils.unSelectable(b);var y,C=domUtils.findParentByTagName(v.startContainer,g,!0),N=[];if(C)switch(C.tagName){case"TD":if(y=C.parentNode,y.previousSibling)y.parentNode.insertBefore(b,y),N=domUtils.findParents(b);else{var w=domUtils.findParentByTagName(y,"table");w.parentNode.insertBefore(b,w),N=domUtils.findParents(b,!0)}y=N[1],b!==y&&domUtils.breakParent(b,y),h.fireEvent("afteradjusttable",h.document)}else{if(!v.collapsed){v.deleteContents();for(var U=v.startContainer;!domUtils.isBody(U)&&domUtils.isBlockElm(U)&&domUtils.isEmptyNode(U);)v.setStartBefore(U).collapse(!0),domUtils.remove(U),U=v.startContainer}v.insertNode(b);for(var E,y=b.parentNode;!domUtils.isBody(y);)domUtils.breakParent(b,y),E=b.nextSibling,E&&domUtils.isEmptyBlock(E)&&domUtils.remove(E),y=b.parentNode;E=b.nextSibling;var T=b.previousSibling;if(c(T)?domUtils.remove(T):T&&a(T),E)c(E)?domUtils.remove(E):a(E),v.setEndAfter(b).collapse(!1);else{var p=h.document.createElement("p");b.parentNode.appendChild(p),domUtils.fillNode(h.document,p),v.setStart(p,0).collapse(!0)}v.select(!0)}}}},UE.plugin.register("wordimage",function(){var a=this,c=[];return{commands:{wordimage:{execCommand:function(){for(var c,h=domUtils.getElementsByTagName(a.body,"img"),g=[],i=0;c=h[i++];){var v=c.getAttribute("word_img");v&&g.push(v)}return g},queryCommandState:function(){c=domUtils.getElementsByTagName(a.body,"img");for(var h,i=0;h=c[i++];)if(h.getAttribute("word_img"))return 1;return-1},notNeedUndo:!0}},inputRule:function(c){utils.each(c.getNodesByTagName("img"),function(c){var h=c.attrs,g=parseInt(h.width)<128||parseInt(h.height)<43,v=a.options,b=v.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";h.src&&/^(?:(file:\/+))/.test(h.src)&&c.setAttr({width:h.width,height:h.height,alt:h.alt,word_img:h.src,src:b,style:"background:url("+(g?v.themePath+v.theme+"/images/word.gif":v.langPath+v.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd"})})}}}),UE.plugins.dragdrop=function(){var a=this;a.ready(function(){domUtils.on(this.body,"dragend",function(){var c=a.selection.getRange(),h=c.getClosedNode()||a.selection.getStart();if(h&&"IMG"==h.tagName){for(var g,v=h.previousSibling;(g=h.nextSibling)&&1==g.nodeType&&"SPAN"==g.tagName&&!g.firstChild;)domUtils.remove(g);(!v||1!=v.nodeType||domUtils.isEmptyBlock(v))&&v||g&&(!g||domUtils.isEmptyBlock(g))||(v&&"P"==v.tagName&&!domUtils.isEmptyBlock(v)?(v.appendChild(h),domUtils.moveChild(g,v),domUtils.remove(g)):g&&"P"==g.tagName&&!domUtils.isEmptyBlock(g)&&g.insertBefore(h,g.firstChild),v&&"P"==v.tagName&&domUtils.isEmptyBlock(v)&&domUtils.remove(v),g&&"P"==g.tagName&&domUtils.isEmptyBlock(g)&&domUtils.remove(g),c.selectNode(h).select(),a.fireEvent("saveScene"))}})}),a.addListener("keyup",function(c,h){var g=h.keyCode||h.which;if(13==g){var v,b=a.selection.getRange();(v=domUtils.findParentByTagName(b.startContainer,"p",!0))&&"center"==domUtils.getComputedStyle(v,"text-align")&&domUtils.removeStyle(v,"text-align")}})},UE.plugins.undo=function(){function a(a,c){if(a.length!=c.length)return 0;for(var i=0,l=a.length;l>i;i++)if(a[i]!=c[i])return 0;return 1}function c(c,h){return c.collapsed!=h.collapsed?0:a(c.startAddress,h.startAddress)&&a(c.endAddress,h.endAddress)?1:0}function h(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var a=this.editor,c=this.list[this.index],h=UE.htmlparser(c.content.replace(C,""));a.options.autoClearEmptyNode=!1,a.filterInputRule(h),a.options.autoClearEmptyNode=w,a.document.body.innerHTML=h.toHtml(),a.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(a.document,"td th caption p"),function(c){domUtils.isEmptyNode(c)&&domUtils.fillNode(a.document,c)});try{var g=new dom.Range(a.document).moveToAddress(c.address);g.select(N[g.startContainer.nodeName.toLowerCase()])}catch(e){}this.update(),this.clearKey(),a.fireEvent("reset",!0)},this.getScene=function(){var a=this.editor,c=a.selection.getRange(),h=c.createAddress(!1,!0);a.fireEvent("beforegetscene");var g=UE.htmlparser(a.body.innerHTML);a.options.autoClearEmptyNode=!1,a.filterOutputRule(g),a.options.autoClearEmptyNode=w;var v=g.toHtml();return a.fireEvent("aftergetscene"),{address:h,content:v}},this.save=function(a,h){clearTimeout(g);var y=this.getScene(h),C=this.list[this.index];C&&C.content!=y.content&&v.trigger("contentchange"),C&&C.content==y.content&&(a?1:c(C.address,y.address))||(this.list=this.list.slice(0,this.index+1),this.list.push(y),this.list.length>b&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){T=0,U=null}}var g,v=this,b=v.options.maxUndoCount||20,y=v.options.maxInputCount||20,C=new RegExp(domUtils.fillChar+"|</hr>","gi"),N={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},w=v.options.autoClearEmptyNode;v.undoManger=new h,v.undoManger.editor=v,v.addListener("saveScene",function(){var a=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,a)}),v.addListener("reset",function(a,c){c||this.undoManger.reset()}),v.commands.redo=v.commands.undo={execCommand:function(a){this.undoManger[a]()},queryCommandState:function(a){return this.undoManger["has"+("undo"==a.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var U,E={16:1,17:1,18:1,37:1,38:1,39:1,40:1},T=0,S=!1;v.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){S=!0}),domUtils.on(this.body,"compositionend",function(){S=!1})}),v.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var k=!0;v.addListener("keydown",function(a,c){function h(a){a.undoManger.save(!1,!0),a.fireEvent("selectionchange")}var v=this,b=c.keyCode||c.which;if(!(E[b]||c.ctrlKey||c.metaKey||c.shiftKey||c.altKey)){if(S)return;if(!v.selection.getRange().collapsed)return v.undoManger.save(!1,!0),void(k=!1);0==v.undoManger.list.length&&v.undoManger.save(!0),clearTimeout(g),g=setTimeout(function(){if(S)var a=setInterval(function(){S||(h(v),clearInterval(a))},300);else h(v)},200),U=b,T++,T>=y&&h(v)}}),v.addListener("keyup",function(a,c){var h=c.keyCode||c.which;if(!(E[h]||c.ctrlKey||c.metaKey||c.shiftKey||c.altKey)){if(S)return;k||(this.undoManger.save(!1,!0),k=!0)}}),v.stopCmdUndo=function(){v.__hasEnterExecCommand=!0},v.startCmdUndo=function(){v.__hasEnterExecCommand=!1}},UE.plugin.register("copy",function(){function a(){ZeroClipboard.config({debug:!1,swfPath:c.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.swf"});var a=c.zeroclipboard=new ZeroClipboard;a.on("copy",function(e){var a=e.client,h=c.selection.getRange(),g=document.createElement("div");g.appendChild(h.cloneContents()),a.setText(g.innerText||g.textContent),a.setHtml(g.innerHTML),h.select()}),a.on("mouseover mouseout",function(e){var a=e.target;"mouseover"==e.type?domUtils.addClass(a,"edui-state-hover"):"mouseout"==e.type&&domUtils.removeClasses(a,"edui-state-hover")}),a.on("wrongflash noflash",function(){ZeroClipboard.destroy()})}var c=this;return{bindEvents:{ready:function(){browser.ie||(window.ZeroClipboard?a():utils.loadFile(document,{src:c.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.js",tag:"script",type:"text/javascript",defer:"defer"},function(){a()}))}},commands:{copy:{execCommand:function(){c.document.execCommand("copy")||alert(c.getLang("copymsg"))}}}}}),UE.plugins.paste=function(){function a(a){var c=this.document;if(!c.getElementById("baidu_pastebin")){var h=this.selection.getRange(),g=h.createBookmark(),v=c.createElement("div");v.id="baidu_pastebin",browser.webkit&&v.appendChild(c.createTextNode(domUtils.fillChar+domUtils.fillChar)),c.body.appendChild(v),g.start.style.display="",v.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(g.start).y+"px",h.selectNodeContents(v).select(!0),setTimeout(function(){if(browser.webkit)for(var b,i=0,y=c.querySelectorAll("#baidu_pastebin");b=y[i++];){if(!domUtils.isEmptyNode(b)){v=b;break}domUtils.remove(b)}try{v.parentNode.removeChild(v)}catch(e){}h.moveToBookmark(g).select(!0),a(v)},0)}}function c(a){return a.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(a,c,h,g){return h=h.toLowerCase(),{img:1}[h]?a:(g=g.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(a,c,h){return{src:1,href:1,name:1}[c.toLowerCase()]?c+"="+h+" ":""}),{span:1,div:1}[h]?"":"<"+c+h+" "+utils.trim(g)+">")})}function h(a){var h;if(a.firstChild){for(var C,N=domUtils.getElementsByTagName(a,"span"),i=0;C=N[i++];)("_baidu_cut_start"==C.id||"_baidu_cut_end"==C.id)&&domUtils.remove(C);if(browser.webkit){for(var w,U=a.querySelectorAll("div br"),i=0;w=U[i++];){var E=w.parentNode;"DIV"==E.tagName&&1==E.childNodes.length&&(E.innerHTML="<p><br/></p>",domUtils.remove(E))}for(var T,S=a.querySelectorAll("#baidu_pastebin"),i=0;T=S[i++];){var k=g.document.createElement("p");for(T.parentNode.insertBefore(k,T);T.firstChild;)k.appendChild(T.firstChild);domUtils.remove(T)}for(var B,I=a.querySelectorAll("meta"),i=0;B=I[i++];)domUtils.remove(B);var U=a.querySelectorAll("br");for(i=0;B=U[i++];)/^apple-/i.test(B.className)&&domUtils.remove(B)}if(browser.gecko){var _=a.querySelectorAll("[_moz_dirty]");for(i=0;B=_[i++];)B.removeAttribute("_moz_dirty")}if(!browser.ie)for(var B,A=a.querySelectorAll("span.Apple-style-span"),i=0;B=A[i++];)domUtils.remove(B,!0);h=a.innerHTML,h=UE.filterWord(h);var L=UE.htmlparser(h);if(g.options.filterRules&&UE.filterNode(L,g.options.filterRules),g.filterInputRule(L),browser.webkit){var R=L.lastChild();R&&"element"==R.type&&"br"==R.tagName&&L.removeChild(R),utils.each(g.body.querySelectorAll("div"),function(a){domUtils.isEmptyBlock(a)&&domUtils.remove(a,!0)})}if(h={html:L.toHtml()},g.fireEvent("beforepaste",h,L),!h.html)return;L=UE.htmlparser(h.html,!0),1===g.queryCommandState("pasteplain")?g.execCommand("insertHtml",UE.filterNode(L,g.options.filterTxtRules).toHtml(),!0):(UE.filterNode(L,g.options.filterTxtRules),v=L.toHtml(),b=h.html,y=g.selection.getRange().createAddress(!0),g.execCommand("insertHtml",g.getOpt("retainOnlyLabelPasted")===!0?c(b):b,!0)),g.fireEvent("afterpaste",h)}}var g=this;g.setOpt({retainOnlyLabelPasted:!1});var v,b,y;g.addListener("pasteTransfer",function(a,h){if(y&&v&&b&&v!=b){var C=g.selection.getRange();if(C.moveToAddress(y,!0),!C.collapsed){for(;!domUtils.isBody(C.startContainer);){var N=C.startContainer;if(1==N.nodeType){if(N=N.childNodes[C.startOffset],!N){C.setStartBefore(C.startContainer);continue}var w=N.previousSibling;w&&3==w.nodeType&&new RegExp("^[\n\r	 "+domUtils.fillChar+"]*$").test(w.nodeValue)&&C.setStartBefore(w)}if(0!=C.startOffset)break;C.setStartBefore(C.startContainer)}for(;!domUtils.isBody(C.endContainer);){var U=C.endContainer;if(1==U.nodeType){if(U=U.childNodes[C.endOffset],!U){C.setEndAfter(C.endContainer);continue}var E=U.nextSibling;E&&3==E.nodeType&&new RegExp("^[\n\r	"+domUtils.fillChar+"]*$").test(E.nodeValue)&&C.setEndAfter(E)}if(C.endOffset!=C.endContainer[3==C.endContainer.nodeType?"nodeValue":"childNodes"].length)break;C.setEndAfter(C.endContainer)}}C.deleteContents(),C.select(!0),g.__hasEnterExecCommand=!0;var T=b;2===h?T=c(T):h&&(T=v),g.execCommand("inserthtml",T,!0),g.__hasEnterExecCommand=!1;for(var S=g.selection.getRange();!domUtils.isBody(S.startContainer)&&!S.startOffset&&S.startContainer[3==S.startContainer.nodeType?"nodeValue":"childNodes"].length;)S.setStartBefore(S.startContainer);var k=S.createAddress(!0);y.endAddress=k.startAddress}}),g.addListener("ready",function(){domUtils.on(g.body,"cut",function(){var a=g.selection.getRange();!a.collapsed&&g.undoManger&&g.undoManger.save()}),domUtils.on(g.body,browser.ie||browser.opera?"keydown":"paste",function(e){(!browser.ie&&!browser.opera||(e.ctrlKey||e.metaKey)&&"86"==e.keyCode)&&a.call(g,function(a){h(a)})})}),g.commands.paste={execCommand:function(){browser.ie?(a.call(g,function(a){h(a)}),g.document.execCommand("paste")):alert(g.getLang("pastemsg"))}}},UE.plugins.pasteplain=function(){var a=this;a.setOpt({pasteplain:!1,filterTxtRules:function(){function a(a){a.tagName="p",a.setStyle()}function c(a){a.parentNode.removeChild(a,!0)}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:function(a){for(var c,p=UE.uNode.createElement("p");c=a.firstChild();)"text"!=c.type&&UE.dom.dtd.$block[c.tagName]?p.firstChild()?(a.parentNode.insertBefore(p,a),p=UE.uNode.createElement("p")):a.parentNode.insertBefore(c,a):p.appendChild(c);p.firstChild()&&a.parentNode.insertBefore(p,a),a.parentNode.removeChild(a)},ol:c,ul:c,dl:c,dt:c,dd:c,li:c,caption:a,th:a,tr:a,h1:a,h2:a,h3:a,h4:a,h5:a,h6:a,td:function(a){var c=!!a.innerText();c&&a.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),a),a.parentNode.removeChild(a,a.innerText())}}}()});var c=a.options.pasteplain;a.commands.pasteplain={queryCommandState:function(){return c?1:0},execCommand:function(){c=0|!c},notNeedUndo:1}},UE.plugins.list=function(){function a(a){var c=[];for(var p in a)c.push(p);return c}function c(a){var c=a.className;return domUtils.hasClass(a,/custom_/)?c.match(/custom_(\w+)/)[1]:domUtils.getStyle(a,"list-style-type")}function h(a,h){utils.each(domUtils.getElementsByTagName(a,"ol ul"),function(b){if(domUtils.inDoc(b,a)){var y=b.parentNode;if(y.tagName==b.tagName){var C=c(b)||("OL"==b.tagName?"decimal":"disc"),N=c(y)||("OL"==y.tagName?"decimal":"disc");if(C==N){var E=utils.indexOf(U[b.tagName],C);E=E+1==U[b.tagName].length?0:E+1,v(b,U[b.tagName][E])}}var T=0,S=2;domUtils.hasClass(b,/custom_/)?/[ou]l/i.test(y.tagName)&&domUtils.hasClass(y,/custom_/)||(S=1):/[ou]l/i.test(y.tagName)&&domUtils.hasClass(y,/custom_/)&&(S=3);var k=domUtils.getStyle(b,"list-style-type");k&&(b.style.cssText="list-style-type:"+k),b.className=utils.trim(b.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+S,utils.each(domUtils.getElementsByTagName(b,"li"),function(a){if(a.style.cssText&&(a.style.cssText=""),!a.firstChild)return void domUtils.remove(a);if(a.parentNode===b){if(T++,domUtils.hasClass(b,/custom_/)){var h=1,g=c(b);if("OL"==b.tagName){if(g)switch(g){case"cn":case"cn1":case"cn2":T>10&&(T%10==0||T>10&&20>T)?h=2:T>20&&(h=3);break;case"num2":T>9&&(h=2)}a.className="list-"+w[g]+T+" list-"+g+"-paddingleft-"+h}else a.className="list-"+w[g]+" list-"+g+"-paddingleft"}else a.className=a.className.replace(/list-[\w\-]+/gi,"");var v=a.getAttribute("class");null===v||v.replace(/\s/g,"")||domUtils.removeAttributes(a,"class")}}),!h&&g(b,b.tagName.toLowerCase(),c(b)||domUtils.getStyle(b,"list-style-type"),!0)}})}function g(a,g,v,b){var y=a.nextSibling;y&&1==y.nodeType&&y.tagName.toLowerCase()==g&&(c(y)||domUtils.getStyle(y,"list-style-type")||("ol"==g?"decimal":"disc"))==v&&(domUtils.moveChild(y,a),0==y.childNodes.length&&domUtils.remove(y)),y&&domUtils.isFillChar(y)&&domUtils.remove(y);var C=a.previousSibling;C&&1==C.nodeType&&C.tagName.toLowerCase()==g&&(c(C)||domUtils.getStyle(C,"list-style-type")||("ol"==g?"decimal":"disc"))==v&&domUtils.moveChild(a,C),C&&domUtils.isFillChar(C)&&domUtils.remove(C),!b&&domUtils.isEmptyBlock(a)&&domUtils.remove(a),c(a)&&h(a.ownerDocument,!0)}function v(a,c){w[c]&&(a.className="custom_"+c);try{domUtils.setStyle(a,"list-style-type",c)}catch(e){}}function b(a){var c=a.previousSibling;c&&domUtils.isEmptyBlock(c)&&domUtils.remove(c),c=a.nextSibling,c&&domUtils.isEmptyBlock(c)&&domUtils.remove(c)}function y(a){for(;a&&!domUtils.isBody(a);){if("TABLE"==a.nodeName)return null;if("LI"==a.nodeName)return a;a=a.parentNode}}var C=this,N={TD:1,PRE:1,BLOCKQUOTE:1},w={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"};C.setOpt({autoTransWordToList:!1,insertorderedlist:{num:"",num1:"",num2:"",cn:"",cn1:"",cn2:"",decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:"",dash:"",dot:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1,disablePInList:!1});var U={OL:a(C.options.insertorderedlist),UL:a(C.options.insertunorderedlist)},E=C.options.listiconpath;for(var s in w)C.options.insertorderedlist.hasOwnProperty(s)||C.options.insertunorderedlist.hasOwnProperty(s)||delete w[s];C.ready(function(){var a=[];for(var p in w){if("dash"==p||"dot"==p)a.push("li.list-"+w[p]+"{background-image:url("+E+w[p]+".gif)}"),a.push("ul.custom_"+p+"{list-style:none;}ul.custom_"+p+" li{background-position:0 3px;background-repeat:no-repeat}");else{for(var i=0;99>i;i++)a.push("li.list-"+w[p]+i+"{background-image:url("+E+"list-"+w[p]+i+".gif)}");a.push("ol.custom_"+p+"{list-style:none;}ol.custom_"+p+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(p){case"cn":a.push("li.list-"+p+"-paddingleft-1{padding-left:25px}"),a.push("li.list-"+p+"-paddingleft-2{padding-left:40px}"),a.push("li.list-"+p+"-paddingleft-3{padding-left:55px}");break;case"cn1":a.push("li.list-"+p+"-paddingleft-1{padding-left:30px}"),a.push("li.list-"+p+"-paddingleft-2{padding-left:40px}"),a.push("li.list-"+p+"-paddingleft-3{padding-left:55px}");break;case"cn2":a.push("li.list-"+p+"-paddingleft-1{padding-left:40px}"),a.push("li.list-"+p+"-paddingleft-2{padding-left:55px}"),a.push("li.list-"+p+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":a.push("li.list-"+p+"-paddingleft-1{padding-left:25px}");break;case"num2":a.push("li.list-"+p+"-paddingleft-1{padding-left:35px}"),a.push("li.list-"+p+"-paddingleft-2{padding-left:40px}");break;case"dash":a.push("li.list-"+p+"-paddingleft{padding-left:35px}");break;case"dot":a.push("li.list-"+p+"-paddingleft{padding-left:20px}")}}a.push(".list-paddingleft-1{padding-left:0}"),a.push(".list-paddingleft-2{padding-left:"+C.options.listDefaultPaddingLeft+"px}"),a.push(".list-paddingleft-3{padding-left:"+2*C.options.listDefaultPaddingLeft+"px}"),utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+a.join("\n"),C.document)}),C.ready(function(){domUtils.on(C.body,"cut",function(){setTimeout(function(){var a,c=C.selection.getRange();if(!c.collapsed&&(a=domUtils.findParentByTagName(c.startContainer,"li",!0))&&!a.nextSibling&&domUtils.isEmptyBlock(a)){var h,g=a.parentNode;if(h=g.previousSibling)domUtils.remove(g),c.setStartAtLast(h).collapse(!0),c.select(!0);else if(h=g.nextSibling)domUtils.remove(g),c.setStartAtFirst(h).collapse(!0),c.select(!0);else{var v=C.document.createElement("p");domUtils.fillNode(C.document,v),g.parentNode.insertBefore(v,g),domUtils.remove(g),c.setStart(v,0).collapse(!0),c.select(!0)}}})})}),C.addListener("beforepaste",function(a,h){var g,v=this,b=v.selection.getRange(),y=UE.htmlparser(h.html,!0);if(g=domUtils.findParentByTagName(b.startContainer,"li",!0)){var C=g.parentNode,N="OL"==C.tagName?"ul":"ol";utils.each(y.getNodesByTagName(N),function(n){if(n.tagName=C.tagName,n.setAttr(),n.parentNode===y)a=c(C)||("OL"==C.tagName?"decimal":"disc");else{var h=n.parentNode.getAttr("class");a=h&&/custom_/.test(h)?h.match(/custom_(\w+)/)[1]:n.parentNode.getStyle("list-style-type"),a||(a="OL"==C.tagName?"decimal":"disc")}var g=utils.indexOf(U[C.tagName],a);n.parentNode!==y&&(g=g+1==U[C.tagName].length?0:g+1);var v=U[C.tagName][g];w[v]?n.setAttr("class","custom_"+v):n.setStyle("list-style-type",v)})}h.html=y.toHtml()}),C.getOpt("disablePInList")===!0&&C.addOutputRule(function(a){utils.each(a.getNodesByTagName("li"),function(a){var c=[],h=0;utils.each(a.children,function(n){if("p"==n.tagName){for(var g;g=n.children.pop();)c.splice(h,0,g),g.parentNode=a,lastNode=g;if(g=c[c.length-1],!g||"element"!=g.type||"br"!=g.tagName){var v=UE.uNode.createElement("br");v.parentNode=a,c.push(v)}h=c.length}}),c.length&&(a.children=c)})}),C.addInputRule(function(a){function c(a,c){var v=c.firstChild();if(v&&"element"==v.type&&"span"==v.tagName&&/Wingdings|Symbol/.test(v.getStyle("font-family"))){for(var p in g)if(g[p]==v.data)return p;return"disc"}for(var p in h)if(h[p].test(a))return p}if(utils.each(a.getNodesByTagName("li"),function(a){for(var c,h=UE.uNode.createElement("p"),i=0;c=a.children[i];)"text"==c.type||dtd.p[c.tagName]?h.appendChild(c):h.firstChild()?(a.insertBefore(h,c),h=UE.uNode.createElement("p"),i+=2):i++;(h.firstChild()&&!h.parentNode||!a.firstChild())&&a.appendChild(h),h.firstChild()||h.innerHTML(browser.ie?"&nbsp;":"<br/>");var p=a.firstChild(),g=p.lastChild();g&&"text"==g.type&&/^\s*$/.test(g.data)&&p.removeChild(g)}),C.options.autoTransWordToList){var h={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},g={square:"n"};utils.each(a.getNodesByTagName("p"),function(a){function g(a,p,c){if("ol"==a.tagName)if(browser.ie){var g=p.firstChild();"element"==g.type&&"span"==g.tagName&&h[c].test(g.innerText())&&p.removeChild(g)}else p.innerHTML(p.innerHTML().replace(h[c],""));else p.removeChild(p.firstChild());var v=UE.uNode.createElement("li");v.appendChild(p),a.appendChild(v)}if("MsoListParagraph"==a.getAttr("class")){a.setStyle("margin",""),a.setStyle("margin-left",""),a.setAttr("class","");var v,b=a,y=a;if("li"!=a.parentNode.tagName&&(v=c(a.innerText(),a))){var N=UE.uNode.createElement(C.options.insertorderedlist.hasOwnProperty(v)?"ol":"ul");for(w[v]?N.setAttr("class","custom_"+v):N.setStyle("list-style-type",v);a&&"li"!=a.parentNode.tagName&&c(a.innerText(),a);)b=a.nextSibling(),b||a.parentNode.insertBefore(N,a),g(N,a,v),a=b;!N.parentNode&&a&&a.parentNode&&a.parentNode.insertBefore(N,a)}var U=y.firstChild();U&&"element"==U.type&&"span"==U.tagName&&/^\s*(&nbsp;)+\s*$/.test(U.innerText())&&U.parentNode.removeChild(U)}})}}),C.addListener("contentchange",function(){h(C.document)}),C.addListener("keydown",function(a,c){function h(){c.preventDefault?c.preventDefault():c.returnValue=!1,C.fireEvent("contentchange"),C.undoManger&&C.undoManger.save()}function g(a,c){for(;a&&!domUtils.isBody(a);){if(c(a))return null;if(1==a.nodeType&&/[ou]l/i.test(a.tagName))return a;a=a.parentNode}return null}var v=c.keyCode||c.which;if(13==v&&!c.shiftKey){var y=C.selection.getRange(),N=domUtils.findParent(y.startContainer,function(a){return domUtils.isBlockElm(a)},!0),w=domUtils.findParentByTagName(y.startContainer,"li",!0);if(N&&"PRE"!=N.tagName&&!w){var U=N.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),"");/^\s*1\s*\.[^\d]/.test(U)&&(N.innerHTML=U.replace(/^\s*1\s*\./,""),y.setStartAtLast(N).collapse(!0).select(),C.__hasEnterExecCommand=!0,C.execCommand("insertorderedlist"),C.__hasEnterExecCommand=!1)}var E=C.selection.getRange(),T=g(E.startContainer,function(a){return"TABLE"==a.tagName}),S=E.collapsed?T:g(E.endContainer,function(a){return"TABLE"==a.tagName});if(T&&S&&T===S){if(!E.collapsed){if(T=domUtils.findParentByTagName(E.startContainer,"li",!0),S=domUtils.findParentByTagName(E.endContainer,"li",!0),!T||!S||T!==S){var k=E.cloneRange(),B=k.collapse(!1).createBookmark();E.deleteContents(),k.moveToBookmark(B);var w=domUtils.findParentByTagName(k.startContainer,"li",!0);return b(w),k.select(),void h()}if(E.deleteContents(),w=domUtils.findParentByTagName(E.startContainer,"li",!0),w&&domUtils.isEmptyBlock(w))return R=w.previousSibling,next=w.nextSibling,p=C.document.createElement("p"),domUtils.fillNode(C.document,p),I=w.parentNode,R&&next?(E.setStart(next,0).collapse(!0).select(!0),domUtils.remove(w)):((R||next)&&R?w.parentNode.parentNode.insertBefore(p,I.nextSibling):I.parentNode.insertBefore(p,I),domUtils.remove(w),I.firstChild||domUtils.remove(I),E.setStart(p,0).setCursor()),void h()}if(w=domUtils.findParentByTagName(E.startContainer,"li",!0)){if(domUtils.isEmptyBlock(w)){B=E.createBookmark();var I=w.parentNode;if(w!==I.lastChild?(domUtils.breakParent(w,I),b(w)):(I.parentNode.insertBefore(w,I.nextSibling),domUtils.isEmptyNode(I)&&domUtils.remove(I)),!dtd.$list[w.parentNode.tagName])if(domUtils.isBlockElm(w.firstChild))domUtils.remove(w,!0);else{for(p=C.document.createElement("p"),w.parentNode.insertBefore(p,w);w.firstChild;)p.appendChild(w.firstChild);domUtils.remove(w)}E.moveToBookmark(B).select()}else{var _=w.firstChild;if(!_||!domUtils.isBlockElm(_)){var p=C.document.createElement("p");for(!w.firstChild&&domUtils.fillNode(C.document,p);w.firstChild;)p.appendChild(w.firstChild);w.appendChild(p),_=p}var A=C.document.createElement("span");E.insertNode(A),domUtils.breakParent(A,w);var L=A.nextSibling;_=L.firstChild,_||(p=C.document.createElement("p"),domUtils.fillNode(C.document,p),L.appendChild(p),_=p),domUtils.isEmptyNode(_)&&(_.innerHTML="",domUtils.fillNode(C.document,_)),E.setStart(_,0).collapse(!0).shrinkBoundary().select(),domUtils.remove(A);
var R=L.previousSibling;R&&domUtils.isEmptyBlock(R)&&(R.innerHTML="<p></p>",domUtils.fillNode(C.document,R.firstChild))}h()}}}if(8==v&&(E=C.selection.getRange(),E.collapsed&&domUtils.isStartInblock(E)&&(k=E.cloneRange().trimBoundary(),w=domUtils.findParentByTagName(E.startContainer,"li",!0),w&&domUtils.isStartInblock(k)))){if(T=domUtils.findParentByTagName(E.startContainer,"p",!0),T&&T!==w.firstChild){var I=domUtils.findParentByTagName(T,["ol","ul"]);return domUtils.breakParent(T,I),b(T),C.fireEvent("contentchange"),E.setStart(T,0).setCursor(!1,!0),C.fireEvent("saveScene"),void domUtils.preventDefault(c)}if(w&&(R=w.previousSibling)){if(46==v&&w.childNodes.length)return;if(dtd.$list[R.tagName]&&(R=R.lastChild),C.undoManger&&C.undoManger.save(),_=w.firstChild,domUtils.isBlockElm(_))if(domUtils.isEmptyNode(_))for(R.appendChild(_),E.setStart(_,0).setCursor(!1,!0);w.firstChild;)R.appendChild(w.firstChild);else A=C.document.createElement("span"),E.insertNode(A),domUtils.isEmptyBlock(R)&&(R.innerHTML=""),domUtils.moveChild(w,R),E.setStartBefore(A).collapse(!0).select(!0),domUtils.remove(A);else if(domUtils.isEmptyNode(w)){var p=C.document.createElement("p");R.appendChild(p),E.setStart(p,0).setCursor()}else for(E.setEnd(R,R.childNodes.length).collapse().select(!0);w.firstChild;)R.appendChild(w.firstChild);return domUtils.remove(w),C.fireEvent("contentchange"),C.fireEvent("saveScene"),void domUtils.preventDefault(c)}if(w&&!w.previousSibling){var I=w.parentNode,B=E.createBookmark();if(domUtils.isTagNode(I.parentNode,"ol ul"))I.parentNode.insertBefore(w,I),domUtils.isEmptyNode(I)&&domUtils.remove(I);else{for(;w.firstChild;)I.parentNode.insertBefore(w.firstChild,I);domUtils.remove(w),domUtils.isEmptyNode(I)&&domUtils.remove(I)}return E.moveToBookmark(B).setCursor(!1,!0),C.fireEvent("contentchange"),C.fireEvent("saveScene"),void domUtils.preventDefault(c)}}}),C.addListener("keyup",function(a,h){var v=h.keyCode||h.which;if(8==v){var b,y=C.selection.getRange();(b=domUtils.findParentByTagName(y.startContainer,["ol","ul"],!0))&&g(b,b.tagName.toLowerCase(),c(b)||domUtils.getComputedStyle(b,"list-style-type"),!0)}}),C.addListener("tabkeydown",function(){function a(a){if(-1!=C.options.maxListLevel){for(var c=a.parentNode,h=0;/[ou]l/i.test(c.tagName);)h++,c=c.parentNode;if(h>=C.options.maxListLevel)return!0}}var h=C.selection.getRange(),b=domUtils.findParentByTagName(h.startContainer,"li",!0);if(b){var y;if(!h.collapsed){C.fireEvent("saveScene"),y=h.createBookmark();for(var N,w,i=0,E=domUtils.findParents(b);w=E[i++];)if(domUtils.isTagNode(w,"ol ul")){N=w;break}var T=b;if(y.end)for(;T&&!(domUtils.getPosition(T,y.end)&domUtils.POSITION_FOLLOWING);)if(a(T))T=domUtils.getNextDomNode(T,!1,null,function(a){return a!==N});else{var S=T.parentNode,k=C.document.createElement(S.tagName),B=utils.indexOf(U[k.tagName],c(S)||domUtils.getComputedStyle(S,"list-style-type")),I=B+1==U[k.tagName].length?0:B+1,_=U[k.tagName][I];for(v(k,_),S.insertBefore(k,T);T&&!(domUtils.getPosition(T,y.end)&domUtils.POSITION_FOLLOWING);){if(b=T.nextSibling,k.appendChild(T),!b||domUtils.isTagNode(b,"ol ul")){if(b)for(;(b=b.firstChild)&&"LI"!=b.tagName;);else b=domUtils.getNextDomNode(T,!1,null,function(a){return a!==N});break}T=b}g(k,k.tagName.toLowerCase(),_),T=b}return C.fireEvent("contentchange"),h.moveToBookmark(y).select(),!0}if(a(b))return!0;var S=b.parentNode,k=C.document.createElement(S.tagName),B=utils.indexOf(U[k.tagName],c(S)||domUtils.getComputedStyle(S,"list-style-type"));B=B+1==U[k.tagName].length?0:B+1;var _=U[k.tagName][B];if(v(k,_),domUtils.isStartInblock(h))return C.fireEvent("saveScene"),y=h.createBookmark(),S.insertBefore(k,b),k.appendChild(b),g(k,k.tagName.toLowerCase(),_),C.fireEvent("contentchange"),h.moveToBookmark(y).select(!0),!0}}),C.commands.insertorderedlist=C.commands.insertunorderedlist={execCommand:function(a,h){h||(h="insertorderedlist"==a.toLowerCase()?"decimal":"disc");var b=this,C=this.selection.getRange(),w=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase():!domUtils.isWhitespace(a)},U="insertorderedlist"==a.toLowerCase()?"ol":"ul",E=b.document.createDocumentFragment();C.adjustmentBoundary().shrinkBoundary();var T,S,k,B,I=C.createBookmark(!0),_=y(b.document.getElementById(I.start)),A=0,L=y(b.document.getElementById(I.end)),R=0;if(_||L){if(_&&(T=_.parentNode),I.end||(L=_),L&&(S=L.parentNode),T===S){for(;_!==L;){if(B=_,_=_.nextSibling,!domUtils.isBlockElm(B.firstChild)){for(var p=b.document.createElement("p");B.firstChild;)p.appendChild(B.firstChild);B.appendChild(p)}E.appendChild(B)}if(B=b.document.createElement("span"),T.insertBefore(B,L),!domUtils.isBlockElm(L.firstChild)){for(p=b.document.createElement("p");L.firstChild;)p.appendChild(L.firstChild);L.appendChild(p)}E.appendChild(L),domUtils.breakParent(B,T),domUtils.isEmptyNode(B.previousSibling)&&domUtils.remove(B.previousSibling),domUtils.isEmptyNode(B.nextSibling)&&domUtils.remove(B.nextSibling);var D=c(T)||domUtils.getComputedStyle(T,"list-style-type")||("insertorderedlist"==a.toLowerCase()?"decimal":"disc");if(T.tagName.toLowerCase()==U&&D==h){for(var O,i=0,P=b.document.createDocumentFragment();O=E.firstChild;)if(domUtils.isTagNode(O,"ol ul"))P.appendChild(O);else for(;O.firstChild;)P.appendChild(O.firstChild),domUtils.remove(O);B.parentNode.insertBefore(P,B)}else k=b.document.createElement(U),v(k,h),k.appendChild(E),B.parentNode.insertBefore(k,B);return domUtils.remove(B),k&&g(k,U,h),void C.moveToBookmark(I).select()}if(_){for(;_;){if(B=_.nextSibling,domUtils.isTagNode(_,"ol ul"))E.appendChild(_);else{for(var M=b.document.createDocumentFragment(),H=0;_.firstChild;)domUtils.isBlockElm(_.firstChild)&&(H=1),M.appendChild(_.firstChild);if(H)E.appendChild(M);else{var F=b.document.createElement("p");F.appendChild(M),E.appendChild(F)}domUtils.remove(_)}_=B}T.parentNode.insertBefore(E,T.nextSibling),domUtils.isEmptyNode(T)?(C.setStartBefore(T),domUtils.remove(T)):C.setStartAfter(T),A=1}if(L&&domUtils.inDoc(S,b.document)){for(_=S.firstChild;_&&_!==L;){if(B=_.nextSibling,domUtils.isTagNode(_,"ol ul"))E.appendChild(_);else{for(M=b.document.createDocumentFragment(),H=0;_.firstChild;)domUtils.isBlockElm(_.firstChild)&&(H=1),M.appendChild(_.firstChild);H?E.appendChild(M):(F=b.document.createElement("p"),F.appendChild(M),E.appendChild(F)),domUtils.remove(_)}_=B}var $=domUtils.createElement(b.document,"div",{tmpDiv:1});domUtils.moveChild(L,$),E.appendChild($),domUtils.remove(L),S.parentNode.insertBefore(E,S),C.setEndBefore(S),domUtils.isEmptyNode(S)&&domUtils.remove(S),R=1}}A||C.setStartBefore(b.document.getElementById(I.start)),I.end&&!R&&C.setEndAfter(b.document.getElementById(I.end)),C.enlarge(!0,function(a){return N[a.tagName]}),E=b.document.createDocumentFragment();for(var V,z=C.createBookmark(),W=domUtils.getNextDomNode(z.start,!1,w),j=C.cloneRange(),X=domUtils.isBlockElm;W&&W!==z.end&&domUtils.getPosition(W,z.end)&domUtils.POSITION_PRECEDING;)if(3==W.nodeType||dtd.li[W.tagName]){if(1==W.nodeType&&dtd.$list[W.tagName]){for(;W.firstChild;)E.appendChild(W.firstChild);V=domUtils.getNextDomNode(W,!1,w),domUtils.remove(W),W=V;continue}for(V=W,j.setStartBefore(W);W&&W!==z.end&&(!X(W)||domUtils.isBookmarkNode(W));)V=W,W=domUtils.getNextDomNode(W,!1,null,function(a){return!N[a.tagName]});W&&X(W)&&(B=domUtils.getNextDomNode(V,!1,w),B&&domUtils.isBookmarkNode(B)&&(W=domUtils.getNextDomNode(B,!1,w),V=B)),j.setEndAfter(V),W=domUtils.getNextDomNode(V,!1,w);var Y=C.document.createElement("li");if(Y.appendChild(j.extractContents()),domUtils.isEmptyNode(Y)){for(var V=C.document.createElement("p");Y.firstChild;)V.appendChild(Y.firstChild);Y.appendChild(V)}E.appendChild(Y)}else W=domUtils.getNextDomNode(W,!0,w);C.moveToBookmark(z).collapse(!0),k=b.document.createElement(U),v(k,h),k.appendChild(E),C.insertNode(k),g(k,U,h);for(var O,i=0,K=domUtils.getElementsByTagName(k,"div");O=K[i++];)O.getAttribute("tmpDiv")&&domUtils.remove(O,!0);C.moveToBookmark(I).select()},queryCommandState:function(a){for(var c,h="insertorderedlist"==a.toLowerCase()?"ol":"ul",g=this.selection.getStartElementPath(),i=0;c=g[i++];){if("TABLE"==c.nodeName)return 0;if(h==c.nodeName.toLowerCase())return 1}return 0},queryCommandValue:function(a){for(var h,g,v="insertorderedlist"==a.toLowerCase()?"ol":"ul",b=this.selection.getStartElementPath(),i=0;g=b[i++];){if("TABLE"==g.nodeName){h=null;break}if(v==g.nodeName.toLowerCase()){h=g;break}}return h?c(h)||domUtils.getComputedStyle(h,"list-style-type"):null}}},function(){var a={textarea:function(a,c){var h=c.ownerDocument.createElement("textarea");return h.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;",browser.ie&&browser.version<8&&(h.style.width=c.offsetWidth+"px",h.style.height=c.offsetHeight+"px",c.onresize=function(){h.style.width=c.offsetWidth+"px",h.style.height=c.offsetHeight+"px"}),c.appendChild(h),{setContent:function(a){h.value=a},getContent:function(){return h.value},select:function(){var a;browser.ie?(a=h.createTextRange(),a.collapse(!0),a.select()):(h.setSelectionRange(0,0),h.focus())},dispose:function(){c.removeChild(h),c.onresize=null,h=null,c=null}}},codemirror:function(a,c){var h=window.CodeMirror(c,{mode:"text/html",tabMode:"indent",lineNumbers:!0,lineWrapping:!0}),g=h.getWrapperElement();return g.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;',h.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;",h.refresh(),{getCodeMirror:function(){return h},setContent:function(a){h.setValue(a)},getContent:function(){return h.getValue()},select:function(){h.focus()},dispose:function(){c.removeChild(g),g=null,h=null}}}};UE.plugins.source=function(){function c(c){return a["codemirror"==b.sourceEditor&&window.CodeMirror?"codemirror":"textarea"](v,c)}var h,g,v=this,b=this.options,y=!1;b.sourceEditor=browser.ie?"textarea":b.sourceEditor||"codemirror",v.setOpt({sourceEditorFirst:!1});var C,N,w;v.commands.source={execCommand:function(){if(y=!y){w=v.selection.getRange().createAddress(!1,!0),v.undoManger&&v.undoManger.save(!0),browser.gecko&&(v.body.contentEditable=!1),C=v.iframe.style.cssText,v.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;",v.fireEvent("beforegetcontent");var a=UE.htmlparser(v.body.innerHTML);v.filterOutputRule(a),a.traversal(function(a){if("element"==a.type)switch(a.tagName){case"td":case"th":case"caption":a.children&&1==a.children.length&&"br"==a.firstChild().tagName&&a.removeChild(a.firstChild());break;case"pre":a.innerText(a.innerText().replace(/&nbsp;/g," "))}}),v.fireEvent("aftergetcontent");var b=a.toHtml(!0);h=c(v.iframe.parentNode),h.setContent(b),g=v.setContent,v.setContent=function(a){var c=UE.htmlparser(a);v.filterInputRule(c),a=c.toHtml(),h.setContent(a)},setTimeout(function(){h.select(),v.addListener("fullscreenchanged",function(){try{h.getCodeMirror().refresh()}catch(e){}})}),N=v.getContent,v.getContent=function(){return h.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{v.iframe.style.cssText=C;var U=h.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";U=U.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(a,c){return c&&!dtd.$inlineWithA[c.toLowerCase()]?a.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):a.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),v.setContent=g,v.setContent(U),h.dispose(),h=null,v.getContent=N;var E=v.body.firstChild;if(E||(v.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",E=v.body.firstChild),v.undoManger&&v.undoManger.save(!0),browser.gecko){var T=document.createElement("input");T.style.cssText="position:absolute;left:0;top:-32768px",document.body.appendChild(T),v.body.contentEditable=!1,setTimeout(function(){domUtils.setViewportOffset(T,{left:-32768,top:0}),T.focus(),setTimeout(function(){v.body.contentEditable=!0,v.selection.getRange().moveToAddress(w).select(!0),domUtils.remove(T)})})}else try{v.selection.getRange().moveToAddress(w).select(!0)}catch(e){}}this.fireEvent("sourcemodechanged",y)},queryCommandState:function(){return 0|y},notNeedUndo:1};var U=v.queryCommandState;v.queryCommandState=function(a){return a=a.toLowerCase(),y?a in{source:1,fullscreen:1}?1:-1:U.apply(this,arguments)},"codemirror"==b.sourceEditor&&v.addListener("ready",function(){utils.loadFile(document,{src:b.codeMirrorJsUrl||b.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){b.sourceEditorFirst&&setTimeout(function(){v.execCommand("source")},0)}),utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:b.codeMirrorCssUrl||b.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}(),UE.plugins.enterkey=function(){var a,c=this,h=c.options.enterTag;c.addListener("keyup",function(h,g){var v=g.keyCode||g.which;if(13==v){var b,y=c.selection.getRange(),C=y.startContainer;if(browser.ie)c.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(a)){if(browser.gecko){var N=domUtils.findParentByTagName(C,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);N||(c.document.execCommand("formatBlock",!1,"<p>"),b=1)}else if(1==C.nodeType){var w,U=c.document.createTextNode("");if(y.insertNode(U),w=domUtils.findParentByTagName(U,"div",!0)){for(var p=c.document.createElement("p");w.firstChild;)p.appendChild(w.firstChild);w.parentNode.insertBefore(p,w),domUtils.remove(w),y.setStartBefore(U).setCursor(),b=1}domUtils.remove(U)}c.undoManger&&b&&c.undoManger.save()}browser.opera&&y.select()}}}),c.addListener("keydown",function(g,v){var b=v.keyCode||v.which;if(13==b){if(c.fireEvent("beforeenterkeydown"))return void domUtils.preventDefault(v);c.fireEvent("saveScene",!0,!0),a="";var y=c.selection.getRange();if(!y.collapsed){var C=y.startContainer,N=y.endContainer,w=domUtils.findParentByTagName(C,"td",!0),U=domUtils.findParentByTagName(N,"td",!0);if(w&&U&&w!==U||!w&&U||w&&!U)return void(v.preventDefault?v.preventDefault():v.returnValue=!1)}if("p"==h)browser.ie||(C=domUtils.findParentByTagName(y.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),C||browser.opera?(a=C.tagName,"p"==C.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(C)):(c.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(y=c.selection.getRange(),C=domUtils.findParentByTagName(y.startContainer,"p",!0),C&&domUtils.removeDirtyAttr(C))));else if(v.preventDefault?v.preventDefault():v.returnValue=!1,y.collapsed){T=y.document.createElement("br"),y.insertNode(T);var E=T.parentNode;E.lastChild===T?(T.parentNode.insertBefore(T.cloneNode(!0),T),y.setStartBefore(T)):y.setStartAfter(T),y.setCursor()}else if(y.deleteContents(),C=y.startContainer,1==C.nodeType&&(C=C.childNodes[y.startOffset])){for(;1==C.nodeType;){if(dtd.$empty[C.tagName])return y.setStartBefore(C).setCursor(),c.undoManger&&c.undoManger.save(),!1;if(!C.firstChild){var T=y.document.createElement("br");return C.appendChild(T),y.setStart(C,0).setCursor(),c.undoManger&&c.undoManger.save(),!1}C=C.firstChild}C===y.startContainer.childNodes[y.startOffset]?(T=y.document.createElement("br"),y.insertNode(T).setCursor()):y.setStart(C,0).setCursor()}else T=y.document.createElement("br"),y.insertNode(T).setStartAfter(T).setCursor()}})},UE.plugins.keystrokes=function(){var a=this,c=!0;a.addListener("keydown",function(h,g){var v=g.keyCode||g.which,b=a.selection.getRange();if(!b.collapsed&&!(g.ctrlKey||g.shiftKey||g.altKey||g.metaKey)&&(v>=65&&90>=v||v>=48&&57>=v||v>=96&&111>=v||{13:1,8:1,46:1}[v])){var y=b.startContainer;if(domUtils.isFillChar(y)&&b.setStartBefore(y),y=b.endContainer,domUtils.isFillChar(y)&&b.setEndAfter(y),b.txtToElmBoundary(),b.endContainer&&1==b.endContainer.nodeType&&(y=b.endContainer.childNodes[b.endOffset],y&&domUtils.isBr(y)&&b.setEndAfter(y)),0==b.startOffset&&(y=b.startContainer,domUtils.isBoundaryNode(y,"firstChild")&&(y=b.endContainer,b.endOffset==(3==y.nodeType?y.nodeValue.length:y.childNodes.length)&&domUtils.isBoundaryNode(y,"lastChild"))))return a.fireEvent("saveScene"),a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",b.setStart(a.body.firstChild,0).setCursor(!1,!0),void a._selectionChange()}if(v==keymap.Backspace){if(b=a.selection.getRange(),c=b.collapsed,a.fireEvent("delkeydown",g))return;var C,N;if(b.collapsed&&b.inFillChar()&&(C=b.startContainer,domUtils.isFillChar(C)?(b.setStartBefore(C).shrinkBoundary(!0).collapse(!0),domUtils.remove(C)):(C.nodeValue=C.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),b.startOffset--,b.collapse(!0).select(!0))),C=b.getClosedNode())return a.fireEvent("saveScene"),b.setStartBefore(C),domUtils.remove(C),b.setCursor(),a.fireEvent("saveScene"),void domUtils.preventDefault(g);if(!browser.ie&&(C=domUtils.findParentByTagName(b.startContainer,"table",!0),N=domUtils.findParentByTagName(b.endContainer,"table",!0),C&&!N||!C&&N||C!==N))return void g.preventDefault()}if(v==keymap.Tab){var w={ol:1,ul:1,table:1};if(a.fireEvent("tabkeydown",g))return void domUtils.preventDefault(g);var U=a.selection.getRange();a.fireEvent("saveScene");for(var i=0,E="",T=a.options.tabSize||4,S=a.options.tabNode||"&nbsp;";T>i;i++)E+=S;var k=a.document.createElement("span");if(k.innerHTML=E+domUtils.fillChar,U.collapsed)U.insertNode(k.cloneNode(!0).firstChild).setCursor(!0);else{var B=function(a){return domUtils.isBlockElm(a)&&!w[a.tagName.toLowerCase()]};if(C=domUtils.findParent(U.startContainer,B,!0),N=domUtils.findParent(U.endContainer,B,!0),C&&N&&C===N)U.deleteContents(),U.insertNode(k.cloneNode(!0).firstChild).setCursor(!0);else{var I=U.createBookmark();U.enlarge(!0);for(var _=U.createBookmark(),A=domUtils.getNextDomNode(_.start,!1,B);A&&!(domUtils.getPosition(A,_.end)&domUtils.POSITION_FOLLOWING);)A.insertBefore(k.cloneNode(!0).firstChild,A.firstChild),A=domUtils.getNextDomNode(A,!1,B);U.moveToBookmark(_).moveToBookmark(I).select()}}domUtils.preventDefault(g)}if(browser.gecko&&46==v&&(U=a.selection.getRange(),U.collapsed&&(C=U.startContainer,domUtils.isEmptyBlock(C)))){for(var L=C.parentNode;1==domUtils.getChildCount(L)&&!domUtils.isBody(L);)C=L,L=L.parentNode;return void(C===L.lastChild&&g.preventDefault())}}),a.addListener("keyup",function(a,h){var g,v=h.keyCode||h.which,b=this;if(v==keymap.Backspace){if(b.fireEvent("delkeyup"))return;if(g=b.selection.getRange(),g.collapsed){var y,C=["h1","h2","h3","h4","h5","h6"];if((y=domUtils.findParentByTagName(g.startContainer,C,!0))&&domUtils.isEmptyBlock(y)){var N=y.previousSibling;if(N&&"TABLE"!=N.nodeName)return domUtils.remove(y),void g.setStartAtLast(N).setCursor(!1,!0);var w=y.nextSibling;if(w&&"TABLE"!=w.nodeName)return domUtils.remove(y),void g.setStartAtFirst(w).setCursor(!1,!0)}if(domUtils.isBody(g.startContainer)){var y=domUtils.createElement(b.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});g.insertNode(y).setStart(y,0).setCursor(!1,!0)}}if(!c&&(3==g.startContainer.nodeType||1==g.startContainer.nodeType&&domUtils.isEmptyBlock(g.startContainer)))if(browser.ie){var U=g.document.createElement("span");g.insertNode(U).setStartBefore(U).collapse(!0),g.select(),domUtils.remove(U)}else g.select()}})},UE.plugins.fiximgclick=function(){function a(){this.editor=null,this.resizer=null,this.cover=null,this.doc=document,this.prePos={x:0,y:0},this.startPos={x:0,y:0}}var c=!1;return function(){var h=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];a.prototype={init:function(a){var c=this;c.editor=a,c.startPos=this.prePos={x:0,y:0},c.dragId=-1;var h=[],g=c.cover=document.createElement("div"),v=c.resizer=document.createElement("div");for(g.id=c.editor.ui.id+"_imagescale_cover",g.style.cssText="position:absolute;display:none;z-index:"+c.editor.options.zIndex+";filter:alpha(opacity=0); opacity:0;background:#CCC;",domUtils.on(g,"mousedown click",function(){c.hide()}),i=0;8>i;i++)h.push('<span class="edui-editor-imagescale-hand'+i+'"></span>');v.id=c.editor.ui.id+"_imagescale",v.className="edui-editor-imagescale",v.innerHTML=h.join(""),v.style.cssText+=";display:none;border:1px solid #3b77ff;z-index:"+c.editor.options.zIndex+";",c.editor.ui.getDom().appendChild(g),c.editor.ui.getDom().appendChild(v),c.initStyle(),c.initEvents()},initStyle:function(){utils.cssRule("imagescale",".edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}.edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},initEvents:function(){var a=this;a.startPos.x=a.startPos.y=0,a.isDraging=!1},_eventHandler:function(e){var a=this;switch(e.type){case"mousedown":var h,h=e.target||e.srcElement;-1!=h.className.indexOf("edui-editor-imagescale-hand")&&-1==a.dragId&&(a.dragId=h.className.slice(-1),a.startPos.x=a.prePos.x=e.clientX,a.startPos.y=a.prePos.y=e.clientY,domUtils.on(a.doc,"mousemove",a.proxy(a._eventHandler,a)));break;case"mousemove":-1!=a.dragId&&(a.updateContainerStyle(a.dragId,{x:e.clientX-a.prePos.x,y:e.clientY-a.prePos.y}),a.prePos.x=e.clientX,a.prePos.y=e.clientY,c=!0,a.updateTargetElement());break;case"mouseup":-1!=a.dragId&&(a.updateContainerStyle(a.dragId,{x:e.clientX-a.prePos.x,y:e.clientY-a.prePos.y}),a.updateTargetElement(),a.target.parentNode&&a.attachTo(a.target),a.dragId=-1),domUtils.un(a.doc,"mousemove",a.proxy(a._eventHandler,a)),c&&(c=!1,a.editor.fireEvent("contentchange"))}},updateTargetElement:function(){var a=this;domUtils.setStyles(a.target,{width:a.resizer.style.width,height:a.resizer.style.height}),a.target.width=parseInt(a.resizer.style.width),a.target.height=parseInt(a.resizer.style.height),a.attachTo(a.target)},updateContainerStyle:function(a,c){var g,v=this,b=v.resizer;0!=h[a][0]&&(g=parseInt(b.style.left)+c.x,b.style.left=v._validScaledProp("left",g)+"px"),0!=h[a][1]&&(g=parseInt(b.style.top)+c.y,b.style.top=v._validScaledProp("top",g)+"px"),0!=h[a][2]&&(g=b.clientWidth+h[a][2]*c.x,b.style.width=v._validScaledProp("width",g)+"px"),0!=h[a][3]&&(g=b.clientHeight+h[a][3]*c.y,b.style.height=v._validScaledProp("height",g)+"px")},_validScaledProp:function(a,c){var h=this.resizer,g=document;switch(c=isNaN(c)?0:c,a){case"left":return 0>c?0:c+h.clientWidth>g.clientWidth?g.clientWidth-h.clientWidth:c;case"top":return 0>c?0:c+h.clientHeight>g.clientHeight?g.clientHeight-h.clientHeight:c;case"width":return 0>=c?1:c+h.offsetLeft>g.clientWidth?g.clientWidth-h.offsetLeft:c;case"height":return 0>=c?1:c+h.offsetTop>g.clientHeight?g.clientHeight-h.offsetTop:c}},hideCover:function(){this.cover.style.display="none"},showCover:function(){var a=this,c=domUtils.getXY(a.editor.ui.getDom()),h=domUtils.getXY(a.editor.iframe);domUtils.setStyles(a.cover,{width:a.editor.iframe.offsetWidth+"px",height:a.editor.iframe.offsetHeight+"px",top:h.y-c.y+"px",left:h.x-c.x+"px",position:"absolute",display:""})},show:function(a){var c=this;c.resizer.style.display="block",a&&c.attachTo(a),domUtils.on(this.resizer,"mousedown",c.proxy(c._eventHandler,c)),domUtils.on(c.doc,"mouseup",c.proxy(c._eventHandler,c)),c.showCover(),c.editor.fireEvent("afterscaleshow",c),c.editor.fireEvent("saveScene")},hide:function(){var a=this;a.hideCover(),a.resizer.style.display="none",domUtils.un(a.resizer,"mousedown",a.proxy(a._eventHandler,a)),domUtils.un(a.doc,"mouseup",a.proxy(a._eventHandler,a)),a.editor.fireEvent("afterscalehide",a)},proxy:function(a,c){return function(){return a.apply(c||this,arguments)}},attachTo:function(a){var c=this,h=c.target=a,g=this.resizer,v=domUtils.getXY(h),b=domUtils.getXY(c.editor.iframe),y=domUtils.getXY(g.parentNode);domUtils.setStyles(g,{width:h.width+"px",height:h.height+"px",left:b.x+v.x-c.editor.document.body.scrollLeft-y.x-parseInt(g.style.borderLeftWidth)+"px",top:b.y+v.y-c.editor.document.body.scrollTop-y.y-parseInt(g.style.borderTopWidth)+"px"})}}}(),function(){var c,h=this;h.setOpt("imageScaleEnabled",!0),!browser.ie&&h.options.imageScaleEnabled&&h.addListener("click",function(){var g=h.selection.getRange(),v=g.getClosedNode();if(v&&"IMG"==v.tagName&&"false"!=h.body.contentEditable){if(-1!=v.className.indexOf("edui-faked-music")||v.getAttribute("anchorname")||domUtils.hasClass(v,"loadingclass")||domUtils.hasClass(v,"loaderrorclass"))return;if(!c){c=new a,c.init(h),h.ui.getDom().appendChild(c.resizer);var b,y=function(){c.hide(),c.target&&h.selection.getRange().selectNode(c.target).select()},C=function(e){var a=e.target||e.srcElement;!a||void 0!==a.className&&-1!=a.className.indexOf("edui-editor-imagescale")||y(e)};h.addListener("afterscaleshow",function(){h.addListener("beforekeydown",y),h.addListener("beforemousedown",C),domUtils.on(document,"keydown",y),domUtils.on(document,"mousedown",C),h.selection.getNative().removeAllRanges()}),h.addListener("afterscalehide",function(){h.removeListener("beforekeydown",y),h.removeListener("beforemousedown",C),domUtils.un(document,"keydown",y),domUtils.un(document,"mousedown",C);var a=c.target;a.parentNode&&h.selection.getRange().selectNode(a).select()}),domUtils.on(c.resizer,"mousedown",function(e){h.selection.getNative().removeAllRanges();var a=e.target||e.srcElement;a&&-1==a.className.indexOf("edui-editor-imagescale-hand")&&(b=setTimeout(function(){c.hide(),c.target&&h.selection.getRange().selectNode(a).select()},200))}),domUtils.on(c.resizer,"mouseup",function(e){var a=e.target||e.srcElement;a&&-1==a.className.indexOf("edui-editor-imagescale-hand")&&clearTimeout(b)})}c.show(v)}else c&&"none"!=c.resizer.style.display&&c.hide()}),browser.webkit&&h.addListener("click",function(a,e){if("IMG"==e.target.tagName&&"false"!=h.body.contentEditable){var c=new dom.Range(h.document);c.selectNode(e.target).select()}})}}(),UE.plugin.register("autolink",function(){var a=0;return browser.ie?{}:{bindEvents:{reset:function(){a=0},keydown:function(a,c){var h=this,g=c.keyCode||c.which;if(32==g||13==g){for(var v,b,y=h.selection.getNative(),C=y.getRangeAt(0).cloneRange(),N=C.startContainer;1==N.nodeType&&C.startOffset>0&&(N=C.startContainer.childNodes[C.startOffset-1]);)C.setStart(N,1==N.nodeType?N.childNodes.length:N.nodeValue.length),C.collapse(!0),N=C.startContainer;do{if(0==C.startOffset){for(N=C.startContainer.previousSibling;N&&1==N.nodeType;)N=N.lastChild;if(!N||domUtils.isFillChar(N))break;v=N.nodeValue.length}else N=C.startContainer,v=C.startOffset;C.setStart(N,v-1),b=C.toString().charCodeAt(0)}while(160!=b&&32!=b);if(C.toString().replace(new RegExp(domUtils.fillChar,"g"),"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){for(;C.toString().length&&!/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(C.toString());)try{C.setStart(C.startContainer,C.startOffset+1)}catch(e){for(var N=C.startContainer;!(next=N.nextSibling);){if(domUtils.isBody(N))return;N=N.parentNode}C.setStart(next,0)}if(domUtils.findParentByTagName(C.startContainer,"a",!0))return;var w,U=h.document.createElement("a"),E=h.document.createTextNode(" ");h.undoManger&&h.undoManger.save(),U.appendChild(C.extractContents()),U.href=U.innerHTML=U.innerHTML.replace(/<[^>]+>/g,""),w=U.getAttribute("href").replace(new RegExp(domUtils.fillChar,"g"),""),w=/^(?:https?:\/\/)/gi.test(w)?w:"http://"+w,U.setAttribute("_src",utils.html(w)),U.href=utils.html(w),C.insertNode(U),U.parentNode.insertBefore(E,U.nextSibling),C.setStart(E,0),C.collapse(!0),y.removeAllRanges(),y.addRange(C),h.undoManger&&h.undoManger.save()}}}}}},function(){function a(a){if(3==a.nodeType)return null;if("A"==a.nodeName)return a;for(var c=a.lastChild;c;){if("A"==c.nodeName)return c;if(3==c.nodeType){if(domUtils.isWhitespace(c)){c=c.previousSibling;continue}return null}c=c.lastChild}}var c={37:1,38:1,39:1,40:1,13:1,32:1};browser.ie&&this.addListener("keyup",function(h,g){var v=this,b=g.keyCode;if(c[b]){var y=v.selection.getRange(),C=y.startContainer;if(13==b){for(;C&&!domUtils.isBody(C)&&!domUtils.isBlockElm(C);)C=C.parentNode;if(C&&!domUtils.isBody(C)&&"P"==C.nodeName){var N=C.previousSibling;if(N&&1==N.nodeType){var N=a(N);N&&!N.getAttribute("_href")&&domUtils.remove(N,!0)}}}else if(32==b)3==C.nodeType&&/^\s$/.test(C.nodeValue)&&(C=C.previousSibling,C&&"A"==C.nodeName&&!C.getAttribute("_href")&&domUtils.remove(C,!0));else if(C=domUtils.findParentByTagName(C,"a",!0),C&&!C.getAttribute("_href")){var w=y.createBookmark();domUtils.remove(C,!0),y.moveToBookmark(w).select(!0)}}})}),UE.plugins.autoheight=function(){function a(){var a=this;clearTimeout(v),b||(!a.queryCommandState||a.queryCommandState&&1!=a.queryCommandState("source"))&&(v=setTimeout(function(){for(var c=a.body.lastChild;c&&1!=c.nodeType;)c=c.previousSibling;c&&1==c.nodeType&&(c.style.clear="both",g=Math.max(domUtils.getXY(c).y+c.offsetHeight+25,Math.max(C.minFrameHeight,C.initialFrameHeight)),g!=y&&(g!==parseInt(a.iframe.parentNode.style.height)&&(a.iframe.parentNode.style.height=g+"px"),a.body.style.height=g+"px",y=g),domUtils.removeStyle(c,"clear"))},50))}var c=this;if(c.autoHeightEnabled=c.options.autoHeightEnabled!==!1,c.autoHeightEnabled){var h,g,v,b,y=0,C=c.options;c.addListener("fullscreenchanged",function(a,f){b=f}),c.addListener("destroy",function(){c.removeListener("contentchange afterinserthtml keyup mouseup",a)}),c.enableAutoHeight=function(){var c=this;if(c.autoHeightEnabled){var g=c.document;c.autoHeightEnabled=!0,h=g.body.style.overflowY,g.body.style.overflowY="hidden",c.addListener("contentchange afterinserthtml keyup mouseup",a),setTimeout(function(){a.call(c)},browser.gecko?100:0),c.fireEvent("autoheightchanged",c.autoHeightEnabled)}},c.disableAutoHeight=function(){c.body.style.overflowY=h||"",c.removeListener("contentchange",a),c.removeListener("keyup",a),c.removeListener("mouseup",a),c.autoHeightEnabled=!1,c.fireEvent("autoheightchanged",c.autoHeightEnabled)},c.on("setHeight",function(){c.disableAutoHeight()}),c.addListener("ready",function(){c.enableAutoHeight();var h;domUtils.on(browser.ie?c.body:c.document,browser.webkit?"dragover":"drop",function(){clearTimeout(h),h=setTimeout(function(){a.call(c)},100)});var g;window.onscroll=function(){null===g?g=this.scrollY:0==this.scrollY&&0!=g&&(c.window.scrollTo(0,0),g=null)}})}},UE.plugins.autofloat=function(){function a(){return UE.ui?1:(alert(y.autofloatMsg),0)}function c(){var a=document.body.style;a.backgroundImage='url("about:blank")',a.backgroundAttachment="fixed"}function h(){var a=domUtils.getXY(U),c=domUtils.getComputedStyle(U,"position"),h=domUtils.getComputedStyle(U,"left");U.style.width=U.offsetWidth+"px",U.style.zIndex=1*b.options.zIndex+1,U.parentNode.insertBefore(I,U),k||B&&browser.ie?("absolute"!=U.style.position&&(U.style.position="absolute"),U.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-E+N+"px"):(browser.ie7Compat&&_&&(_=!1,U.style.left=domUtils.getXY(U).x-document.documentElement.getBoundingClientRect().left+2+"px"),"fixed"!=U.style.position&&(U.style.position="fixed",U.style.top=N+"px",("absolute"==c||"relative"==c)&&parseFloat(h)&&(U.style.left=a.x+"px")))}function g(){_=!0,I.parentNode&&I.parentNode.removeChild(I),U.style.cssText=w}function v(){var a=T(b.container),c=b.options.toolbarTopOffset||0;
a.top<0&&a.bottom-U.offsetHeight>c?h():g()}var b=this,y=b.getLang();b.setOpt({topOffset:0});var C=b.options.autoFloatEnabled!==!1,N=b.options.topOffset;if(C){var w,U,E,T,S=UE.ui.uiUtils,k=browser.ie&&browser.version<=6,B=browser.quirks,I=document.createElement("div"),_=!0,A=utils.defer(function(){v()},browser.ie?200:100,!0);b.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],v),b.removeListener("keydown",A)}),b.addListener("ready",function(){if(a(b)){if(!b.ui)return;T=S.getClientRect,U=b.ui.getDom("toolbarbox"),E=T(U).top,w=U.style.cssText,I.style.height=U.offsetHeight+"px",k&&c(),domUtils.on(window,["scroll","resize"],v),b.addListener("keydown",A),b.addListener("beforefullscreenchange",function(t,a){a&&g()}),b.addListener("fullscreenchanged",function(t,a){a||v()}),b.addListener("sourcemodechanged",function(){setTimeout(function(){v()},0)}),b.addListener("clearDoc",function(){setTimeout(function(){v()},0)})}})}},UE.plugins.video=function(){function a(a,c,g,v,b,y,C){var N;switch(C){case"image":N="<img "+(v?'id="'+v+'"':"")+' width="'+c+'" height="'+g+'" _url="'+a+'" class="'+y.replace(/\bvideo-js\b/,"")+'" src="'+h.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+h.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(b?"float:"+b+";":"")+'" />';break;case"embed":N='<embed type="application/x-shockwave-flash" class="'+y+'" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+utils.html(a)+'" width="'+c+'" height="'+g+'"'+(b?' style="float:'+b+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';break;case"video":var w=a.substr(a.lastIndexOf(".")+1);"ogv"==w&&(w="ogg"),N="<video"+(v?' id="'+v+'"':"")+' class="'+y+' video-js" '+(b?' style="float:'+b+'"':"")+' controls preload="none" width="'+c+'" height="'+g+'" src="'+a+'" data-setup="{}"><source src="'+a+'" type="video/'+w+'" /></video>'}return N}function c(c,h){utils.each(c.getNodesByTagName(h?"img":"embed video"),function(c){var g=c.getAttr("class");if(g&&-1!=g.indexOf("edui-faked-video")){var v=a(c.getAttr(h?"_url":"src"),c.getAttr("width"),c.getAttr("height"),null,c.getStyle("float")||"",g,h?"embed":"image");c.parentNode.replaceChild(UE.uNode.createElement(v),c)}if(g&&-1!=g.indexOf("edui-upload-video")){var v=a(c.getAttr(h?"_url":"src"),c.getAttr("width"),c.getAttr("height"),null,c.getStyle("float")||"",g,h?"video":"image");c.parentNode.replaceChild(UE.uNode.createElement(v),c)}})}var h=this;h.addOutputRule(function(a){c(a,!0)}),h.addInputRule(function(a){c(a)}),h.commands.insertvideo={execCommand:function(c,g,v){g=utils.isArray(g)?g:[g];for(var b,y,C=[],N="tmpVedio",i=0,w=g.length;w>i;i++)y=g[i],b="upload"==v?"edui-upload-video video-js vjs-default-skin":"edui-faked-video",C.push(a(y.url,y.width||420,y.height||280,N+i,null,b,"image"));h.execCommand("inserthtml",C.join(""),!0);for(var U=this.selection.getRange(),i=0,w=g.length;w>i;i++){var E=this.document.getElementById("tmpVedio"+i);domUtils.removeAttributes(E,"id"),U.selectNode(E).select(),h.execCommand("imagefloat",g[i].align)}},queryCommandState:function(){var a=h.selection.getRange().getClosedNode(),c=a&&("edui-faked-video"==a.className||-1!=a.className.indexOf("edui-upload-video"));return c?1:0}}},function(){function a(){}var c=UE.UETable=function(a){this.table=a,this.indexTable=[],this.selectedTds=[],this.cellsRange={},this.update(a)};c.removeSelectedClass=function(a){utils.each(a,function(a){domUtils.removeClasses(a,"selectTdClass")})},c.addSelectedClass=function(a){utils.each(a,function(a){domUtils.addClass(a,"selectTdClass")})},c.isEmptyBlock=function(a){var c=new RegExp(domUtils.fillChar,"g");if(a[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(c,"").length>0)return 0;for(var i in dtd.$isNotEmpty)if(dtd.$isNotEmpty.hasOwnProperty(i)&&a.getElementsByTagName(i).length)return 0;return 1},c.getWidth=function(a){return a?parseInt(domUtils.getComputedStyle(a,"width"),10):0},c.getTableCellAlignState=function(a){!utils.isArray(a)&&(a=[a]);var c={},h=["align","valign"],g=null,v=!0;return utils.each(a,function(a){return utils.each(h,function(h){if(g=a.getAttribute(h),!c[h]&&g)c[h]=g;else if(!c[h]||g!==c[h])return v=!1,!1}),v}),v?c:null},c.getTableItemsByRange=function(a){var c=a.selection.getStart();c&&c.id&&0===c.id.indexOf("_baidu_bookmark_start_")&&c.nextSibling&&(c=c.nextSibling);var h=c&&domUtils.findParentByTagName(c,["td","th"],!0),g=h&&h.parentNode,v=c&&domUtils.findParentByTagName(c,"caption",!0),b=v?v.parentNode:g&&g.parentNode.parentNode;return{cell:h,tr:g,table:b,caption:v}},c.getUETableBySelected=function(a){var h=c.getTableItemsByRange(a).table;return h&&h.ueTable&&h.ueTable.selectedTds.length?h.ueTable:null},c.getDefaultValue=function(a,c){var h,g,v,b,y={thin:"0px",medium:"1px",thick:"2px"};if(c)return C=c.getElementsByTagName("td")[0],b=domUtils.getComputedStyle(c,"border-left-width"),h=parseInt(y[b]||b,10),b=domUtils.getComputedStyle(C,"padding-left"),g=parseInt(y[b]||b,10),b=domUtils.getComputedStyle(C,"border-left-width"),v=parseInt(y[b]||b,10),{tableBorder:h,tdPadding:g,tdBorder:v};c=a.document.createElement("table"),c.insertRow(0).insertCell(0).innerHTML="xxx",a.body.appendChild(c);var C=c.getElementsByTagName("td")[0];return b=domUtils.getComputedStyle(c,"border-left-width"),h=parseInt(y[b]||b,10),b=domUtils.getComputedStyle(C,"padding-left"),g=parseInt(y[b]||b,10),b=domUtils.getComputedStyle(C,"border-left-width"),v=parseInt(y[b]||b,10),domUtils.remove(c),{tableBorder:h,tdPadding:g,tdBorder:v}},c.getUETable=function(a){var h=a.tagName.toLowerCase();return a="td"==h||"th"==h||"caption"==h?domUtils.findParentByTagName(a,"table",!0):a,a.ueTable||(a.ueTable=new c(a)),a.ueTable},c.cloneCell=function(a,c,h){if(!a||utils.isString(a))return this.table.ownerDocument.createElement(a||"td");var g=domUtils.hasClass(a,"selectTdClass");g&&domUtils.removeClasses(a,"selectTdClass");var v=a.cloneNode(!0);return c&&(v.rowSpan=v.colSpan=1),!h&&domUtils.removeAttributes(v,"width height"),!h&&domUtils.removeAttributes(v,"style"),v.style.borderLeftStyle="",v.style.borderTopStyle="",v.style.borderLeftColor=a.style.borderRightColor,v.style.borderLeftWidth=a.style.borderRightWidth,v.style.borderTopColor=a.style.borderBottomColor,v.style.borderTopWidth=a.style.borderBottomWidth,g&&domUtils.addClass(a,"selectTdClass"),v},c.prototype={getMaxRows:function(){for(var a,c=this.table.rows,h=1,i=0;a=c[i];i++){for(var g,v=1,b=0;g=a.cells[b++];)v=Math.max(g.rowSpan||1,v);h=Math.max(v+i,h)}return h},getMaxCols:function(){for(var a,c=this.table.rows,h=0,g={},i=0;a=c[i];i++){for(var v,b=0,y=0;v=a.cells[y++];)if(b+=v.colSpan||1,v.rowSpan&&v.rowSpan>1)for(var C=1;C<v.rowSpan;C++)g["row_"+(i+C)]?g["row_"+(i+C)]++:g["row_"+(i+C)]=v.colSpan||1;b+=g["row_"+i]||0,h=Math.max(b,h)}return h},getCellColIndex:function(){},getHSideCell:function(c,h){try{var g,v,b=this.getCellInfo(c),y=this.selectedTds.length,C=this.cellsRange;return!h&&(y?!C.beginColIndex:!b.colIndex)||h&&(y?C.endColIndex==this.colsNum-1:b.colIndex==this.colsNum-1)?null:(g=y?C.beginRowIndex:b.rowIndex,v=h?y?C.endColIndex+1:b.colIndex+1:y?C.beginColIndex-1:b.colIndex<1?0:b.colIndex-1,this.getCell(this.indexTable[g][v].rowIndex,this.indexTable[g][v].cellIndex))}catch(e){a(e)}},getTabNextCell:function(a,c){var h,g=this.getCellInfo(a),v=c||g.rowIndex,b=g.colIndex+1+(g.colSpan-1);try{h=this.getCell(this.indexTable[v][b].rowIndex,this.indexTable[v][b].cellIndex)}catch(e){try{v=1*v+1,b=0,h=this.getCell(this.indexTable[v][b].rowIndex,this.indexTable[v][b].cellIndex)}catch(e){}}return h},getVSideCell:function(c,h,g){try{var v,b,y=this.getCellInfo(c),C=this.selectedTds.length&&!g,N=this.cellsRange;return!h&&0==y.rowIndex||h&&(C?N.endRowIndex==this.rowsNum-1:y.rowIndex+y.rowSpan>this.rowsNum-1)?null:(v=h?C?N.endRowIndex+1:y.rowIndex+y.rowSpan:C?N.beginRowIndex-1:y.rowIndex-1,b=C?N.beginColIndex:y.colIndex,this.getCell(this.indexTable[v][b].rowIndex,this.indexTable[v][b].cellIndex))}catch(e){a(e)}},getSameEndPosCells:function(c,h){try{for(var g="x"===h.toLowerCase(),v=domUtils.getXY(c)[g?"x":"y"]+c["offset"+(g?"Width":"Height")],b=this.table.rows,y=null,C=[],i=0;i<this.rowsNum;i++){y=b[i].cells;for(var N,w=0;N=y[w++];){var U=domUtils.getXY(N)[g?"x":"y"]+N["offset"+(g?"Width":"Height")];if(U>v&&g)break;if((c==N||v==U)&&(1==N[g?"colSpan":"rowSpan"]&&C.push(N),g))break}}return C}catch(e){a(e)}},setCellContent:function(a,c){a.innerHTML=c||(browser.ie?domUtils.fillChar:"<br />")},cloneCell:c.cloneCell,getSameStartPosXCells:function(c){try{for(var h,g=domUtils.getXY(c).x+c.offsetWidth,v=this.table.rows,b=[],i=0;i<this.rowsNum;i++){h=v[i].cells;for(var y,C=0;y=h[C++];){var N=domUtils.getXY(y).x;if(N>g)break;if(N==g&&1==y.colSpan){b.push(y);break}}}return b}catch(e){a(e)}},update:function(a){this.table=a||this.table,this.selectedTds=[],this.cellsRange={},this.indexTable=[];for(var c=this.table.rows,h=this.getMaxRows(),g=h-c.length,v=this.getMaxCols();g--;)this.table.insertRow(c.length);this.rowsNum=h,this.colsNum=v;for(var i=0,b=c.length;b>i;i++)this.indexTable[i]=new Array(v);for(var y,C=0;y=c[C];C++)for(var N,w=0,U=y.cells;N=U[w];w++){N.rowSpan>h&&(N.rowSpan=h);for(var E=w,T=N.rowSpan||1,S=N.colSpan||1;this.indexTable[C][E];)E++;for(var k=0;T>k;k++)for(var B=0;S>B;B++)this.indexTable[C+k][E+B]={rowIndex:C,cellIndex:w,colIndex:E,rowSpan:T,colSpan:S}}for(k=0;h>k;k++)for(B=0;v>B;B++)void 0===this.indexTable[k][B]&&(y=c[k],N=y.cells[y.cells.length-1],N=N?N.cloneNode(!0):this.table.ownerDocument.createElement("td"),this.setCellContent(N),1!==N.colSpan&&(N.colSpan=1),1!==N.rowSpan&&(N.rowSpan=1),y.appendChild(N),this.indexTable[k][B]={rowIndex:k,cellIndex:N.cellIndex,colIndex:B,rowSpan:1,colSpan:1});var I=domUtils.getElementsByTagName(this.table,"td"),_=[];if(utils.each(I,function(a){domUtils.hasClass(a,"selectTdClass")&&_.push(a)}),_.length){var A=_[0],L=_[_.length-1],R=this.getCellInfo(A),D=this.getCellInfo(L);this.selectedTds=_,this.cellsRange={beginRowIndex:R.rowIndex,beginColIndex:R.colIndex,endRowIndex:D.rowIndex+D.rowSpan-1,endColIndex:D.colIndex+D.colSpan-1}}if(!domUtils.hasClass(this.table.rows[0],"firstRow")){domUtils.addClass(this.table.rows[0],"firstRow");for(var i=1;i<this.table.rows.length;i++)domUtils.removeClasses(this.table.rows[i],"firstRow")}},getCellInfo:function(a){if(a)for(var c=a.cellIndex,h=a.parentNode.rowIndex,g=this.indexTable[h],v=this.colsNum,b=c;v>b;b++){var y=g[b];if(y.rowIndex===h&&y.cellIndex===c)return y}},getCell:function(a,c){return a<this.rowsNum&&this.table.rows[a].cells[c]||null},deleteCell:function(a,c){c="number"==typeof c?c:a.parentNode.rowIndex;var h=this.table.rows[c];h.deleteCell(a.cellIndex)},getCellsRange:function(a,c){function h(a,c,v,b){var y,C,N,w=a,U=c,E=v,T=b;if(a>0)for(C=c;b>C;C++)y=g.indexTable[a][C],N=y.rowIndex,a>N&&(w=Math.min(N,w));if(b<g.colsNum)for(N=a;v>N;N++)y=g.indexTable[N][b],C=y.colIndex+y.colSpan-1,C>b&&(T=Math.max(C,T));if(v<g.rowsNum)for(C=c;b>C;C++)y=g.indexTable[v][C],N=y.rowIndex+y.rowSpan-1,N>v&&(E=Math.max(N,E));if(c>0)for(N=a;v>N;N++)y=g.indexTable[N][c],C=y.colIndex,c>C&&(U=Math.min(y.colIndex,U));return w!=a||U!=c||E!=v||T!=b?h(w,U,E,T):{beginRowIndex:a,beginColIndex:c,endRowIndex:v,endColIndex:b}}try{var g=this,v=g.getCellInfo(a);if(a===c)return{beginRowIndex:v.rowIndex,beginColIndex:v.colIndex,endRowIndex:v.rowIndex+v.rowSpan-1,endColIndex:v.colIndex+v.colSpan-1};var b=g.getCellInfo(c),y=Math.min(v.rowIndex,b.rowIndex),C=Math.min(v.colIndex,b.colIndex),N=Math.max(v.rowIndex+v.rowSpan-1,b.rowIndex+b.rowSpan-1),w=Math.max(v.colIndex+v.colSpan-1,b.colIndex+b.colSpan-1);return h(y,C,N,w)}catch(e){}},getCells:function(a){this.clearSelected();for(var c,h,g,v=a.beginRowIndex,b=a.beginColIndex,y=a.endRowIndex,C=a.endColIndex,N={},w=[],i=v;y>=i;i++)for(var U=b;C>=U;U++){c=this.indexTable[i][U],h=c.rowIndex,g=c.colIndex;var E=h+"|"+g;if(!N[E]){if(N[E]=1,i>h||U>g||h+c.rowSpan-1>y||g+c.colSpan-1>C)return null;w.push(this.getCell(h,c.cellIndex))}}return w},clearSelected:function(){c.removeSelectedClass(this.selectedTds),this.selectedTds=[],this.cellsRange={}},setSelected:function(a){var h=this.getCells(a);c.addSelectedClass(h),this.selectedTds=h,this.cellsRange=a},isFullRow:function(){var a=this.cellsRange;return a.endColIndex-a.beginColIndex+1==this.colsNum},isFullCol:function(){var a=this.cellsRange,c=this.table,h=c.getElementsByTagName("th"),g=a.endRowIndex-a.beginRowIndex+1;return h.length?g==this.rowsNum||g==this.rowsNum-1:g==this.rowsNum},getNextCell:function(c,h,g){try{var v,b,y=this.getCellInfo(c),C=this.selectedTds.length&&!g,N=this.cellsRange;return!h&&0==y.rowIndex||h&&(C?N.endRowIndex==this.rowsNum-1:y.rowIndex+y.rowSpan>this.rowsNum-1)?null:(v=h?C?N.endRowIndex+1:y.rowIndex+y.rowSpan:C?N.beginRowIndex-1:y.rowIndex-1,b=C?N.beginColIndex:y.colIndex,this.getCell(this.indexTable[v][b].rowIndex,this.indexTable[v][b].cellIndex))}catch(e){a(e)}},getPreviewCell:function(c,h){try{var g,v,b=this.getCellInfo(c),y=this.selectedTds.length,C=this.cellsRange;return!h&&(y?!C.beginColIndex:!b.colIndex)||h&&(y?C.endColIndex==this.colsNum-1:b.rowIndex>this.colsNum-1)?null:(g=h?y?C.beginRowIndex:b.rowIndex<1?0:b.rowIndex-1:y?C.beginRowIndex:b.rowIndex,v=h?y?C.endColIndex+1:b.colIndex:y?C.beginColIndex-1:b.colIndex<1?0:b.colIndex-1,this.getCell(this.indexTable[g][v].rowIndex,this.indexTable[g][v].cellIndex))}catch(e){a(e)}},moveContent:function(a,h){if(!c.isEmptyBlock(h)){if(c.isEmptyBlock(a))return void(a.innerHTML=h.innerHTML);var g=a.lastChild;for(3!=g.nodeType&&dtd.$block[g.tagName]||a.appendChild(a.ownerDocument.createElement("br"));g=h.firstChild;)a.appendChild(g)}},mergeRight:function(a){var c=this.getCellInfo(a),h=c.colIndex+c.colSpan,g=this.indexTable[c.rowIndex][h],v=this.getCell(g.rowIndex,g.cellIndex);a.colSpan=c.colSpan+g.colSpan,a.removeAttribute("width"),this.moveContent(a,v),this.deleteCell(v,g.rowIndex),this.update()},mergeDown:function(a){var c=this.getCellInfo(a),h=c.rowIndex+c.rowSpan,g=this.indexTable[h][c.colIndex],v=this.getCell(g.rowIndex,g.cellIndex);a.rowSpan=c.rowSpan+g.rowSpan,a.removeAttribute("height"),this.moveContent(a,v),this.deleteCell(v,g.rowIndex),this.update()},mergeRange:function(){var a=this.cellsRange,c=this.getCell(a.beginRowIndex,this.indexTable[a.beginRowIndex][a.beginColIndex].cellIndex);if("TH"==c.tagName&&a.endRowIndex!==a.beginRowIndex){var h=this.indexTable,g=this.getCellInfo(c);c=this.getCell(1,h[1][g.colIndex].cellIndex),a=this.getCellsRange(c,this.getCell(h[this.rowsNum-1][g.colIndex].rowIndex,h[this.rowsNum-1][g.colIndex].cellIndex))}for(var v,b=this.getCells(a),i=0;v=b[i++];)v!==c&&(this.moveContent(c,v),this.deleteCell(v));if(c.rowSpan=a.endRowIndex-a.beginRowIndex+1,c.rowSpan>1&&c.removeAttribute("height"),c.colSpan=a.endColIndex-a.beginColIndex+1,c.colSpan>1&&c.removeAttribute("width"),c.rowSpan==this.rowsNum&&1!=c.colSpan&&(c.colSpan=1),c.colSpan==this.colsNum&&1!=c.rowSpan){var y=c.parentNode.rowIndex;if(this.table.deleteRow)for(var i=y+1,C=y+1,N=c.rowSpan;N>i;i++)this.table.deleteRow(C);else for(var i=0,N=c.rowSpan-1;N>i;i++){var w=this.table.rows[y+1];w.parentNode.removeChild(w)}c.rowSpan=1}this.update()},insertRow:function(a,c){function h(a,c,h){if(0==a){var g=h.nextSibling||h.previousSibling,v=g.cells[a];"TH"==v.tagName&&(v=c.ownerDocument.createElement("th"),v.appendChild(c.firstChild),h.insertBefore(v,c),domUtils.remove(c))}else if("TH"==c.tagName){var b=c.ownerDocument.createElement("td");b.appendChild(c.firstChild),h.insertBefore(b,c),domUtils.remove(c)}}var g,v=this.colsNum,b=this.table,y=b.insertRow(a),C="string"==typeof c&&"TH"==c.toUpperCase();if(0==a||a==this.rowsNum)for(var N=0;v>N;N++)g=this.cloneCell(c,!0),this.setCellContent(g),g.getAttribute("vAlign")&&g.setAttribute("vAlign",g.getAttribute("vAlign")),y.appendChild(g),C||h(N,g,y);else{var w=this.indexTable[a];for(N=0;v>N;N++){var U=w[N];U.rowIndex<a?(g=this.getCell(U.rowIndex,U.cellIndex),g.rowSpan=U.rowSpan+1):(g=this.cloneCell(c,!0),this.setCellContent(g),y.appendChild(g)),C||h(N,g,y)}}return this.update(),y},deleteRow:function(a){for(var c=this.table.rows[a],h=this.indexTable[a],g=this.colsNum,v=0,b=0;g>b;){var y=h[b],C=this.getCell(y.rowIndex,y.cellIndex);if(C.rowSpan>1&&y.rowIndex==a){var N=C.cloneNode(!0);N.rowSpan=C.rowSpan-1,N.innerHTML="",C.rowSpan=1;var w,U=a+1,E=this.table.rows[U],T=this.getPreviewMergedCellsNum(U,b)-v;b>T?(w=b-T-1,domUtils.insertAfter(E.cells[w],N)):E.cells.length&&E.insertBefore(N,E.cells[0]),v+=1}b+=C.colSpan||1}var S=[],k={};for(b=0;g>b;b++){var B=h[b].rowIndex,I=h[b].cellIndex,_=B+"_"+I;k[_]||(k[_]=1,C=this.getCell(B,I),S.push(C))}var A=[];utils.each(S,function(a){1==a.rowSpan?a.parentNode.removeChild(a):A.push(a)}),utils.each(A,function(a){a.rowSpan--}),c.parentNode.removeChild(c),this.update()},insertCol:function(a,c,h){function g(a,c,h){if(0==a){var g=c.nextSibling||c.previousSibling;"TH"==g.tagName&&(g=c.ownerDocument.createElement("th"),g.appendChild(c.firstChild),h.insertBefore(g,c),domUtils.remove(c))}else if("TH"==c.tagName){var v=c.ownerDocument.createElement("td");v.appendChild(c.firstChild),h.insertBefore(v,c),domUtils.remove(c)}}var v,b,y,C=this.rowsNum,N=0,w=parseInt((this.table.offsetWidth-20*(this.colsNum+1)-(this.colsNum+1))/(this.colsNum+1),10),U="string"==typeof c&&"TH"==c.toUpperCase();if(0==a||a==this.colsNum)for(;C>N;N++)v=this.table.rows[N],y=v.cells[0==a?a:v.cells.length],b=this.cloneCell(c,!0),this.setCellContent(b),b.setAttribute("vAlign",b.getAttribute("vAlign")),y&&b.setAttribute("width",y.getAttribute("width")),a?domUtils.insertAfter(v.cells[v.cells.length-1],b):v.insertBefore(b,v.cells[0]),U||g(N,b,v);else for(;C>N;N++){var E=this.indexTable[N][a];E.colIndex<a?(b=this.getCell(E.rowIndex,E.cellIndex),b.colSpan=E.colSpan+1):(v=this.table.rows[N],y=v.cells[E.cellIndex],b=this.cloneCell(c,!0),this.setCellContent(b),b.setAttribute("vAlign",b.getAttribute("vAlign")),y&&b.setAttribute("width",y.getAttribute("width")),y?v.insertBefore(b,y):v.appendChild(b)),U||g(N,b,v)}this.update(),this.updateWidth(w,h||{tdPadding:10,tdBorder:1})},updateWidth:function(a,h){var g=this.table,v=c.getWidth(g)-2*h.tdPadding-h.tdBorder+a;if(v<g.ownerDocument.body.offsetWidth)return void g.setAttribute("width",v);var b=domUtils.getElementsByTagName(this.table,"td th");utils.each(b,function(c){c.setAttribute("width",a)})},deleteCol:function(a){for(var c=this.indexTable,h=this.table.rows,g=this.table.getAttribute("width"),v=0,b=this.rowsNum,y={},C=0;b>C;){var N=c[C],w=N[a],U=w.rowIndex+"_"+w.colIndex;if(!y[U]){y[U]=1;var E=this.getCell(w.rowIndex,w.cellIndex);v||(v=E&&parseInt(E.offsetWidth/E.colSpan,10).toFixed(0)),E.colSpan>1?E.colSpan--:h[C].deleteCell(w.cellIndex),C+=w.rowSpan||1}}this.table.setAttribute("width",g-v),this.update()},splitToCells:function(a){var c=this,h=this.splitToRows(a);utils.each(h,function(a){c.splitToCols(a)})},splitToRows:function(a){var c=this.getCellInfo(a),h=c.rowIndex,g=c.colIndex,v=[];a.rowSpan=1,v.push(a);for(var i=h,b=h+c.rowSpan;b>i;i++)if(i!=h){var y=this.table.rows[i],C=y.insertCell(g-this.getPreviewMergedCellsNum(i,g));C.colSpan=c.colSpan,this.setCellContent(C),C.setAttribute("vAlign",a.getAttribute("vAlign")),C.setAttribute("align",a.getAttribute("align")),a.style.cssText&&(C.style.cssText=a.style.cssText),v.push(C)}return this.update(),v},getPreviewMergedCellsNum:function(a,c){for(var h=this.indexTable[a],g=0,i=0;c>i;){var v=h[i].colSpan,b=h[i].rowIndex;g+=v-(b==a?1:0),i+=v}return g},splitToCols:function(a){var c=(a.offsetWidth/a.colSpan-22).toFixed(0),h=this.getCellInfo(a),g=h.rowIndex,v=h.colIndex,b=[];a.colSpan=1,a.setAttribute("width",c),b.push(a);for(var y=v,C=v+h.colSpan;C>y;y++)if(y!=v){var N=this.table.rows[g],w=N.insertCell(this.indexTable[g][y].cellIndex+1);if(w.rowSpan=h.rowSpan,this.setCellContent(w),w.setAttribute("vAlign",a.getAttribute("vAlign")),w.setAttribute("align",a.getAttribute("align")),w.setAttribute("width",c),a.style.cssText&&(w.style.cssText=a.style.cssText),"TH"==a.tagName){var U=a.ownerDocument.createElement("th");U.appendChild(w.firstChild),U.setAttribute("vAlign",a.getAttribute("vAlign")),U.rowSpan=w.rowSpan,N.insertBefore(U,w),domUtils.remove(w)}b.push(w)}return this.update(),b},isLastCell:function(a,c,h){c=c||this.rowsNum,h=h||this.colsNum;var g=this.getCellInfo(a);return g.rowIndex+g.rowSpan==c&&g.colIndex+g.colSpan==h},getLastCell:function(a){a=a||this.table.getElementsByTagName("td");var c,h=(this.getCellInfo(a[0]),this),g=a[0],v=g.parentNode,b=0,y=0;return utils.each(a,function(a){a.parentNode==v&&(y+=a.colSpan||1),b+=a.rowSpan*a.colSpan||1}),c=b/y,utils.each(a,function(a){return h.isLastCell(a,c,y)?(g=a,!1):void 0}),g},selectRow:function(a){var c=this.indexTable[a],h=this.getCell(c[0].rowIndex,c[0].cellIndex),g=this.getCell(c[this.colsNum-1].rowIndex,c[this.colsNum-1].cellIndex),v=this.getCellsRange(h,g);this.setSelected(v)},selectTable:function(){var a=this.table.getElementsByTagName("td"),c=this.getCellsRange(a[0],a[a.length-1]);this.setSelected(c)},setBackground:function(a,c){if("string"==typeof c)utils.each(a,function(a){a.style.backgroundColor=c});else if("object"==typeof c){c=utils.extend({repeat:!0,colorList:["#ddd","#fff"]},c);for(var h,g=this.getCellInfo(a[0]).rowIndex,v=0,b=c.colorList,y=function(a,c,h){return a[c]?a[c]:h?a[c%a.length]:""},i=0;h=a[i++];){var C=this.getCellInfo(h);h.style.backgroundColor=y(b,g+v==C.rowIndex?v:++v,c.repeat)}}},removeBackground:function(a){utils.each(a,function(a){a.style.backgroundColor=""})}}}(),function(){function a(a,h){var g=domUtils.getElementsByTagName(a,"td th");utils.each(g,function(a){a.removeAttribute("width")}),a.setAttribute("width",c(h,!0,y(h,a)));var v=[];setTimeout(function(){utils.each(g,function(a){1==a.colSpan&&v.push(a.offsetWidth)}),utils.each(g,function(a,i){1==a.colSpan&&a.setAttribute("width",v[i]+"")})},0)}function c(a,c,h){var g=a.body;return g.offsetWidth-(c?2*parseInt(domUtils.getComputedStyle(g,"margin-left"),10):0)-2*h.tableBorder-(a.options.offsetWidth||0)}function h(a){var c=v(a).cell;if(c){var h=C(c);return h.selectedTds.length?h.selectedTds:[c]}return[]}var g=UE.UETable,v=function(a){return g.getTableItemsByRange(a)},b=function(a){return g.getUETableBySelected(a)},y=function(a,c){return g.getDefaultValue(a,c)},C=function(a){return g.getUETable(a)};UE.commands.inserttable={queryCommandState:function(){return v(this).table?-1:0},execCommand:function(a,c){function h(a,c){for(var h=[],g=a.numRows,v=a.numCols,r=0;g>r;r++){h.push("<tr"+(0==r?' class="firstRow"':"")+">");for(var b=0;v>b;b++)h.push('<td width="'+c+'"  vAlign="'+a.tdvalign+'" >'+(browser.ie&&browser.version<11?domUtils.fillChar:"<br/>")+"</td>");h.push("</tr>")}return"<table><tbody>"+h.join("")+"</tbody></table>"}c||(c=utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign}));var g=this,v=this.selection.getRange(),b=v.startContainer,C=domUtils.findParent(b,function(a){return domUtils.isBlockElm(a)},!0)||g.body,N=y(g),w=C.offsetWidth,U=Math.floor(w/c.numCols-2*N.tdPadding-N.tdBorder);!c.tdvalign&&(c.tdvalign=g.options.tdvalign),g.execCommand("inserthtml",h(c,U))}},UE.commands.insertparagraphbeforetable={queryCommandState:function(){return v(this).cell?0:-1},execCommand:function(){var a=v(this).table;if(a){var p=this.document.createElement("p");p.innerHTML=browser.ie?"&nbsp;":"<br />",a.parentNode.insertBefore(p,a),this.selection.getRange().setStart(p,0).setCursor()}}},UE.commands.deletetable={queryCommandState:function(){var a=this.selection.getRange();return domUtils.findParentByTagName(a.startContainer,"table",!0)?0:-1},execCommand:function(a,c){var h=this.selection.getRange();if(c=c||domUtils.findParentByTagName(h.startContainer,"table",!0)){var g=c.nextSibling;g||(g=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"}),c.parentNode.insertBefore(g,c)),domUtils.remove(c),h=this.selection.getRange(),3==g.nodeType?h.setStartBefore(g):h.setStart(g,0),h.setCursor(!1,!0),this.fireEvent("tablehasdeleted")}}},UE.commands.cellalign={queryCommandState:function(){return h(this).length?0:-1},execCommand:function(a,c){var g=h(this);if(g.length)for(var v,i=0;v=g[i++];)v.setAttribute("align",c)}},UE.commands.cellvalign={queryCommandState:function(){return h(this).length?0:-1},execCommand:function(a,c){var g=h(this);if(g.length)for(var v,i=0;v=g[i++];)v.setAttribute("vAlign",c)}},UE.commands.insertcaption={queryCommandState:function(){var a=v(this).table;return a&&0==a.getElementsByTagName("caption").length?1:-1},execCommand:function(){var a=v(this).table;if(a){var c=this.document.createElement("caption");c.innerHTML=browser.ie?domUtils.fillChar:"<br/>",a.insertBefore(c,a.firstChild);var h=this.selection.getRange();h.setStart(c,0).setCursor()}}},UE.commands.deletecaption={queryCommandState:function(){var a=this.selection.getRange(),c=domUtils.findParentByTagName(a.startContainer,"table");return c?0==c.getElementsByTagName("caption").length?-1:1:-1},execCommand:function(){var a=this.selection.getRange(),c=domUtils.findParentByTagName(a.startContainer,"table");if(c){domUtils.remove(c.getElementsByTagName("caption")[0]);var h=this.selection.getRange();h.setStart(c.rows[0].cells[0],0).setCursor()}}},UE.commands.inserttitle={queryCommandState:function(){var a=v(this).table;if(a){var c=a.rows[0];return"th"!=c.cells[c.cells.length-1].tagName.toLowerCase()?0:-1}return-1},execCommand:function(){var a=v(this).table;a&&C(a).insertRow(0,"th");var c=a.getElementsByTagName("th")[0];this.selection.getRange().setStart(c,0).setCursor(!1,!0)}},UE.commands.deletetitle={queryCommandState:function(){var a=v(this).table;if(a){var c=a.rows[0];return"th"==c.cells[c.cells.length-1].tagName.toLowerCase()?0:-1}return-1},execCommand:function(){var a=v(this).table;a&&domUtils.remove(a.rows[0]);var c=a.getElementsByTagName("td")[0];this.selection.getRange().setStart(c,0).setCursor(!1,!0)}},UE.commands.inserttitlecol={queryCommandState:function(){var a=v(this).table;if(a){var c=a.rows[a.rows.length-1];return c.getElementsByTagName("th").length?-1:0}return-1},execCommand:function(){var c=v(this).table;c&&C(c).insertCol(0,"th"),a(c,this);var h=c.getElementsByTagName("th")[0];this.selection.getRange().setStart(h,0).setCursor(!1,!0)}},UE.commands.deletetitlecol={queryCommandState:function(){var a=v(this).table;if(a){var c=a.rows[a.rows.length-1];return c.getElementsByTagName("th").length?0:-1}return-1},execCommand:function(){var c=v(this).table;if(c)for(var i=0;i<c.rows.length;i++)domUtils.remove(c.rows[i].children[0]);a(c,this);var h=c.getElementsByTagName("td")[0];this.selection.getRange().setStart(h,0).setCursor(!1,!0)}},UE.commands.mergeright={queryCommandState:function(){var a=v(this),c=a.table,h=a.cell;if(!c||!h)return-1;var g=C(c);if(g.selectedTds.length)return-1;var b=g.getCellInfo(h),y=b.colIndex+b.colSpan;if(y>=g.colsNum)return-1;var N=g.indexTable[b.rowIndex][y],w=c.rows[N.rowIndex].cells[N.cellIndex];return w&&h.tagName==w.tagName&&N.rowIndex==b.rowIndex&&N.rowSpan==b.rowSpan?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this).cell,g=C(h);g.mergeRight(h),a.moveToBookmark(c).select()}},UE.commands.mergedown={queryCommandState:function(){var a=v(this),c=a.table,h=a.cell;if(!c||!h)return-1;var g=C(c);if(g.selectedTds.length)return-1;var b=g.getCellInfo(h),y=b.rowIndex+b.rowSpan;if(y>=g.rowsNum)return-1;var N=g.indexTable[y][b.colIndex],w=c.rows[N.rowIndex].cells[N.cellIndex];return w&&h.tagName==w.tagName&&N.colIndex==b.colIndex&&N.colSpan==b.colSpan?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this).cell,g=C(h);g.mergeDown(h),a.moveToBookmark(c).select()}},UE.commands.mergecells={queryCommandState:function(){return b(this)?0:-1},execCommand:function(){var a=b(this);if(a&&a.selectedTds.length){var c=a.selectedTds[0];a.mergeRange();var h=this.selection.getRange();domUtils.isEmptyBlock(c)?h.setStart(c,0).collapse(!0):h.selectNodeContents(c),h.select()}}},UE.commands.insertrow={queryCommandState:function(){var a=v(this),c=a.cell;return c&&("TD"==c.tagName||"TH"==c.tagName&&a.tr!==a.table.rows[0])&&C(a.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this),g=h.cell,b=h.table,y=C(b),N=y.getCellInfo(g);if(y.selectedTds.length)for(var w=y.cellsRange,i=0,U=w.endRowIndex-w.beginRowIndex+1;U>i;i++)y.insertRow(w.beginRowIndex,g);else y.insertRow(N.rowIndex,g);a.moveToBookmark(c).select(),"enabled"===b.getAttribute("interlaced")&&this.fireEvent("interlacetable",b)}},UE.commands.insertrownext={queryCommandState:function(){var a=v(this),c=a.cell;return c&&"TD"==c.tagName&&C(a.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this),g=h.cell,b=h.table,y=C(b),N=y.getCellInfo(g);if(y.selectedTds.length)for(var w=y.cellsRange,i=0,U=w.endRowIndex-w.beginRowIndex+1;U>i;i++)y.insertRow(w.endRowIndex+1,g);else y.insertRow(N.rowIndex+N.rowSpan,g);a.moveToBookmark(c).select(),"enabled"===b.getAttribute("interlaced")&&this.fireEvent("interlacetable",b)}},UE.commands.deleterow={queryCommandState:function(){var a=v(this);return a.cell?0:-1},execCommand:function(){var a=v(this).cell,c=C(a),h=c.cellsRange,g=c.getCellInfo(a),b=c.getVSideCell(a),y=c.getVSideCell(a,!0),N=this.selection.getRange();if(utils.isEmptyObject(h))c.deleteRow(g.rowIndex);else for(var i=h.beginRowIndex;i<h.endRowIndex+1;i++)c.deleteRow(h.beginRowIndex);var w=c.table;if(w.getElementsByTagName("td").length)if(1==g.rowSpan||g.rowSpan==h.endRowIndex-h.beginRowIndex+1)(y||b)&&N.selectNodeContents(y||b).setCursor(!1,!0);else{var U=c.getCell(g.rowIndex,c.indexTable[g.rowIndex][g.colIndex].cellIndex);U&&N.selectNodeContents(U).setCursor(!1,!0)}else{var E=w.nextSibling;domUtils.remove(w),E&&N.setStart(E,0).setCursor(!1,!0)}"enabled"===w.getAttribute("interlaced")&&this.fireEvent("interlacetable",w)}},UE.commands.insertcol={queryCommandState:function(){var a=v(this),c=a.cell;return c&&("TD"==c.tagName||"TH"==c.tagName&&c!==a.tr.cells[0])&&C(a.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(a){var c=this.selection.getRange(),h=c.createBookmark(!0);if(-1!=this.queryCommandState(a)){var g=v(this).cell,b=C(g),y=b.getCellInfo(g);if(b.selectedTds.length)for(var N=b.cellsRange,i=0,w=N.endColIndex-N.beginColIndex+1;w>i;i++)b.insertCol(N.beginColIndex,g);else b.insertCol(y.colIndex,g);c.moveToBookmark(h).select(!0)}}},UE.commands.insertcolnext={queryCommandState:function(){var a=v(this),c=a.cell;return c&&C(a.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this).cell,g=C(h),b=g.getCellInfo(h);if(g.selectedTds.length)for(var y=g.cellsRange,i=0,N=y.endColIndex-y.beginColIndex+1;N>i;i++)g.insertCol(y.endColIndex+1,h);else g.insertCol(b.colIndex+b.colSpan,h);a.moveToBookmark(c).select()}},UE.commands.deletecol={queryCommandState:function(){var a=v(this);return a.cell?0:-1},execCommand:function(){var a=v(this).cell,c=C(a),h=c.cellsRange,g=c.getCellInfo(a),b=c.getHSideCell(a),y=c.getHSideCell(a,!0);if(utils.isEmptyObject(h))c.deleteCol(g.colIndex);else for(var i=h.beginColIndex;i<h.endColIndex+1;i++)c.deleteCol(h.beginColIndex);var N=c.table,w=this.selection.getRange();if(N.getElementsByTagName("td").length)domUtils.inDoc(a,this.document)?w.setStart(a,0).setCursor(!1,!0):y&&domUtils.inDoc(y,this.document)?w.selectNodeContents(y).setCursor(!1,!0):b&&domUtils.inDoc(b,this.document)&&w.selectNodeContents(b).setCursor(!0,!0);else{var U=N.nextSibling;domUtils.remove(N),U&&w.setStart(U,0).setCursor(!1,!0)}}},UE.commands.splittocells={queryCommandState:function(){var a=v(this),c=a.cell;if(!c)return-1;var h=C(a.table);return h.selectedTds.length>0?-1:c&&(c.colSpan>1||c.rowSpan>1)?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this).cell,g=C(h);
g.splitToCells(h),a.moveToBookmark(c).select()}},UE.commands.splittorows={queryCommandState:function(){var a=v(this),c=a.cell;if(!c)return-1;var h=C(a.table);return h.selectedTds.length>0?-1:c&&c.rowSpan>1?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this).cell,g=C(h);g.splitToRows(h),a.moveToBookmark(c).select()}},UE.commands.splittocols={queryCommandState:function(){var a=v(this),c=a.cell;if(!c)return-1;var h=C(a.table);return h.selectedTds.length>0?-1:c&&c.colSpan>1?0:-1},execCommand:function(){var a=this.selection.getRange(),c=a.createBookmark(!0),h=v(this).cell,g=C(h);g.splitToCols(h),a.moveToBookmark(c).select()}},UE.commands.adaptbytext=UE.commands.adaptbywindow={queryCommandState:function(){return v(this).table?0:-1},execCommand:function(c){var h=v(this),g=h.table;if(g)if("adaptbywindow"==c)a(g,this);else{var b=domUtils.getElementsByTagName(g,"td th");utils.each(b,function(a){a.removeAttribute("width")}),g.removeAttribute("width")}}},UE.commands.averagedistributecol={queryCommandState:function(){var a=b(this);return a&&(a.isFullRow()||a.isFullCol())?0:-1},execCommand:function(){function a(){var a,c=g.table,v=0,b=0,C=y(h,c);if(g.isFullRow())v=c.offsetWidth,b=g.colsNum;else for(var N,w=g.cellsRange.beginColIndex,U=g.cellsRange.endColIndex,i=w;U>=i;)N=g.selectedTds[i],v+=N.offsetWidth,i+=N.colSpan,b+=1;return a=Math.ceil(v/b)-2*C.tdBorder-2*C.tdPadding}function c(a){utils.each(domUtils.getElementsByTagName(g.table,"th"),function(a){a.setAttribute("width","")});var c=g.isFullRow()?domUtils.getElementsByTagName(g.table,"td"):g.selectedTds;utils.each(c,function(c){1==c.colSpan&&c.setAttribute("width",a)})}var h=this,g=b(h);g&&g.selectedTds.length&&c(a())}},UE.commands.averagedistributerow={queryCommandState:function(){var a=b(this);return a?a.selectedTds&&/th/gi.test(a.selectedTds[0].tagName)?-1:a.isFullRow()||a.isFullCol()?0:-1:-1},execCommand:function(){function a(){var a,c,v=0,b=g.table,C=y(h,b),N=parseInt(domUtils.getComputedStyle(b.getElementsByTagName("td")[0],"padding-top"));if(g.isFullCol()){var w,U,E=domUtils.getElementsByTagName(b,"caption"),T=domUtils.getElementsByTagName(b,"th");E.length>0&&(w=E[0].offsetHeight),T.length>0&&(U=T[0].offsetHeight),v=b.offsetHeight-(w||0)-(U||0),c=0==T.length?g.rowsNum:g.rowsNum-1}else{for(var S=g.cellsRange.beginRowIndex,k=g.cellsRange.endRowIndex,B=0,I=domUtils.getElementsByTagName(b,"tr"),i=S;k>=i;i++)v+=I[i].offsetHeight,B+=1;c=B}return a=browser.ie&&browser.version<9?Math.ceil(v/c):Math.ceil(v/c)-2*C.tdBorder-2*N}function c(a){var c=g.isFullCol()?domUtils.getElementsByTagName(g.table,"td"):g.selectedTds;utils.each(c,function(c){1==c.rowSpan&&c.setAttribute("height",a)})}var h=this,g=b(h);g&&g.selectedTds.length&&c(a())}},UE.commands.cellalignment={queryCommandState:function(){return v(this).table?0:-1},execCommand:function(a,c){var h=this,g=b(h);if(g)utils.each(g.selectedTds,function(a){domUtils.setAttributes(a,c)});else{var v=h.selection.getStart(),y=v&&domUtils.findParentByTagName(v,["td","th","caption"],!0);/caption/gi.test(y.tagName)?(y.style.textAlign=c.align,y.style.verticalAlign=c.vAlign):domUtils.setAttributes(y,c),h.selection.getRange().setCursor(!0)}},queryCommandValue:function(){var a=v(this).cell;if(a||(a=h(this)[0]),a){var c=UE.UETable.getUETable(a).selectedTds;return!c.length&&(c=a),UE.UETable.getTableCellAlignState(c)}return null}},UE.commands.tablealignment={queryCommandState:function(){return browser.ie&&browser.version<8?-1:v(this).table?0:-1},execCommand:function(a,c){var h=this,g=h.selection.getStart(),v=g&&domUtils.findParentByTagName(g,["table"],!0);v&&v.setAttribute("align",c)}},UE.commands.edittable={queryCommandState:function(){return v(this).table?0:-1},execCommand:function(a,c){var h=this.selection.getRange(),g=domUtils.findParentByTagName(h.startContainer,"table");if(g){var v=domUtils.getElementsByTagName(g,"td").concat(domUtils.getElementsByTagName(g,"th"),domUtils.getElementsByTagName(g,"caption"));utils.each(v,function(a){a.style.borderColor=c})}}},UE.commands.edittd={queryCommandState:function(){return v(this).table?0:-1},execCommand:function(a,c){var h=this,g=b(h);if(g)utils.each(g.selectedTds,function(a){a.style.backgroundColor=c});else{var v=h.selection.getStart(),y=v&&domUtils.findParentByTagName(v,["td","th","caption"],!0);y&&(y.style.backgroundColor=c)}}},UE.commands.settablebackground={queryCommandState:function(){return h(this).length>1?0:-1},execCommand:function(a,c){var g,v;g=h(this),v=C(g[0]),v.setBackground(g,c)}},UE.commands.cleartablebackground={queryCommandState:function(){var a=h(this);if(!a.length)return-1;for(var c,i=0;c=a[i++];)if(""!==c.style.backgroundColor)return 0;return-1},execCommand:function(){var a=h(this),c=C(a[0]);c.removeBackground(a)}},UE.commands.interlacetable=UE.commands.uninterlacetable={queryCommandState:function(a){var c=v(this).table;if(!c)return-1;var h=c.getAttribute("interlaced");return"interlacetable"==a?"enabled"===h?-1:0:h&&"disabled"!==h?0:-1},execCommand:function(a,c){var h=v(this).table;"interlacetable"==a?(h.setAttribute("interlaced","enabled"),this.fireEvent("interlacetable",h,c)):(h.setAttribute("interlaced","disabled"),this.fireEvent("uninterlacetable",h))}},UE.commands.setbordervisible={queryCommandState:function(){var a=v(this).table;return a?0:-1},execCommand:function(){var a=v(this).table;utils.each(domUtils.getElementsByTagName(a,"td"),function(a){a.style.borderWidth="1px",a.style.borderStyle="solid"})}}}(),UE.plugins.table=function(){function a(){}function c(a){h(a,"width",!0),h(a,"height",!0)}function h(a,c,h){a.style[c]&&(h&&a.setAttribute(c,parseInt(a.style[c],10)),a.style[c]="")}function g(a){if("TD"==a.tagName||"TH"==a.tagName)return a;var c;return(c=domUtils.findParentByTagName(a,"td",!0)||domUtils.findParentByTagName(a,"th",!0))?c:null}function v(a){var c=new RegExp(domUtils.fillChar,"g");if(a[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(c,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(a.getElementsByTagName(n).length)return 0;return 1}function b(a){return a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:{x:a.clientX+et.document.body.scrollLeft-et.document.body.clientLeft,y:a.clientY+et.document.body.scrollTop-et.document.body.clientTop}}function y(c){if(!F())try{var h,v=g(c.target||c.srcElement);if(ot&&(et.body.style.webkitUserSelect="none",(Math.abs(dt.x-c.clientX)>st||Math.abs(dt.y-c.clientY)>st)&&(L(),ot=!1,lt=0,D(c))),yt&&Ut)return lt=0,et.body.style.webkitUserSelect="none",et.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"](),h=b(c),T(et,!0,yt,h,v),void("h"==yt?wt.style.left=U(Ut,c)+"px":"v"==yt&&(wt.style.top=E(Ut,c)+"px"));if(v){if(et.fireEvent("excludetable",v)===!0)return;h=b(c);var y=S(v,h),N=domUtils.findParentByTagName(v,"table",!0);if(w(N,v,c,!0)){if(et.fireEvent("excludetable",N)===!0)return;et.body.style.cursor="url("+et.options.cursorpath+"h.png),pointer"}else if(w(N,v,c)){if(et.fireEvent("excludetable",N)===!0)return;et.body.style.cursor="url("+et.options.cursorpath+"v.png),pointer"}else{et.body.style.cursor="text";/\d/.test(y)&&(y=y.replace(/\d/,""),v=ft(v).getPreviewCell(v,"v"==y)),T(et,v?!!y:!1,v?y:"",h,v)}}else C(!1,N,et)}catch(e){a(e)}}function C(a,c,h){if(a)N(c,h);else{if(xt)return;kt=setTimeout(function(){!xt&&Nt&&Nt.parentNode&&Nt.parentNode.removeChild(Nt)},2e3)}}function N(a,c){function h(h,g){clearTimeout(y),y=setTimeout(function(){c.fireEvent("tableClicked",a,g)},300)}function g(){clearTimeout(y);var h=ft(a),g=a.rows[0].cells[0],v=h.getLastCell(),b=h.getCellsRange(g,v);c.selection.getRange().setStart(g,0).setCursor(!1,!0),h.setSelected(b)}var v=domUtils.getXY(a),b=a.ownerDocument;if(Nt&&Nt.parentNode)return Nt;Nt=b.createElement("div"),Nt.contentEditable=!1,Nt.innerHTML="",Nt.style.cssText="width:15px;height:15px;background-image:url("+c.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(v.y-15)+"px;left:"+v.x+"px;",domUtils.unSelectable(Nt),Nt.onmouseover=function(){xt=!0},Nt.onmouseout=function(){xt=!1},domUtils.on(Nt,"click",function(a,c){h(c,this)}),domUtils.on(Nt,"dblclick",function(a,c){g(c)}),domUtils.on(Nt,"dragstart",function(a,c){domUtils.preventDefault(c)});var y;b.body.appendChild(Nt)}function w(a,c,h,g){var v=b(h),y=S(c,v);if(g){var C=a.getElementsByTagName("caption")[0],N=C?C.offsetHeight:0;return"v1"==y&&v.y-domUtils.getXY(a).y-N<8}return"h1"==y&&v.x-domUtils.getXY(a).x<8}function U(a,c){var h=ft(a);if(h){var g=h.getSameEndPosCells(a,"x")[0],v=h.getSameStartPosXCells(a)[0],y=b(c).x,C=(g?domUtils.getXY(g).x:domUtils.getXY(h.table).x)+20,N=v?domUtils.getXY(v).x+v.offsetWidth-20:et.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(et.body,"width"),10);return C+=nt,N-=nt,C>y?C:y>N?N:y}}function E(c,h){try{var g=domUtils.getXY(c).y,v=b(h).y;return g>v?g:v}catch(e){a(e)}}function T(c,h,g,v,b){try{c.body.style.cursor="h"==g?"col-resize":"v"==g?"row-resize":"text",browser.ie&&(!g||Et||ht(c)?K(c):(Y(c,c.document),G(g,b))),Ct=h}catch(e){a(e)}}function S(a,c){var h=domUtils.getXY(a);return h?h.x+a.offsetWidth-c.x<at?"h":c.x-h.x<at?"h1":h.y+a.offsetHeight-c.y<at?"v":c.y-h.y<at?"v1":"":""}function k(a,c){if(!F())if(dt={x:c.clientX,y:c.clientY},2==c.button){var h=ht(et),g=!1;if(h){var v=Q(et,c);utils.each(h.selectedTds,function(a){a===v&&(g=!0)}),g?(v=h.selectedTds[0],setTimeout(function(){et.selection.getRange().setStart(v,0).setCursor(!1,!0)},0)):(gt(domUtils.getElementsByTagName(et.body,"th td")),h.clearSelected())}}else I(c)}function B(a){lt=0,a=a||et.window.event;var c=g(a.target||a.srcElement);if(c){var h;if(h=S(c,b(a))){if(K(et),"h1"==h)if(h="h",w(domUtils.findParentByTagName(c,"table"),c,a))et.execCommand("adaptbywindow");else if(c=ft(c).getPreviewCell(c)){var v=et.selection.getRange();v.selectNodeContents(c).setCursor(!0,!0)}if("h"==h){var y=ft(c),C=y.table,N=V(c,C,!0);N=A(N,"left"),y.width=y.offsetWidth;var U=[],E=[];utils.each(N,function(a){U.push(a.offsetWidth)}),utils.each(N,function(a){a.removeAttribute("width")}),window.setTimeout(function(){var a=!0;utils.each(N,function(c,h){var g=c.offsetWidth;return g>U[h]?(a=!1,!1):void E.push(g)});var c=a?E:U;utils.each(N,function(a,h){a.width=c[h]-X()})},0)}}}}function I(a){if(gt(domUtils.getElementsByTagName(et.body,"td th")),utils.each(et.document.getElementsByTagName("table"),function(t){t.ueTable=null}),vt=Q(et,a)){var c=domUtils.findParentByTagName(vt,"table",!0);ut=ft(c),ut&&ut.clearSelected(),Ct?_(a):(et.document.body.style.webkitUserSelect="",Et=!0,et.addListener("mouseover",P))}}function _(a){browser.ie&&(a=R(a)),L(),ot=!0,tt=setTimeout(function(){D(a)},ct)}function A(a,c){for(var h=[],g=null,i=0,v=a.length;v>i;i++)g=a[i][c],g&&h.push(g);return h}function L(){tt&&clearTimeout(tt),tt=null}function R(a){var c=["pageX","pageY","clientX","clientY","srcElement","target"],h={};if(a)for(var g,v,i=0;g=c[i];i++)v=a[g],v&&(h[g]=v);return h}function D(a){if(ot=!1,vt=a.target||a.srcElement){var c=S(vt,b(a));/\d/.test(c)&&(c=c.replace(/\d/,""),vt=ft(vt).getPreviewCell(vt,"v"==c)),K(et),Y(et,et.document),et.fireEvent("saveScene"),G(c,vt),Et=!0,yt=c,Ut=vt}}function O(a,c){if(!F()){if(L(),ot=!1,Ct&&(lt=++lt%3,dt={x:c.clientX,y:c.clientY},it=setTimeout(function(){lt>0&&lt--},ct),2===lt))return lt=0,void B(c);if(2!=c.button){var h=this,g=h.selection.getRange(),v=domUtils.findParentByTagName(g.startContainer,"table",!0),b=domUtils.findParentByTagName(g.endContainer,"table",!0);if((v||b)&&(v===b?(v=domUtils.findParentByTagName(g.startContainer,["td","th","caption"],!0),b=domUtils.findParentByTagName(g.endContainer,["td","th","caption"],!0),v!==b&&h.selection.clearRange()):h.selection.clearRange()),Et=!1,h.document.body.style.webkitUserSelect="",yt&&Ut&&(h.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"](),lt=0,wt=h.document.getElementById("ue_tableDragLine"))){var y=domUtils.getXY(Ut),C=domUtils.getXY(wt);switch(yt){case"h":H(Ut,C.x-y.x);break;case"v":$(Ut,C.y-y.y-Ut.offsetHeight)}return yt="",Ut=null,K(h),void h.fireEvent("saveScene")}if(vt){var N=ft(vt),w=N?N.selectedTds[0]:null;if(w)g=new dom.Range(h.document),domUtils.isEmptyBlock(w)?g.setStart(w,0).setCursor(!1,!0):g.selectNodeContents(w).shrinkBoundary().setCursor(!1,!0);else if(g=h.selection.getRange().shrinkBoundary(),!g.collapsed){var v=domUtils.findParentByTagName(g.startContainer,["td","th"],!0),b=domUtils.findParentByTagName(g.endContainer,["td","th"],!0);(v&&!b||!v&&b||v&&b&&v!==b)&&g.setCursor(!1,!0)}vt=null,h.removeListener("mouseover",P)}else{var U=domUtils.findParentByTagName(c.target||c.srcElement,"td",!0);if(U||(U=domUtils.findParentByTagName(c.target||c.srcElement,"th",!0)),U&&("TD"==U.tagName||"TH"==U.tagName)){if(h.fireEvent("excludetable",U)===!0)return;g=new dom.Range(h.document),g.setStart(U,0).setCursor(!1,!0)}}h._selectionChange(250,c)}}}function P(a,c){if(!F()){var h=this,g=c.target||c.srcElement;if(bt=domUtils.findParentByTagName(g,"td",!0)||domUtils.findParentByTagName(g,"th",!0),vt&&bt&&("TD"==vt.tagName&&"TD"==bt.tagName||"TH"==vt.tagName&&"TH"==bt.tagName)&&domUtils.findParentByTagName(vt,"table")==domUtils.findParentByTagName(bt,"table")){var v=ft(bt);if(vt!=bt){h.document.body.style.webkitUserSelect="none",h.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();var b=v.getCellsRange(vt,bt);v.setSelected(b)}else h.document.body.style.webkitUserSelect="",v.clearSelected()}c.preventDefault?c.preventDefault():c.returnValue=!1}}function M(a,c,h){var g=parseInt(domUtils.getComputedStyle(a,"line-height"),10),v=h+c;c=g>v?g:v,a.style.height&&(a.style.height=""),1==a.rowSpan?a.setAttribute("height",c):a.removeAttribute&&a.removeAttribute("height")}function H(a,c){var h=ft(a);if(h){var g=h.table,v=V(a,g);if(g.style.width="",g.removeAttribute("width"),c=z(c,a,v),a.nextSibling){utils.each(v,function(a){a.left.width=+a.left.width+c,a.right&&(a.right.width=+a.right.width-c)})}else utils.each(v,function(a){a.left.width-=-c})}}function F(){return"false"===et.body.contentEditable}function $(a,c){if(!(Math.abs(c)<10)){var h=ft(a);if(h)for(var g,v=h.getSameEndPosCells(a,"y"),b=v[0]?v[0].offsetHeight:0,i=0;g=v[i++];)M(g,c,b)}}function V(a,c,h){if(c||(c=domUtils.findParentByTagName(a,"table")),!c)return null;for(var g=(domUtils.getNodeIndex(a),a),v=c.rows,b=0;g;)1===g.nodeType&&(b+=g.colSpan||1),g=g.previousSibling;g=null;var y=[];return utils.each(v,function(a){var c=a.cells,g=0;utils.each(c,function(a){return g+=a.colSpan||1,g===b?(y.push({left:a,right:a.nextSibling||null}),!1):g>b?(h&&y.push({left:a}),!1):void 0})}),y}function z(a,c,h){if(a-=X(),0>a)return 0;a-=W(c);var g=0>a?"left":"right";return a=Math.abs(a),utils.each(h,function(c){var h=c[g];h&&(a=Math.min(a,W(h)-nt))}),a=0>a?0:a,"left"===g?-a:a}function W(a){var c=0,c=a.offsetWidth-X();a.nextSibling||(c-=j(a)),c=0>c?0:c;try{a.width=c}catch(e){}return c}function j(a){if(tab=domUtils.findParentByTagName(a,"table",!1),void 0===tab.offsetVal){var c=a.previousSibling;tab.offsetVal=c&&a.offsetWidth-c.offsetWidth===mt.borderWidth?mt.borderWidth:0}return tab.offsetVal}function X(){if(void 0===mt.tabcellSpace){var a=et.document.createElement("table"),c=et.document.createElement("tbody"),h=et.document.createElement("tr"),g=et.document.createElement("td"),v=null;g.style.cssText="border: 0;",g.width=1,h.appendChild(g),h.appendChild(v=g.cloneNode(!1)),c.appendChild(h),a.appendChild(c),a.style.cssText="visibility: hidden;",et.body.appendChild(a),mt.paddingSpace=g.offsetWidth-1;var b=a.offsetWidth;g.style.cssText="",v.style.cssText="",mt.borderWidth=(a.offsetWidth-b)/3,mt.tabcellSpace=mt.paddingSpace+mt.borderWidth,et.body.removeChild(a)}return X=function(){return mt.tabcellSpace},mt.tabcellSpace}function Y(a){Et||(wt=a.document.createElement("div"),domUtils.setAttributes(wt,{id:"ue_tableDragLine",unselectable:"on",contenteditable:!1,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"}),a.body.appendChild(wt))}function K(a){if(!Et)for(var c;c=a.document.getElementById("ue_tableDragLine");)domUtils.remove(c)}function G(a,c){if(c){var h,g=domUtils.findParentByTagName(c,"table"),v=g.getElementsByTagName("caption"),b=g.offsetWidth,y=g.offsetHeight-(v.length>0?v[0].offsetHeight:0),C=domUtils.getXY(g),N=domUtils.getXY(c);switch(a){case"h":h="height:"+y+"px;top:"+(C.y+(v.length>0?v[0].offsetHeight:0))+"px;left:"+(N.x+c.offsetWidth),wt.style.cssText=h+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":h="width:"+b+"px;left:"+C.x+"px;top:"+(N.y+c.offsetHeight),wt.style.cssText=h+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)"}}}function J(a,c){for(var h,g,v=domUtils.getElementsByTagName(a.body,"table"),i=0;g=v[i++];){var b=domUtils.getElementsByTagName(g,"td");b[0]&&(c?(h=b[0].style.borderColor.replace(/\s/g,""),/(#ffffff)|(rgb\(255,255,255\))/gi.test(h)&&domUtils.addClass(g,"noBorderTable")):domUtils.removeClasses(g,"noBorderTable"))}}function Z(a,c,h){var g=a.body;return g.offsetWidth-(c?2*parseInt(domUtils.getComputedStyle(g,"margin-left"),10):0)-2*h.tableBorder-(a.options.offsetWidth||0)}function Q(a,c){var h=domUtils.findParentByTagName(c.target||c.srcElement,["td","th"],!0),g=null;if(!h)return null;if(g=S(h,b(c)),!h)return null;if("h1"===g&&h.previousSibling){var v=domUtils.getXY(h),y=h.offsetWidth;Math.abs(v.x+y-c.clientX)>y/3&&(h=h.previousSibling)}else if("v1"===g&&h.parentNode.previousSibling){var v=domUtils.getXY(h),C=h.offsetHeight;Math.abs(v.y+C-c.clientY)>C/3&&(h=h.parentNode.previousSibling.firstChild)}return h&&a.fireEvent("excludetable",h)!==!0?h:null}var et=this,tt=null,it=null,nt=5,ot=!1,at=5,st=10,lt=0,dt=null,ct=360,mt=UE.UETable,ft=function(a){return mt.getUETable(a)},ht=function(a){return mt.getUETableBySelected(a)},pt=function(a,c){return mt.getDefaultValue(a,c)},gt=function(a){return mt.removeSelectedClass(a)};et.ready(function(){var a=this,c=a.selection.getText;a.selection.getText=function(){var h=ht(a);if(h){var g="";return utils.each(h.selectedTds,function(a){g+=a[browser.ie?"innerText":"textContent"]}),g}return c.call(a.selection)}});var vt=null,bt=null,yt="",Ct=!1,Nt=null,xt=!1,wt=null,Ut=null,Et=!1,Tt=!0;et.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:et.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:!1,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]}),et.getUETable=ft;var St={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};et.ready(function(){utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}table{margin-bottom:10px;border-collapse:collapse;display:table;}td,th{padding: 5px 10px;border: 1px solid #DDD;}caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}th{border-top:1px solid #BBB;background-color:#F7F7F7;}table tr.firstRow th{border-top-width:2px;}.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }td p{margin:0;padding:0;}",et.document);var a,h,b;et.addListener("keydown",function(c,g){var y=this,C=g.keyCode||g.which;if(8==C){var N=ht(y);N&&N.selectedTds.length&&(N.isFullCol()?y.execCommand("deletecol"):N.isFullRow()?y.execCommand("deleterow"):y.fireEvent("delcells"),domUtils.preventDefault(g));var w=domUtils.findParentByTagName(y.selection.getStart(),"caption",!0),U=y.selection.getRange();if(U.collapsed&&w&&v(w)){y.fireEvent("saveScene");var E=w.parentNode;domUtils.remove(w),E&&U.setStart(E.rows[0].cells[0],0).setCursor(!1,!0),y.fireEvent("saveScene")}}if(46==C&&(N=ht(y))){y.fireEvent("saveScene");for(var T,i=0;T=N.selectedTds[i++];)domUtils.fillNode(y.document,T);y.fireEvent("saveScene"),domUtils.preventDefault(g)}if(13==C){var S=y.selection.getRange(),w=domUtils.findParentByTagName(S.startContainer,"caption",!0);if(w){var E=domUtils.findParentByTagName(w,"table");return S.collapsed?w&&S.setStart(E.rows[0].cells[0],0).setCursor(!1,!0):(S.deleteContents(),y.fireEvent("saveScene")),void domUtils.preventDefault(g)}if(S.collapsed){var E=domUtils.findParentByTagName(S.startContainer,"table");if(E){var k=E.rows[0].cells[0],B=domUtils.findParentByTagName(y.selection.getStart(),["td","th"],!0),I=E.previousSibling;if(k===B&&(!I||1==I.nodeType&&"TABLE"==I.tagName)&&domUtils.isStartInblock(S)){var _=domUtils.findParent(y.selection.getStart(),function(n){return domUtils.isBlockElm(n)},!0);_&&(/t(h|d)/i.test(_.tagName)||_===B.firstChild)&&(y.execCommand("insertparagraphbeforetable"),domUtils.preventDefault(g))}}}}if((g.ctrlKey||g.metaKey)&&"67"==g.keyCode){a=null;var N=ht(y);if(N){var A=N.selectedTds;h=N.isFullCol(),b=N.isFullRow(),a=[[N.cloneCell(A[0],null,!0)]];for(var T,i=1;T=A[i];i++)T.parentNode!==A[i-1].parentNode?a.push([N.cloneCell(T,null,!0)]):a[a.length-1].push(N.cloneCell(T,null,!0))}}}),et.addListener("tablehasdeleted",function(){T(this,!1,"",null),Nt&&domUtils.remove(Nt)}),et.addListener("beforepaste",function(g,y){var C=this,N=C.selection.getRange();if(domUtils.findParentByTagName(N.startContainer,"caption",!0)){var w=C.document.createElement("div");return w.innerHTML=y.html,void(y.html=w[browser.ie9below?"innerText":"textContent"])}var U=ht(C);if(a){C.fireEvent("saveScene");var E,T,N=C.selection.getRange(),S=domUtils.findParentByTagName(N.startContainer,["td","th"],!0);if(S){var k=ft(S);if(b){var B=k.getCellInfo(S).rowIndex;"TH"==S.tagName&&B++;for(var I,i=0;I=a[i++];){for(var _,A=k.insertRow(B++,"td"),L=0;_=I[L];L++){var R=A.cells[L];R||(R=A.insertCell(L)),R.innerHTML=_.innerHTML,_.getAttribute("width")&&R.setAttribute("width",_.getAttribute("width")),_.getAttribute("vAlign")&&R.setAttribute("vAlign",_.getAttribute("vAlign")),_.getAttribute("align")&&R.setAttribute("align",_.getAttribute("align")),_.style.cssText&&(R.style.cssText=_.style.cssText)}for(var _,L=0;(_=A.cells[L])&&I[L];L++)_.innerHTML=I[L].innerHTML,I[L].getAttribute("width")&&_.setAttribute("width",I[L].getAttribute("width")),I[L].getAttribute("vAlign")&&_.setAttribute("vAlign",I[L].getAttribute("vAlign")),I[L].getAttribute("align")&&_.setAttribute("align",I[L].getAttribute("align")),I[L].style.cssText&&(_.style.cssText=I[L].style.cssText)}}else{if(h){P=k.getCellInfo(S);for(var _,D=0,L=0,I=a[0];_=I[L++];)D+=_.colSpan||1;for(C.__hasEnterExecCommand=!0,i=0;D>i;i++)C.execCommand("insertcol");C.__hasEnterExecCommand=!1,S=k.table.rows[0].cells[P.cellIndex],"TH"==S.tagName&&(S=k.table.rows[1].cells[P.cellIndex])}for(var I,i=0;I=a[i++];){E=S;for(var _,L=0;_=I[L++];)if(S)S.innerHTML=_.innerHTML,_.getAttribute("width")&&S.setAttribute("width",_.getAttribute("width")),_.getAttribute("vAlign")&&S.setAttribute("vAlign",_.getAttribute("vAlign")),_.getAttribute("align")&&S.setAttribute("align",_.getAttribute("align")),_.style.cssText&&(S.style.cssText=_.style.cssText),T=S,S=S.nextSibling;else{var O=_.cloneNode(!0);domUtils.removeAttributes(O,["class","rowSpan","colSpan"]),T.parentNode.appendChild(O)}if(S=k.getNextCell(E,!0,!0),!a[i])break;if(!S){var P=k.getCellInfo(E);k.table.insertRow(k.table.rows.length),k.update(),S=k.getVSideCell(E,!0)}}}k.update()}else{U=C.document.createElement("table");for(var I,i=0;I=a[i++];){for(var _,A=U.insertRow(U.rows.length),L=0;_=I[L++];)O=mt.cloneCell(_,null,!0),domUtils.removeAttributes(O,["class"]),A.appendChild(O);2==L&&O.rowSpan>1&&(O.rowSpan=1)}var M=pt(C),H=C.body.offsetWidth-(Tt?2*parseInt(domUtils.getComputedStyle(C.body,"margin-left"),10):0)-2*M.tableBorder-(C.options.offsetWidth||0);C.execCommand("insertHTML","<table  "+(h&&b?'width="'+H+'"':"")+">"+U.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"</table>")}return C.fireEvent("contentchange"),C.fireEvent("saveScene"),y.html="",!0}var F,w=C.document.createElement("div");w.innerHTML=y.html,F=w.getElementsByTagName("table"),domUtils.findParentByTagName(C.selection.getStart(),"table")?(utils.each(F,function(t){domUtils.remove(t)}),domUtils.findParentByTagName(C.selection.getStart(),"caption",!0)&&(w.innerHTML=w[browser.ie?"innerText":"textContent"])):utils.each(F,function(a){c(a,!0),domUtils.removeAttributes(a,["style","border"]),utils.each(domUtils.getElementsByTagName(a,"td"),function(a){v(a)&&domUtils.fillNode(C.document,a),c(a,!0)})}),y.html=w.innerHTML}),et.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(et.body,"table"),function(a){if(a.offsetWidth>et.body.offsetWidth){var c=pt(et,a);a.style.width=et.body.offsetWidth-(Tt?2*parseInt(domUtils.getComputedStyle(et.body,"margin-left"),10):0)-2*c.tableBorder-(et.options.offsetWidth||0)+"px"}})}),et.addListener("blur",function(){a=null});var N;et.addListener("keydown",function(){clearTimeout(N),N=setTimeout(function(){var a=et.selection.getRange(),c=domUtils.findParentByTagName(a.startContainer,["th","td"],!0);if(c){var h=c.parentNode.parentNode.parentNode;h.offsetWidth>h.getAttribute("width")&&(c.style.wordBreak="break-all")}},100)}),et.addListener("selectionchange",function(){T(et,!1,"",null)}),et.addListener("contentchange",function(){var a=this;if(K(a),!ht(a)){var c=a.selection.getRange(),h=c.startContainer;h=domUtils.findParentByTagName(h,["td","th"],!0),utils.each(domUtils.getElementsByTagName(a.document,"table"),function(c){a.fireEvent("excludetable",c)!==!0&&(c.ueTable=new mt(c),c.onmouseover=function(){a.fireEvent("tablemouseover",c)},c.onmousemove=function(){a.fireEvent("tablemousemove",c),a.options.tableDragable&&C(!0,this,a),utils.defer(function(){a.fireEvent("contentchange",50)},!0)},c.onmouseout=function(){a.fireEvent("tablemouseout",c),T(a,!1,"",null),K(a)},c.onclick=function(c){c=a.window.event||c;var h=g(c.target||c.srcElement);if(h){var v,b=ft(h),y=b.table,C=b.getCellInfo(h),N=a.selection.getRange();if(w(y,h,c,!0)){var U=b.getCell(b.indexTable[b.rowsNum-1][C.colIndex].rowIndex,b.indexTable[b.rowsNum-1][C.colIndex].cellIndex);return void(c.shiftKey&&b.selectedTds.length?b.selectedTds[0]!==U?(v=b.getCellsRange(b.selectedTds[0],U),b.setSelected(v)):N&&N.selectNodeContents(U).select():h!==U?(v=b.getCellsRange(h,U),b.setSelected(v)):N&&N.selectNodeContents(U).select())}if(w(y,h,c)){var E=b.getCell(b.indexTable[C.rowIndex][b.colsNum-1].rowIndex,b.indexTable[C.rowIndex][b.colsNum-1].cellIndex);c.shiftKey&&b.selectedTds.length?b.selectedTds[0]!==E?(v=b.getCellsRange(b.selectedTds[0],E),b.setSelected(v)):N&&N.selectNodeContents(E).select():h!==E?(v=b.getCellsRange(h,E),b.setSelected(v)):N&&N.selectNodeContents(E).select()}}})}),J(a,!0)}}),domUtils.on(et.document,"mousemove",y),domUtils.on(et.document,"mouseout",function(a){var c=a.target||a.srcElement;"TABLE"==c.tagName&&T(et,!1,"",null)}),et.addListener("interlacetable",function(a,c,h){if(c)for(var g=this,v=c.rows,b=v.length,y=function(a,c,h){return a[c]?a[c]:h?a[c%a.length]:""},i=0;b>i;i++)v[i].className=y(h||g.options.classList,i,!0)}),et.addListener("uninterlacetable",function(a,c){if(c)for(var h=this,g=c.rows,v=h.options.classList,b=g.length,i=0;b>i;i++)domUtils.removeClasses(g[i],v)}),et.addListener("mousedown",k),et.addListener("mouseup",O),domUtils.on(et.body,"dragstart",function(a){O.call(et,"dragstart",a)}),et.addOutputRule(function(a){utils.each(a.getNodesByTagName("div"),function(n){"ue_tableDragLine"==n.getAttr("id")&&n.parentNode.removeChild(n)})});var U=0;et.addListener("mousedown",function(){U=0}),et.addListener("tabkeydown",function(){var a=this.selection.getRange(),c=a.getCommonAncestor(!0,!0),h=domUtils.findParentByTagName(c,"table");if(h){if(domUtils.findParentByTagName(c,"caption",!0)){var g=domUtils.getElementsByTagName(h,"th td");g&&g.length&&a.setStart(g[0],0).setCursor(!1,!0)}else{var g=domUtils.findParentByTagName(c,["td","th"],!0),b=ft(g);U=g.rowSpan>1?U:b.getCellInfo(g).rowIndex;var y=b.getTabNextCell(g,U);y?v(y)?a.setStart(y,0).setCursor(!1,!0):a.selectNodeContents(y).select():(et.fireEvent("saveScene"),et.__hasEnterExecCommand=!0,this.execCommand("insertrownext"),et.__hasEnterExecCommand=!1,a=this.selection.getRange(),a.setStart(h.rows[h.rows.length-1].cells[0],0).setCursor(),et.fireEvent("saveScene"))}return!0}}),browser.ie&&et.addListener("selectionchange",function(){T(this,!1,"",null)}),et.addListener("keydown",function(a,c){var h=this,g=c.keyCode||c.which;if(8!=g&&46!=g){var v=!(c.ctrlKey||c.metaKey||c.shiftKey||c.altKey);v&&gt(domUtils.getElementsByTagName(h.body,"td"));var b=ht(h);b&&v&&b.clearSelected()}}),et.addListener("beforegetcontent",function(){J(this,!1),browser.ie&&utils.each(this.document.getElementsByTagName("caption"),function(a){domUtils.isEmptyNode(a)&&(a.innerHTML="&nbsp;")})}),et.addListener("aftergetcontent",function(){J(this,!0)}),et.addListener("getAllHtml",function(){gt(et.document.getElementsByTagName("td"))}),et.addListener("fullscreenchanged",function(a,c){if(!c){var h=this.body.offsetWidth/document.body.offsetWidth,g=domUtils.getElementsByTagName(this.body,"table");utils.each(g,function(a){if(a.offsetWidth<et.body.offsetWidth)return!1;var c=domUtils.getElementsByTagName(a,"td"),g=[];utils.each(c,function(a){g.push(a.offsetWidth)});for(var v,i=0;v=c[i];i++)v.setAttribute("width",Math.floor(g[i]*h));a.setAttribute("width",Math.floor(Z(et,Tt,pt(et))))})}});var E=et.execCommand;et.execCommand=function(a){var c=this;a=a.toLowerCase();var h,g,b=ht(c),y=new dom.Range(c.document),C=c.commands[a]||UE.commands[a];if(C){if(!b||St[a]||C.notNeedUndo||c.__hasEnterExecCommand)g=E.apply(c,arguments);else{c.__hasEnterExecCommand=!0,c.fireEvent("beforeexeccommand",a),h=b.selectedTds;for(var N,w,U,T=-2,S=-2,i=0;U=h[i];i++)v(U)?y.setStart(U,0).setCursor(!1,!0):y.selectNode(U).select(!0),w=c.queryCommandState(a),N=c.queryCommandValue(a),-1!=w&&((T!==w||S!==N)&&(c._ignoreContentChange=!0,g=E.apply(c,arguments),c._ignoreContentChange=!1),T=c.queryCommandState(a),S=c.queryCommandValue(a),domUtils.isEmptyBlock(U)&&domUtils.fillNode(c.document,U));y.setStart(h[0],0).shrinkBoundary(!0).setCursor(!1,!0),c.fireEvent("contentchange"),c.fireEvent("afterexeccommand",a),c.__hasEnterExecCommand=!1,c._selectionChange()}return g}}});var kt},UE.UETable.prototype.sortTable=function(a,c){var h=this.table,g=h.rows,v=[],b="TH"===g[0].cells[0].tagName,y=0;if(this.selectedTds.length){for(var C=this.cellsRange,N=C.endRowIndex+1,i=C.beginRowIndex;N>i;i++)v[i]=g[i];v.splice(0,C.beginRowIndex),y=C.endRowIndex+1===this.rowsNum?0:C.endRowIndex+1}else for(var i=0,N=g.length;N>i;i++)v[i]=g[i];var w={reversecurrent:function(){return 1},orderbyasc:function(a,c){var h=a.innerText||a.textContent,g=c.innerText||c.textContent;return h.localeCompare(g)},reversebyasc:function(a,c){var h=a.innerHTML,g=c.innerHTML;return g.localeCompare(h)},orderbynum:function(a,c){var h=a[browser.ie?"innerText":"textContent"].match(/\d+/),g=c[browser.ie?"innerText":"textContent"].match(/\d+/);return h&&(h=+h[0]),g&&(g=+g[0]),(h||0)-(g||0)},reversebynum:function(a,c){var h=a[browser.ie?"innerText":"textContent"].match(/\d+/),g=c[browser.ie?"innerText":"textContent"].match(/\d+/);return h&&(h=+h[0]),g&&(g=+g[0]),(g||0)-(h||0)}};h.setAttribute("data-sort-type",c&&"string"==typeof c&&w[c]?c:""),b&&v.splice(0,1),v=utils.sort(v,function(h,g){var v;return v=c&&"function"==typeof c?c.call(this,h.cells[a],g.cells[a]):c&&"number"==typeof c?1:c&&"string"==typeof c&&w[c]?w[c].call(this,h.cells[a],g.cells[a]):w.orderbyasc.call(this,h.cells[a],g.cells[a])});for(var U=h.ownerDocument.createDocumentFragment(),E=0,N=v.length;N>E;E++)U.appendChild(v[E]);
var T=h.getElementsByTagName("tbody")[0];y?T.insertBefore(U,g[y-C.endRowIndex+C.beginRowIndex-1]):T.appendChild(U)},UE.plugins.tablesort=function(){var a=this,c=UE.UETable,h=function(a){return c.getUETable(a)},g=function(a){return c.getTableItemsByRange(a)};a.ready(function(){utils.cssRule("tablesort","table.sortEnabled tr.firstRow th,table.sortEnabled tr.firstRow td{padding-right:20px;background-repeat: no-repeat;background-position: center right;   background-image:url("+a.options.themePath+a.options.theme+"/images/sortable.png);}",a.document),a.addListener("afterexeccommand",function(a,c){("mergeright"==c||"mergedown"==c||"mergecells"==c)&&this.execCommand("disablesort")})}),UE.commands.sorttable={queryCommandState:function(){var a=this,c=g(a);if(!c.cell)return-1;for(var h,v=c.table,b=v.getElementsByTagName("td"),i=0;h=b[i++];)if(1!=h.rowSpan||1!=h.colSpan)return-1;return 0},execCommand:function(a,c){var v=this,b=v.selection.getRange(),y=b.createBookmark(!0),C=g(v),N=C.cell,w=h(C.table),U=w.getCellInfo(N);w.sortTable(U.cellIndex,c),b.moveToBookmark(y);try{b.select()}catch(e){}}},UE.commands.enablesort=UE.commands.disablesort={queryCommandState:function(a){var c=g(this).table;if(c&&"enablesort"==a)for(var h=domUtils.getElementsByTagName(c,"th td"),i=0;i<h.length;i++)if(h[i].getAttribute("colspan")>1||h[i].getAttribute("rowspan")>1)return-1;return c?"enablesort"==a^"sortEnabled"!=c.getAttribute("data-sort")?-1:0:-1},execCommand:function(a){var c=g(this).table;c.setAttribute("data-sort","enablesort"==a?"sortEnabled":"sortDisabled"),"enablesort"==a?domUtils.addClass(c,"sortEnabled"):domUtils.removeClasses(c,"sortEnabled")}}},UE.plugins.contextmenu=function(){var a=this;if(a.setOpt("enableContextMenu",!0),a.getOpt("enableContextMenu")!==!1){var c,h=a.getLang("contextMenu"),g=a.options.contextMenu||[{label:h.selectall,cmdName:"selectall"},{label:h.cleardoc,cmdName:"cleardoc",exec:function(){confirm(h.confirmclear)&&this.execCommand("cleardoc")}},"-",{label:h.unlink,cmdName:"unlink"},"-",{group:h.paragraph,icon:"justifyjustify",subMenu:[{label:h.justifyleft,cmdName:"justify",value:"left"},{label:h.justifyright,cmdName:"justify",value:"right"},{label:h.justifycenter,cmdName:"justify",value:"center"},{label:h.justifyjustify,cmdName:"justify",value:"justify"}]},"-",{group:h.table,icon:"table",subMenu:[{label:h.inserttable,cmdName:"inserttable"},{label:h.deletetable,cmdName:"deletetable"},"-",{label:h.deleterow,cmdName:"deleterow"},{label:h.deletecol,cmdName:"deletecol"},{label:h.insertcol,cmdName:"insertcol"},{label:h.insertcolnext,cmdName:"insertcolnext"},{label:h.insertrow,cmdName:"insertrow"},{label:h.insertrownext,cmdName:"insertrownext"},"-",{label:h.insertcaption,cmdName:"insertcaption"},{label:h.deletecaption,cmdName:"deletecaption"},{label:h.inserttitle,cmdName:"inserttitle"},{label:h.deletetitle,cmdName:"deletetitle"},{label:h.inserttitlecol,cmdName:"inserttitlecol"},{label:h.deletetitlecol,cmdName:"deletetitlecol"},"-",{label:h.mergecells,cmdName:"mergecells"},{label:h.mergeright,cmdName:"mergeright"},{label:h.mergedown,cmdName:"mergedown"},"-",{label:h.splittorows,cmdName:"splittorows"},{label:h.splittocols,cmdName:"splittocols"},{label:h.splittocells,cmdName:"splittocells"},"-",{label:h.averageDiseRow,cmdName:"averagedistributerow"},{label:h.averageDisCol,cmdName:"averagedistributecol"},"-",{label:h.edittd,cmdName:"edittd",exec:function(){UE.ui.edittd&&new UE.ui.edittd(this),this.getDialog("edittd").open()}},{label:h.edittable,cmdName:"edittable",exec:function(){UE.ui.edittable&&new UE.ui.edittable(this),this.getDialog("edittable").open()}},{label:h.setbordervisible,cmdName:"setbordervisible"}]},{group:h.tablesort,icon:"tablesort",subMenu:[{label:h.enablesort,cmdName:"enablesort"},{label:h.disablesort,cmdName:"disablesort"},"-",{label:h.reversecurrent,cmdName:"sorttable",value:"reversecurrent"},{label:h.orderbyasc,cmdName:"sorttable",value:"orderbyasc"},{label:h.reversebyasc,cmdName:"sorttable",value:"reversebyasc"},{label:h.orderbynum,cmdName:"sorttable",value:"orderbynum"},{label:h.reversebynum,cmdName:"sorttable",value:"reversebynum"}]},{group:h.borderbk,icon:"borderBack",subMenu:[{label:h.setcolor,cmdName:"interlacetable",exec:function(){this.execCommand("interlacetable")}},{label:h.unsetcolor,cmdName:"uninterlacetable",exec:function(){this.execCommand("uninterlacetable")}},{label:h.setbackground,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["#bbb","#ccc"]})}},{label:h.unsetbackground,cmdName:"cleartablebackground",exec:function(){this.execCommand("cleartablebackground")}},{label:h.redandblue,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["red","blue"]})}},{label:h.threecolorgradient,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:!0,colorList:["#aaa","#bbb","#ccc"]})}}]},{group:h.aligntd,icon:"aligntd",subMenu:[{cmdName:"cellalignment",value:{align:"left",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"bottom"}}]},{group:h.aligntable,icon:"aligntable",subMenu:[{cmdName:"tablealignment",className:"left",label:h.tableleft,value:"left"},{cmdName:"tablealignment",className:"center",label:h.tablecenter,value:"center"},{cmdName:"tablealignment",className:"right",label:h.tableright,value:"right"}]},"-",{label:h.insertparagraphbefore,cmdName:"insertparagraph",value:!0},{label:h.insertparagraphafter,cmdName:"insertparagraph"},{label:h.copy,cmdName:"copy"},{label:h.paste,cmdName:"paste"}];if(g.length){var v=UE.ui.uiUtils;a.addListener("contextmenu",function(b,y){var C=v.getViewportOffsetByEvent(y);a.fireEvent("beforeselectionchange"),c&&c.destroy();for(var N,i=0,w=[];N=g[i];i++){var U;!function(c){function g(){switch(c.icon){case"table":return a.getLang("contextMenu.table");case"justifyjustify":return a.getLang("contextMenu.paragraph");case"aligntd":return a.getLang("contextMenu.aligntd");case"aligntable":return a.getLang("contextMenu.aligntable");case"tablesort":return h.tablesort;case"borderBack":return h.borderbk;default:return""}}if("-"==c)(U=w[w.length-1])&&"-"!==U&&w.push("-");else if(c.hasOwnProperty("group")){for(var v,b=0,y=[];v=c.subMenu[b];b++)!function(c){"-"==c?(U=y[y.length-1])&&"-"!==U?y.push("-"):y.splice(y.length-1):(a.commands[c.cmdName]||UE.commands[c.cmdName]||c.query)&&(c.query?c.query():a.queryCommandState(c.cmdName))>-1&&y.push({label:c.label||a.getLang("contextMenu."+c.cmdName+(c.value||""))||"",className:"edui-for-"+c.cmdName+(c.className?" edui-for-"+c.cmdName+"-"+c.className:""),onclick:c.exec?function(){c.exec.call(a)}:function(){a.execCommand(c.cmdName,c.value)}})}(v);y.length&&w.push({label:g(),className:"edui-for-"+c.icon,subMenu:{items:y,editor:a}})}else(a.commands[c.cmdName]||UE.commands[c.cmdName]||c.query)&&(c.query?c.query.call(a):a.queryCommandState(c.cmdName))>-1&&w.push({label:c.label||a.getLang("contextMenu."+c.cmdName),className:"edui-for-"+(c.icon?c.icon:c.cmdName+(c.value||"")),onclick:c.exec?function(){c.exec.call(a)}:function(){a.execCommand(c.cmdName,c.value)}})}(N)}if("-"==w[w.length-1]&&w.pop(),c=new UE.ui.Menu({items:w,className:"edui-contextmenu",editor:a}),c.render(),c.showAt(C),a.fireEvent("aftershowcontextmenu",c),domUtils.preventDefault(y),browser.ie){var E;try{E=a.selection.getNative().createRange()}catch(e){return}if(E.item){var T=new dom.Range(a.document);T.selectNode(E.item(0)).select(!0,!0)}}}),a.addListener("aftershowcontextmenu",function(c,h){if(a.zeroclipboard){var g=h.items;for(var v in g)"edui-for-copy"==g[v].className&&a.zeroclipboard.clip(g[v].getDom())}})}}},UE.plugins.shortcutmenu=function(){var a,c=this,h=c.options.shortcutMenu||[];h.length&&(c.addListener("contextmenu mouseup",function(c,e){var g=this,v={type:c,target:e.target||e.srcElement,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY};if(setTimeout(function(){var b=g.selection.getRange();(b.collapsed===!1||"contextmenu"==c)&&(a||(a=new baidu.editor.ui.ShortCutMenu({editor:g,items:h,theme:g.options.theme,className:"edui-shortcutmenu"}),a.render(),g.fireEvent("afterrendershortcutmenu",a)),a.show(v,!!UE.plugins.contextmenu))}),"contextmenu"==c&&(domUtils.preventDefault(e),browser.ie9below)){var b;try{b=g.selection.getNative().createRange()}catch(e){return}if(b.item){var y=new dom.Range(g.document);y.selectNode(b.item(0)).select(!0,!0)}}}),c.addListener("keydown",function(c){"keydown"==c&&a&&!a.isHidden&&a.hide()}))},UE.plugins.basestyle=function(){var a={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},c=function(a,c){return domUtils.filterNodeList(a.selection.getStartElementPath(),c)},h=this;h.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"}),h.addInputRule(function(a){utils.each(a.getNodesByTagName("b i"),function(a){switch(a.tagName){case"b":a.tagName="strong";break;case"i":a.tagName="em"}})});for(var g in a)!function(a,g){h.commands[a]={execCommand:function(a){var v=h.selection.getRange(),b=c(this,g);if(v.collapsed){if(b){var y=h.document.createTextNode("");v.insertNode(y).removeInlineStyle(g),v.setStartBefore(y),domUtils.remove(y)}else{var C=v.document.createElement(g[0]);("superscript"==a||"subscript"==a)&&(y=h.document.createTextNode(""),v.insertNode(y).removeInlineStyle(["sub","sup"]).setStartBefore(y).collapse(!0)),v.insertNode(C).setStart(C,0)}v.collapse(!0)}else("superscript"==a||"subscript"==a)&&(b&&b.tagName.toLowerCase()==a||v.removeInlineStyle(["sub","sup"])),b?v.removeInlineStyle(g):v.applyInlineStyle(g[0]);v.select()},queryCommandState:function(){return c(this,g)?1:0}}}(g,a[g])},UE.plugins.elementpath=function(){var a,c,h=this;h.setOpt("elementPathEnabled",!0),h.options.elementPathEnabled&&(h.commands.elementpath={execCommand:function(g,v){var b=c[v],y=h.selection.getRange();a=1*v,y.selectNode(b).select()},queryCommandValue:function(){var h=[].concat(this.selection.getStartElementPath()).reverse(),g=[];c=h;for(var v,i=0;v=h[i];i++)if(3!=v.nodeType){var b=v.tagName.toLowerCase();if("img"==b&&v.getAttribute("anchorname")&&(b="anchor"),g[i]=b,a==i){a=-1;break}}return g}})},UE.plugins.formatmatch=function(){function a(b,y){function C(a){return T&&a.selectNode(T),a.applyInlineStyle(g[g.length-1].tagName,null,g)}if(browser.webkit)var N="IMG"==y.target.tagName?y.target:null;h.undoManger&&h.undoManger.save();var w=h.selection.getRange(),U=N||w.getClosedNode();if(c&&U&&"IMG"==U.tagName)U.style.cssText+=";float:"+(c.style.cssFloat||c.style.styleFloat||"none")+";display:"+(c.style.display||"inline"),c=null;else if(!c){var E=w.collapsed;if(E){var T=h.document.createTextNode("match");w.insertNode(T).select()}h.__hasEnterExecCommand=!0;var S=h.options.removeFormatAttributes;h.options.removeFormatAttributes="",h.execCommand("removeformat"),h.options.removeFormatAttributes=S,h.__hasEnterExecCommand=!1,w=h.selection.getRange(),g.length&&C(w),T&&w.setStartBefore(T).collapse(!0),w.select(),T&&domUtils.remove(T)}h.undoManger&&h.undoManger.save(),h.removeListener("mouseup",a),v=0}var c,h=this,g=[],v=0;h.addListener("reset",function(){g=[],v=0}),h.commands.formatmatch={execCommand:function(){if(v)return v=0,g=[],void h.removeListener("mouseup",a);var b=h.selection.getRange();if(c=b.getClosedNode(),!c||"IMG"!=c.tagName){b.collapse(!0).shrinkBoundary();var y=b.startContainer;g=domUtils.findParents(y,!0,function(a){return!domUtils.isBlockElm(a)&&1==a.nodeType});for(var C,i=0;C=g[i];i++)if("A"==C.tagName){g.splice(i,1);break}}h.addListener("mouseup",a),v=1},queryCommandState:function(){return v},notNeedUndo:1}},UE.plugin.register("searchreplace",function(){function a(a,c,h){var g=c.searchStr;-1==c.dir&&(a=a.split("").reverse().join(""),g=g.split("").reverse().join(""),h=a.length-h);for(var v,b=new RegExp(g,"g"+(c.casesensitive?"":"i"));v=b.exec(a);)if(v.index>=h)return-1==c.dir?a.length-v.index-c.searchStr.length:v.index;return-1}function c(c,h,g){var v,b,C=g.all||1==g.dir?"getNextDomNode":"getPreDomNode";domUtils.isBody(c)&&(c=c.firstChild);for(var N=1;c;){if(v=3==c.nodeType?c.nodeValue:c[browser.ie?"innerText":"textContent"],b=a(v,g,h),N=0,-1!=b)return{node:c,index:b};for(c=domUtils[C](c);c&&y[c.nodeName.toLowerCase()];)c=domUtils[C](c,!0);c&&(h=-1==g.dir?(3==c.nodeType?c.nodeValue:c[browser.ie?"innerText":"textContent"]).length:0)}}function h(a,c,g){for(var v,b=0,y=a.firstChild,C=0;y;){if(3==y.nodeType){if(C=y.nodeValue.replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,b+=C,b>=c)return{node:y,index:C-(b-c)}}else if(!dtd.$empty[y.tagName]&&(C=y[browser.ie?"innerText":"textContent"].replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,b+=C,b>=c&&(v=h(y,C-(b-c),g))))return v;y=domUtils.getNextDomNode(y)}}function g(a,g){var b,y=a.selection.getRange(),C=g.searchStr,N=a.document.createElement("span");if(N.innerHTML="$$ueditor_searchreplace_key$$",y.shrinkBoundary(!0),!y.collapsed){y.select();var w=a.selection.getText();if(new RegExp("^"+g.searchStr+"$",g.casesensitive?"":"i").test(w)){if(void 0!=g.replaceStr)return v(y,g.replaceStr),y.select(),!0;y.collapse(-1==g.dir)}}y.insertNode(N),y.enlargeToBlockElm(!0),b=y.startContainer;var U=b[browser.ie?"innerText":"textContent"].indexOf("$$ueditor_searchreplace_key$$");y.setStartBefore(N),domUtils.remove(N);var E=c(b,U,g);if(E){var T=h(E.node,E.index,C),S=h(E.node,E.index+C.length,C);return y.setStart(T.node,T.index).setEnd(S.node,S.index),void 0!==g.replaceStr&&v(y,g.replaceStr),y.select(),!0}y.setCursor()}function v(a,c){c=b.document.createTextNode(c),a.deleteContents().insertNode(c)}var b=this,y={table:1,tbody:1,tr:1,ol:1,ul:1};return{commands:{searchreplace:{execCommand:function(a,c){utils.extend(c,{all:!1,casesensitive:!1,dir:1},!0);var h=0;if(c.all){var v=b.selection.getRange(),y=b.body.firstChild;for(y&&1==y.nodeType?(v.setStart(y,0),v.shrinkBoundary(!0)):3==y.nodeType&&v.setStartBefore(y),v.collapse(!0).select(!0),void 0!==c.replaceStr&&b.fireEvent("saveScene");g(this,c);)h++;h&&b.fireEvent("saveScene")}else void 0!==c.replaceStr&&b.fireEvent("saveScene"),g(this,c)&&h++,h&&b.fireEvent("saveScene");return h},notNeedUndo:1}}}}),UE.plugins.customstyle=function(){var a=this;a.setOpt({customstyle:[{tag:"h1",name:"tc",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;"},{tag:"h1",name:"tl",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;"},{tag:"span",name:"im",style:"font-size:16px;font-style:italic;font-weight:bold;line-height:18px;"},{tag:"span",name:"hi",style:"font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;"}]}),a.commands.customstyle={execCommand:function(a,c){var h,g,v=this,b=c.tag,y=domUtils.findParent(v.selection.getStart(),function(a){return a.getAttribute("label")},!0),C={};for(var p in c)void 0!==c[p]&&(C[p]=c[p]);if(delete C.tag,y&&y.getAttribute("label")==c.label){if(h=this.selection.getRange(),g=h.createBookmark(),h.collapsed)if(dtd.$block[y.tagName]){var N=v.document.createElement("p");domUtils.moveChild(y,N),y.parentNode.insertBefore(N,y),domUtils.remove(y)}else domUtils.remove(y,!0);else{var w=domUtils.getCommonAncestor(g.start,g.end),U=domUtils.getElementsByTagName(w,b);new RegExp(b,"i").test(w.tagName)&&U.push(w);for(var E,i=0;E=U[i++];)if(E.getAttribute("label")==c.label){var T=domUtils.getPosition(E,g.start),S=domUtils.getPosition(E,g.end);if((T&domUtils.POSITION_FOLLOWING||T&domUtils.POSITION_CONTAINS)&&(S&domUtils.POSITION_PRECEDING||S&domUtils.POSITION_CONTAINS)&&dtd.$block[b]){var N=v.document.createElement("p");domUtils.moveChild(E,N),E.parentNode.insertBefore(N,E)}domUtils.remove(E,!0)}y=domUtils.findParent(w,function(a){return a.getAttribute("label")==c.label},!0),y&&domUtils.remove(y,!0)}h.moveToBookmark(g).select()}else if(dtd.$block[b]){if(this.execCommand("paragraph",b,C,"customstyle"),h=v.selection.getRange(),!h.collapsed){h.collapse(),y=domUtils.findParent(v.selection.getStart(),function(a){return a.getAttribute("label")==c.label},!0);var k=v.document.createElement("p");domUtils.insertAfter(y,k),domUtils.fillNode(v.document,k),h.setStart(k,0).setCursor()}}else{if(h=v.selection.getRange(),h.collapsed)return y=v.document.createElement(b),domUtils.setAttributes(y,C),void h.insertNode(y).setStart(y,0).setCursor();g=h.createBookmark(),h.applyInlineStyle(b,C).moveToBookmark(g).select()}},queryCommandValue:function(){var a=domUtils.filterNodeList(this.selection.getStartElementPath(),function(a){return a.getAttribute("label")});return a?a.getAttribute("label"):""}},a.addListener("keyup",function(c,h){var g=h.keyCode||h.which;if(32==g||13==g){var v=a.selection.getRange();if(v.collapsed){var b=domUtils.findParent(a.selection.getStart(),function(a){return a.getAttribute("label")},!0);if(b&&dtd.$block[b.tagName]&&domUtils.isEmptyNode(b)){var p=a.document.createElement("p");domUtils.insertAfter(b,p),domUtils.fillNode(a.document,p),domUtils.remove(b),v.setStart(p,0).setCursor()}}}})},UE.plugins.catchremoteimage=function(){var me=this,ajax=UE.ajax;me.options.catchRemoteImageEnable!==!1&&(me.setOpt({catchRemoteImageEnable:!1}),me.addListener("afterpaste",function(){me.fireEvent("catchRemoteImage")}),me.addListener("catchRemoteImage",function(){function catchremoteimage(a,c){var h=utils.serializeParam(me.queryCommandValue("serverparam"))||"",g=utils.formatUrl(catcherActionUrl+(-1==catcherActionUrl.indexOf("?")?"?":"&")+h),v=utils.isCrossDomainUrl(g),b={method:"POST",dataType:v?"jsonp":"",timeout:6e4,onsuccess:c.success,onerror:c.error};b[catcherFieldName]=a,ajax.request(g,b)}for(var catcherLocalDomain=me.getOpt("catcherLocalDomain"),catcherActionUrl=me.getActionUrl(me.getOpt("catcherActionName")),catcherUrlPrefix=me.getOpt("catcherUrlPrefix"),catcherFieldName=me.getOpt("catcherFieldName"),remoteImages=[],imgs=domUtils.getElementsByTagName(me.document,"img"),test=function(a,c){if(-1!=a.indexOf(location.host)||/(^\.)|(^\/)/.test(a))return!0;if(c)for(var h,g=0;h=c[g++];)if(-1!==a.indexOf(h))return!0;return!1},i=0,ci;ci=imgs[i++];)if(!ci.getAttribute("word_img")){var src=ci.getAttribute("_src")||ci.src||"";/^(https?|ftp):/i.test(src)&&!test(src,catcherLocalDomain)&&remoteImages.push(src)}remoteImages.length&&catchremoteimage(remoteImages,{success:function(r){try{var info=void 0!==r.state?r:eval("("+r.responseText+")")}catch(e){return}var i,j,ci,cj,oldSrc,newSrc,list=info.list;for(i=0;ci=imgs[i++];)for(oldSrc=ci.getAttribute("_src")||ci.src||"",j=0;cj=list[j++];)if(oldSrc==cj.source&&"SUCCESS"==cj.state){newSrc=catcherUrlPrefix+cj.url,domUtils.setAttributes(ci,{src:newSrc,_src:newSrc});break}me.fireEvent("catchremotesuccess")},error:function(){me.fireEvent("catchremoteerror")}})}))},UE.plugin.register("snapscreen",function(){function getLocation(a){var c,h=document.createElement("a"),g=utils.serializeParam(me.queryCommandValue("serverparam"))||"";return h.href=a,browser.ie&&(h.href=h.href),c=h.search,g&&(c=c+(-1==c.indexOf("?")?"?":"&")+g,c=c.replace(/[&]+/gi,"&")),{port:h.port,hostname:h.hostname,path:h.pathname+c||+h.hash}}var me=this,snapplugin;return{commands:{snapscreen:{execCommand:function(cmd){function onSuccess(rs){try{if(rs=eval("("+rs+")"),"SUCCESS"==rs.state){var opt=me.options;me.execCommand("insertimage",{src:opt.snapscreenUrlPrefix+rs.url,_src:opt.snapscreenUrlPrefix+rs.url,alt:rs.title||"",floatStyle:opt.snapscreenImgAlign})}else alert(rs.state)}catch(e){alert(lang.callBackErrorMsg)}}var url,local,res,lang=me.getLang("snapScreen_plugin");if(!snapplugin){var container=me.container,doc=me.container.ownerDocument||me.container.document;snapplugin=doc.createElement("object");try{snapplugin.type="application/x-pluginbaidusnap"}catch(e){return}snapplugin.style.cssText="position:absolute;left:-9999px;width:0;height:0;",snapplugin.setAttribute("width","0"),snapplugin.setAttribute("height","0"),container.appendChild(snapplugin)}url=me.getActionUrl(me.getOpt("snapscreenActionName")),local=getLocation(url),setTimeout(function(){try{res=snapplugin.saveSnapshot(local.hostname,local.path,local.port)}catch(e){return void me.ui._dialogs.snapscreenDialog.open()}onSuccess(res)},50)},queryCommandState:function(){return-1!=navigator.userAgent.indexOf("Windows",0)?0:-1}}}}}),UE.commands.insertparagraph={execCommand:function(a,c){for(var h,g=this,v=g.selection.getRange(),b=v.startContainer;b&&!domUtils.isBody(b);)h=b,b=b.parentNode;if(h){var p=g.document.createElement("p");c?h.parentNode.insertBefore(p,h):h.parentNode.insertBefore(p,h.nextSibling),domUtils.fillNode(g.document,p),v.setStart(p,0).setCursor(!1,!0)}}},UE.plugin.register("webapp",function(){function a(a,h){return h?'<iframe class="edui-faked-webapp" title="'+a.title+'" '+(a.align&&!a.cssfloat?'align="'+a.align+'"':"")+(a.cssfloat?'style="float:'+a.cssfloat+'"':"")+'width="'+a.width+'" height="'+a.height+'"  scrolling="no" frameborder="0" src="'+a.url+'" logo_url = "'+a.logo+'"></iframe>':'<img title="'+a.title+'" width="'+a.width+'" height="'+a.height+'" src="'+c.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" _logo_url="'+a.logo+'" style="background:url('+a.logo+') no-repeat center center; border:1px solid gray;" class="edui-faked-webapp" _url="'+a.url+'" '+(a.align&&!a.cssfloat?'align="'+a.align+'"':"")+(a.cssfloat?'style="float:'+a.cssfloat+'"':"")+"/>"}var c=this;return{outputRule:function(c){utils.each(c.getNodesByTagName("img"),function(c){var h;if("edui-faked-webapp"==c.getAttr("class")){h=a({title:c.getAttr("title"),width:c.getAttr("width"),height:c.getAttr("height"),align:c.getAttr("align"),cssfloat:c.getStyle("float"),url:c.getAttr("_url"),logo:c.getAttr("_logo_url")},!0);var g=UE.uNode.createElement(h);c.parentNode.replaceChild(g,c)}})},inputRule:function(c){utils.each(c.getNodesByTagName("iframe"),function(c){if("edui-faked-webapp"==c.getAttr("class")){var h=UE.uNode.createElement(a({title:c.getAttr("title"),width:c.getAttr("width"),height:c.getAttr("height"),align:c.getAttr("align"),cssfloat:c.getStyle("float"),url:c.getAttr("src"),logo:c.getAttr("logo_url")}));c.parentNode.replaceChild(h,c)}})},commands:{webapp:{execCommand:function(c,h){var g=this,v=a(utils.extend(h,{align:"none"}),!1);g.execCommand("inserthtml",v)},queryCommandState:function(){var a=this,c=a.selection.getRange().getClosedNode(),h=c&&"edui-faked-webapp"==c.className;return h?1:0}}}}}),UE.plugins.template=function(){UE.commands.template={execCommand:function(a,c){c.html&&this.execCommand("inserthtml",c.html)}},this.addListener("click",function(a,c){var h=c.target||c.srcElement,g=this.selection.getRange(),v=domUtils.findParent(h,function(a){return a.className&&domUtils.hasClass(a,"ue_t")?a:void 0},!0);v&&g.selectNode(v).shrinkBoundary().select()}),this.addListener("keydown",function(a,c){var h=this.selection.getRange();if(!h.collapsed&&!(c.ctrlKey||c.metaKey||c.shiftKey||c.altKey)){var g=domUtils.findParent(h.startContainer,function(a){return a.className&&domUtils.hasClass(a,"ue_t")?a:void 0},!0);g&&domUtils.removeClasses(g,["ue_t"])}})},UE.plugin.register("music",function(){function a(a,h,g,v,b,y){return y?'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+a+'" width="'+h+'" height="'+g+'" '+(v&&!b?'align="'+v+'"':"")+(b?'style="float:'+b+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(v&&!b?'align="'+v+'"':"")+(b?'style="float:'+b+'"':"")+' width="'+h+'" height="'+g+'" _url="'+a+'" class="edui-faked-music" src="'+c.options.langPath+c.options.lang+'/images/music.png" />'}var c=this;return{outputRule:function(c){utils.each(c.getNodesByTagName("img"),function(c){var h;if("edui-faked-music"==c.getAttr("class")){var g=c.getStyle("float"),v=c.getAttr("align");h=a(c.getAttr("_url"),c.getAttr("width"),c.getAttr("height"),v,g,!0);var b=UE.uNode.createElement(h);c.parentNode.replaceChild(b,c)}})},inputRule:function(c){utils.each(c.getNodesByTagName("embed"),function(c){if("edui-faked-music"==c.getAttr("class")){var h=c.getStyle("float"),g=c.getAttr("align");html=a(c.getAttr("src"),c.getAttr("width"),c.getAttr("height"),g,h,!1);var v=UE.uNode.createElement(html);c.parentNode.replaceChild(v,c)}})},commands:{music:{execCommand:function(c,h){var g=this,v=a(h.url,h.width||400,h.height||95,"none",!1);g.execCommand("inserthtml",v)},queryCommandState:function(){var a=this,c=a.selection.getRange().getClosedNode(),h=c&&"edui-faked-music"==c.className;return h?1:0}}}}}),UE.plugin.register("autoupload",function(){function a(a,c){var h,g,v,b,y,C,N,w,U=c,E=/image\/\w+/i.test(a.type)?"image":"file",T="loading_"+(+new Date).toString(36);if(h=U.getOpt(E+"FieldName"),g=U.getOpt(E+"UrlPrefix"),v=U.getOpt(E+"MaxSize"),b=U.getOpt(E+"AllowFiles"),y=U.getActionUrl(U.getOpt(E+"ActionName")),N=function(a){var c=U.document.getElementById(T);c&&domUtils.remove(c),U.fireEvent("showmessage",{id:T,content:a,type:"error",timeout:4e3})},"image"==E?(C='<img class="loadingclass" id="'+T+'" src="'+U.options.themePath+U.options.theme+'/images/spacer.gif" title="'+(U.getLang("autoupload.loading")||"")+'" >',w=function(a){var c=g+a.url,h=U.document.getElementById(T);h&&(h.setAttribute("src",c),h.setAttribute("_src",c),h.setAttribute("title",a.title||""),h.setAttribute("alt",a.original||""),h.removeAttribute("id"),domUtils.removeClasses(h,"loadingclass"))}):(C='<p><img class="loadingclass" id="'+T+'" src="'+U.options.themePath+U.options.theme+'/images/spacer.gif" title="'+(U.getLang("autoupload.loading")||"")+'" ></p>',w=function(a){var c=g+a.url,h=U.document.getElementById(T),v=U.selection.getRange(),b=v.createBookmark();v.selectNode(h).select(),U.execCommand("insertfile",{url:c}),v.moveToBookmark(b).select()}),U.execCommand("inserthtml",C),!U.getOpt(E+"ActionName"))return void N(U.getLang("autoupload.errorLoadConfig"));if(a.size>v)return void N(U.getLang("autoupload.exceedSizeError"));var S=a.name?a.name.substr(a.name.lastIndexOf(".")):"";if(S&&"image"!=E||b&&-1==(b.join("")+".").indexOf(S.toLowerCase()+"."))return void N(U.getLang("autoupload.exceedTypeError"));var k=new XMLHttpRequest,B=new FormData,I=utils.serializeParam(U.queryCommandValue("serverparam"))||"",_=utils.formatUrl(y+(-1==y.indexOf("?")?"?":"&")+I);B.append(h,a,a.name||"blob."+a.type.substr("image/".length)),B.append("type","ajax"),k.open("post",_,!0),k.setRequestHeader("X-Requested-With","XMLHttpRequest"),k.addEventListener("load",function(e){try{var a=new Function("return "+utils.trim(e.target.response))();"SUCCESS"==a.state&&a.url?w(a):N(a.state)}catch(c){N(U.getLang("autoupload.loadError"))}}),k.send(B)}function c(e){return e.clipboardData&&e.clipboardData.items&&1==e.clipboardData.items.length&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function h(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}return{outputRule:function(a){utils.each(a.getNodesByTagName("img"),function(n){/\b(loaderrorclass)|(bloaderrorclass)\b/.test(n.getAttr("class"))&&n.parentNode.removeChild(n)}),utils.each(a.getNodesByTagName("p"),function(n){/\bloadpara\b/.test(n.getAttr("class"))&&n.parentNode.removeChild(n)})},bindEvents:{ready:function(){var g=this;window.FormData&&window.FileReader&&(domUtils.on(g.body,"paste drop",function(e){var v,b=!1;if(v="paste"==e.type?c(e):h(e)){for(var y,C=v.length;C--;)y=v[C],y.getAsFile&&(y=y.getAsFile()),y&&y.size>0&&(a(y,g),b=!0);b&&e.preventDefault()}}),domUtils.on(g.body,"dragover",function(e){"Files"==e.dataTransfer.types[0]&&e.preventDefault()}),utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document))}}}}),UE.plugin.register("autosave",function(){function a(a){var b;if(!(new Date-h<g)){if(!a.hasContents())return void(v&&c.removePreferences(v));h=new Date,a._saveFlag=null,b=c.body.innerHTML,a.fireEvent("beforeautosave",{content:b})!==!1&&(c.setPreferences(v,b),a.fireEvent("afterautosave",{content:b}))}}var c=this,h=new Date,g=20,v=null;return{defaultOptions:{saveInterval:500},bindEvents:{ready:function(){var a="-drafts-data",h=null;h=c.key?c.key+a:(c.container.parentNode.id||"ue-common")+a,v=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+h},contentchange:function(){c.getOpt("enableAutoSave")&&v&&(c._saveFlag&&window.clearTimeout(c._saveFlag),c.options.saveInterval>0?c._saveFlag=window.setTimeout(function(){a(c)},c.options.saveInterval):a(c))}},commands:{clearlocaldata:{execCommand:function(){v&&c.getPreferences(v)&&c.removePreferences(v)},notNeedUndo:!0,ignoreContentChange:!0},getlocaldata:{execCommand:function(){return v?c.getPreferences(v)||"":""},notNeedUndo:!0,ignoreContentChange:!0},drafts:{execCommand:function(){v&&(c.body.innerHTML=c.getPreferences(v)||"<p>"+domUtils.fillHtml+"</p>",c.focus(!0))},queryCommandState:function(){return v?null===c.getPreferences(v)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}}}}),UE.plugin.register("charts",function(){function a(a){var c=null,h=0;if(a.rows.length<2)return!1;if(a.rows[0].cells.length<2)return!1;c=a.rows[0].cells,h=c.length;for(var g,i=0;g=c[i];i++)if("th"!==g.tagName.toLowerCase())return!1;for(var v,i=1;v=a.rows[i];i++){if(v.cells.length!=h)return!1;if("th"!==v.cells[0].tagName.toLowerCase())return!1;for(var g,b=1;g=v.cells[b];b++){var y=utils.trim(g.innerText||g.textContent||"");if(y=y.replace(new RegExp(UE.dom.domUtils.fillChar,"g"),"").replace(/^\s+|\s+$/g,""),!/^\d*\.?\d+$/.test(y))return!1}}return!0}var c=this;return{bindEvents:{chartserror:function(){}},commands:{charts:{execCommand:function(h,g){var v=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",!0),b=[],y={};if(!v)return!1;if(!a(v))return c.fireEvent("chartserror"),!1;y.title=g.title||"",y.subTitle=g.subTitle||"",y.xTitle=g.xTitle||"",y.yTitle=g.yTitle||"",y.suffix=g.suffix||"",y.tip=g.tip||"",y.dataFormat=g.tableDataFormat||"",y.chartType=g.chartType||0;for(var C in y)y.hasOwnProperty(C)&&b.push(C+":"+y[C]);v.setAttribute("data-chart",b.join(";")),domUtils.addClass(v,"edui-charts-table")},queryCommandState:function(){var c=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",!0);return c&&a(c)?0:-1}}},inputRule:function(a){utils.each(a.getNodesByTagName("table"),function(a){void 0!==a.getAttr("data-chart")&&a.setAttr("style")})},outputRule:function(a){utils.each(a.getNodesByTagName("table"),function(a){void 0!==a.getAttr("data-chart")&&a.setAttr("style","display: none;")})}}}),UE.plugin.register("section",function(){function a(){this.tag="",this.level=-1,this.dom=null,this.nextSection=null,this.previousSection=null,this.parentSection=null,this.startAddress=[],this.endAddress=[],this.children=[]}function c(c){var h=new a;return utils.extend(h,c)}function h(a,c){for(var h=c,i=0;i<a.length;i++){if(!h.childNodes)return null;h=h.childNodes[a[i]]}return h}var g=this;return{bindMultiEvents:{type:"aftersetcontent afterscencerestore",handler:function(){g.fireEvent("updateSections")}},bindEvents:{ready:function(){g.fireEvent("updateSections"),domUtils.on(g.body,"drop paste",function(){g.fireEvent("updateSections")
})},afterexeccommand:function(a,c){"paragraph"==c&&g.fireEvent("updateSections")},keyup:function(a,e){var c=this,h=c.selection.getRange();if(1!=h.collapsed)c.fireEvent("updateSections");else{var g=e.keyCode||e.which;(13==g||8==g||46==g)&&c.fireEvent("updateSections")}}},commands:{getsections:{execCommand:function(a,h){function g(a){for(var i=0;i<b.length;i++)if(b[i](a))return i;return-1}function v(a,h){for(var b,C,w,U=null,E=a.childNodes,i=0,T=E.length;T>i;i++)if(w=E[i],b=g(w),b>=0){var S=y.selection.getRange().selectNode(w).createAddress(!0).startAddress,k=c({tag:w.tagName,title:w.innerText||w.textContent||"",level:b,dom:w,startAddress:utils.clone(S,[]),endAddress:utils.clone(S,[]),children:[]});for(N.nextSection=k,k.previousSection=N,C=N;b<=C.level;)C=C.parentSection;k.parentSection=C,C.children.push(k),U=N=k}else 1===w.nodeType&&v(w,h),U&&U.endAddress[U.endAddress.length-1]++}for(var b=h||["h1","h2","h3","h4","h5","h6"],i=0;i<b.length;i++)"string"==typeof b[i]?b[i]=function(a){return function(c){return c.tagName==a.toUpperCase()}}(b[i]):"function"!=typeof b[i]&&(b[i]=function(){return null});var y=this,C=c({level:-1,title:"root"}),N=C;return v(y.body,C),C},notNeedUndo:!0},movesection:{execCommand:function(a,c,g,v){function b(a,c,h){for(var g=!1,v=!1,i=0;i<a.length&&!(i>=h.length);i++){if(h[i]>a[i]){g=!0;break}if(h[i]<a[i])break}for(var i=0;i<c.length&&!(i>=h.length);i++){if(h[i]<a[i]){v=!0;break}if(h[i]>a[i])break}return g&&v}var y,C,N=this;if(c&&g&&-1!=g.level&&(y=v?g.endAddress:g.startAddress,C=h(y,N.body),y&&C&&!b(c.startAddress,c.endAddress,y))){var w,U,E=h(c.startAddress,N.body),T=h(c.endAddress,N.body);if(v)for(w=T;w&&!(domUtils.getPosition(E,w)&domUtils.POSITION_FOLLOWING)&&(U=w.previousSibling,domUtils.insertAfter(C,w),w!=E);)w=U;else for(w=E;w&&!(domUtils.getPosition(w,T)&domUtils.POSITION_FOLLOWING)&&(U=w.nextSibling,C.parentNode.insertBefore(w,C),w!=T);)w=U;N.fireEvent("updateSections")}}},deletesection:{execCommand:function(a,c,h){function g(a){for(var c=v.body,i=0;i<a.length;i++){if(!c.childNodes)return null;c=c.childNodes[a[i]]}return c}var v=this;if(c){var b,y=g(c.startAddress),C=g(c.endAddress),N=y;if(h)domUtils.remove(N);else for(;N&&domUtils.inDoc(C,v.document)&&!(domUtils.getPosition(N,C)&domUtils.POSITION_FOLLOWING);)b=N.nextSibling,domUtils.remove(N),N=b;v.fireEvent("updateSections")}}},selectsection:{execCommand:function(a,c){if(!c&&!c.dom)return!1;var h=this,g=h.selection.getRange(),v={startAddress:utils.clone(c.startAddress,[]),endAddress:utils.clone(c.endAddress,[])};return v.endAddress[v.endAddress.length-1]++,g.moveToAddress(v).select().scrollToView(),!0},notNeedUndo:!0},scrolltosection:{execCommand:function(a,c){if(!c&&!c.dom)return!1;var h=this,g=h.selection.getRange(),v={startAddress:c.startAddress,endAddress:c.endAddress};return v.endAddress[v.endAddress.length-1]++,g.moveToAddress(v).scrollToView(),!0},notNeedUndo:!0}}}}),UE.plugin.register("simpleupload",function(){function a(){var a=c.offsetWidth||20,v=c.offsetHeight||20,b=document.createElement("iframe"),y="display:block;width:"+a+"px;height:"+v+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";domUtils.on(b,"load",function(){var c,C,N,w=(+new Date).toString(36);C=b.contentDocument||b.contentWindow.document,N=C.body,c=C.createElement("div"),c.innerHTML='<form id="edui_form_'+w+'" target="edui_iframe_'+w+'" method="POST" enctype="multipart/form-data" action="'+h.getOpt("serverUrl")+'" style="'+y+'"><input id="edui_input_'+w+'" type="file" accept="image/*" name="'+h.options.imageFieldName+'" style="'+y+'"></form><iframe id="edui_iframe_'+w+'" name="edui_iframe_'+w+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>',c.className="edui-"+h.options.theme,c.id=h.ui.id+"_iframeupload",N.style.cssText=y,N.style.width=a+"px",N.style.height=v+"px",N.appendChild(c),N.parentNode&&(N.parentNode.style.width=a+"px",N.parentNode.style.height=a+"px");var U=C.getElementById("edui_form_"+w),E=C.getElementById("edui_input_"+w),T=C.getElementById("edui_iframe_"+w);domUtils.on(E,"change",function(){function a(){try{var v,b,y,C=(T.contentDocument||T.contentWindow.document).body,N=C.innerText||C.textContent||"";b=new Function("return "+N)(),v=h.options.imageUrlPrefix+b.url,"SUCCESS"==b.state&&b.url?(y=h.document.getElementById(g),y.setAttribute("src",v),y.setAttribute("_src",v),y.setAttribute("title",b.title||""),y.setAttribute("alt",b.original||""),y.removeAttribute("id"),domUtils.removeClasses(y,"loadingclass")):c&&c(b.state)}catch(w){c&&c(h.getLang("simpleupload.loadError"))}U.reset(),domUtils.un(T,"load",a)}function c(a){if(g){var c=h.document.getElementById(g);c&&domUtils.remove(c),h.fireEvent("showmessage",{id:g,content:a,type:"error",timeout:4e3})}}if(E.value){var g="loading_"+(+new Date).toString(36),v=utils.serializeParam(h.queryCommandValue("serverparam"))||"",b=h.getActionUrl(h.getOpt("imageActionName")),y=h.getOpt("imageAllowFiles");if(h.focus(),h.execCommand("inserthtml",'<img class="loadingclass" id="'+g+'" src="'+h.options.themePath+h.options.theme+'/images/spacer.gif" title="'+(h.getLang("simpleupload.loading")||"")+'" >'),!h.getOpt("imageActionName"))return void errorHandler(h.getLang("autoupload.errorLoadConfig"));var C=E.value,N=C?C.substr(C.lastIndexOf(".")):"";if(!N||y&&-1==(y.join("")+".").indexOf(N.toLowerCase()+"."))return void c(h.getLang("simpleupload.exceedTypeError"));domUtils.on(T,"load",a),U.action=utils.formatUrl(b+(-1==b.indexOf("?")?"?":"&")+v),U.submit()}});var S;h.addListener("selectionchange",function(){clearTimeout(S),S=setTimeout(function(){var a=h.queryCommandState("simpleupload");E.disabled=-1==a?"disabled":!1},400)}),g=!0}),b.style.cssText=y,c.appendChild(b)}var c,h=this,g=!1;return{bindEvents:{ready:function(){utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document)},simpleuploadbtnready:function(g,v){c=v,h.afterConfigReady(a)}},outputRule:function(a){utils.each(a.getNodesByTagName("img"),function(n){/\b(loaderrorclass)|(bloaderrorclass)\b/.test(n.getAttr("class"))&&n.parentNode.removeChild(n)})},commands:{simpleupload:{queryCommandState:function(){return g?0:-1}}}}}),UE.plugin.register("serverparam",function(){var a={};return{commands:{serverparam:{execCommand:function(c,h,g){void 0===h||null===h?a={}:utils.isString(h)?void 0===g||null===g?delete a[h]:a[h]=g:utils.isObject(h)?utils.extend(a,h,!0):utils.isFunction(h)&&utils.extend(a,h(),!0)},queryCommandValue:function(){return a||{}}}}}}),UE.plugin.register("insertfile",function(){function a(a){var c=a.substr(a.lastIndexOf(".")+1).toLowerCase(),h={rar:"icon_rar.gif",zip:"icon_rar.gif",tar:"icon_rar.gif",gz:"icon_rar.gif",bz2:"icon_rar.gif",doc:"icon_doc.gif",docx:"icon_doc.gif",pdf:"icon_pdf.gif",mp3:"icon_mp3.gif",xls:"icon_xls.gif",chm:"icon_chm.gif",ppt:"icon_ppt.gif",pptx:"icon_ppt.gif",avi:"icon_mv.gif",rmvb:"icon_mv.gif",wmv:"icon_mv.gif",flv:"icon_mv.gif",swf:"icon_mv.gif",rm:"icon_mv.gif",exe:"icon_exe.gif",psd:"icon_psd.gif",txt:"icon_txt.gif",jpg:"icon_jpg.gif",png:"icon_jpg.gif",jpeg:"icon_jpg.gif",gif:"icon_jpg.gif",ico:"icon_jpg.gif",bmp:"icon_jpg.gif"};return h[c]?h[c]:h.txt}var c=this;return{commands:{insertfile:{execCommand:function(h,g){g=utils.isArray(g)?g:[g];var i,v,b,y,C="",N=c.getOpt("UEDITOR_HOME_URL"),w=N+("/"==N.substr(N.length-1)?"":"/")+"dialogs/attachment/fileTypeImages/";for(i=0;i<g.length;i++)v=g[i],b=w+a(v.url),y=v.title||v.url.substr(v.url.lastIndexOf("/")+1),C+='<p style="line-height: 16px;"><img style="vertical-align: middle; margin-right: 2px;" src="'+b+'" _src="'+b+'" /><a style="font-size:12px; color:#0066cc;" href="'+v.url+'" title="'+y+'">'+y+"</a></p>";c.execCommand("insertHtml",C)}}}}});var baidu=baidu||{};baidu.editor=baidu.editor||{},UE.ui=baidu.editor.ui={},function(){function a(){var a=document.getElementById("edui_fixedlayer");N.setViewportOffset(a,{left:0,top:0})}function c(){g.on(window,"scroll",a),g.on(window,"resize",baidu.editor.utils.defer(a,0,!0))}var h=baidu.editor.browser,g=baidu.editor.dom.domUtils,v="$EDITORUI",b=window[v]={},y="ID"+v,C=0,N=baidu.editor.ui.uiUtils={uid:function(a){return a?a[y]||(a[y]=++C):++C},hook:function(a,c){var h;return a&&a._callbacks?h=a:(h=function(){var q;a&&(q=a.apply(this,arguments));for(var c=h._callbacks,g=c.length;g--;){var r=c[g].apply(this,arguments);void 0===q&&(q=r)}return q},h._callbacks=[]),h._callbacks.push(c),h},createElementByHtml:function(a){var c=document.createElement("div");return c.innerHTML=a,c=c.firstChild,c.parentNode.removeChild(c),c},getViewportElement:function(){return h.ie&&h.quirks?document.body:document.documentElement},getClientRect:function(a){var c;try{c=a.getBoundingClientRect()}catch(e){c={left:0,top:0,height:0,width:0}}for(var h,v={left:Math.round(c.left),top:Math.round(c.top),height:Math.round(c.bottom-c.top),width:Math.round(c.right-c.left)};(h=a.ownerDocument)!==document&&(a=g.getWindow(h).frameElement);)c=a.getBoundingClientRect(),v.left+=c.left,v.top+=c.top;return v.bottom=v.top+v.height,v.right=v.left+v.width,v},getViewportRect:function(){var a=N.getViewportElement(),c=0|(window.innerWidth||a.clientWidth),h=0|(window.innerHeight||a.clientHeight);return{left:0,top:0,height:h,width:c,bottom:h,right:c}},setViewportOffset:function(a,c){var h=N.getFixedLayer();a.parentNode===h?(a.style.left=c.left+"px",a.style.top=c.top+"px"):g.setViewportOffset(a,c)},getEventOffset:function(a){var c=a.target||a.srcElement,h=N.getClientRect(c),g=N.getViewportOffsetByEvent(a);return{left:g.left-h.left,top:g.top-h.top}},getViewportOffsetByEvent:function(a){var c=a.target||a.srcElement,h=g.getWindow(c).frameElement,v={left:a.clientX,top:a.clientY};if(h&&c.ownerDocument!==document){var b=N.getClientRect(h);v.left+=b.left,v.top+=b.top}return v},setGlobal:function(a,c){return b[a]=c,v+'["'+a+'"]'},unsetGlobal:function(a){delete b[a]},copyAttributes:function(a,c){for(var v=c.attributes,b=v.length;b--;){var y=v[b];"style"==y.nodeName||"class"==y.nodeName||h.ie&&!y.specified||a.setAttribute(y.nodeName,y.nodeValue)}c.className&&g.addClass(a,c.className),c.style.cssText&&(a.style.cssText+=";"+c.style.cssText)},removeStyle:function(a,c){if(a.style.removeProperty)a.style.removeProperty(c);else{if(!a.style.removeAttribute)throw"";a.style.removeAttribute(c)}},contains:function(a,c){return a&&c&&(a===c?!1:a.contains?a.contains(c):16&a.compareDocumentPosition(c))},startDrag:function(a,c,h){function g(a){var x=a.clientX-y,h=a.clientY-C;c.ondragmove(x,h,a),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function v(){h.removeEventListener("mousemove",g,!0),h.removeEventListener("mouseup",v,!0),window.removeEventListener("mouseup",v,!0),c.ondragstop()}function b(){N.releaseCapture(),N.detachEvent("onmousemove",g),N.detachEvent("onmouseup",b),N.detachEvent("onlosecaptrue",b),c.ondragstop()}var h=h||document,y=a.clientX,C=a.clientY;if(h.addEventListener)h.addEventListener("mousemove",g,!0),h.addEventListener("mouseup",v,!0),window.addEventListener("mouseup",v,!0),a.preventDefault();else{var N=a.srcElement;N.setCapture(),N.attachEvent("onmousemove",g),N.attachEvent("onmouseup",b),N.attachEvent("onlosecaptrue",b),a.returnValue=!1}c.ondragstart()},getFixedLayer:function(){var g=document.getElementById("edui_fixedlayer");return null==g&&(g=document.createElement("div"),g.id="edui_fixedlayer",document.body.appendChild(g),h.ie&&h.version<=8?(g.style.position="absolute",c(),setTimeout(a)):g.style.position="fixed",g.style.left="0",g.style.top="0",g.style.width="0",g.style.height="0"),g},makeUnselectable:function(a){if(h.opera||h.ie&&h.version<9){if(a.unselectable="on",a.hasChildNodes())for(var i=0;i<a.childNodes.length;i++)1==a.childNodes[i].nodeType&&N.makeUnselectable(a.childNodes[i])}else void 0!==a.style.MozUserSelect?a.style.MozUserSelect="none":void 0!==a.style.WebkitUserSelect?a.style.WebkitUserSelect="none":void 0!==a.style.KhtmlUserSelect&&(a.style.KhtmlUserSelect="none")}}}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.uiUtils,h=baidu.editor.EventBase,g=baidu.editor.ui.UIBase=function(){};g.prototype={className:"",uiName:"",initOptions:function(a){var h=this;for(var g in a)h[g]=a[g];this.id=this.id||"edui"+c.uid()},initUIBase:function(){this._globalKey=a.unhtml(c.setGlobal(this.id,this))},render:function(a){for(var h,g=this.renderHtml(),v=c.createElementByHtml(g),b=domUtils.getElementsByTagName(v,"*"),y="edui-"+(this.theme||this.editor.options.theme),C=document.getElementById("edui_fixedlayer"),i=0;h=b[i++];)domUtils.addClass(h,y);domUtils.addClass(v,y),C&&(C.className="",domUtils.addClass(C,y));var N=this.getDom();null!=N?(N.parentNode.replaceChild(v,N),c.copyAttributes(v,N)):("string"==typeof a&&(a=document.getElementById(a)),a=a||c.getFixedLayer(),domUtils.addClass(a,y),a.appendChild(v)),this.postRender()},getDom:function(a){return document.getElementById(a?this.id+"_"+a:this.id)},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(a){var c="edui-"+this.uiName;return a.replace(/##/g,this.id).replace(/%%-/g,this.uiName?c+"-":"").replace(/%%/g,(this.uiName?c:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var a=this.getDom();a&&baidu.editor.dom.domUtils.remove(a),c.unsetGlobal(this.id)}},a.inherits(g,h)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.UIBase,h=baidu.editor.ui.Separator=function(a){this.initOptions(a),this.initSeparator()};h.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}},a.inherits(h,c)}(),function(){var a=baidu.editor.utils,c=baidu.editor.dom.domUtils,h=baidu.editor.ui.UIBase,g=baidu.editor.ui.uiUtils,v=baidu.editor.ui.Mask=function(a){this.initOptions(a),this.initUIBase()};v.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onclick="return $$._onClick(event, this);" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var a=this;c.on(window,"resize",function(){setTimeout(function(){a.isHidden()||a._fill()})})},show:function(a){this._fill(),this.getDom().style.display="",this.getDom().style.zIndex=a},hide:function(){this.getDom().style.display="none",this.getDom().style.zIndex=""},isHidden:function(){return"none"==this.getDom().style.display},_onMouseDown:function(){return!1},_onClick:function(e,a){this.fireEvent("click",e,a)},_fill:function(){var a=this.getDom(),c=g.getViewportRect();a.style.width=c.width+"px",a.style.height=c.height+"px"}},a.inherits(v,h)}(),function(){function a(a,c){for(var i=0;i<y.length;i++){var h=y[i];if(!h.isHidden()&&h.queryAutoHide(c)!==!1){if(a&&/scroll/gi.test(a.type)&&"edui-wordpastepop"==h.className)return;h.hide()}}y.length&&h.editor.fireEvent("afterhidepop")}var c=baidu.editor.utils,h=baidu.editor.ui.uiUtils,g=baidu.editor.dom.domUtils,v=baidu.editor.ui.UIBase,b=baidu.editor.ui.Popup=function(a){this.initOptions(a),this.initPopup()},y=[];b.postHide=a;var C=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];b.prototype={SHADOW_RADIUS:5,content:null,_hidden:!1,autoRender:!0,canSideLeft:!0,canSideUp:!0,initPopup:function(){this.initUIBase(),y.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%" onmousedown="return false;"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div> </div></div>"},getContentHtmlTpl:function(){return this.content?"string"==typeof this.content?this.content:this.content.renderHtml():""},_UIBase_postRender:v.prototype.postRender,postRender:function(){if(this.content instanceof v&&this.content.postRender(),this.captureWheel&&!this.captured){this.captured=!0;var a=(document.documentElement.clientHeight||document.body.clientHeight)-80,c=this.getDom().offsetHeight,b=h.getClientRect(this.combox.getDom()).top,y=this.getDom("content"),C=this.getDom("body").getElementsByTagName("iframe"),N=this;for(C.length&&(C=C[0]);b+c>a;)c-=30;y.style.height=c+"px",C&&(C.style.height=c+"px"),window.XMLHttpRequest?g.on(y,"onmousewheel"in document.body?"mousewheel":"DOMMouseScroll",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,y.scrollTop-=e.wheelDelta?e.wheelDelta/120*60:e.detail/-3*60}):g.on(this.getDom(),"mousewheel",function(e){e.returnValue=!1,N.getDom("content").scrollTop-=e.wheelDelta/120*60})}this.fireEvent("postRenderAfter"),this.hide(!0),this._UIBase_postRender()},_doAutoRender:function(){!this.getDom()&&this.autoRender&&this.render()},mesureSize:function(){var a=this.getDom("content");return h.getClientRect(a)},fitSize:function(){if(this.captureWheel&&this.sized)return this.__size;this.sized=!0;var a=this.getDom("body");a.style.width="",a.style.height="";var c=this.mesureSize();if(this.captureWheel){a.style.width=-(-20-c.width)+"px";var h=parseInt(this.getDom("content").style.height,10);!window.isNaN(h)&&(c.height=h)}else a.style.width=c.width+"px";return a.style.height=c.height+"px",this.__size=c,this.captureWheel&&(this.getDom("content").style.overflow="auto"),c},showAnchor:function(a,c){this.showAnchorRect(h.getClientRect(a),c)},showAnchorRect:function(a,c){this._doAutoRender();var v=h.getViewportRect();this.getDom().style.visibility="hidden",this._show();var b,y,N,w,U=this.fitSize();c?(b=this.canSideLeft&&a.right+U.width>v.right&&a.left>U.width,y=this.canSideUp&&a.top+U.height>v.bottom&&a.bottom>U.height,N=b?a.left-U.width:a.right,w=y?a.bottom-U.height:a.top):(b=this.canSideLeft&&a.right+U.width>v.right&&a.left>U.width,y=this.canSideUp&&a.top+U.height>v.bottom&&a.bottom>U.height,N=b?a.right-U.width:a.left,w=y?a.top-U.height:a.bottom);var E=this.getDom();h.setViewportOffset(E,{left:N,top:w}),g.removeClasses(E,C),E.className+=" "+C[2*(y?1:0)+(b?1:0)],this.editor&&(E.style.zIndex=1*this.editor.container.style.zIndex+10,baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=E.style.zIndex-1),this.getDom().style.visibility="visible"},showAt:function(a){var c=a.left,h=a.top,g={left:c,top:h,right:c,bottom:h,height:0,width:0};this.showAnchorRect(g,!1,!0)},_show:function(){if(this._hidden){var a=this.getDom();a.style.display="",this._hidden=!1,this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender(),this._show()},hide:function(a){!this._hidden&&this.getDom()&&(this.getDom().style.display="none",this._hidden=!0,a||this.fireEvent("hide"))},queryAutoHide:function(a){return!a||!h.contains(this.getDom(),a)}},c.inherits(b,v),g.on(document,"mousedown",function(c){var h=c.target||c.srcElement;a(c,h)}),g.on(window,"scroll",function(c,h){a(c,h)})}(),function(){function a(a,c){for(var h='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div><div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+a+'</div></div><table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0"><tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+c.getLang("themeColor")+'</td> </tr><tr class="edui-colorpicker-tablefirstrow" >',i=0;i<v.length;i++)i&&i%10===0&&(h+="</tr>"+(60==i?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+c.getLang("standardColor")+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-tablefirstrow"':"")+">"),h+=70>i?'<td style="padding: 0 2px;"><a hidefocus title="'+v[i]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell" data-color="#'+v[i]+'" style="background-color:#'+v[i]+";border:solid #ccc;"+(10>i||i>=60?"border-width:1px;":i>=10&&20>i?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return h+="</tr></table></div>"}var c=baidu.editor.utils,h=baidu.editor.ui.UIBase,g=baidu.editor.ui.ColorPicker=function(a){this.initOptions(a),this.noColorText=this.noColorText||this.editor.getLang("clearColor"),this.initUIBase()};g.prototype={getHtmlTpl:function(){return a(this.noColorText,this.editor)},_onTableClick:function(a){var c=a.target||a.srcElement,h=c.getAttribute("data-color");h&&this.fireEvent("pickcolor",h)},_onTableOver:function(a){var c=a.target||a.srcElement,h=c.getAttribute("data-color");h&&(this.getDom("preview").style.backgroundColor=h)},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}},c.inherits(g,h);var v="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(",")}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.uiUtils,h=baidu.editor.ui.UIBase,g=baidu.editor.ui.TablePicker=function(a){this.initOptions(a),this.initTablePicker()};g.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-tablepicker %%"><div class="edui-tablepicker-body"><div class="edui-infoarea"><span id="##_label" class="edui-label"></span></div><div class="edui-pickarea" onmousemove="$$._onMouseMove(event, this);" onmouseover="$$._onMouseOver(event, this);" onmouseout="$$._onMouseOut(event, this);" onclick="$$._onClick(event, this);"><div id="##_overlay" class="edui-overlay"></div></div></div></div>'},_UIBase_render:h.prototype.render,render:function(a){this._UIBase_render(a),this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(a,c){var h=this.getDom("overlay").style,g=this.lengthOfCellSide;h.width=a*g+"px",h.height=c*g+"px";var v=this.getDom("label");v.innerHTML=a+this.editor.getLang("t_col")+" x "+c+this.editor.getLang("t_row"),this.numCols=a,this.numRows=c},_onMouseOver:function(a,h){var g=a.relatedTarget||a.fromElement;c.contains(h,g)||h===g||(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="")},_onMouseOut:function(a,h){var g=a.relatedTarget||a.toElement;c.contains(h,g)||h===g||(this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row"),this.getDom("overlay").style.visibility="hidden")},_onMouseMove:function(a){var h=(this.getDom("overlay").style,c.getEventOffset(a)),g=this.lengthOfCellSide,v=Math.ceil(h.left/g),b=Math.ceil(h.top/g);this._track(v,b)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}},a.inherits(g,h)}(),function(){var a=baidu.editor.browser,c=baidu.editor.dom.domUtils,h=baidu.editor.ui.uiUtils,g='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(a.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"');baidu.editor.ui.Stateful={alwalysHoverable:!1,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl,this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var a=this._Stateful_dGetHtmlTpl();return a.replace(/stateful/g,function(){return g})},Stateful_onMouseEnter:function(a,c){this.target=c,(!this.isDisabled()||this.alwalysHoverable)&&(this.addState("hover"),this.fireEvent("over"))},Stateful_onMouseLeave:function(){(!this.isDisabled()||this.alwalysHoverable)&&(this.removeState("hover"),this.removeState("active"),this.fireEvent("out"))},Stateful_onMouseOver:function(a,c){var g=a.relatedTarget;h.contains(c,g)||c===g||this.Stateful_onMouseEnter(a,c)},Stateful_onMouseOut:function(a,c){var g=a.relatedTarget;h.contains(c,g)||c===g||this.Stateful_onMouseLeave(a,c)},Stateful_onMouseDown:function(){this.isDisabled()||this.addState("active")},Stateful_onMouseUp:function(){this.isDisabled()||this.removeState("active")},Stateful_postRender:function(){this.disabled&&!this.hasState("disabled")&&this.addState("disabled")},hasState:function(a){return c.hasClass(this.getStateDom(),"edui-state-"+a)},addState:function(a){this.hasState(a)||(this.getStateDom().className+=" edui-state-"+a)},removeState:function(a){this.hasState(a)&&c.removeClasses(this.getStateDom(),["edui-state-"+a])},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(a){!this.isDisabled()&&a?this.addState("checked"):this.removeState("checked")},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(a){a?(this.removeState("hover"),this.removeState("checked"),this.removeState("active"),this.addState("disabled")):this.removeState("disabled")}}}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.UIBase,h=baidu.editor.ui.Stateful,g=baidu.editor.ui.Button=function(a){if(a.name){var c=a.name,h=a.cssRules;a.className||(a.className="edui-for-"+c),a.cssRules=".edui-default  .edui-for-"+c+" .edui-icon {"+h+"}"}this.initOptions(a),this.initButton()};g.prototype={uiName:"button",label:"",title:"",showIcon:!0,showText:!0,cssRules:"",initButton:function(){this.initUIBase(),this.Stateful_init(),this.cssRules&&a.cssRule("edui-customize-"+this.name+"-style",this.cssRules)},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return $$._onMouseDown(event, this);" onclick="return $$._onClick(event, this);">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div></div></div></div>"},postRender:function(){this.Stateful_postRender(),this.setDisabled(this.disabled)},_onMouseDown:function(e){var a=e.target||e.srcElement,c=a&&a.tagName&&a.tagName.toLowerCase();return"input"==c||"object"==c||"object"==c?!1:void 0},_onClick:function(){this.isDisabled()||this.fireEvent("click")},setTitle:function(a){var c=this.getDom("label");c.innerHTML=a}},a.inherits(g,c),a.extend(g.prototype,h)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.uiUtils,h=(baidu.editor.dom.domUtils,baidu.editor.ui.UIBase),g=baidu.editor.ui.Stateful,v=baidu.editor.ui.SplitButton=function(a){this.initOptions(a),this.initSplitButton()};v.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){this.initUIBase(),this.Stateful_init();if(null!=this.popup){var a=this.popup;this.popup=null,this.setPopup(a)}},_UIBase_postRender:h.prototype.postRender,postRender:function(){this.Stateful_postRender(),this._UIBase_postRender()},setPopup:function(h){this.popup!==h&&(null!=this.popup&&this.popup.dispose(),h.addListener("show",a.bind(this._onPopupShow,this)),h.addListener("hide",a.bind(this._onPopupHide,this)),h.addListener("postrender",a.bind(function(){h.getDom("body").appendChild(c.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(c.getClientRect(this.getDom()).width+20)+'px"></div>')),h.getDom().className+=" "+this.className},this)),this.popup=h)},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon"></div></div><div class="edui-box edui-splitborder"></div><div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div></div></div></div>'},showPopup:function(){var a=c.getClientRect(this.getDom());a.top-=this.popup.SHADOW_RADIUS,a.height+=this.popup.SHADOW_RADIUS,this.popup.showAnchorRect(a)},_onArrowClick:function(){this.isDisabled()||this.showPopup()},_onButtonClick:function(){this.isDisabled()||this.fireEvent("buttonclick")}},a.inherits(v,h),a.extend(v.prototype,g,!0)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.uiUtils,h=baidu.editor.ui.ColorPicker,g=baidu.editor.ui.Popup,v=baidu.editor.ui.SplitButton,b=baidu.editor.ui.ColorButton=function(a){this.initOptions(a),this.initColorButton()};b.prototype={initColorButton:function(){var a=this;this.popup=new g({content:new h({noColorText:a.editor.getLang("clearColor"),editor:a.editor,onpickcolor:function(t,c){a._onPickColor(c)},onpicknocolor:function(t,c){a._onPickNoColor(c)}}),editor:a.editor}),this.initSplitButton()},_SplitButton_postRender:v.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.getDom("button_body").appendChild(c.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>')),this.getDom().className+=" edui-colorbutton"},setColor:function(a){this.getDom("colorlump").style.backgroundColor=a,this.color=a},_onPickColor:function(a){this.fireEvent("pickcolor",a)!==!1&&(this.setColor(a),this.popup.hide())},_onPickNoColor:function(){this.fireEvent("picknocolor")!==!1&&this.popup.hide()}},a.inherits(b,v)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.Popup,h=baidu.editor.ui.TablePicker,g=baidu.editor.ui.SplitButton,v=baidu.editor.ui.TableButton=function(a){this.initOptions(a),this.initTableButton()};v.prototype={initTableButton:function(){var a=this;this.popup=new c({content:new h({editor:a.editor,onpicktable:function(t,c,h){a._onPickTable(c,h)}}),editor:a.editor}),this.initSplitButton()},_onPickTable:function(a,c){this.fireEvent("picktable",a,c)!==!1&&this.popup.hide()}},a.inherits(v,g)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.UIBase,h=baidu.editor.ui.AutoTypeSetPicker=function(a){this.initOptions(a),this.initAutoTypeSetPicker()};h.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var a=this.editor,c=a.options.autotypeset,h=a.getLang("autoTypeSet"),g="textAlignValue"+a.uid,v="imageBlockLineValue"+a.uid,b="symbolConverValue"+a.uid;return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td nowrap><input type="checkbox" name="mergeEmptyline" '+(c.mergeEmptyline?"checked":"")+">"+h.mergeLine+'</td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(c.removeEmptyline?"checked":"")+">"+h.delLine+'</td></tr><tr><td nowrap><input type="checkbox" name="removeClass" '+(c.removeClass?"checked":"")+">"+h.removeFormat+'</td><td colspan="2"><input type="checkbox" name="indent" '+(c.indent?"checked":"")+">"+h.indent+'</td></tr><tr><td nowrap><input type="checkbox" name="textAlign" '+(c.textAlign?"checked":"")+">"+h.alignment+'</td><td colspan="2" id="'+g+'"><input type="radio" name="'+g+'" value="left" '+(c.textAlign&&"left"==c.textAlign?"checked":"")+">"+a.getLang("justifyleft")+'<input type="radio" name="'+g+'" value="center" '+(c.textAlign&&"center"==c.textAlign?"checked":"")+">"+a.getLang("justifycenter")+'<input type="radio" name="'+g+'" value="right" '+(c.textAlign&&"right"==c.textAlign?"checked":"")+">"+a.getLang("justifyright")+'</td></tr><tr><td nowrap><input type="checkbox" name="imageBlockLine" '+(c.imageBlockLine?"checked":"")+">"+h.imageFloat+'</td><td nowrap id="'+v+'"><input type="radio" name="'+v+'" value="none" '+(c.imageBlockLine&&"none"==c.imageBlockLine?"checked":"")+">"+a.getLang("default")+'<input type="radio" name="'+v+'" value="left" '+(c.imageBlockLine&&"left"==c.imageBlockLine?"checked":"")+">"+a.getLang("justifyleft")+'<input type="radio" name="'+v+'" value="center" '+(c.imageBlockLine&&"center"==c.imageBlockLine?"checked":"")+">"+a.getLang("justifycenter")+'<input type="radio" name="'+v+'" value="right" '+(c.imageBlockLine&&"right"==c.imageBlockLine?"checked":"")+">"+a.getLang("justifyright")+'</td></tr><tr><td nowrap><input type="checkbox" name="clearFontSize" '+(c.clearFontSize?"checked":"")+">"+h.removeFontsize+'</td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(c.clearFontFamily?"checked":"")+">"+h.removeFontFamily+'</td></tr><tr><td nowrap colspan="3"><input type="checkbox" name="removeEmptyNode" '+(c.removeEmptyNode?"checked":"")+">"+h.removeHtml+'</td></tr><tr><td nowrap colspan="3"><input type="checkbox" name="pasteFilter" '+(c.pasteFilter?"checked":"")+">"+h.pasteFilter+'</td></tr><tr><td nowrap><input type="checkbox" name="symbolConver" '+(c.bdc2sb||c.tobdc?"checked":"")+">"+h.symbol+'</td><td id="'+b+'"><input type="radio" name="bdc" value="bdc2sb" '+(c.bdc2sb?"checked":"")+">"+h.bdc2sb+'<input type="radio" name="bdc" value="tobdc" '+(c.tobdc?"checked":"")+">"+h.tobdc+'</td><td nowrap align="right"><button >'+h.run+"</button></td></tr></table></div></div>"
},_UIBase_render:c.prototype.render},a.inherits(h,c)}(),function(){function a(a){for(var h,g={},v=a.getDom(),b=a.editor.uid,y=null,C=null,N=domUtils.getElementsByTagName(v,"input"),i=N.length-1;h=N[i--];)if(y=h.getAttribute("type"),"checkbox"==y)if(C=h.getAttribute("name"),g[C]&&delete g[C],h.checked){var w=document.getElementById(C+"Value"+b);if(w){if(/input/gi.test(w.tagName))g[C]=w.value;else for(var U,E=w.getElementsByTagName("input"),T=E.length-1;U=E[T--];)if(U.checked){g[C]=U.value;break}}else g[C]=!0}else g[C]=!1;else g[h.getAttribute("value")]=h.checked;for(var S,k=domUtils.getElementsByTagName(v,"select"),i=0;S=k[i++];){var B=S.getAttribute("name");g[B]=g[B]?S.value:""}c.extend(a.editor.options.autotypeset,g),a.editor.setPreferences("autotypeset",g)}var c=baidu.editor.utils,h=baidu.editor.ui.Popup,g=baidu.editor.ui.AutoTypeSetPicker,v=baidu.editor.ui.SplitButton,b=baidu.editor.ui.AutoTypeSetButton=function(a){this.initOptions(a),this.initAutoTypeSetButton()};b.prototype={initAutoTypeSetButton:function(){var c=this;this.popup=new h({content:new g({editor:c.editor}),editor:c.editor,hide:function(){!this._hidden&&this.getDom()&&(a(this),this.getDom().style.display="none",this._hidden=!0,this.fireEvent("hide"))}});var v=0;this.popup.addListener("postRenderAfter",function(){var h=this;if(!v){var g=this.getDom(),b=g.getElementsByTagName("button")[0];b.onclick=function(){a(h),c.editor.execCommand("autotypeset"),h.hide()},domUtils.on(g,"click",function(e){var g=e.target||e.srcElement,v=c.editor.uid;if(g&&"INPUT"==g.tagName){if("imageBlockLine"==g.name||"textAlign"==g.name||"symbolConver"==g.name)for(var b=g.checked,y=document.getElementById(g.name+"Value"+v),C=y.getElementsByTagName("input"),N={imageBlockLine:"none",textAlign:"left",symbolConver:"tobdc"},i=0;i<C.length;i++)b?C[i].value==N[g.name]&&(C[i].checked="checked"):C[i].checked=!1;if(g.name=="imageBlockLineValue"+v||g.name=="textAlignValue"+v||"bdc"==g.name){var w=g.parentNode.previousSibling.getElementsByTagName("input");w&&(w[0].checked=!0)}a(h)}}),v=1}}),this.initSplitButton()}},c.inherits(b,v)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.Popup,h=baidu.editor.ui.Stateful,g=baidu.editor.ui.UIBase,v=baidu.editor.ui.CellAlignPicker=function(a){this.initOptions(a),this.initSelected(),this.initCellAlignPicker()};v.prototype={initSelected:function(){var a={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3};this.selected&&(this.selectedIndex=a.valign[this.selected.valign]*a.count+a.align[this.selected.align])},initCellAlignPicker:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){for(var a=["left","center","right"],c=9,h=null,g=-1,v=[],i=0;c>i;i++)h=this.selectedIndex===i?' class="edui-cellalign-selected" ':"",g=i%3,0===g&&v.push("<tr>"),v.push('<td index="'+i+'" '+h+' stateful><div class="edui-icon edui-'+a[g]+'"></div></td>'),2===g&&v.push("</tr>");return'<div id="##" class="edui-cellalignpicker %%"><div class="edui-cellalignpicker-body"><table onclick="$$._onClick(event);">'+v.join("")+"</table></div></div>"},getStateDom:function(){return this.target},_onClick:function(a){var h=a.target||a.srcElement;/icon/.test(h.className)&&(this.items[h.parentNode.getAttribute("index")].onclick(),c.postHide(a))},_UIBase_render:g.prototype.render},a.inherits(v,g),a.extend(v.prototype,h,!0)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.Stateful,h=baidu.editor.ui.uiUtils,g=baidu.editor.ui.UIBase,v=baidu.editor.ui.PastePicker=function(a){this.initOptions(a),this.initPastePicker()};v.prototype={initPastePicker:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"></div><div class="edui-pastecontainer"><div class="edui-title">'+this.editor.getLang("pasteOpt")+'</div><div class="edui-button"><div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful><div class="edui-richtxticon"></div></div><div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful><div class="edui-tagicon"></div></div><div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful><div class="edui-plaintxticon"></div></div></div></div></div>'},getStateDom:function(){return this.target},format:function(a){this.editor.ui._isTransfer=!0,this.editor.fireEvent("pasteTransfer",a)},_onClick:function(a){var c=domUtils.getNextDomNode(a),g=h.getViewportRect().height,v=h.getClientRect(c);c.style.top=v.top+v.height>g?-v.height-a.offsetHeight+"px":"",/hidden/gi.test(domUtils.getComputedStyle(c,"visibility"))?(c.style.visibility="visible",domUtils.addClass(a,"edui-state-opened")):(c.style.visibility="hidden",domUtils.removeClasses(a,"edui-state-opened"))},_UIBase_render:g.prototype.render},a.inherits(v,g),a.extend(v.prototype,c,!0)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.uiUtils,h=baidu.editor.ui.UIBase,g=baidu.editor.ui.Toolbar=function(a){this.initOptions(a),this.initToolbar()};g.prototype={items:null,initToolbar:function(){this.items=this.items||[],this.initUIBase()},add:function(a,c){void 0===c?this.items.push(a):this.items.splice(c,0,a)},getHtmlTpl:function(){for(var a=[],i=0;i<this.items.length;i++)a[i]=this.items[i].renderHtml();return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+a.join("")+"</div>"},postRender:function(){for(var a=this.getDom(),i=0;i<this.items.length;i++)this.items[i].postRender();c.makeUnselectable(a)},_onMouseDown:function(e){var a=e.target||e.srcElement,c=a&&a.tagName&&a.tagName.toLowerCase();return"input"==c||"object"==c||"object"==c?!1:void 0}},a.inherits(g,h)}(),function(){var a=baidu.editor.utils,c=baidu.editor.dom.domUtils,h=baidu.editor.ui.uiUtils,g=baidu.editor.ui.UIBase,v=baidu.editor.ui.Popup,b=baidu.editor.ui.Stateful,y=baidu.editor.ui.CellAlignPicker,C=baidu.editor.ui.Menu=function(a){this.initOptions(a),this.initMenu()},N={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return!0}};C.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[],this.initPopup(),this.initItems()},initItems:function(){for(var i=0;i<this.items.length;i++){var a=this.items[i];"-"==a?this.items[i]=this.getSeparator():a instanceof w||(a.editor=this.editor,a.theme=this.editor.options.theme,this.items[i]=this.createItem(a))}},getSeparator:function(){return N},createItem:function(a){return a.menu=this,new w(a)},_Popup_getContentHtmlTpl:v.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(0==this.items.length)return this._Popup_getContentHtmlTpl();for(var a=[],i=0;i<this.items.length;i++){var c=this.items[i];a[i]=c.renderHtml()}return'<div class="%%-body">'+a.join("")+"</div>"},_Popup_postRender:v.prototype.postRender,postRender:function(){for(var a=this,i=0;i<this.items.length;i++){var g=this.items[i];g.ownerMenu=this,g.postRender()}c.on(this.getDom(),"mouseover",function(c){c=c||event;var g=c.relatedTarget||c.fromElement,v=a.getDom();h.contains(v,g)||v===g||a.fireEvent("over")}),this._Popup_postRender()},queryAutoHide:function(a){if(a){if(h.contains(this.getDom(),a))return!1;for(var i=0;i<this.items.length;i++){var c=this.items[i];if(c.queryAutoHide(a)===!1)return!1}}},clearItems:function(){for(var i=0;i<this.items.length;i++){var a=this.items[i];clearTimeout(a._showingTimer),clearTimeout(a._closingTimer),a.subMenu&&a.subMenu.destroy()}this.items=[]},destroy:function(){this.getDom()&&c.remove(this.getDom()),this.clearItems()},dispose:function(){this.destroy()}},a.inherits(C,v);var w=baidu.editor.ui.MenuItem=function(a){if(this.initOptions(a),this.initUIBase(),this.Stateful_init(),this.subMenu&&!(this.subMenu instanceof C))if(a.className&&-1!=a.className.indexOf("aligntd")){var h=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment"),this.subMenu=new v({content:new y(this.subMenu),parentMenu:h,editor:h.editor,destroy:function(){this.getDom()&&c.remove(this.getDom())}}),this.subMenu.addListener("postRenderAfter",function(){c.on(this.getDom(),"mouseover",function(){h.addState("opened")})})}else this.subMenu=new C(this.subMenu)};w.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:!0,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"</div></div>"},postRender:function(){var a=this;this.addListener("over",function(){a.ownerMenu.fireEvent("submenuover",a),a.subMenu&&a.delayShowSubMenu()}),this.subMenu&&(this.getDom().className+=" edui-hassubmenu",this.subMenu.render(),this.addListener("out",function(){a.delayHideSubMenu()}),this.subMenu.addListener("over",function(){clearTimeout(a._closingTimer),a._closingTimer=null,a.addState("opened")}),this.ownerMenu.addListener("hide",function(){a.hideSubMenu()}),this.ownerMenu.addListener("submenuover",function(t,c){c!==a&&a.delayHideSubMenu()}),this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide,this.subMenu.queryAutoHide=function(c){return c&&h.contains(a.getDom(),c)?!1:this._bakQueryAutoHide(c)}),this.getDom().style.tabIndex="-1",h.makeUnselectable(this.getDom()),this.Stateful_postRender()},delayShowSubMenu:function(){var a=this;a.isDisabled()||(a.addState("opened"),clearTimeout(a._showingTimer),clearTimeout(a._closingTimer),a._closingTimer=null,a._showingTimer=setTimeout(function(){a.showSubMenu()},250))},delayHideSubMenu:function(){var a=this;a.isDisabled()||(a.removeState("opened"),clearTimeout(a._showingTimer),a._closingTimer||(a._closingTimer=setTimeout(function(){a.hasState("opened")||a.hideSubMenu(),a._closingTimer=null},400)))},renderLabelHtml:function(){return'<div class="edui-arrow"></div><div class="edui-box edui-icon"></div><div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(a){return this.subMenu&&this.hasState("opened")?this.subMenu.queryAutoHide(a):void 0},_onClick:function(a,c){this.hasState("disabled")||this.fireEvent("click",a,c)!==!1&&(this.subMenu?this.showSubMenu():v.postHide(a))},showSubMenu:function(){var a=h.getClientRect(this.getDom());a.right-=5,a.left+=2,a.width-=7,a.top-=4,a.bottom+=4,a.height+=8,this.subMenu.showAnchorRect(a,!0,!0)},hideSubMenu:function(){this.subMenu.hide()}},a.inherits(w,g),a.extend(w.prototype,b,!0)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.uiUtils,h=baidu.editor.ui.Menu,g=baidu.editor.ui.SplitButton,v=baidu.editor.ui.Combox=function(a){this.initOptions(a),this.initCombox()};v.prototype={uiName:"combox",onbuttonclick:function(){this.showPopup()},initCombox:function(){var a=this;this.items=this.items||[];for(var i=0;i<this.items.length;i++){var c=this.items[i];c.uiName="listitem",c.index=i,c.onclick=function(){a.selectByIndex(this.index)}}this.popup=new h({items:this.items,uiName:"list",editor:this.editor,captureWheel:!0,combox:this}),this.initSplitButton()},_SplitButton_postRender:g.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.setLabel(this.label||""),this.setValue(this.initValue||"")},showPopup:function(){var a=c.getClientRect(this.getDom());a.top+=1,a.bottom-=1,a.height-=2,this.popup.showAnchorRect(a)},getValue:function(){return this.value},setValue:function(a){var c=this.indexByValue(a);-1!=c?(this.selectedIndex=c,this.setLabel(this.items[c].label),this.value=this.items[c].value):(this.selectedIndex=-1,this.setLabel(this.getLabelForUnknowValue(a)),this.value=a)},setLabel:function(a){this.getDom("button_body").innerHTML=a,this.label=a},getLabelForUnknowValue:function(a){return a},indexByValue:function(a){for(var i=0;i<this.items.length;i++)if(a==this.items[i].value)return i;return-1},getItem:function(a){return this.items[a]},selectByIndex:function(a){a<this.items.length&&this.fireEvent("select",a)!==!1&&(this.selectedIndex=a,this.value=this.items[a].value,this.setLabel(this.items[a].label))}},a.inherits(v,g)}(),function(){var a,c,h,g=baidu.editor.utils,v=baidu.editor.dom.domUtils,b=baidu.editor.ui.uiUtils,y=baidu.editor.ui.Mask,C=baidu.editor.ui.UIBase,N=baidu.editor.ui.Button,w=baidu.editor.ui.Dialog=function(a){if(a.name){var c=a.name,h=a.cssRules;a.className||(a.className="edui-for-"+c),h&&(a.cssRules=".edui-default .edui-for-"+c+" .edui-dialog-content  {"+h+"}")}this.initOptions(g.extend({autoReset:!0,draggable:!0,onok:function(){},oncancel:function(){},onclose:function(t,a){return a?this.onok():this.oncancel()},holdScroll:!1},a)),this.initDialog()};w.prototype={draggable:!1,uiName:"dialog",initDialog:function(){var v=this,b=this.editor.options.theme;if(this.cssRules&&g.cssRule("edui-customize-"+this.name+"-style",this.cssRules),this.initUIBase(),this.modalMask=a||(a=new y({className:"edui-dialog-modalmask",theme:b,onclick:function(){h&&h.close(!1)}})),this.dragMask=c||(c=new y({className:"edui-dialog-dragmask",theme:b})),this.closeButton=new N({className:"edui-dialog-closebutton",title:v.closeDialog,theme:b,onclick:function(){v.close(!1)}}),this.fullscreen&&this.initResizeEvent(),this.buttons)for(var i=0;i<this.buttons.length;i++)this.buttons[i]instanceof N||(this.buttons[i]=new N(g.extend(this.buttons[i],{editor:this.editor},!0)))},initResizeEvent:function(){var a=this;v.on(window,"resize",function(){a._hidden||void 0===a._hidden||(a.__resizeTimer&&window.clearTimeout(a.__resizeTimer),a.__resizeTimer=window.setTimeout(function(){a.__resizeTimer=null;var c=a.getDom(),h=a.getDom("content"),g=UE.ui.uiUtils.getClientRect(c),v=UE.ui.uiUtils.getClientRect(h),y=b.getViewportRect();h.style.width=y.width-g.width+v.width+"px",h.style.height=y.height-g.height+v.height+"px",c.style.width=y.width+"px",c.style.height=y.height+"px",a.fireEvent("resize")},100))})},fitSize:function(){var a=this.getDom("body"),c=this.mesureSize();return a.style.width=c.width+"px",a.style.height=c.height+"px",c},safeSetOffset:function(a){var c=this,h=c.getDom(),g=b.getViewportRect(),v=b.getClientRect(h),y=a.left;y+v.width>g.right&&(y=g.right-v.width);var C=a.top;C+v.height>g.bottom&&(C=g.bottom-v.height),h.style.left=Math.max(y,0)+"px",h.style.top=Math.max(C,0)+"px"},showAtCenter:function(){var a=b.getViewportRect();if(this.fullscreen){var c=this.getDom(),h=this.getDom("content");c.style.display="block";var g=UE.ui.uiUtils.getClientRect(c),y=UE.ui.uiUtils.getClientRect(h);c.style.left="-100000px",h.style.width=a.width-g.width+y.width+"px",h.style.height=a.height-g.height+y.height+"px",c.style.width=a.width+"px",c.style.height=a.height+"px",c.style.left=0,this._originalContext={html:{overflowX:document.documentElement.style.overflowX,overflowY:document.documentElement.style.overflowY},body:{overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY}},document.documentElement.style.overflowX="hidden",document.documentElement.style.overflowY="hidden",document.body.style.overflowX="hidden",document.body.style.overflowY="hidden"}else{this.getDom().style.display="";var C=this.fitSize(),N=0|this.getDom("titlebar").offsetHeight,w=a.width/2-C.width/2,U=a.height/2-(C.height-N)/2-N,E=this.getDom();this.safeSetOffset({left:Math.max(0|w,0),top:Math.max(0|U,0)}),v.hasClass(E,"edui-state-centered")||(E.className+=" edui-state-centered")}this._show()},getContentHtml:function(){var a="";return"string"==typeof this.content?a=this.content:this.iframeUrl&&(a='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'),a},getHtmlTpl:function(){var a="";if(this.buttons){for(var c=[],i=0;i<this.buttons.length;i++)c[i]=this.buttons[i].renderHtml();a='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+c.join("")+"</div></div>"}return'<div id="##" class="%%"><div '+(this.fullscreen?'class="%%-wrap edui-dialog-fullscreen-flag"':'class="%%"')+'><div id="##_body" class="%%-body"><div class="%%-shadow"></div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"</span></div>"+this.closeButton.renderHtml()+'</div><div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+a+"</div></div></div>"},postRender:function(){this.modalMask.getDom()||(this.modalMask.render(),this.modalMask.hide()),this.dragMask.getDom()||(this.dragMask.render(),this.dragMask.hide());var a=this;if(this.addListener("show",function(){a.modalMask.show(this.getDom().style.zIndex-2)}),this.addListener("hide",function(){a.modalMask.hide()}),this.buttons)for(var i=0;i<this.buttons.length;i++)this.buttons[i].postRender();v.on(window,"resize",function(){setTimeout(function(){a.isHidden()||a.safeSetOffset(b.getClientRect(a.getDom()))})}),this._hide()},mesureSize:function(){var a=this.getDom("body"),c=b.getClientRect(this.getDom("content")).width,h=a.style;return h.width=c,b.getClientRect(a)},_onTitlebarMouseDown:function(a){if(this.draggable){var c,h=(b.getViewportRect(),this);b.startDrag(a,{ondragstart:function(){c=b.getClientRect(h.getDom()),h.getDom("contmask").style.visibility="visible",h.dragMask.show(h.getDom().style.zIndex-1)},ondragmove:function(x,a){var g=c.left+x,v=c.top+a;h.safeSetOffset({left:g,top:v})},ondragstop:function(){h.getDom("contmask").style.visibility="hidden",v.removeClasses(h.getDom(),["edui-state-centered"]),h.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml(),this.fireEvent("dialogafterreset")},_show:function(){this._hidden&&(this.getDom().style.display="",this.editor.container.style.zIndex&&(this.getDom().style.zIndex=1*this.editor.container.style.zIndex+10),this._hidden=!1,this.fireEvent("show"),baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4)},isHidden:function(){return this._hidden},_hide:function(){if(!this._hidden){var a=this.getDom();a.style.display="none",a.style.zIndex="",a.style.width="",a.style.height="",this._hidden=!0,this.fireEvent("hide")}},open:function(){if(this.autoReset)try{this.reset()}catch(e){this.render(),this.open()}if(this.showAtCenter(),this.iframeUrl)try{this.getDom("iframe").focus()}catch(ex){}h=this},_onCloseButtonClick:function(){this.close(!1)},close:function(a){if(this.fireEvent("close",a)!==!1){this.fullscreen&&(document.documentElement.style.overflowX=this._originalContext.html.overflowX,document.documentElement.style.overflowY=this._originalContext.html.overflowY,document.body.style.overflowX=this._originalContext.body.overflowX,document.body.style.overflowY=this._originalContext.body.overflowY,delete this._originalContext),this._hide();var c=this.getDom("content"),h=this.getDom("iframe");if(c&&h){var g=h.contentDocument||h.contentWindow.document;g&&(g.body.innerHTML=""),v.remove(c)}}}},g.inherits(w,C)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.Menu,h=baidu.editor.ui.SplitButton,g=baidu.editor.ui.MenuButton=function(a){this.initOptions(a),this.initMenuButton()};g.prototype={initMenuButton:function(){var a=this;this.uiName="menubutton",this.popup=new c({items:a.items,className:a.className,editor:a.editor}),this.popup.addListener("show",function(){for(var c=this,i=0;i<c.items.length;i++)c.items[i].removeState("checked"),c.items[i].value==a._value&&(c.items[i].addState("checked"),this.value=a._value)}),this.initSplitButton()},setValue:function(a){this._value=a}},a.inherits(g,h)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.Popup,h=baidu.editor.ui.SplitButton,g=baidu.editor.ui.MultiMenuPop=function(a){this.initOptions(a),this.initMultiMenu()};g.prototype={initMultiMenu:function(){var a=this;this.popup=new c({content:"",editor:a.editor,iframe_rendered:!1,onshow:function(){this.iframe_rendered||(this.iframe_rendered=!0,this.getDom("content").innerHTML='<iframe id="'+a.id+'_iframe" src="'+a.iframeUrl+'" frameborder="0"></iframe>',a.editor.container.style.zIndex&&(this.getDom().style.zIndex=1*a.editor.container.style.zIndex+1))}}),this.onbuttonclick=function(){this.showPopup()},this.initSplitButton()}},a.inherits(g,h)}(),function(){function a(e){var a=e.target||e.srcElement,c=y.findParent(a,function(a){return y.hasClass(a,"edui-shortcutmenu")||y.hasClass(a,"edui-popup")},!0);if(!c)for(var h,i=0;h=C[i++];)h.hide()}var c,h=baidu.editor.ui,g=h.UIBase,v=h.uiUtils,b=baidu.editor.utils,y=baidu.editor.dom.domUtils,C=[],N=!1,w=h.ShortCutMenu=function(a){this.initOptions(a),this.initShortCutMenu()};w.postHide=a,w.prototype={isHidden:!0,SPACE:5,initShortCutMenu:function(){this.items=this.items||[],this.initUIBase(),this.initItems(),this.initEvent(),C.push(this)},initEvent:function(){var a=this,h=a.editor.document;y.on(h,"mousemove",function(e){if(a.isHidden===!1){if(a.getSubMenuMark()||"contextmenu"==a.eventType)return;var h=!0,g=a.getDom(),v=g.offsetWidth,b=g.offsetHeight,y=v/2+a.SPACE,C=b/2,x=Math.abs(e.screenX-a.left),N=Math.abs(e.screenY-a.top);clearTimeout(c),c=setTimeout(function(){N>0&&C>N?a.setOpacity(g,"1"):N>C&&C+70>N?(a.setOpacity(g,"0.5"),h=!1):N>C+70&&C+140>N&&a.hide(),h&&x>0&&y>x?a.setOpacity(g,"1"):x>y&&y+70>x?a.setOpacity(g,"0.5"):x>y+70&&y+140>x&&a.hide()})}}),browser.chrome&&y.on(h,"mouseout",function(e){var c=e.relatedTarget||e.toElement;(null==c||"HTML"==c.tagName)&&a.hide()}),a.editor.addListener("afterhidepop",function(){a.isHidden||(N=!0)})},initItems:function(){if(b.isArray(this.items))for(var i=0,a=this.items.length;a>i;i++){var c=this.items[i].toLowerCase();h[c]&&(this.items[i]=new h[c](this.editor),this.items[i].className+=" edui-shortcutsubmenu ")}},setOpacity:function(a,c){browser.ie&&browser.version<9?a.style.filter="alpha(opacity = "+100*parseFloat(c)+");":a.style.opacity=c},getSubMenuMark:function(){N=!1;for(var a,c=v.getFixedLayer(),h=y.getElementsByTagName(c,"div",function(a){return y.hasClass(a,"edui-shortcutsubmenu edui-popup")}),i=0;a=h[i++];)"none"!=a.style.display&&(N=!0);return N},show:function(e,a){function c(a){a.left<0&&(a.left=0),a.top<0&&(a.top=0),C.style.cssText="position:absolute;left:"+a.left+"px;top:"+a.top+"px;"}function h(a){a.tagName||(a=a.getDom()),b.left=parseInt(a.style.left),b.top=parseInt(a.style.top),b.top-=C.offsetHeight+15,c(b)}var g=this,b={},C=this.getDom(),N=v.getFixedLayer();if(g.eventType=e.type,C.style.cssText="display:block;left:-9999px","contextmenu"==e.type&&a){var w=y.getElementsByTagName(N,"div","edui-contextmenu")[0];w?h(w):g.editor.addListener("aftershowcontextmenu",function(a,c){h(c)})}else b=v.getViewportOffsetByEvent(e),b.top-=C.offsetHeight+g.SPACE,b.left+=g.SPACE+20,c(b),g.setOpacity(C,.2);g.isHidden=!1,g.left=e.screenX+C.offsetWidth/2-g.SPACE,g.top=e.screenY-C.offsetHeight/2-g.SPACE,g.editor&&(C.style.zIndex=1*g.editor.container.style.zIndex+10,N.style.zIndex=C.style.zIndex-1)},hide:function(){this.getDom()&&(this.getDom().style.display="none"),this.isHidden=!0},postRender:function(){if(b.isArray(this.items))for(var a,i=0;a=this.items[i++];)a.postRender()},getHtmlTpl:function(){var a;if(b.isArray(this.items)){a=[];for(var i=0;i<this.items.length;i++)a[i]=this.items[i].renderHtml();a=a.join("")}else a=this.items;return'<div id="##" class="%% edui-toolbar" data-src="shortcutmenu" onmousedown="return false;" onselectstart="return false;" >'+a+"</div>"}},b.inherits(w,g),y.on(document,"mousedown",function(e){a(e)}),y.on(window,"scroll",function(e){a(e)})}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui.UIBase,h=baidu.editor.ui.Breakline=function(a){this.initOptions(a),this.initSeparator()};h.prototype={uiName:"Breakline",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return"<br/>"}},a.inherits(h,c)}(),function(){var a=baidu.editor.utils,c=baidu.editor.dom.domUtils,h=baidu.editor.ui.UIBase,g=baidu.editor.ui.Message=function(a){this.initOptions(a),this.initMessage()};g.prototype={initMessage:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-message %%"> <div id="##_closer" class="edui-message-closer">×</div> <div id="##_body" class="edui-message-body edui-message-type-info"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-message-content">  </div> </div></div>'},reset:function(a){var c=this;a.keepshow||(clearTimeout(this.timer),c.timer=setTimeout(function(){c.hide()},a.timeout||4e3)),void 0!==a.content&&c.setContent(a.content),void 0!==a.type&&c.setType(a.type),c.show()},postRender:function(){var a=this,h=this.getDom("closer");h&&c.on(h,"click",function(){a.hide()})},setContent:function(a){this.getDom("content").innerHTML=a},setType:function(a){a=a||"info";var c=this.getDom("body");c.className=c.className.replace(/edui-message-type-[\w-]+/,"edui-message-type-"+a)},getContent:function(){return this.getDom("content").innerHTML},getType:function(){var a=this.getDom("body").match(/edui-message-type-([\w-]+)/);return a?a[1]:""},show:function(){this.getDom().style.display="block"},hide:function(){var a=this.getDom();a&&(a.style.display="none",a.parentNode&&a.parentNode.removeChild(a))}},a.inherits(g,h)}(),function(){var a=baidu.editor.utils,c=baidu.editor.ui,h=c.Dialog;c.buttons={},c.Dialog=function(a){var c=new h(a);return c.addListener("hide",function(){if(c.editor){var a=c.editor;try{if(browser.gecko){var h=a.window.scrollY,x=a.window.scrollX;a.body.focus(),a.window.scrollTo(x,h)}else a.focus()}catch(ex){}}}),c};for(var g,v={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",preview:"~/dialogs/preview/preview.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html",charts:"~/dialogs/charts/charts.html"},b=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable","drafts"],i=0;g=b[i++];)g=g.toLowerCase(),c[g]=function(a){return function(h){var ui=new c.Button({className:"edui-for-"+a,title:h.options.labelMap[a]||h.getLang("labelMap."+a)||"",onclick:function(){h.execCommand(a)},theme:h.options.theme,showText:!1});return c.buttons[a]=ui,h.addListener("selectionchange",function(c,g,v){var b=h.queryCommandState(a);-1==b?(ui.setDisabled(!0),ui.setChecked(!1)):v||(ui.setDisabled(!1),ui.setChecked(b))}),ui}}(g);c.cleardoc=function(a){var ui=new c.Button({className:"edui-for-cleardoc",title:a.options.labelMap.cleardoc||a.getLang("labelMap.cleardoc")||"",theme:a.options.theme,onclick:function(){confirm(a.getLang("confirmClear"))&&a.execCommand("cleardoc")}});return c.buttons.cleardoc=ui,a.addListener("selectionchange",function(){ui.setDisabled(-1==a.queryCommandState("cleardoc"))}),ui};var y={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var p in y)!function(a,h){for(var g,i=0;g=h[i++];)!function(h){c[a.replace("float","")+h]=function(g){var ui=new c.Button({className:"edui-for-"+a.replace("float","")+h,title:g.options.labelMap[a.replace("float","")+h]||g.getLang("labelMap."+a.replace("float","")+h)||"",theme:g.options.theme,onclick:function(){g.execCommand(a,h)}});return c.buttons[a]=ui,g.addListener("selectionchange",function(c,v,b){ui.setDisabled(-1==g.queryCommandState(a)),ui.setChecked(g.queryCommandValue(a)==h&&!b)}),ui}}(g)}(p,y[p]);for(var g,i=0;g=["backcolor","forecolor"][i++];)c[g]=function(a){return function(h){var ui=new c.ColorButton({className:"edui-for-"+a,color:"default",title:h.options.labelMap[a]||h.getLang("labelMap."+a)||"",editor:h,onpickcolor:function(t,c){h.execCommand(a,c)},onpicknocolor:function(){h.execCommand(a,"default"),this.setColor("transparent"),this.color="default"},onbuttonclick:function(){h.execCommand(a,this.color)}});return c.buttons[a]=ui,h.addListener("selectionchange",function(){ui.setDisabled(-1==h.queryCommandState(a))}),ui}}(g);var C={noOk:["searchreplace","help","spechars","webapp","preview"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","insertframe","edittip","edittable","edittd","scrawl","template","music","background","charts"]};for(var p in C)!function(h,g){for(var b,i=0;b=g[i++];)browser.opera&&"searchreplace"===b||!function(g){c[g]=function(b,y,C){y=y||(b.options.iframeUrlMap||{})[g]||v[g],C=b.options.labelMap[g]||b.getLang("labelMap."+g)||"";var N;y&&(N=new c.Dialog(a.extend({iframeUrl:b.ui.mapUrl(y),editor:b,className:"edui-for-"+g,title:C,holdScroll:"insertimage"===g,fullscreen:/charts|preview/.test(g),closeDialog:b.getLang("closeDialog")},"ok"==h?{buttons:[{className:"edui-okbutton",label:b.getLang("ok"),editor:b,onclick:function(){N.close(!0)}},{className:"edui-cancelbutton",label:b.getLang("cancel"),editor:b,onclick:function(){N.close(!1)}}]}:{})),b.ui._dialogs[g+"Dialog"]=N);var ui=new c.Button({className:"edui-for-"+g,title:C,onclick:function(){if(N)switch(g){case"wordimage":var a=b.execCommand("wordimage");a&&a.length&&(N.render(),N.open());break;case"scrawl":-1!=b.queryCommandState("scrawl")&&(N.render(),N.open());break;default:N.render(),N.open()}},theme:b.options.theme,disabled:"scrawl"==g&&-1==b.queryCommandState("scrawl")||"charts"==g});return c.buttons[g]=ui,b.addListener("selectionchange",function(){var a={edittable:1};if(!(g in a)){var c=b.queryCommandState(g);ui.getDom()&&(ui.setDisabled(-1==c),ui.setChecked(c))}}),ui}}(b.toLowerCase())}(p,C[p]);c.snapscreen=function(a,h,g){g=a.options.labelMap.snapscreen||a.getLang("labelMap.snapscreen")||"";var ui=new c.Button({className:"edui-for-snapscreen",title:g,onclick:function(){a.execCommand("snapscreen")},theme:a.options.theme});if(c.buttons.snapscreen=ui,h=h||(a.options.iframeUrlMap||{}).snapscreen||v.snapscreen){var b=new c.Dialog({iframeUrl:a.ui.mapUrl(h),editor:a,className:"edui-for-snapscreen",title:g,buttons:[{className:"edui-okbutton",label:a.getLang("ok"),editor:a,onclick:function(){b.close(!0)}},{className:"edui-cancelbutton",label:a.getLang("cancel"),editor:a,onclick:function(){b.close(!1)}}]});b.render(),a.ui._dialogs.snapscreenDialog=b}return a.addListener("selectionchange",function(){ui.setDisabled(-1==a.queryCommandState("snapscreen"))}),ui},c.insertcode=function(h,g,v){g=h.options.insertcode||[],v=h.options.labelMap.insertcode||h.getLang("labelMap.insertcode")||"";var b=[];a.each(g,function(a,c){b.push({label:a,value:c,theme:h.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"</div>"}})});var ui=new c.Combox({editor:h,items:b,onselect:function(t,a){h.execCommand("insertcode",this.items[a].value)},onbuttonclick:function(){this.showPopup()},title:v,initValue:v,className:"edui-for-insertcode",indexByValue:function(a){if(a)for(var c,i=0;c=this.items[i];i++)if(-1!=c.value.indexOf(a))return i;return-1}});return c.buttons.insertcode=ui,h.addListener("selectionchange",function(a,c,g){if(!g){var b=h.queryCommandState("insertcode");
if(-1==b)ui.setDisabled(!0);else{ui.setDisabled(!1);var y=h.queryCommandValue("insertcode");if(!y)return void ui.setValue(v);y&&(y=y.replace(/['"]/g,"").split(",")[0]),ui.setValue(y)}}}),ui},c.fontfamily=function(h,g,v){if(g=h.options.fontfamily||[],v=h.options.labelMap.fontfamily||h.getLang("labelMap.fontfamily")||"",g.length){for(var b,i=0,y=[];b=g[i];i++){var C=h.getLang("fontfamily")[b.name]||"";!function(c,g){y.push({label:c,value:g,theme:h.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+a.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})}(b.label||C,b.val)}var ui=new c.Combox({editor:h,items:y,onselect:function(t,a){h.execCommand("FontFamily",this.items[a].value)},onbuttonclick:function(){this.showPopup()},title:v,initValue:v,className:"edui-for-fontfamily",indexByValue:function(a){if(a)for(var c,i=0;c=this.items[i];i++)if(-1!=c.value.indexOf(a))return i;return-1}});return c.buttons.fontfamily=ui,h.addListener("selectionchange",function(a,c,g){if(!g){var v=h.queryCommandState("FontFamily");if(-1==v)ui.setDisabled(!0);else{ui.setDisabled(!1);var b=h.queryCommandValue("FontFamily");b&&(b=b.replace(/['"]/g,"").split(",")[0]),ui.setValue(b)}}}),ui}},c.fontsize=function(a,h,g){if(g=a.options.labelMap.fontsize||a.getLang("labelMap.fontsize")||"",h=h||a.options.fontsize||[],h.length){for(var v=[],i=0;i<h.length;i++){var b=h[i]+"px";v.push({label:b,value:b,theme:a.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var ui=new c.Combox({editor:a,items:v,title:g,initValue:g,onselect:function(t,c){a.execCommand("FontSize",this.items[c].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});return c.buttons.fontsize=ui,a.addListener("selectionchange",function(c,h,g){if(!g){var v=a.queryCommandState("FontSize");-1==v?ui.setDisabled(!0):(ui.setDisabled(!1),ui.setValue(a.queryCommandValue("FontSize")))}}),ui}},c.paragraph=function(h,g,v){if(v=h.options.labelMap.paragraph||h.getLang("labelMap.paragraph")||"",g=h.options.paragraph||[],!a.isEmptyObject(g)){var b=[];for(var i in g)b.push({value:i,label:g[i]||h.getLang("paragraph")[i],theme:h.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}});var ui=new c.Combox({editor:h,items:b,title:v,initValue:v,className:"edui-for-paragraph",onselect:function(t,a){h.execCommand("Paragraph",this.items[a].value)},onbuttonclick:function(){this.showPopup()}});return c.buttons.paragraph=ui,h.addListener("selectionchange",function(a,c,g){if(!g){var v=h.queryCommandState("Paragraph");if(-1==v)ui.setDisabled(!0);else{ui.setDisabled(!1);var b=h.queryCommandValue("Paragraph"),y=ui.indexByValue(b);ui.setValue(-1!=y?b:ui.initValue)}}}),ui}},c.customstyle=function(a){var h=a.options.customstyle||[],g=a.options.labelMap.customstyle||a.getLang("labelMap.customstyle")||"";if(h.length){for(var t,v=a.getLang("customstyle"),i=0,b=[];t=h[i++];)!function(t){var c={};c.label=t.label?t.label:v[t.name],c.style=t.style,c.className=t.className,c.tag=t.tag,b.push({label:c.label,value:c,theme:a.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><'+c.tag+" "+(c.className?' class="'+c.className+'"':"")+(c.style?' style="'+c.style+'"':"")+">"+c.label+"</"+c.tag+"></div>"}})}(t);var ui=new c.Combox({editor:a,items:b,title:g,initValue:g,className:"edui-for-customstyle",onselect:function(t,c){a.execCommand("customstyle",this.items[c].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(a){for(var c,i=0;c=this.items[i++];)if(c.label==a)return i-1;return-1}});return c.buttons.customstyle=ui,a.addListener("selectionchange",function(c,h,g){if(!g){var v=a.queryCommandState("customstyle");if(-1==v)ui.setDisabled(!0);else{ui.setDisabled(!1);var b=a.queryCommandValue("customstyle"),y=ui.indexByValue(b);ui.setValue(-1!=y?b:ui.initValue)}}}),ui}},c.inserttable=function(a,h,g){g=a.options.labelMap.inserttable||a.getLang("labelMap.inserttable")||"";var ui=new c.TableButton({editor:a,title:g,className:"edui-for-inserttable",onpicktable:function(t,c,h){a.execCommand("InsertTable",{numRows:h,numCols:c,border:1})},onbuttonclick:function(){this.showPopup()}});return c.buttons.inserttable=ui,a.addListener("selectionchange",function(){ui.setDisabled(-1==a.queryCommandState("inserttable"))}),ui},c.lineheight=function(a){var h=a.options.lineheight||[];if(h.length){for(var g,i=0,v=[];g=h[i++];)v.push({label:g,value:g,theme:a.options.theme,onclick:function(){a.execCommand("lineheight",this.value)}});var ui=new c.MenuButton({editor:a,className:"edui-for-lineheight",title:a.options.labelMap.lineheight||a.getLang("labelMap.lineheight")||"",items:v,onbuttonclick:function(){var c=a.queryCommandValue("LineHeight")||this.value;a.execCommand("LineHeight",c)}});return c.buttons.lineheight=ui,a.addListener("selectionchange",function(){var c=a.queryCommandState("LineHeight");if(-1==c)ui.setDisabled(!0);else{ui.setDisabled(!1);var h=a.queryCommandValue("LineHeight");h&&ui.setValue((h+"").replace(/cm/,"")),ui.setChecked(c)}}),ui}};for(var N,w=["top","bottom"],r=0;N=w[r++];)!function(a){c["rowspacing"+a]=function(h){var g=h.options["rowspacing"+a]||[];if(!g.length)return null;for(var v,i=0,b=[];v=g[i++];)b.push({label:v,value:v,theme:h.options.theme,onclick:function(){h.execCommand("rowspacing",this.value,a)}});var ui=new c.MenuButton({editor:h,className:"edui-for-rowspacing"+a,title:h.options.labelMap["rowspacing"+a]||h.getLang("labelMap.rowspacing"+a)||"",items:b,onbuttonclick:function(){var c=h.queryCommandValue("rowspacing",a)||this.value;h.execCommand("rowspacing",c,a)}});return c.buttons[a]=ui,h.addListener("selectionchange",function(){var c=h.queryCommandState("rowspacing",a);if(-1==c)ui.setDisabled(!0);else{ui.setDisabled(!1);var g=h.queryCommandValue("rowspacing",a);g&&ui.setValue((g+"").replace(/%/,"")),ui.setChecked(c)}}),ui}}(N);for(var U,E=["insertorderedlist","insertunorderedlist"],l=0;U=E[l++];)!function(a){c[a]=function(h){var g=h.options[a],v=function(){h.execCommand(a,this.value)},b=[];for(var i in g)b.push({label:g[i]||h.getLang()[a][i]||"",value:i,theme:h.options.theme,onclick:v});var ui=new c.MenuButton({editor:h,className:"edui-for-"+a,title:h.getLang("labelMap."+a)||"",items:b,onbuttonclick:function(){var c=h.queryCommandValue(a)||this.value;h.execCommand(a,c)}});return c.buttons[a]=ui,h.addListener("selectionchange",function(){var c=h.queryCommandState(a);if(-1==c)ui.setDisabled(!0);else{ui.setDisabled(!1);var g=h.queryCommandValue(a);ui.setValue(g),ui.setChecked(c)}}),ui}}(U);c.fullscreen=function(a,h){h=a.options.labelMap.fullscreen||a.getLang("labelMap.fullscreen")||"";var ui=new c.Button({className:"edui-for-fullscreen",title:h,theme:a.options.theme,onclick:function(){a.ui&&a.ui.setFullScreen(!a.ui.isFullScreen()),this.setChecked(a.ui.isFullScreen())}});return c.buttons.fullscreen=ui,a.addListener("selectionchange",function(){var c=a.queryCommandState("fullscreen");ui.setDisabled(-1==c),ui.setChecked(a.ui.isFullScreen())}),ui},c.emotion=function(a,h){var g="emotion",ui=new c.MultiMenuPop({title:a.options.labelMap[g]||a.getLang("labelMap."+g)||"",editor:a,className:"edui-for-"+g,iframeUrl:a.ui.mapUrl(h||(a.options.iframeUrlMap||{})[g]||v[g])});return c.buttons[g]=ui,a.addListener("selectionchange",function(){ui.setDisabled(-1==a.queryCommandState(g))}),ui},c.autotypeset=function(a){var ui=new c.AutoTypeSetButton({editor:a,title:a.options.labelMap.autotypeset||a.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){a.execCommand("autotypeset")}});return c.buttons.autotypeset=ui,a.addListener("selectionchange",function(){ui.setDisabled(-1==a.queryCommandState("autotypeset"))}),ui},c.simpleupload=function(a){var h="simpleupload",ui=new c.Button({className:"edui-for-"+h,title:a.options.labelMap[h]||a.getLang("labelMap."+h)||"",onclick:function(){},theme:a.options.theme,showText:!1});return c.buttons[h]=ui,a.addListener("ready",function(){var c=ui.getDom("body"),h=c.children[0];a.fireEvent("simpleuploadbtnready",h)}),a.addListener("selectionchange",function(c,g,v){var b=a.queryCommandState(h);-1==b?(ui.setDisabled(!0),ui.setChecked(!1)):v||(ui.setDisabled(!1),ui.setChecked(b))}),ui}}(),function(){function a(a){this.initOptions(a),this.initEditorUI()}var c=baidu.editor.utils,h=baidu.editor.ui.uiUtils,g=baidu.editor.ui.UIBase,v=baidu.editor.dom.domUtils,b=[];a.prototype={uiName:"editor",initEditorUI:function(){function a(a,ui){a.setOpt({wordCount:!0,maximumWords:1e4,wordCountMsg:a.options.wordCountMsg||a.getLang("wordCountMsg"),wordOverFlowMsg:a.options.wordOverFlowMsg||a.getLang("wordOverFlowMsg")});var c=a.options,h=c.maximumWords,g=c.wordCountMsg,v=c.wordOverFlowMsg,b=ui.getDom("wordcount");if(c.wordCount){var y=a.getContentLength(!0);y>h?(b.innerHTML=v,a.fireEvent("wordcountoverflow")):b.innerHTML=g.replace("{#leave}",h-y).replace("{#count}",y)}}this.editor.ui=this,this._dialogs={},this.initUIBase(),this._initToolbars();var c=this.editor,h=this;c.addListener("ready",function(){function g(){a(c,h),v.un(c.document,"click",arguments.callee)}c.getDialog=function(a){return c.ui._dialogs[a+"Dialog"]},v.on(c.window,"scroll",function(a){baidu.editor.ui.Popup.postHide(a)}),c.ui._actualFrameWidth=c.options.initialFrameWidth,UE.browser.ie&&6===UE.browser.version&&c.container.ownerDocument.execCommand("BackgroundImageCache",!1,!0),c.options.elementPathEnabled&&(c.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+c.getLang("elementPathTip")+":</div>"),c.options.wordCount&&(v.on(c.document,"click",g),c.ui.getDom("wordcount").innerHTML=c.getLang("wordCountTip")),c.ui._scale(),c.options.scaleEnabled?(c.autoHeightEnabled&&c.disableAutoHeight(),h.enableScale()):h.disableScale(),c.options.elementPathEnabled||c.options.wordCount||c.options.scaleEnabled||(c.ui.getDom("elementpath").style.display="none",c.ui.getDom("wordcount").style.display="none",c.ui.getDom("scale").style.display="none"),c.selection.isFocus()&&c.fireEvent("selectionchange",!1,!0)}),c.addListener("mousedown",function(t,a){var c=a.target||a.srcElement;baidu.editor.ui.Popup.postHide(a,c),baidu.editor.ui.ShortCutMenu.postHide(a)}),c.addListener("delcells",function(){UE.ui.edittip&&new UE.ui.edittip(c),c.getDialog("edittip").open()});var g,b,y=!1;c.addListener("afterpaste",function(){c.queryCommandState("pasteplain")||(baidu.editor.ui.PastePicker&&(g=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:c}),editor:c,className:"edui-wordpastepop"}),g.render()),y=!0)}),c.addListener("afterinserthtml",function(){clearTimeout(b),b=setTimeout(function(){if(g&&(y||c.ui._isTransfer)){if(g.isHidden()){var a=v.createElement(c.document,"span",{style:"line-height:0px;",innerHTML:"﻿"}),h=c.selection.getRange();h.insertNode(a);var b=getDomNode(a,"firstChild","previousSibling");b&&g.showAnchor(3==b.nodeType?b.parentNode:b),v.remove(a)}else g.show();delete c.ui._isTransfer,y=!1}},200)}),c.addListener("contextmenu",function(t,a){baidu.editor.ui.Popup.postHide(a)}),c.addListener("keydown",function(t,a){g&&g.dispose(a);var c=a.keyCode||a.which;a.altKey&&90==c&&UE.ui.buttons.fullscreen.onclick()}),c.addListener("wordcount",function(){a(this,h)}),c.addListener("selectionchange",function(){c.options.elementPathEnabled&&h[(-1==c.queryCommandState("elementpath")?"dis":"en")+"ableElementPath"](),c.options.scaleEnabled&&h[(-1==c.queryCommandState("scale")?"dis":"en")+"ableScale"]()});var C=new baidu.editor.ui.Popup({editor:c,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide(),c.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(a){this.hide(),c.ui._dialogs[a]&&c.ui._dialogs[a].open()},_onImgSetFloat:function(a){this.hide(),c.execCommand("imagefloat",a)},_setIframeAlign:function(a){var c=C.anchorEl,h=c.cloneNode(!0);switch(a){case-2:h.setAttribute("align","");break;case-1:h.setAttribute("align","left");break;case 1:h.setAttribute("align","right")}c.parentNode.insertBefore(h,c),v.remove(c),C.anchorEl=h,C.showAnchor(C.anchorEl)},_updateIframe:function(){var a=c._iframe=C.anchorEl;v.hasClass(a,"ueditor_baidumap")?(c.selection.getRange().selectNode(a).select(),c.ui._dialogs.mapDialog.open(),C.hide()):(c.ui._dialogs.insertframeDialog.open(),C.hide())},_onRemoveButtonClick:function(a){c.execCommand(a),this.hide()},queryAutoHide:function(a){return a&&a.ownerDocument==c.document&&("img"==a.tagName.toLowerCase()||v.findParentByTagName(a,"a",!0))?a!==C.anchorEl:baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,a)}});C.render(),c.options.imagePopup&&(c.addListener("mouseover",function(t,a){a=a||window.event;var h=a.target||a.srcElement;if(c.ui._dialogs.insertframeDialog&&/iframe/gi.test(h.tagName)){var g=C.formatHtml("<nobr>"+c.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+c.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+c.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+c.getLang("justifyright")+'</span>&nbsp;&nbsp; <span onclick="$$._updateIframe( this);" class="edui-clickable">'+c.getLang("modify")+"</span></nobr>");g?(C.getDom("content").innerHTML=g,C.anchorEl=h,C.showAnchor(C.anchorEl)):C.hide()}}),c.addListener("selectionchange",function(t,a){if(a){var h="",g="",b=c.selection.getRange().getClosedNode(),y=c.ui._dialogs;if(b&&"IMG"==b.tagName){var N="insertimageDialog";if((-1!=b.className.indexOf("edui-faked-video")||-1!=b.className.indexOf("edui-upload-video"))&&(N="insertvideoDialog"),-1!=b.className.indexOf("edui-faked-webapp")&&(N="webappDialog"),-1!=b.src.indexOf("http://api.map.baidu.com")&&(N="mapDialog"),-1!=b.className.indexOf("edui-faked-music")&&(N="musicDialog"),-1!=b.src.indexOf("http://maps.google.com/maps/api/staticmap")&&(N="gmapDialog"),b.getAttribute("anchorname")&&(N="anchorDialog",h=C.formatHtml("<nobr>"+c.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+c.getLang("modify")+"</span>&nbsp;&nbsp;<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+c.getLang("delete")+"</span></nobr>")),b.getAttribute("word_img")&&(c.word_img=[b.getAttribute("word_img")],N="wordimageDialog"),(v.hasClass(b,"loadingclass")||v.hasClass(b,"loaderrorclass"))&&(N=""),!y[N])return;g="<nobr>"+c.getLang("property")+': <span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+c.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+c.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+c.getLang("justifyright")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+c.getLang("justifycenter")+"</span>&nbsp;&nbsp;<span onclick=\"$$._onImgEditButtonClick('"+N+'\');" class="edui-clickable">'+c.getLang("modify")+"</span></nobr>",!h&&(h=C.formatHtml(g))}if(c.ui._dialogs.linkDialog){var w,U=c.queryCommandValue("link");if(U&&(w=U.getAttribute("_href")||U.getAttribute("href",2))){var E=w;w.length>30&&(E=w.substring(0,20)+"..."),h&&(h+='<div style="height:5px;"></div>'),h+=C.formatHtml("<nobr>"+c.getLang("anthorMsg")+': <a target="_blank" href="'+w+'" title="'+w+'" >'+E+'</a> <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+c.getLang("modify")+'</span> <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+c.getLang("clear")+"</span></nobr>"),C.showAnchor(U)}}h?(C.getDom("content").innerHTML=h,C.anchorEl=b||U,C.showAnchor(C.anchorEl)):C.hide()}}))},_initToolbars:function(){for(var a=this.editor,h=this.toolbars||[],g=[],i=0;i<h.length;i++){for(var v=h[i],b=new baidu.editor.ui.Toolbar({theme:a.options.theme}),y=0;y<v.length;y++){var C=v[y],N=null;if("string"==typeof C){if(C=C.toLowerCase(),"|"==C&&(C="Separator"),"||"==C&&(C="Breakline"),baidu.editor.ui[C]&&(N=new baidu.editor.ui[C](a)),"fullscreen"==C){g&&g[0]?g[0].items.splice(0,0,N):N&&b.items.splice(0,0,N);continue}}else N=C;N&&N.id&&b.add(N)}g[i]=b}c.each(UE._customizeUI,function(c,h){var g,v;return c.id&&c.id!=a.key?!1:(g=c.execFn.call(a,a,h),void(g&&(v=c.index,void 0===v&&(v=b.items.length),b.add(g,v))))}),this.toolbars=g},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;"><div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+'</div><div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div><div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div><div style="height:0;overflow:hidden;clear:both;"></div></div><div id="##_message_holder" class="%%-messageholder"></div></div><div id="##_iframeholder" class="%%-iframeholder"></div><div id="##_bottombar" class="%%-bottomContainer"><table><tr><td id="##_elementpath" class="%%-bottombar"></td><td id="##_wordcount" class="%%-wordcount"></td><td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td></tr></table></div><div id="##_scalelayer"></div></div>'},showWordImageDialog:function(){this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){for(var a=[],i=0;i<this.toolbars.length;i++)a.push(this.toolbars[i].renderHtml());return a.join("")},setFullScreen:function(a){var c=this.editor,h=c.container.parentNode.parentNode;if(this._fullscreen!=a){if(this._fullscreen=a,this.editor.fireEvent("beforefullscreenchange",a),baidu.editor.browser.gecko)var g=c.selection.getRange().createBookmark();if(a){for(;"BODY"!=h.tagName;){var v=baidu.editor.dom.domUtils.getComputedStyle(h,"position");b.push(v),h.style.position="static",h=h.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow,this._bakBodyOverflow=document.body.style.overflow,this._bakAutoHeight=this.editor.autoHeightEnabled,this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop),this._bakEditorContaninerWidth=c.iframe.parentNode.offsetWidth,this._bakAutoHeight&&(c.autoHeightEnabled=!1,this.editor.disableAutoHeight()),document.documentElement.style.overflow="hidden",window.scrollTo(0,window.scrollY),this._bakCssText=this.getDom().style.cssText,this._bakCssText1=this.getDom("iframeholder").style.cssText,c.iframe.parentNode.style.width="",this._updateFullScreen()}else{for(;"BODY"!=h.tagName;)h.style.position=b.shift(),h=h.parentNode;this.getDom().style.cssText=this._bakCssText,this.getDom("iframeholder").style.cssText=this._bakCssText1,this._bakAutoHeight&&(c.autoHeightEnabled=!0,this.editor.enableAutoHeight()),document.documentElement.style.overflow=this._bakHtmlOverflow,document.body.style.overflow=this._bakBodyOverflow,c.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px",window.scrollTo(0,this._bakScrollTop)}if(browser.gecko&&"true"===c.body.contentEditable){var y=document.createElement("input");document.body.appendChild(y),c.body.contentEditable=!1,setTimeout(function(){y.focus(),setTimeout(function(){c.body.contentEditable=!0,c.fireEvent("fullscreenchanged",a),c.selection.getRange().moveToBookmark(g).select(!0),baidu.editor.dom.domUtils.remove(y),a&&window.scroll(0,0)},0)},0)}"true"===c.body.contentEditable&&(this.editor.fireEvent("fullscreenchanged",a),this.triggerLayout())}},_updateFullScreen:function(){if(this._fullscreen){var a=h.getViewportRect();if(this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+a.width+"px;height:"+a.height+"px;z-index:"+(1*this.getDom().style.zIndex+100),h.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0}),this.editor.setHeight(a.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0),!0),browser.gecko)try{window.onresize()}catch(e){}}},_updateElementPath:function(){var a,c=this.getDom("elementpath");if(this.elementPathEnabled&&(a=this.editor.queryCommandValue("elementpath"))){for(var h,g=[],i=0;h=a[i];i++)g[i]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+i+'&quot;);">'+h+"</span>");c.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+g.join(" &gt; ")+"</div>"}else c.style.display="none"},disableElementPath:function(){var a=this.getDom("elementpath");a.innerHTML="",a.style.display="none",this.elementPathEnabled=!1},enableElementPath:function(){var a=this.getDom("elementpath");a.style.display="",this.elementPathEnabled=!0,this._updateElementPath()},_scale:function(){function a(){k=v.getXY(C),B||(B=y.options.minFrameHeight+w.offsetHeight+U.offsetHeight),T.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+C.offsetWidth+"px;height:"+C.offsetHeight+"px;z-index:"+(y.options.zIndex+1),v.on(b,"mousemove",c),v.on(N,"mouseup",h),v.on(b,"mouseup",h)}function c(a){g();var e=a||window.event;_=e.pageX||b.documentElement.scrollLeft+e.clientX,A=e.pageY||b.documentElement.scrollTop+e.clientY,L=_-k.x,R=A-k.y,L>=I&&(S=!0,T.style.width=L+"px"),R>=B&&(S=!0,T.style.height=R+"px")}function h(){S&&(S=!1,y.ui._actualFrameWidth=T.offsetWidth-2,C.style.width=y.ui._actualFrameWidth+"px",y.setHeight(T.offsetHeight-U.offsetHeight-w.offsetHeight-2,!0)),T&&(T.style.display="none"),g(),v.un(b,"mousemove",c),v.un(N,"mouseup",h),v.un(b,"mouseup",h)}function g(){browser.ie?b.selection.clear():window.getSelection().removeAllRanges()}var b=document,y=this.editor,C=y.container,N=y.document,w=this.getDom("toolbarbox"),U=this.getDom("bottombar"),E=this.getDom("scale"),T=this.getDom("scalelayer"),S=!1,k=null,B=0,I=y.options.minFrameWidth,_=0,A=0,L=0,R=0,D=this;this.editor.addListener("fullscreenchanged",function(e,a){if(a)D.disableScale();else if(D.editor.options.scaleEnabled){D.enableScale();var c=D.editor.document.createElement("span");D.editor.body.appendChild(c),D.editor.body.style.height=Math.max(v.getXY(c).y,D.editor.iframe.offsetHeight-20)+"px",v.remove(c)}}),this.enableScale=function(){1!=y.queryCommandState("source")&&(E.style.display="",this.scaleEnabled=!0,v.on(E,"mousedown",a))},this.disableScale=function(){E.style.display="none",this.scaleEnabled=!1,v.un(E,"mousedown",a)}},isFullScreen:function(){return this._fullscreen},postRender:function(){g.prototype.postRender.call(this);for(var i=0;i<this.toolbars.length;i++)this.toolbars[i].postRender();var a,c=this,h=baidu.editor.dom.domUtils,v=function(){clearTimeout(a),a=setTimeout(function(){c._updateFullScreen()})};h.on(window,"resize",v),c.addListener("destroy",function(){h.un(window,"resize",v),clearTimeout(a)})},showToolbarMsg:function(a,c){if(this.getDom("toolbarmsg_label").innerHTML=a,this.getDom("toolbarmsg").style.display="",!c){var h=this.getDom("upload_dialog");h.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(a){return a?a.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var a=this.getDom();a.style.zoom="1"==a.style.zoom?"100%":"1"}},c.inherits(a,baidu.editor.ui.UIBase);var y={};UE.ui.Editor=function(h){var g=new UE.Editor(h);g.options.editor=g,c.loadFile(document,{href:g.options.themePath+g.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var b=g.render;return g.render=function(h){h.constructor===String&&(g.key=h,y[h]=g),c.domReady(function(){function c(){if(g.setOpt({labelMap:g.options.labelMap||g.getLang("labelMap")}),new a(g.options),h&&(h.constructor===String&&(h=document.getElementById(h)),h&&h.getAttribute("name")&&(g.options.textarea=h.getAttribute("name")),h&&/script|textarea/gi.test(h.tagName))){var c=document.createElement("div");h.parentNode.insertBefore(c,h);var y=h.value||h.innerHTML;g.options.initialContent=/^[\t\r\n ]*$/.test(y)?g.options.initialContent:y.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),h.className&&(c.className=h.className),h.style.cssText&&(c.style.cssText=h.style.cssText),/textarea/i.test(h.tagName)?(g.textarea=h,g.textarea.style.display="none"):h.parentNode.removeChild(h),h.id&&(c.id=h.id,v.removeAttributes(h,"id")),h=c,h.innerHTML=""}v.addClass(h,"edui-"+g.options.theme),g.ui.render(h);var C=g.options;g.container=g.ui.getDom();for(var N,w=v.findParents(h,!0),U=[],i=0;N=w[i];i++)U[i]=N.style.display,N.style.display="block";if(C.initialFrameWidth)C.minFrameWidth=C.initialFrameWidth;else{C.minFrameWidth=C.initialFrameWidth=h.offsetWidth;var E=h.style.width;/%$/.test(E)&&(C.initialFrameWidth=E)}C.initialFrameHeight?C.minFrameHeight=C.initialFrameHeight:C.initialFrameHeight=C.minFrameHeight=h.offsetHeight;for(var N,i=0;N=w[i];i++)N.style.display=U[i];h.style.height&&(h.style.height=""),g.container.style.width=C.initialFrameWidth+(/%$/.test(C.initialFrameWidth)?"":"px"),g.container.style.zIndex=C.zIndex,b.call(g,g.ui.getDom("iframeholder")),g.fireEvent("afteruiready")}g.langIsReady?c():g.addListener("langReady",c)})},g},UE.getEditor=function(a,c){var h=y[a];return h||(h=y[a]=new UE.ui.Editor(c),h.render(a)),h},UE.delEditor=function(a){var c;(c=y[a])&&(c.key&&c.destroy(),delete y[a])},UE.registerUI=function(a,h,g,v){c.each(a.split(/\s+/),function(a){UE._customizeUI[a]={id:v,execFn:h,index:g}})}}(),UE.registerUI("message",function(a){function c(){var a=y.ui.getDom("toolbarbox");a&&(h.style.top=a.offsetHeight+3+"px"),h.style.zIndex=Math.max(y.options.zIndex,y.iframe.style.zIndex)+1}var h,g=baidu.editor.ui,v=g.Message,b=[],y=a;y.addListener("ready",function(){h=document.getElementById(y.ui.id+"_message_holder"),c(),setTimeout(function(){c()},500)}),y.addListener("showmessage",function(a,g){g=utils.isString(g)?{content:g}:g;var C=new v({timeout:g.timeout,type:g.type,content:g.content,keepshow:g.keepshow,editor:y}),N=g.id||"msg_"+(+new Date).toString(36);return C.render(h),b[N]=C,C.reset(g),c(),N}),y.addListener("updatemessage",function(a,c,g){g=utils.isString(g)?{content:g}:g;var v=b[c];v.render(h),v&&v.reset(g)}),y.addListener("hidemessage",function(a,c){var h=b[c];h&&h.hide()})}),UE.registerUI("autosave",function(a){var c=null,h=null;a.on("afterautosave",function(){clearTimeout(c),c=setTimeout(function(){h&&a.trigger("hidemessage",h),h=a.trigger("showmessage",{content:a.getLang("autosave.success"),timeout:2e3})},2e3)})})}();